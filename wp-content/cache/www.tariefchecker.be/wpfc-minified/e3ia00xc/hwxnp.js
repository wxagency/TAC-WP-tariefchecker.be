!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";var n=[],r=e.document,i=Object.getPrototypeOf,o=n.slice,a=n.concat,s=n.push,u=n.indexOf,l={},c=l.toString,f=l.hasOwnProperty,p=f.toString,d=p.call(Object),h={},g=function e(t){return"function"==typeof t&&"number"!=typeof t.nodeType},y=function e(t){return null!=t&&t===t.window},v={type:!0,src:!0,noModule:!0};function m(e,t,n){var i,o=(t=t||r).createElement("script");if(o.text=e,n)for(i in v)n[i]&&(o[i]=n[i]);t.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[c.call(e)]||"object":typeof e}var b="3.3.1",w=function(e,t){return new w.fn.init(e,t)},T=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;w.fn=w.prototype={jquery:"3.3.1",constructor:w,length:0,toArray:function(){return o.call(this)},get:function(e){return null==e?o.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return w.each(this,e)},map:function(e){return this.pushStack(w.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:n.sort,splice:n.splice},w.extend=w.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||g(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],a!==(r=e[t])&&(l&&r&&(w.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,o=n&&Array.isArray(n)?n:[]):o=n&&w.isPlainObject(n)?n:{},a[t]=w.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},w.extend({expando:"jQuery"+("3.3.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==c.call(e))&&(!(t=i(e))||"function"==typeof(n=f.call(t,"constructor")&&t.constructor)&&p.call(n)===d)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e){m(e)},each:function(e,t){var n,r=0;if(C(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(T,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(C(Object(e))?w.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:u.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],o=0,a=e.length,s=!n;o<a;o++)(r=!t(e[o],o))!==s&&i.push(e[o]);return i},map:function(e,t,n){var r,i,o=0,s=[];if(C(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&s.push(i);return a.apply([],s)},guid:1,support:h}),"function"==typeof Symbol&&(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});function C(e){var t=!!e&&"length"in e&&e.length,n=x(e);return!g(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}var E=function(e){var t,n,r,i,o,a,s,u,l,c,f,p,d,h,g,y,v,m,x,b="sizzle"+1*new Date,w=e.document,T=0,C=0,E=ae(),k=ae(),S=ae(),D=function(e,t){return e===t&&(f=!0),0},N={}.hasOwnProperty,A=[],j=A.pop,q=A.push,L=A.push,H=A.slice,O=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},P="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",R="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",I="\\["+M+"*("+R+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+R+"))|)"+M+"*\\]",W=":("+R+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+I+")*)|.*)\\)|)",$=new RegExp(M+"+","g"),B=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),F=new RegExp("^"+M+"*,"+M+"*"),_=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),z=new RegExp("="+M+"*([^\\]'\"]*?)"+M+"*\\]","g"),X=new RegExp(W),U=new RegExp("^"+R+"$"),V={ID:new RegExp("^#("+R+")"),CLASS:new RegExp("^\\.("+R+")"),TAG:new RegExp("^("+R+"|[*])"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+W),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+P+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},G=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,K=/[+~]/,Z=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),ee=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},te=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ne=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},re=function(){p()},ie=me(function(e){return!0===e.disabled&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{L.apply(A=H.call(w.childNodes),w.childNodes),A[w.childNodes.length].nodeType}catch(e){L={apply:A.length?function(e,t){q.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function oe(e,t,r,i){var o,s,l,c,f,h,v,m=t&&t.ownerDocument,T=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==T&&9!==T&&11!==T)return r;if(!i&&((t?t.ownerDocument||t:w)!==d&&p(t),t=t||d,g)){if(11!==T&&(f=J.exec(e)))if(o=f[1]){if(9===T){if(!(l=t.getElementById(o)))return r;if(l.id===o)return r.push(l),r}else if(m&&(l=m.getElementById(o))&&x(t,l)&&l.id===o)return r.push(l),r}else{if(f[2])return L.apply(r,t.getElementsByTagName(e)),r;if((o=f[3])&&n.getElementsByClassName&&t.getElementsByClassName)return L.apply(r,t.getElementsByClassName(o)),r}if(n.qsa&&!S[e+" "]&&(!y||!y.test(e))){if(1!==T)m=t,v=e;else if("object"!==t.nodeName.toLowerCase()){(c=t.getAttribute("id"))?c=c.replace(te,ne):t.setAttribute("id",c=b),s=(h=a(e)).length;while(s--)h[s]="#"+c+" "+ve(h[s]);v=h.join(","),m=K.test(e)&&ge(t.parentNode)||t}if(v)try{return L.apply(r,m.querySelectorAll(v)),r}catch(e){}finally{c===b&&t.removeAttribute("id")}}}return u(e.replace(B,"$1"),t,r,i)}function ae(){var e=[];function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}return t}function se(e){return e[b]=!0,e}function ue(e){var t=d.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function le(e,t){var n=e.split("|"),i=n.length;while(i--)r.attrHandle[n[i]]=t}function ce(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function fe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function pe(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function de(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ie(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function he(e){return se(function(t){return t=+t,se(function(n,r){var i,o=e([],n.length,t),a=o.length;while(a--)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function ge(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}n=oe.support={},o=oe.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},p=oe.setDocument=function(e){var t,i,a=e?e.ownerDocument||e:w;return a!==d&&9===a.nodeType&&a.documentElement?(d=a,h=d.documentElement,g=!o(d),w!==d&&(i=d.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",re,!1):i.attachEvent&&i.attachEvent("onunload",re)),n.attributes=ue(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ue(function(e){return e.appendChild(d.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Q.test(d.getElementsByClassName),n.getById=ue(function(e){return h.appendChild(e).id=b,!d.getElementsByName||!d.getElementsByName(b).length}),n.getById?(r.filter.ID=function(e){var t=e.replace(Z,ee);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&g){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(Z,ee);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},r.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&g){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},r.find.CLASS=n.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&g)return t.getElementsByClassName(e)},v=[],y=[],(n.qsa=Q.test(d.querySelectorAll))&&(ue(function(e){h.appendChild(e).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&y.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||y.push("\\["+M+"*(?:value|"+P+")"),e.querySelectorAll("[id~="+b+"-]").length||y.push("~="),e.querySelectorAll(":checked").length||y.push(":checked"),e.querySelectorAll("a#"+b+"+*").length||y.push(".#.+[+~]")}),ue(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=d.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&y.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&y.push(":enabled",":disabled"),h.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&y.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),y.push(",.*:")})),(n.matchesSelector=Q.test(m=h.matches||h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ue(function(e){n.disconnectedMatch=m.call(e,"*"),m.call(e,"[s!='']:x"),v.push("!=",W)}),y=y.length&&new RegExp(y.join("|")),v=v.length&&new RegExp(v.join("|")),t=Q.test(h.compareDocumentPosition),x=t||Q.test(h.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},D=t?function(e,t){if(e===t)return f=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===d||e.ownerDocument===w&&x(w,e)?-1:t===d||t.ownerDocument===w&&x(w,t)?1:c?O(c,e)-O(c,t):0:4&r?-1:1)}:function(e,t){if(e===t)return f=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e===d?-1:t===d?1:i?-1:o?1:c?O(c,e)-O(c,t):0;if(i===o)return ce(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?ce(a[r],s[r]):a[r]===w?-1:s[r]===w?1:0},d):d},oe.matches=function(e,t){return oe(e,null,null,t)},oe.matchesSelector=function(e,t){if((e.ownerDocument||e)!==d&&p(e),t=t.replace(z,"='$1']"),n.matchesSelector&&g&&!S[t+" "]&&(!v||!v.test(t))&&(!y||!y.test(t)))try{var r=m.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return oe(t,d,null,[e]).length>0},oe.contains=function(e,t){return(e.ownerDocument||e)!==d&&p(e),x(e,t)},oe.attr=function(e,t){(e.ownerDocument||e)!==d&&p(e);var i=r.attrHandle[t.toLowerCase()],o=i&&N.call(r.attrHandle,t.toLowerCase())?i(e,t,!g):void 0;return void 0!==o?o:n.attributes||!g?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},oe.escape=function(e){return(e+"").replace(te,ne)},oe.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},oe.uniqueSort=function(e){var t,r=[],i=0,o=0;if(f=!n.detectDuplicates,c=!n.sortStable&&e.slice(0),e.sort(D),f){while(t=e[o++])t===e[o]&&(i=r.push(o));while(i--)e.splice(r[i],1)}return c=null,e},i=oe.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===o||4===o)return e.nodeValue}else while(t=e[r++])n+=i(t);return n},(r=oe.selectors={cacheLength:50,createPseudo:se,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Z,ee),e[3]=(e[3]||e[4]||e[5]||"").replace(Z,ee),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||oe.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&oe.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return V.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=a(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Z,ee).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=E[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&E(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=oe.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace($," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,f,p,d,h,g=o!==a?"nextSibling":"previousSibling",y=t.parentNode,v=s&&t.nodeName.toLowerCase(),m=!u&&!s,x=!1;if(y){if(o){while(g){p=t;while(p=p[g])if(s?p.nodeName.toLowerCase()===v:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?y.firstChild:y.lastChild],a&&m){x=(d=(l=(c=(f=(p=y)[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]||[])[0]===T&&l[1])&&l[2],p=d&&y.childNodes[d];while(p=++d&&p&&p[g]||(x=d=0)||h.pop())if(1===p.nodeType&&++x&&p===t){c[e]=[T,d,x];break}}else if(m&&(x=d=(l=(c=(f=(p=t)[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]||[])[0]===T&&l[1]),!1===x)while(p=++d&&p&&p[g]||(x=d=0)||h.pop())if((s?p.nodeName.toLowerCase()===v:1===p.nodeType)&&++x&&(m&&((c=(f=p[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]=[T,x]),p===t))break;return(x-=i)===r||x%r==0&&x/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||oe.error("unsupported pseudo: "+e);return i[b]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?se(function(e,n){var r,o=i(e,t),a=o.length;while(a--)e[r=O(e,o[a])]=!(n[r]=o[a])}):function(e){return i(e,0,n)}):i}},pseudos:{not:se(function(e){var t=[],n=[],r=s(e.replace(B,"$1"));return r[b]?se(function(e,t,n,i){var o,a=r(e,null,i,[]),s=e.length;while(s--)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),t[0]=null,!n.pop()}}),has:se(function(e){return function(t){return oe(e,t).length>0}}),contains:se(function(e){return e=e.replace(Z,ee),function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:se(function(e){return U.test(e||"")||oe.error("unsupported lang: "+e),e=e.replace(Z,ee).toLowerCase(),function(t){var n;do{if(n=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:de(!1),disabled:de(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return Y.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:he(function(){return[0]}),last:he(function(e,t){return[t-1]}),eq:he(function(e,t,n){return[n<0?n+t:n]}),even:he(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:he(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:he(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:he(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=fe(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=pe(t);function ye(){}ye.prototype=r.filters=r.pseudos,r.setFilters=new ye,a=oe.tokenize=function(e,t){var n,i,o,a,s,u,l,c=k[e+" "];if(c)return t?0:c.slice(0);s=e,u=[],l=r.preFilter;while(s){n&&!(i=F.exec(s))||(i&&(s=s.slice(i[0].length)||s),u.push(o=[])),n=!1,(i=_.exec(s))&&(n=i.shift(),o.push({value:n,type:i[0].replace(B," ")}),s=s.slice(n.length));for(a in r.filter)!(i=V[a].exec(s))||l[a]&&!(i=l[a](i))||(n=i.shift(),o.push({value:n,type:a,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?oe.error(e):k(e,u).slice(0)};function ve(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function me(e,t,n){var r=t.dir,i=t.next,o=i||r,a=n&&"parentNode"===o,s=C++;return t.first?function(t,n,i){while(t=t[r])if(1===t.nodeType||a)return e(t,n,i);return!1}:function(t,n,u){var l,c,f,p=[T,s];if(u){while(t=t[r])if((1===t.nodeType||a)&&e(t,n,u))return!0}else while(t=t[r])if(1===t.nodeType||a)if(f=t[b]||(t[b]={}),c=f[t.uniqueID]||(f[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((l=c[o])&&l[0]===T&&l[1]===s)return p[2]=l[2];if(c[o]=p,p[2]=e(t,n,u))return!0}return!1}}function xe(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function be(e,t,n){for(var r=0,i=t.length;r<i;r++)oe(e,t[r],n);return n}function we(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Te(e,t,n,r,i,o){return r&&!r[b]&&(r=Te(r)),i&&!i[b]&&(i=Te(i,o)),se(function(o,a,s,u){var l,c,f,p=[],d=[],h=a.length,g=o||be(t||"*",s.nodeType?[s]:s,[]),y=!e||!o&&t?g:we(g,p,e,s,u),v=n?i||(o?e:h||r)?[]:a:y;if(n&&n(y,v,s,u),r){l=we(v,d),r(l,[],s,u),c=l.length;while(c--)(f=l[c])&&(v[d[c]]=!(y[d[c]]=f))}if(o){if(i||e){if(i){l=[],c=v.length;while(c--)(f=v[c])&&l.push(y[c]=f);i(null,v=[],l,u)}c=v.length;while(c--)(f=v[c])&&(l=i?O(o,f):p[c])>-1&&(o[l]=!(a[l]=f))}}else v=we(v===a?v.splice(h,v.length):v),i?i(null,a,v,u):L.apply(a,v)})}function Ce(e){for(var t,n,i,o=e.length,a=r.relative[e[0].type],s=a||r.relative[" "],u=a?1:0,c=me(function(e){return e===t},s,!0),f=me(function(e){return O(t,e)>-1},s,!0),p=[function(e,n,r){var i=!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):f(e,n,r));return t=null,i}];u<o;u++)if(n=r.relative[e[u].type])p=[me(xe(p),n)];else{if((n=r.filter[e[u].type].apply(null,e[u].matches))[b]){for(i=++u;i<o;i++)if(r.relative[e[i].type])break;return Te(u>1&&xe(p),u>1&&ve(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace(B,"$1"),n,u<i&&Ce(e.slice(u,i)),i<o&&Ce(e=e.slice(i)),i<o&&ve(e))}p.push(n)}return xe(p)}function Ee(e,t){var n=t.length>0,i=e.length>0,o=function(o,a,s,u,c){var f,h,y,v=0,m="0",x=o&&[],b=[],w=l,C=o||i&&r.find.TAG("*",c),E=T+=null==w?1:Math.random()||.1,k=C.length;for(c&&(l=a===d||a||c);m!==k&&null!=(f=C[m]);m++){if(i&&f){h=0,a||f.ownerDocument===d||(p(f),s=!g);while(y=e[h++])if(y(f,a||d,s)){u.push(f);break}c&&(T=E)}n&&((f=!y&&f)&&v--,o&&x.push(f))}if(v+=m,n&&m!==v){h=0;while(y=t[h++])y(x,b,a,s);if(o){if(v>0)while(m--)x[m]||b[m]||(b[m]=j.call(u));b=we(b)}L.apply(u,b),c&&!o&&b.length>0&&v+t.length>1&&oe.uniqueSort(u)}return c&&(T=E,l=w),x};return n?se(o):o}return s=oe.compile=function(e,t){var n,r=[],i=[],o=S[e+" "];if(!o){t||(t=a(e)),n=t.length;while(n--)(o=Ce(t[n]))[b]?r.push(o):i.push(o);(o=S(e,Ee(i,r))).selector=e}return o},u=oe.select=function(e,t,n,i){var o,u,l,c,f,p="function"==typeof e&&e,d=!i&&a(e=p.selector||e);if(n=n||[],1===d.length){if((u=d[0]=d[0].slice(0)).length>2&&"ID"===(l=u[0]).type&&9===t.nodeType&&g&&r.relative[u[1].type]){if(!(t=(r.find.ID(l.matches[0].replace(Z,ee),t)||[])[0]))return n;p&&(t=t.parentNode),e=e.slice(u.shift().value.length)}o=V.needsContext.test(e)?0:u.length;while(o--){if(l=u[o],r.relative[c=l.type])break;if((f=r.find[c])&&(i=f(l.matches[0].replace(Z,ee),K.test(u[0].type)&&ge(t.parentNode)||t))){if(u.splice(o,1),!(e=i.length&&ve(u)))return L.apply(n,i),n;break}}}return(p||s(e,d))(i,t,!g,n,!t||K.test(e)&&ge(t.parentNode)||t),n},n.sortStable=b.split("").sort(D).join("")===b,n.detectDuplicates=!!f,p(),n.sortDetached=ue(function(e){return 1&e.compareDocumentPosition(d.createElement("fieldset"))}),ue(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||le("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ue(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||le("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ue(function(e){return null==e.getAttribute("disabled")})||le(P,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),oe}(e);w.find=E,w.expr=E.selectors,w.expr[":"]=w.expr.pseudos,w.uniqueSort=w.unique=E.uniqueSort,w.text=E.getText,w.isXMLDoc=E.isXML,w.contains=E.contains,w.escapeSelector=E.escape;var k=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&w(e).is(n))break;r.push(e)}return r},S=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},D=w.expr.match.needsContext;function N(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var A=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,t,n){return g(t)?w.grep(e,function(e,r){return!!t.call(e,r,e)!==n}):t.nodeType?w.grep(e,function(e){return e===t!==n}):"string"!=typeof t?w.grep(e,function(e){return u.call(t,e)>-1!==n}):w.filter(t,e,n)}w.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?w.find.matchesSelector(r,e)?[r]:[]:w.find.matches(e,w.grep(t,function(e){return 1===e.nodeType}))},w.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(w(e).filter(function(){for(t=0;t<r;t++)if(w.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)w.find(e,i[t],n);return r>1?w.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&D.test(e)?w(e):e||[],!1).length}});var q,L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(w.fn.init=function(e,t,n){var i,o;if(!e)return this;if(n=n||q,"string"==typeof e){if(!(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:L.exec(e))||!i[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof w?t[0]:t,w.merge(this,w.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:r,!0)),A.test(i[1])&&w.isPlainObject(t))for(i in t)g(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return(o=r.getElementById(i[2]))&&(this[0]=o,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):g(e)?void 0!==n.ready?n.ready(e):e(w):w.makeArray(e,this)}).prototype=w.fn,q=w(r);var H=/^(?:parents|prev(?:Until|All))/,O={children:!0,contents:!0,next:!0,prev:!0};w.fn.extend({has:function(e){var t=w(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(w.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&w(e);if(!D.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&w.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?w.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?u.call(w(e),this[0]):u.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(w.uniqueSort(w.merge(this.get(),w(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});function P(e,t){while((e=e[t])&&1!==e.nodeType);return e}w.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return k(e,"parentNode")},parentsUntil:function(e,t,n){return k(e,"parentNode",n)},next:function(e){return P(e,"nextSibling")},prev:function(e){return P(e,"previousSibling")},nextAll:function(e){return k(e,"nextSibling")},prevAll:function(e){return k(e,"previousSibling")},nextUntil:function(e,t,n){return k(e,"nextSibling",n)},prevUntil:function(e,t,n){return k(e,"previousSibling",n)},siblings:function(e){return S((e.parentNode||{}).firstChild,e)},children:function(e){return S(e.firstChild)},contents:function(e){return N(e,"iframe")?e.contentDocument:(N(e,"template")&&(e=e.content||e),w.merge([],e.childNodes))}},function(e,t){w.fn[e]=function(n,r){var i=w.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=w.filter(r,i)),this.length>1&&(O[e]||w.uniqueSort(i),H.test(e)&&i.reverse()),this.pushStack(i)}});var M=/[^\x20\t\r\n\f]+/g;function R(e){var t={};return w.each(e.match(M)||[],function(e,n){t[n]=!0}),t}w.Callbacks=function(e){e="string"==typeof e?R(e):w.extend({},e);var t,n,r,i,o=[],a=[],s=-1,u=function(){for(i=i||e.once,r=t=!0;a.length;s=-1){n=a.shift();while(++s<o.length)!1===o[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=o.length,n=!1)}e.memory||(n=!1),t=!1,i&&(o=n?[]:"")},l={add:function(){return o&&(n&&!t&&(s=o.length-1,a.push(n)),function t(n){w.each(n,function(n,r){g(r)?e.unique&&l.has(r)||o.push(r):r&&r.length&&"string"!==x(r)&&t(r)})}(arguments),n&&!t&&u()),this},remove:function(){return w.each(arguments,function(e,t){var n;while((n=w.inArray(t,o,n))>-1)o.splice(n,1),n<=s&&s--}),this},has:function(e){return e?w.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return i=a=[],o=n="",this},disabled:function(){return!o},lock:function(){return i=a=[],n||t||(o=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=[e,(n=n||[]).slice?n.slice():n],a.push(n),t||u()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l};function I(e){return e}function W(e){throw e}function $(e,t,n,r){var i;try{e&&g(i=e.promise)?i.call(e).done(t).fail(n):e&&g(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}w.extend({Deferred:function(t){var n=[["notify","progress",w.Callbacks("memory"),w.Callbacks("memory"),2],["resolve","done",w.Callbacks("once memory"),w.Callbacks("once memory"),0,"resolved"],["reject","fail",w.Callbacks("once memory"),w.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},"catch":function(e){return i.then(null,e)},pipe:function(){var e=arguments;return w.Deferred(function(t){w.each(n,function(n,r){var i=g(e[r[4]])&&e[r[4]];o[r[1]](function(){var e=i&&i.apply(this,arguments);e&&g(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,i?[e]:arguments)})}),e=null}).promise()},then:function(t,r,i){var o=0;function a(t,n,r,i){return function(){var s=this,u=arguments,l=function(){var e,l;if(!(t<o)){if((e=r.apply(s,u))===n.promise())throw new TypeError("Thenable self-resolution");l=e&&("object"==typeof e||"function"==typeof e)&&e.then,g(l)?i?l.call(e,a(o,n,I,i),a(o,n,W,i)):(o++,l.call(e,a(o,n,I,i),a(o,n,W,i),a(o,n,I,n.notifyWith))):(r!==I&&(s=void 0,u=[e]),(i||n.resolveWith)(s,u))}},c=i?l:function(){try{l()}catch(e){w.Deferred.exceptionHook&&w.Deferred.exceptionHook(e,c.stackTrace),t+1>=o&&(r!==W&&(s=void 0,u=[e]),n.rejectWith(s,u))}};t?c():(w.Deferred.getStackHook&&(c.stackTrace=w.Deferred.getStackHook()),e.setTimeout(c))}}return w.Deferred(function(e){n[0][3].add(a(0,e,g(i)?i:I,e.notifyWith)),n[1][3].add(a(0,e,g(t)?t:I)),n[2][3].add(a(0,e,g(r)?r:W))}).promise()},promise:function(e){return null!=e?w.extend(e,i):i}},o={};return w.each(n,function(e,t){var a=t[2],s=t[5];i[t[1]]=a.add,s&&a.add(function(){r=s},n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),a.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=a.fireWith}),i.promise(o),t&&t.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),i=o.call(arguments),a=w.Deferred(),s=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?o.call(arguments):n,--t||a.resolveWith(r,i)}};if(t<=1&&($(e,a.done(s(n)).resolve,a.reject,!t),"pending"===a.state()||g(i[n]&&i[n].then)))return a.then();while(n--)$(i[n],s(n),a.reject);return a.promise()}});var B=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;w.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&B.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},w.readyException=function(t){e.setTimeout(function(){throw t})};var F=w.Deferred();w.fn.ready=function(e){return F.then(e)["catch"](function(e){w.readyException(e)}),this},w.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--w.readyWait:w.isReady)||(w.isReady=!0,!0!==e&&--w.readyWait>0||F.resolveWith(r,[w]))}}),w.ready.then=F.then;function _(){r.removeEventListener("DOMContentLoaded",_),e.removeEventListener("load",_),w.ready()}"complete"===r.readyState||"loading"!==r.readyState&&!r.documentElement.doScroll?e.setTimeout(w.ready):(r.addEventListener("DOMContentLoaded",_),e.addEventListener("load",_));var z=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===x(n)){i=!0;for(s in n)z(e,t,s,n[s],!0,o,a)}else if(void 0!==r&&(i=!0,g(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(w(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},X=/^-ms-/,U=/-([a-z])/g;function V(e,t){return t.toUpperCase()}function G(e){return e.replace(X,"ms-").replace(U,V)}var Y=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function Q(){this.expando=w.expando+Q.uid++}Q.uid=1,Q.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Y(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[G(t)]=n;else for(r in t)i[G(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][G(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(G):(t=G(t))in r?[t]:t.match(M)||[]).length;while(n--)delete r[t[n]]}(void 0===t||w.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!w.isEmptyObject(t)}};var J=new Q,K=new Q,Z=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ee=/[A-Z]/g;function te(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Z.test(e)?JSON.parse(e):e)}function ne(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(ee,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n=te(n)}catch(e){}K.set(e,t,n)}else n=void 0;return n}w.extend({hasData:function(e){return K.hasData(e)||J.hasData(e)},data:function(e,t,n){return K.access(e,t,n)},removeData:function(e,t){K.remove(e,t)},_data:function(e,t,n){return J.access(e,t,n)},_removeData:function(e,t){J.remove(e,t)}}),w.fn.extend({data:function(e,t){var n,r,i,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(i=K.get(o),1===o.nodeType&&!J.get(o,"hasDataAttrs"))){n=a.length;while(n--)a[n]&&0===(r=a[n].name).indexOf("data-")&&(r=G(r.slice(5)),ne(o,r,i[r]));J.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each(function(){K.set(this,e)}):z(this,function(t){var n;if(o&&void 0===t){if(void 0!==(n=K.get(o,e)))return n;if(void 0!==(n=ne(o,e)))return n}else this.each(function(){K.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){K.remove(this,e)})}}),w.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=J.get(e,t),n&&(!r||Array.isArray(n)?r=J.access(e,t,w.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=w.queue(e,t),r=n.length,i=n.shift(),o=w._queueHooks(e,t),a=function(){w.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return J.get(e,n)||J.access(e,n,{empty:w.Callbacks("once memory").add(function(){J.remove(e,[t+"queue",n])})})}}),w.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?w.queue(this[0],e):void 0===t?this:this.each(function(){var n=w.queue(this,e,t);w._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&w.dequeue(this,e)})},dequeue:function(e){return this.each(function(){w.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=w.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=J.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var re=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ie=new RegExp("^(?:([+-])=|)("+re+")([a-z%]*)$","i"),oe=["Top","Right","Bottom","Left"],ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&w.contains(e.ownerDocument,e)&&"none"===w.css(e,"display")},se=function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i};function ue(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return w.css(e,t,"")},u=s(),l=n&&n[3]||(w.cssNumber[t]?"":"px"),c=(w.cssNumber[t]||"px"!==l&&+u)&&ie.exec(w.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)w.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,w.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var le={};function ce(e){var t,n=e.ownerDocument,r=e.nodeName,i=le[r];return i||(t=n.body.appendChild(n.createElement(r)),i=w.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),le[r]=i,i)}function fe(e,t){for(var n,r,i=[],o=0,a=e.length;o<a;o++)(r=e[o]).style&&(n=r.style.display,t?("none"===n&&(i[o]=J.get(r,"display")||null,i[o]||(r.style.display="")),""===r.style.display&&ae(r)&&(i[o]=ce(r))):"none"!==n&&(i[o]="none",J.set(r,"display",n)));for(o=0;o<a;o++)null!=i[o]&&(e[o].style.display=i[o]);return e}w.fn.extend({show:function(){return fe(this,!0)},hide:function(){return fe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?w(this).show():w(this).hide()})}});var pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,he=/^$|^module$|\/(?:java|ecma)script/i,ge={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ge.optgroup=ge.option,ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td;function ye(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&N(e,t)?w.merge([e],n):n}function ve(e,t){for(var n=0,r=e.length;n<r;n++)J.set(e[n],"globalEval",!t||J.get(t[n],"globalEval"))}var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===x(o))w.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+w.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;w.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&w.inArray(o,r)>-1)i&&i.push(o);else if(l=w.contains(o.ownerDocument,o),a=ye(f.appendChild(o),"script"),l&&ve(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}!function(){var e=r.createDocumentFragment().appendChild(r.createElement("div")),t=r.createElement("input");t.setAttribute("type","radio"),t.setAttribute("checked","checked"),t.setAttribute("name","t"),e.appendChild(t),h.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",h.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var be=r.documentElement,we=/^key/,Te=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ce=/^([^.]*)(?:\.(.+)|)/;function Ee(){return!0}function ke(){return!1}function Se(){try{return r.activeElement}catch(e){}}function De(e,t,n,r,i,o){var a,s;if("object"==typeof t){"string"!=typeof n&&(r=r||n,n=void 0);for(s in t)De(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=ke;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return w().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=w.guid++)),e.each(function(){w.event.add(this,t,i,r,n)})}w.event={global:{},add:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,y=J.get(e);if(y){n.handler&&(n=(o=n).handler,i=o.selector),i&&w.find.matchesSelector(be,i),n.guid||(n.guid=w.guid++),(u=y.events)||(u=y.events={}),(a=y.handle)||(a=y.handle=function(t){return"undefined"!=typeof w&&w.event.triggered!==t.type?w.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(M)||[""]).length;while(l--)d=g=(s=Ce.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=w.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=w.event.special[d]||{},c=w.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&w.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(e,r,h,a)||e.addEventListener&&e.addEventListener(d,a)),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),w.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,y=J.hasData(e)&&J.get(e);if(y&&(u=y.events)){l=(t=(t||"").match(M)||[""]).length;while(l--)if(s=Ce.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){f=w.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,y.handle)||w.removeEvent(e,d,y.handle),delete u[d])}else for(d in u)w.event.remove(e,d+t[l],n,r,!0);w.isEmptyObject(u)&&J.remove(e,"handle events")}},dispatch:function(e){var t=w.event.fix(e),n,r,i,o,a,s,u=new Array(arguments.length),l=(J.get(this,"events")||{})[t.type]||[],c=w.event.special[t.type]||{};for(u[0]=t,n=1;n<arguments.length;n++)u[n]=arguments[n];if(t.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,t)){s=w.event.handlers.call(this,t,l),n=0;while((o=s[n++])&&!t.isPropagationStopped()){t.currentTarget=o.elem,r=0;while((a=o.handlers[r++])&&!t.isImmediatePropagationStopped())t.rnamespace&&!t.rnamespace.test(a.namespace)||(t.handleObj=a,t.data=a.data,void 0!==(i=((w.event.special[a.origType]||{}).handle||a.handler).apply(o.elem,u))&&!1===(t.result=i)&&(t.preventDefault(),t.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,t),t.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&e.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?w(i,this).index(l)>-1:w.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(e,t){Object.defineProperty(w.Event.prototype,e,{enumerable:!0,configurable:!0,get:g(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[w.expando]?e:new w.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==Se()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===Se()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&N(this,"input"))return this.click(),!1},_default:function(e){return N(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},w.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},w.Event=function(e,t){if(!(this instanceof w.Event))return new w.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ee:ke,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&w.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[w.expando]=!0},w.Event.prototype={constructor:w.Event,isDefaultPrevented:ke,isPropagationStopped:ke,isImmediatePropagationStopped:ke,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ee,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ee,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ee,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},w.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&we.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Te.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},w.event.addProp),w.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){w.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return i&&(i===r||w.contains(r,i))||(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),w.fn.extend({on:function(e,t,n,r){return De(this,e,t,n,r)},one:function(e,t,n,r){return De(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,w(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=ke),this.each(function(){w.event.remove(this,e,n,t)})}});var Ne=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Ae=/<script|<style|<link/i,je=/checked\s*(?:[^=]|=\s*.checked.)/i,qe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Le(e,t){return N(e,"table")&&N(11!==t.nodeType?t:t.firstChild,"tr")?w(e).children("tbody")[0]||e:e}function He(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Oe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Pe(e,t){var n,r,i,o,a,s,u,l;if(1===t.nodeType){if(J.hasData(e)&&(o=J.access(e),a=J.set(t,o),l=o.events)){delete a.handle,a.events={};for(i in l)for(n=0,r=l[i].length;n<r;n++)w.event.add(t,i,l[i][n])}K.hasData(e)&&(s=K.access(e),u=w.extend({},s),K.set(t,u))}}function Me(e,t){var n=t.nodeName.toLowerCase();"input"===n&&pe.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function Re(e,t,n,r){t=a.apply([],t);var i,o,s,u,l,c,f=0,p=e.length,d=p-1,y=t[0],v=g(y);if(v||p>1&&"string"==typeof y&&!h.checkClone&&je.test(y))return e.each(function(i){var o=e.eq(i);v&&(t[0]=y.call(this,i,o.html())),Re(o,t,n,r)});if(p&&(i=xe(t,e[0].ownerDocument,!1,e,r),o=i.firstChild,1===i.childNodes.length&&(i=o),o||r)){for(u=(s=w.map(ye(i,"script"),He)).length;f<p;f++)l=i,f!==d&&(l=w.clone(l,!0,!0),u&&w.merge(s,ye(l,"script"))),n.call(e[f],l,f);if(u)for(c=s[s.length-1].ownerDocument,w.map(s,Oe),f=0;f<u;f++)l=s[f],he.test(l.type||"")&&!J.access(l,"globalEval")&&w.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?w._evalUrl&&w._evalUrl(l.src):m(l.textContent.replace(qe,""),c,l))}return e}function Ie(e,t,n){for(var r,i=t?w.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||w.cleanData(ye(r)),r.parentNode&&(n&&w.contains(r.ownerDocument,r)&&ve(ye(r,"script")),r.parentNode.removeChild(r));return e}w.extend({htmlPrefilter:function(e){return e.replace(Ne,"<$1></$2>")},clone:function(e,t,n){var r,i,o,a,s=e.cloneNode(!0),u=w.contains(e.ownerDocument,e);if(!(h.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||w.isXMLDoc(e)))for(a=ye(s),r=0,i=(o=ye(e)).length;r<i;r++)Me(o[r],a[r]);if(t)if(n)for(o=o||ye(e),a=a||ye(s),r=0,i=o.length;r<i;r++)Pe(o[r],a[r]);else Pe(e,s);return(a=ye(s,"script")).length>0&&ve(a,!u&&ye(e,"script")),s},cleanData:function(e){for(var t,n,r,i=w.event.special,o=0;void 0!==(n=e[o]);o++)if(Y(n)){if(t=n[J.expando]){if(t.events)for(r in t.events)i[r]?w.event.remove(n,r):w.removeEvent(n,r,t.handle);n[J.expando]=void 0}n[K.expando]&&(n[K.expando]=void 0)}}}),w.fn.extend({detach:function(e){return Ie(this,e,!0)},remove:function(e){return Ie(this,e)},text:function(e){return z(this,function(e){return void 0===e?w.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Re(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Le(this,e).appendChild(e)})},prepend:function(){return Re(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Le(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Re(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Re(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(w.cleanData(ye(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return w.clone(this,e,t)})},html:function(e){return z(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ae.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=w.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(w.cleanData(ye(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return Re(this,arguments,function(t){var n=this.parentNode;w.inArray(this,e)<0&&(w.cleanData(ye(this)),n&&n.replaceChild(t,this))},e)}}),w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){w.fn[e]=function(e){for(var n,r=[],i=w(e),o=i.length-1,a=0;a<=o;a++)n=a===o?this:this.clone(!0),w(i[a])[t](n),s.apply(r,n.get());return this.pushStack(r)}});var We=new RegExp("^("+re+")(?!px)[a-z%]+$","i"),$e=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},Be=new RegExp(oe.join("|"),"i");!function(){function t(){if(c){l.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",be.appendChild(l).appendChild(c);var t=e.getComputedStyle(c);i="1%"!==t.top,u=12===n(t.marginLeft),c.style.right="60%",s=36===n(t.right),o=36===n(t.width),c.style.position="absolute",a=36===c.offsetWidth||"absolute",be.removeChild(l),c=null}}function n(e){return Math.round(parseFloat(e))}var i,o,a,s,u,l=r.createElement("div"),c=r.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",h.clearCloneStyle="content-box"===c.style.backgroundClip,w.extend(h,{boxSizingReliable:function(){return t(),o},pixelBoxStyles:function(){return t(),s},pixelPosition:function(){return t(),i},reliableMarginLeft:function(){return t(),u},scrollboxSize:function(){return t(),a}}))}();function Fe(e,t,n){var r,i,o,a,s=e.style;return(n=n||$e(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||w.contains(e.ownerDocument,e)||(a=w.style(e,t)),!h.pixelBoxStyles()&&We.test(a)&&Be.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function _e(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}var ze=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ue={position:"absolute",visibility:"hidden",display:"block"},Ve={letterSpacing:"0",fontWeight:"400"},Ge=["Webkit","Moz","ms"],Ye=r.createElement("div").style;function Qe(e){if(e in Ye)return e;var t=e[0].toUpperCase()+e.slice(1),n=Ge.length;while(n--)if((e=Ge[n]+t)in Ye)return e}function Je(e){var t=w.cssProps[e];return t||(t=w.cssProps[e]=Qe(e)||e),t}function Ke(e,t,n){var r=ie.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Ze(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=w.css(e,n+oe[a],!0,i)),r?("content"===n&&(u-=w.css(e,"padding"+oe[a],!0,i)),"margin"!==n&&(u-=w.css(e,"border"+oe[a]+"Width",!0,i))):(u+=w.css(e,"padding"+oe[a],!0,i),"padding"!==n?u+=w.css(e,"border"+oe[a]+"Width",!0,i):s+=w.css(e,"border"+oe[a]+"Width",!0,i));return!r&&o>=0&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))),u}function et(e,t,n){var r=$e(e),i=Fe(e,t,r),o="border-box"===w.css(e,"boxSizing",!1,r),a=o;if(We.test(i)){if(!n)return i;i="auto"}return a=a&&(h.boxSizingReliable()||i===e.style[t]),("auto"===i||!parseFloat(i)&&"inline"===w.css(e,"display",!1,r))&&(i=e["offset"+t[0].toUpperCase()+t.slice(1)],a=!0),(i=parseFloat(i)||0)+Ze(e,t,n||(o?"border":"content"),a,r,i)+"px"}w.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Fe(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=G(t),u=Xe.test(t),l=e.style;if(u||(t=Je(s)),a=w.cssHooks[t]||w.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"==(o=typeof n)&&(i=ie.exec(n))&&i[1]&&(n=ue(e,t,i),o="number"),null!=n&&n===n&&("number"===o&&(n+=i&&i[3]||(w.cssNumber[s]?"":"px")),h.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=G(t);return Xe.test(t)||(t=Je(s)),(a=w.cssHooks[t]||w.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Fe(e,t,r)),"normal"===i&&t in Ve&&(i=Ve[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),w.each(["height","width"],function(e,t){w.cssHooks[t]={get:function(e,n,r){if(n)return!ze.test(w.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?et(e,t,r):se(e,Ue,function(){return et(e,t,r)})},set:function(e,n,r){var i,o=$e(e),a="border-box"===w.css(e,"boxSizing",!1,o),s=r&&Ze(e,t,r,a,o);return a&&h.scrollboxSize()===o.position&&(s-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(o[t])-Ze(e,t,"border",!1,o)-.5)),s&&(i=ie.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=w.css(e,t)),Ke(e,n,s)}}}),w.cssHooks.marginLeft=_e(h.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Fe(e,"marginLeft"))||e.getBoundingClientRect().left-se(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),w.each({margin:"",padding:"",border:"Width"},function(e,t){w.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+oe[r]+t]=o[r]||o[r-2]||o[0];return i}},"margin"!==e&&(w.cssHooks[e+t].set=Ke)}),w.fn.extend({css:function(e,t){return z(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=$e(e),i=t.length;a<i;a++)o[t[a]]=w.css(e,t[a],!1,r);return o}return void 0!==n?w.style(e,t,n):w.css(e,t)},e,t,arguments.length>1)}});function tt(e,t,n,r,i){return new tt.prototype.init(e,t,n,r,i)}w.Tween=tt,tt.prototype={constructor:tt,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||w.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(w.cssNumber[n]?"":"px")},cur:function(){var e=tt.propHooks[this.prop];return e&&e.get?e.get(this):tt.propHooks._default.get(this)},run:function(e){var t,n=tt.propHooks[this.prop];return this.options.duration?this.pos=t=w.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):tt.propHooks._default.set(this),this}},tt.prototype.init.prototype=tt.prototype,tt.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=w.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){w.fx.step[e.prop]?w.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[w.cssProps[e.prop]]&&!w.cssHooks[e.prop]?e.elem[e.prop]=e.now:w.style(e.elem,e.prop,e.now+e.unit)}}},tt.propHooks.scrollTop=tt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},w.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},w.fx=tt.prototype.init,w.fx.step={};var nt,rt,it=/^(?:toggle|show|hide)$/,ot=/queueHooks$/;function at(){rt&&(!1===r.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(at):e.setTimeout(at,w.fx.interval),w.fx.tick())}function st(){return e.setTimeout(function(){nt=void 0}),nt=Date.now()}function ut(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=oe[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function lt(e,t,n){for(var r,i=(pt.tweeners[t]||[]).concat(pt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function ct(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),y=J.get(e,"fxshow");n.queue||(null==(a=w._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,w.queue(e,"fx").length||a.empty.fire()})}));for(r in t)if(i=t[r],it.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!y||void 0===y[r])continue;g=!0}d[r]=y&&y[r]||w.style(e,r)}if((u=!w.isEmptyObject(t))||!w.isEmptyObject(d)){f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=y&&y.display)&&(l=J.get(e,"display")),"none"===(c=w.css(e,"display"))&&(l?c=l:(fe([e],!0),l=e.style.display||l,c=w.css(e,"display"),fe([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===w.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1;for(r in d)u||(y?"hidden"in y&&(g=y.hidden):y=J.access(e,"fxshow",{display:l}),o&&(y.hidden=!g),g&&fe([e],!0),p.done(function(){g||fe([e]),J.remove(e,"fxshow");for(r in d)w.style(e,r,d[r])})),u=lt(g?y[r]:0,r,p),r in y||(y[r]=u.start,g&&(u.end=u.start,u.start=0))}}function ft(e,t){var n,r,i,o,a;for(n in e)if(r=G(n),i=t[r],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=w.cssHooks[r])&&"expand"in a){o=a.expand (o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}function pt(e,t,n){var r,i,o=0,a=pt.prefilters.length,s=w.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=nt||st(),n=Math.max(0,l.startTime+l.duration-t),r=1-(n/l.duration||0),o=0,a=l.tweens.length;o<a;o++)l.tweens[o].run(r);return s.notifyWith(e,[l,r,n]),r<1&&a?n:(a||s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:w.extend({},t),opts:w.extend(!0,{specialEasing:{},easing:w.easing._default},n),originalProperties:t,originalOptions:n,startTime:nt||st(),duration:n.duration,tweens:[],createTween:function(t,n){var r=w.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)l.tweens[n].run(1);return t?(s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l,t])):s.rejectWith(e,[l,t]),this}}),c=l.props;for(ft(c,l.opts.specialEasing);o<a;o++)if(r=pt.prefilters[o].call(l,e,c,l.opts))return g(r.stop)&&(w._queueHooks(l.elem,l.opts.queue).stop=r.stop.bind(r)),r;return w.map(c,lt,l),g(l.opts.start)&&l.opts.start.call(e,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),w.fx.timer(w.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l}w.Animation=w.extend(pt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return ue(n.elem,e,ie.exec(t),n),n}]},tweener:function(e,t){g(e)?(t=e,e=["*"]):e=e.match(M);for(var n,r=0,i=e.length;r<i;r++)n=e[r],pt.tweeners[n]=pt.tweeners[n]||[],pt.tweeners[n].unshift(t)},prefilters:[ct],prefilter:function(e,t){t?pt.prefilters.unshift(e):pt.prefilters.push(e)}}),w.speed=function(e,t,n){var r=e&&"object"==typeof e?w.extend({},e):{complete:n||!n&&t||g(e)&&e,duration:e,easing:n&&t||t&&!g(t)&&t};return w.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in w.fx.speeds?r.duration=w.fx.speeds[r.duration]:r.duration=w.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){g(r.old)&&r.old.call(this),r.queue&&w.dequeue(this,r.queue)},r},w.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=w.isEmptyObject(e),o=w.speed(t,n,r),a=function(){var t=pt(this,w.extend({},e),o);(i||J.get(this,"finish"))&&t.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=w.timers,a=J.get(this);if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&ot.test(i)&&r(a[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||w.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=J.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=w.timers,a=r?r.length:0;for(n.finish=!0,w.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<a;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),w.each(["toggle","show","hide"],function(e,t){var n=w.fn[t];w.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ut(t,!0),e,r,i)}}),w.each({slideDown:ut("show"),slideUp:ut("hide"),slideToggle:ut("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){w.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),w.timers=[],w.fx.tick=function(){var e,t=0,n=w.timers;for(nt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||w.fx.stop(),nt=void 0},w.fx.timer=function(e){w.timers.push(e),w.fx.start()},w.fx.interval=13,w.fx.start=function(){rt||(rt=!0,at())},w.fx.stop=function(){rt=null},w.fx.speeds={slow:600,fast:200,_default:400},w.fn.delay=function(t,n){return t=w.fx?w.fx.speeds[t]||t:t,n=n||"fx",this.queue(n,function(n,r){var i=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(i)}})},function(){var e=r.createElement("input"),t=r.createElement("select").appendChild(r.createElement("option"));e.type="checkbox",h.checkOn=""!==e.value,h.optSelected=t.selected,(e=r.createElement("input")).value="t",e.type="radio",h.radioValue="t"===e.value}();var dt,ht=w.expr.attrHandle;w.fn.extend({attr:function(e,t){return z(this,w.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){w.removeAttr(this,e)})}}),w.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?w.prop(e,t,n):(1===o&&w.isXMLDoc(e)||(i=w.attrHooks[t.toLowerCase()]||(w.expr.match.bool.test(t)?dt:void 0)),void 0!==n?null===n?void w.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=w.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!h.radioValue&&"radio"===t&&N(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(M);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),dt={set:function(e,t,n){return!1===t?w.removeAttr(e,n):e.setAttribute(n,n),n}},w.each(w.expr.match.bool.source.match(/\w+/g),function(e,t){var n=ht[t]||w.find.attr;ht[t]=function(e,t,r){var i,o,a=t.toLowerCase();return r||(o=ht[a],ht[a]=i,i=null!=n(e,t,r)?a:null,ht[a]=o),i}});var gt=/^(?:input|select|textarea|button)$/i,yt=/^(?:a|area)$/i;w.fn.extend({prop:function(e,t){return z(this,w.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[w.propFix[e]||e]})}}),w.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&w.isXMLDoc(e)||(t=w.propFix[t]||t,i=w.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=w.find.attr(e,"tabindex");return t?parseInt(t,10):gt.test(e.nodeName)||yt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),h.optSelected||(w.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),w.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){w.propFix[this.toLowerCase()]=this});function vt(e){return(e.match(M)||[]).join(" ")}function mt(e){return e.getAttribute&&e.getAttribute("class")||""}function xt(e){return Array.isArray(e)?e:"string"==typeof e?e.match(M)||[]:[]}w.fn.extend({addClass:function(e){var t,n,r,i,o,a,s,u=0;if(g(e))return this.each(function(t){w(this).addClass(e.call(this,t,mt(this)))});if((t=xt(e)).length)while(n=this[u++])if(i=mt(n),r=1===n.nodeType&&" "+vt(i)+" "){a=0;while(o=t[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=vt(r))&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,r,i,o,a,s,u=0;if(g(e))return this.each(function(t){w(this).removeClass(e.call(this,t,mt(this)))});if(!arguments.length)return this.attr("class","");if((t=xt(e)).length)while(n=this[u++])if(i=mt(n),r=1===n.nodeType&&" "+vt(i)+" "){a=0;while(o=t[a++])while(r.indexOf(" "+o+" ")>-1)r=r.replace(" "+o+" "," ");i!==(s=vt(r))&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n=typeof e,r="string"===n||Array.isArray(e);return"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):g(e)?this.each(function(n){w(this).toggleClass(e.call(this,n,mt(this),t),t)}):this.each(function(){var t,i,o,a;if(r){i=0,o=w(this),a=xt(e);while(t=a[i++])o.hasClass(t)?o.removeClass(t):o.addClass(t)}else void 0!==e&&"boolean"!==n||((t=mt(this))&&J.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":J.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&(" "+vt(mt(n))+" ").indexOf(t)>-1)return!0;return!1}});var bt=/\r/g;w.fn.extend({val:function(e){var t,n,r,i=this[0];{if(arguments.length)return r=g(e),this.each(function(n){var i;1===this.nodeType&&(null==(i=r?e.call(this,n,w(this).val()):e)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=w.map(i,function(e){return null==e?"":e+""})),(t=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))});if(i)return(t=w.valHooks[i.type]||w.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:"string"==typeof(n=i.value)?n.replace(bt,""):null==n?"":n}}}),w.extend({valHooks:{option:{get:function(e){var t=w.find.attr(e,"value");return null!=t?t:vt(w.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!N(n.parentNode,"optgroup"))){if(t=w(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=w.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=w.inArray(w.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),w.each(["radio","checkbox"],function(){w.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=w.inArray(w(e).val(),t)>-1}},h.checkOn||(w.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),h.focusin="onfocusin"in e;var wt=/^(?:focusinfocus|focusoutblur)$/,Tt=function(e){e.stopPropagation()};w.extend(w.event,{trigger:function(t,n,i,o){var a,s,u,l,c,p,d,h,v=[i||r],m=f.call(t,"type")?t.type:t,x=f.call(t,"namespace")?t.namespace.split("."):[];if(s=h=u=i=i||r,3!==i.nodeType&&8!==i.nodeType&&!wt.test(m+w.event.triggered)&&(m.indexOf(".")>-1&&(m=(x=m.split(".")).shift(),x.sort()),c=m.indexOf(":")<0&&"on"+m,t=t[w.expando]?t:new w.Event(m,"object"==typeof t&&t),t.isTrigger=o?2:3,t.namespace=x.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+x.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),n=null==n?[t]:w.makeArray(n,[t]),d=w.event.special[m]||{},o||!d.trigger||!1!==d.trigger.apply(i,n))){if(!o&&!d.noBubble&&!y(i)){for(l=d.delegateType||m,wt.test(l+m)||(s=s.parentNode);s;s=s.parentNode)v.push(s),u=s;u===(i.ownerDocument||r)&&v.push(u.defaultView||u.parentWindow||e)}a=0;while((s=v[a++])&&!t.isPropagationStopped())h=s,t.type=a>1?l:d.bindType||m,(p=(J.get(s,"events")||{})[t.type]&&J.get(s,"handle"))&&p.apply(s,n),(p=c&&s[c])&&p.apply&&Y(s)&&(t.result=p.apply(s,n),!1===t.result&&t.preventDefault());return t.type=m,o||t.isDefaultPrevented()||d._default&&!1!==d._default.apply(v.pop(),n)||!Y(i)||c&&g(i[m])&&!y(i)&&((u=i[c])&&(i[c]=null),w.event.triggered=m,t.isPropagationStopped()&&h.addEventListener(m,Tt),i[m](),t.isPropagationStopped()&&h.removeEventListener(m,Tt),w.event.triggered=void 0,u&&(i[c]=u)),t.result}},simulate:function(e,t,n){var r=w.extend(new w.Event,n,{type:e,isSimulated:!0});w.event.trigger(r,null,t)}}),w.fn.extend({trigger:function(e,t){return this.each(function(){w.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return w.event.trigger(e,t,n,!0)}}),h.focusin||w.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){w.event.simulate(t,e.target,w.event.fix(e))};w.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=J.access(r,t);i||r.addEventListener(e,n,!0),J.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=J.access(r,t)-1;i?J.access(r,t,i):(r.removeEventListener(e,n,!0),J.remove(r,t))}}});var Ct=e.location,Et=Date.now(),kt=/\?/;w.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||w.error("Invalid XML: "+t),n};var St=/\[\]$/,Dt=/\r?\n/g,Nt=/^(?:submit|button|image|reset|file)$/i,At=/^(?:input|select|textarea|keygen)/i;function jt(e,t,n,r){var i;if(Array.isArray(t))w.each(t,function(t,i){n||St.test(e)?r(e,i):jt(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)});else if(n||"object"!==x(t))r(e,t);else for(i in t)jt(e+"["+i+"]",t[i],n,r)}w.param=function(e,t){var n,r=[],i=function(e,t){var n=g(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(Array.isArray(e)||e.jquery&&!w.isPlainObject(e))w.each(e,function(){i(this.name,this.value)});else for(n in e)jt(n,e[n],t,i);return r.join("&")},w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=w.prop(this,"elements");return e?w.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!w(this).is(":disabled")&&At.test(this.nodeName)&&!Nt.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=w(this).val();return null==n?null:Array.isArray(n)?w.map(n,function(e){return{name:t.name,value:e.replace(Dt,"\r\n")}}):{name:t.name,value:n.replace(Dt,"\r\n")}}).get()}});var qt=/%20/g,Lt=/#.*$/,Ht=/([?&])_=[^&]*/,Ot=/^(.*?):[ \t]*([^\r\n]*)$/gm,Pt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Mt=/^(?:GET|HEAD)$/,Rt=/^\/\//,It={},Wt={},$t="*/".concat("*"),Bt=r.createElement("a");Bt.href=Ct.href;function Ft(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(M)||[];if(g(n))while(r=o[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function _t(e,t,n,r){var i={},o=e===Wt;function a(s){var u;return i[s]=!0,w.each(e[s]||[],function(e,s){var l=s(t,n,r);return"string"!=typeof l||o||i[l]?o?!(u=l):void 0:(t.dataTypes.unshift(l),a(l),!1)}),u}return a(t.dataTypes[0])||!i["*"]&&a("*")}function zt(e,t){var n,r,i=w.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&w.extend(!0,e,r),e}function Xt(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}function Ut(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ct.href,type:"GET",isLocal:Pt.test(Ct.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":$t,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?zt(zt(e,w.ajaxSettings),t):zt(w.ajaxSettings,e)},ajaxPrefilter:Ft(It),ajaxTransport:Ft(Wt),ajax:function(t,n){"object"==typeof t&&(n=t,t=void 0),n=n||{};var i,o,a,s,u,l,c,f,p,d,h=w.ajaxSetup({},n),g=h.context||h,y=h.context&&(g.nodeType||g.jquery)?w(g):w.event,v=w.Deferred(),m=w.Callbacks("once memory"),x=h.statusCode||{},b={},T={},C="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(c){if(!s){s={};while(t=Ot.exec(a))s[t[1].toLowerCase()]=t[2]}t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return c?a:null},setRequestHeader:function(e,t){return null==c&&(e=T[e.toLowerCase()]=T[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==c&&(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(c)E.always(e[E.status]);else for(t in e)x[t]=[x[t],e[t]];return this},abort:function(e){var t=e||C;return i&&i.abort(t),k(0,t),this}};if(v.promise(E),h.url=((t||h.url||Ct.href)+"").replace(Rt,Ct.protocol+"//"),h.type=n.method||n.type||h.method||h.type,h.dataTypes=(h.dataType||"*").toLowerCase().match(M)||[""],null==h.crossDomain){l=r.createElement("a");try{l.href=h.url,l.href=l.href,h.crossDomain=Bt.protocol+"//"+Bt.host!=l.protocol+"//"+l.host}catch(e){h.crossDomain=!0}}if(h.data&&h.processData&&"string"!=typeof h.data&&(h.data=w.param(h.data,h.traditional)),_t(It,h,n,E),c)return E;(f=w.event&&h.global)&&0==w.active++&&w.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Mt.test(h.type),o=h.url.replace(Lt,""),h.hasContent?h.data&&h.processData&&0===(h.contentType||"").indexOf("application/x-www-form-urlencoded")&&(h.data=h.data.replace(qt,"+")):(d=h.url.slice(o.length),h.data&&(h.processData||"string"==typeof h.data)&&(o+=(kt.test(o)?"&":"?")+h.data,delete h.data),!1===h.cache&&(o=o.replace(Ht,"$1"),d=(kt.test(o)?"&":"?")+"_="+Et+++d),h.url=o+d),h.ifModified&&(w.lastModified[o]&&E.setRequestHeader("If-Modified-Since",w.lastModified[o]),w.etag[o]&&E.setRequestHeader("If-None-Match",w.etag[o])),(h.data&&h.hasContent&&!1!==h.contentType||n.contentType)&&E.setRequestHeader("Content-Type",h.contentType),E.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+$t+"; q=0.01":""):h.accepts["*"]);for(p in h.headers)E.setRequestHeader(p,h.headers[p]);if(h.beforeSend&&(!1===h.beforeSend.call(g,E,h)||c))return E.abort();if(C="abort",m.add(h.complete),E.done(h.success),E.fail(h.error),i=_t(Wt,h,n,E)){if(E.readyState=1,f&&y.trigger("ajaxSend",[E,h]),c)return E;h.async&&h.timeout>0&&(u=e.setTimeout(function(){E.abort("timeout")},h.timeout));try{c=!1,i.send(b,k)}catch(e){if(c)throw e;k(-1,e)}}else k(-1,"No Transport");function k(t,n,r,s){var l,p,d,b,T,C=n;c||(c=!0,u&&e.clearTimeout(u),i=void 0,a=s||"",E.readyState=t>0?4:0,l=t>=200&&t<300||304===t,r&&(b=Xt(h,E,r)),b=Ut(h,b,E,l),l?(h.ifModified&&((T=E.getResponseHeader("Last-Modified"))&&(w.lastModified[o]=T),(T=E.getResponseHeader("etag"))&&(w.etag[o]=T)),204===t||"HEAD"===h.type?C="nocontent":304===t?C="notmodified":(C=b.state,p=b.data,l=!(d=b.error))):(d=C,!t&&C||(C="error",t<0&&(t=0))),E.status=t,E.statusText=(n||C)+"",l?v.resolveWith(g,[p,C,E]):v.rejectWith(g,[E,C,d]),E.statusCode(x),x=void 0,f&&y.trigger(l?"ajaxSuccess":"ajaxError",[E,h,l?p:d]),m.fireWith(g,[E,C]),f&&(y.trigger("ajaxComplete",[E,h]),--w.active||w.event.trigger("ajaxStop")))}return E},getJSON:function(e,t,n){return w.get(e,t,n,"json")},getScript:function(e,t){return w.get(e,void 0,t,"script")}}),w.each(["get","post"],function(e,t){w[t]=function(e,n,r,i){return g(n)&&(i=i||r,r=n,n=void 0),w.ajax(w.extend({url:e,type:t,dataType:i,data:n,success:r},w.isPlainObject(e)&&e))}}),w._evalUrl=function(e){return w.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},w.fn.extend({wrapAll:function(e){var t;return this[0]&&(g(e)&&(e=e.call(this[0])),t=w(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return g(e)?this.each(function(t){w(this).wrapInner(e.call(this,t))}):this.each(function(){var t=w(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=g(e);return this.each(function(n){w(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){w(this).replaceWith(this.childNodes)}),this}}),w.expr.pseudos.hidden=function(e){return!w.expr.pseudos.visible(e)},w.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},w.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Vt={0:200,1223:204},Gt=w.ajaxSettings.xhr();h.cors=!!Gt&&"withCredentials"in Gt,h.ajax=Gt=!!Gt,w.ajaxTransport(function(t){var n,r;if(h.cors||Gt&&!t.crossDomain)return{send:function(i,o){var a,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)s[a]=t.xhrFields[a];t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(a in i)s.setRequestHeader(a,i[a]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o(Vt[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=s.ontimeout=n("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout(function(){n&&r()})},n=n("abort");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),w.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return w.globalEval(e),e}}}),w.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),w.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(i,o){t=w("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&o("error"===e.type?404:200,e.type)}),r.head.appendChild(t[0])},abort:function(){n&&n()}}}});var Yt=[],Qt=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Yt.pop()||w.expando+"_"+Et++;return this[e]=!0,e}}),w.ajaxPrefilter("json jsonp",function(t,n,r){var i,o,a,s=!1!==t.jsonp&&(Qt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Qt.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return i=t.jsonpCallback=g(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Qt,"$1"+i):!1!==t.jsonp&&(t.url+=(kt.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return a||w.error(i+" was not called"),a[0]},t.dataTypes[0]="json",o=e[i],e[i]=function(){a=arguments},r.always(function(){void 0===o?w(e).removeProp(i):e[i]=o,t[i]&&(t.jsonpCallback=n.jsonpCallback,Yt.push(i)),a&&g(o)&&o(a[0]),a=o=void 0}),"script"}),h.createHTMLDocument=function(){var e=r.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),w.parseHTML=function(e,t,n){if("string"!=typeof e)return[];"boolean"==typeof t&&(n=t,t=!1);var i,o,a;return t||(h.createHTMLDocument?((i=(t=r.implementation.createHTMLDocument("")).createElement("base")).href=r.location.href,t.head.appendChild(i)):t=r),o=A.exec(e),a=!n&&[],o?[t.createElement(o[1])]:(o=xe([e],t,a),a&&a.length&&w(a).remove(),w.merge([],o.childNodes))},w.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return s>-1&&(r=vt(e.slice(s)),e=e.slice(0,s)),g(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),a.length>0&&w.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?w("<div>").append(w.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},w.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){w.fn[t]=function(e){return this.on(t,e)}}),w.expr.pseudos.animated=function(e){return w.grep(w.timers,function(t){return e===t.elem}).length},w.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l,c=w.css(e,"position"),f=w(e),p={};"static"===c&&(e.style.position="relative"),s=f.offset(),o=w.css(e,"top"),u=w.css(e,"left"),(l=("absolute"===c||"fixed"===c)&&(o+u).indexOf("auto")>-1)?(a=(r=f.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),g(t)&&(t=t.call(e,n,w.extend({},s))),null!=t.top&&(p.top=t.top-s.top+a),null!=t.left&&(p.left=t.left-s.left+i),"using"in t?t.using.call(e,p):f.css(p)}},w.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){w.offset.setOffset(this,e,t)});var t,n,r=this[0];if(r)return r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===w.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===w.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=w(e).offset()).top+=w.css(e,"borderTopWidth",!0),i.left+=w.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-w.css(r,"marginTop",!0),left:t.left-i.left-w.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===w.css(e,"position"))e=e.offsetParent;return e||be})}}),w.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;w.fn[e]=function(r){return z(this,function(e,r,i){var o;if(y(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===i)return o?o[t]:e[r];o?o.scrollTo(n?o.pageXOffset:i,n?i:o.pageYOffset):e[r]=i},e,r,arguments.length)}}),w.each(["top","left"],function(e,t){w.cssHooks[t]=_e(h.pixelPosition,function(e,n){if(n)return n=Fe(e,t),We.test(n)?w(e).position()[t]+"px":n})}),w.each({Height:"height",Width:"width"},function(e,t){w.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){w.fn[r]=function(i,o){var a=arguments.length&&(n||"boolean"!=typeof i),s=n||(!0===i||!0===o?"margin":"border");return z(this,function(t,n,i){var o;return y(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)},t,a?i:void 0,a)}})}),w.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){w.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),w.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),w.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),w.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),g(e))return r=o.call(arguments,2),i=function(){return e.apply(t||this,r.concat(o.call(arguments)))},i.guid=e.guid=e.guid||w.guid++,i},w.holdReady=function(e){e?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=N,w.isFunction=g,w.isWindow=y,w.camelCase=G,w.type=x,w.now=Date.now,w.isNumeric=function(e){var t=w.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},"function"==typeof define&&define.amd&&define("jquery",[],function(){return w});var Jt=e.jQuery,Kt=e.$;return w.noConflict=function(t){return e.$===w&&(e.$=Kt),t&&e.jQuery===w&&(e.jQuery=Jt),w},t||(e.jQuery=e.$=w),w});
(function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){function e(t){for(var e=t.css("visibility");"inherit"===e;)t=t.parent(),e=t.css("visibility");return"hidden"!==e}function i(t){for(var e,i;t.length&&t[0]!==document;){if(e=t.css("position"),("absolute"===e||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}function s(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=n(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",i,function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,o)}function o(){t.datepicker._isDisabledDatepicker(m.inline?m.dpDiv.parent()[0]:m.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function a(e,i){t.extend(e,i);for(var s in i)null==i[s]&&(e[s]=i[s]);return e}function r(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.ui.version="1.12.1";var h=0,l=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(a){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},h=e.split(".")[0];e=e.split(".")[1];var l=h+"-"+e;return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][l.toLowerCase()]=function(e){return!!t.data(e,l)},t[h]=t[h]||{},n=t[h][e],o=t[h][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}(),void 0):(r[e]=s,void 0)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},r,{constructor:o,namespace:h,widgetName:e,widgetFullName:l}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var i,s,n=l.call(arguments,1),o=0,a=n.length;a>o;o++)for(i in n[o])s=n[o][i],n[o].hasOwnProperty(i)&&void 0!==s&&(e[i]=t.isPlainObject(s)?t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(n){var o="string"==typeof n,a=l.call(arguments,1),r=this;return o?this.length||"instance"!==n?this.each(function(){var i,o=t.data(this,s);return"instance"===n?(r=o,!1):o?t.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,a),i!==o&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; "+"attempted to call method '"+n+"'")}):r=void 0:(a.length&&(n=t.widget.extend.apply(null,[n].concat(a))),this.each(function(){var e=t.data(this,s);e?(e.option(n||{}),e._init&&e._init()):t.data(this,s,new i(n,this))})),r}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=h++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},s=e.split("."),e=s.shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,o){var a,r;for(r=0;i.length>r;r++)a=n.classesElementLookup[i[r]]||t(),a=e.add?t(t.unique(a.get().concat(e.element.get()))):t(a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return o.element.toggleClass(this._classes(o),s),this},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+o.eventNamespace,c=h[2];c?n.on(l,c,r):i.on(l,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function s(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var n,o=Math.max,a=Math.abs,r=/left|center|right/,h=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/,d=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return t("body").append(s),e=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType,o=!s&&!n;return{element:i,isWindow:s,isDocument:n,offset:o?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var u,p,f,g,m,_,v=t(n.of),b=t.position.getWithinInfo(n.within),y=t.position.getScrollInfo(b),w=(n.collision||"flip").split(" "),k={};return _=s(v),v[0].preventDefault&&(n.at="left top"),p=_.width,f=_.height,g=_.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):h.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=h.test(i[1])?i[1]:"center",t=l.exec(i[0]),e=l.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),u=e(k.at,p,f),m.left+=u[0],m.top+=u[1],this.each(function(){var s,r,h=t(this),l=h.outerWidth(),c=h.outerHeight(),d=i(this,"marginLeft"),_=i(this,"marginTop"),x=l+d+i(this,"marginRight")+y.width,C=c+_+i(this,"marginBottom")+y.height,D=t.extend({},m),I=e(k.my,h.outerWidth(),h.outerHeight());"right"===n.my[0]?D.left-=l:"center"===n.my[0]&&(D.left-=l/2),"bottom"===n.my[1]?D.top-=c:"center"===n.my[1]&&(D.top-=c/2),D.left+=I[0],D.top+=I[1],s={marginLeft:d,marginTop:_},t.each(["left","top"],function(e,i){t.ui.position[w[e]]&&t.ui.position[w[e]][i](D,{targetWidth:p,targetHeight:f,elemWidth:l,elemHeight:c,collisionPosition:s,collisionWidth:x,collisionHeight:C,offset:[u[0]+I[0],u[1]+I[1]],my:n.my,at:n.at,within:b,elem:h})}),n.using&&(r=function(t){var e=g.left-D.left,i=e+p-l,s=g.top-D.top,r=s+f-c,u={target:{element:v,left:g.left,top:g.top,width:p,height:f},element:{element:h,left:D.left,top:D.top,width:l,height:c},horizontal:0>i?"left":e>0?"right":"center",vertical:0>r?"top":s>0?"bottom":"middle"};l>p&&p>a(e+i)&&(u.horizontal="center"),c>f&&f>a(s+r)&&(u.vertical="middle"),u.important=o(a(e),a(i))>o(a(s),a(r))?"horizontal":"vertical",n.using.call(this,t,u)}),h.offset(t.extend(D,{using:r}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,h=n-r,l=r+e.collisionWidth-a-n;e.collisionWidth>a?h>0&&0>=l?(i=t.left+h+e.collisionWidth-a-n,t.left+=h-i):t.left=l>0&&0>=h?n:h>l?n+a-e.collisionWidth:n:h>0?t.left+=h:l>0?t.left-=l:t.left=o(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,h=n-r,l=r+e.collisionHeight-a-n;e.collisionHeight>a?h>0&&0>=l?(i=t.top+h+e.collisionHeight-a-n,t.top+=h-i):t.top=l>0&&0>=h?n:h>l?n+a-e.collisionHeight:n:h>0?t.top+=h:l>0?t.top-=l:t.top=o(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,r=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=t.left-e.collisionPosition.marginLeft,c=l-h,u=l+e.collisionWidth-r-h,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+d+p+f+e.collisionWidth-r-o,(0>i||a(c)>i)&&(t.left+=d+p+f)):u>0&&(s=t.left-e.collisionPosition.marginLeft+d+p+f-h,(s>0||u>a(s))&&(t.left+=d+p+f))},top:function(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,r=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=t.top-e.collisionPosition.marginTop,c=l-h,u=l+e.collisionHeight-r-h,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+p+f+g+e.collisionHeight-r-o,(0>s||a(c)>s)&&(t.top+=p+f+g)):u>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-h,(i>0||u>a(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});var c="ui-effects-",u="ui-effects-style",d="ui-effects-animated",p=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(t,o){var a,r=o.re.exec(i),h=r&&o.parse(r),l=o.space||"rgba";return h?(a=s[l](h),s[c[l].cache]=a[c[l].cache],n=s._rgba=a._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),s):o[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var o,a="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],l=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=l.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),l.fn=t.extend(l.prototype,{parse:function(n,a,r,h){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(a),a=e);var u=this,d=t.type(n),p=this._rgba=[];return a!==e&&(n=[n,a,r,h],d="array"),"string"===d?this.parse(s(n)||o._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof l?f(c,function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}):f(c,function(e,s){var o=s.cache;f(s.props,function(t,e){if(!u[o]&&s.to){if("alpha"===t||null==n[t])return;u[o]=s.to(u._rgba)}u[o][e.idx]=i(n[t],e,!0)}),u[o]&&0>t.inArray(null,u[o].slice(0,3))&&(u[o][3]=1,s.from&&(u._rgba=s.from(u[o])))}),this):e},is:function(t){var i=l(t),s=!0,n=this;return f(c,function(t,o){var a,r=i[o.cache];return r&&(a=n[o.cache]||o.to&&o.to(n._rgba)||[],f(o.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===a[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return f(c,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=l(t),n=s._space(),o=c[n],a=0===this.alpha()?l("transparent"):this,r=a[o.cache]||o.to(a._rgba),h=r.slice();return s=s[o.cache],f(o.props,function(t,n){var o=n.idx,a=r[o],l=s[o],c=u[n.type]||{};null!==l&&(null===a?h[o]=l:(c.mod&&(l-a>c.mod/2?a+=c.mod:a-l>c.mod/2&&(a-=c.mod)),h[o]=i((l-a)*e+a,n)))}),this[n](h)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(e)._rgba;return l(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,o=t[2]/255,a=t[3],r=Math.max(s,n,o),h=Math.min(s,n,o),l=r-h,c=r+h,u=.5*c;return e=h===r?0:s===r?60*(n-o)/l+360:n===r?60*(o-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=u?l/c:l/(2-c),[Math.round(e)%360,i,u,null==a?1:a]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],o=t[3],a=.5>=s?s*(1+i):s+i-s*i,r=2*s-a;return[Math.round(255*n(r,a,e+1/3)),Math.round(255*n(r,a,e)),Math.round(255*n(r,a,e-1/3)),o]},f(c,function(s,n){var o=n.props,a=n.cache,h=n.to,c=n.from;l.fn[s]=function(s){if(h&&!this[a]&&(this[a]=h(this._rgba)),s===e)return this[a].slice();var n,r=t.type(s),u="array"===r||"object"===r?s:arguments,d=this[a].slice();return f(o,function(t,e){var s=u["object"===r?t:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?(n=l(c(d)),n[a]=d,n):l(d)},f(o,function(e,i){l.fn[e]||(l.fn[e]=function(n){var o,a=t.type(n),h="alpha"===e?this._hsla?"hsla":"rgba":s,l=this[h](),c=l[i.idx];return"undefined"===a?c:("function"===a&&(n=n.call(this,c),a=t.type(n)),null==n&&i.empty?this:("string"===a&&(o=r.exec(n),o&&(n=c+parseFloat(o[2])*("+"===o[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,a,r="";if("transparent"!==n&&("string"!==t.type(n)||(o=s(n)))){if(n=l(o||n),!d.rgba&&1!==n._rgba[3]){for(a="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&a&&a.style;)try{r=t.css(a,"backgroundColor"),a=a.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(h){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=l(e.elem,i),e.end=l(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},l.hook(a),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(p),function(){function e(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(e,i){var s,o,a={};for(s in i)o=i[s],e[s]!==o&&(n[s]||(t.fx.step[s]||!isNaN(parseFloat(o)))&&(a[s]=o));return a}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(p.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,o,a,r){var h=t.speed(o,a,r);return this.queue(function(){var o,a=t(this),r=a.attr("class")||"",l=h.children?a.find("*").addBack():a;l=l.map(function(){var i=t(this);return{el:i,start:e(this)}}),o=function(){t.each(s,function(t,e){n[e]&&a[e+"Class"](n[e])})},o(),l=l.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",r),l=l.map(function(){var e=this,i=t.Deferred(),s=t.extend({},h,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,l.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),h.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,o){return s?t.effects.animateClass.call(this,{add:i},s,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,s,n,o,a){return"boolean"==typeof s||void 0===s?n?t.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,a):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,n,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,o)}})}(),function(){function e(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}function s(t,e){var i=e.outerWidth(),s=e.outerHeight(),n=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,o=n.exec(t)||["",0,i,s,0];return{top:parseFloat(o[1])||0,right:"auto"===o[2]?i:parseFloat(o[2]),bottom:"auto"===o[3]?s:parseFloat(o[3]),left:parseFloat(o[4])||0}}t.expr&&t.expr.filters&&t.expr.filters.animated&&(t.expr.filters.animated=function(e){return function(i){return!!t(i).data(d)||e(i)}}(t.expr.filters.animated)),t.uiBackCompat!==!1&&t.extend(t.effects,{save:function(t,e){for(var i=0,s=e.length;s>i;i++)null!==e[i]&&t.data(c+e[i],t[0].style[e[i]])},restore:function(t,e){for(var i,s=0,n=e.length;n>s;s++)null!==e[s]&&(i=t.data(c+e[s]),t.css(e[s],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(a){o=document.body}return e.wrap(s),(e[0]===o||t.contains(e[0],o))&&t(o).trigger("focus"),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).trigger("focus")),e}}),t.extend(t.effects,{version:"1.12.1",define:function(e,i,s){return s||(s=i,i="effect"),t.effects.effect[e]=s,t.effects.effect[e].mode=i,s},scaledDimensions:function(t,e,i){if(0===e)return{height:0,width:0,outerHeight:0,outerWidth:0};var s="horizontal"!==i?(e||100)/100:1,n="vertical"!==i?(e||100)/100:1;return{height:t.height()*n,width:t.width()*s,outerHeight:t.outerHeight()*n,outerWidth:t.outerWidth()*s}},clipToBox:function(t){return{width:t.clip.right-t.clip.left,height:t.clip.bottom-t.clip.top,left:t.clip.left,top:t.clip.top}},unshift:function(t,e,i){var s=t.queue();e>1&&s.splice.apply(s,[1,0].concat(s.splice(e,i))),t.dequeue()},saveStyle:function(t){t.data(u,t[0].style.cssText)},restoreStyle:function(t){t[0].style.cssText=t.data(u)||"",t.removeData(u)},mode:function(t,e){var i=t.is(":hidden");return"toggle"===e&&(e=i?"show":"hide"),(i?"hide"===e:"show"===e)&&(e="none"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createPlaceholder:function(e){var i,s=e.css("position"),n=e.position();return e.css({marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()),/^(static|relative)/.test(s)&&(s="absolute",i=t("<"+e[0].nodeName+">").insertAfter(e).css({display:/^(inline|ruby)/.test(e.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight"),"float":e.css("float")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"),e.data(c+"placeholder",i)),e.css({position:s,left:n.left,top:n.top}),i},removePlaceholder:function(t){var e=c+"placeholder",i=t.data(e);i&&(i.remove(),t.removeData(e))},cleanUp:function(e){t.effects.restoreStyle(e),t.effects.removePlaceholder(e)},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),t.fn.extend({effect:function(){function i(e){function i(){r.removeData(d),t.effects.cleanUp(r),"hide"===s.mode&&r.hide(),a()}function a(){t.isFunction(h)&&h.call(r[0]),t.isFunction(e)&&e()}var r=t(this);s.mode=c.shift(),t.uiBackCompat===!1||o?"none"===s.mode?(r[l](),a()):n.call(r[0],s,i):(r.is(":hidden")?"hide"===l:"show"===l)?(r[l](),a()):n.call(r[0],s,a)}var s=e.apply(this,arguments),n=t.effects.effect[s.effect],o=n.mode,a=s.queue,r=a||"fx",h=s.complete,l=s.mode,c=[],u=function(e){var i=t(this),s=t.effects.mode(i,l)||o;i.data(d,!0),c.push(s),o&&("show"===s||s===o&&"hide"===s)&&i.show(),o&&"none"===s||t.effects.saveStyle(i),t.isFunction(e)&&e()};return t.fx.off||!n?l?this[l](s.duration,h):this.each(function(){h&&h.call(this)}):a===!1?this.each(u).each(i):this.queue(r,u).queue(r,i)},show:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)
}}(t.fn.show),hide:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(s){if(i(s)||"boolean"==typeof s)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s},cssClip:function(t){return t?this.css("clip","rect("+t.top+"px "+t.right+"px "+t.bottom+"px "+t.left+"px)"):s(this.css("clip"),this)},transfer:function(e,i){var s=t(this),n=t(e.to),o="fixed"===n.css("position"),a=t("body"),r=o?a.scrollTop():0,h=o?a.scrollLeft():0,l=n.offset(),c={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},u=s.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(e.className).css({top:u.top-r,left:u.left-h,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),t.isFunction(i)&&i()})}}),t.fx.step.clip=function(e){e.clipInit||(e.start=t(e.elem).cssClip(),"string"==typeof e.end&&(e.end=s(e.end,e.elem)),e.clipInit=!0),t(e.elem).cssClip({top:e.pos*(e.end.top-e.start.top)+e.start.top,right:e.pos*(e.end.right-e.start.right)+e.start.right,bottom:e.pos*(e.end.bottom-e.start.bottom)+e.start.bottom,left:e.pos*(e.end.left-e.start.left)+e.start.left})}}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}();var f=t.effects;t.effects.define("blind","hide",function(e,i){var s={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},n=t(this),o=e.direction||"up",a=n.cssClip(),r={clip:t.extend({},a)},h=t.effects.createPlaceholder(n);r.clip[s[o][0]]=r.clip[s[o][1]],"show"===e.mode&&(n.cssClip(r.clip),h&&h.css(t.effects.clipToBox(r)),r.clip=a),h&&h.animate(t.effects.clipToBox(r),e.duration,e.easing),n.animate(r,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("bounce",function(e,i){var s,n,o,a=t(this),r=e.mode,h="hide"===r,l="show"===r,c=e.direction||"up",u=e.distance,d=e.times||5,p=2*d+(l||h?1:0),f=e.duration/p,g=e.easing,m="up"===c||"down"===c?"top":"left",_="up"===c||"left"===c,v=0,b=a.queue().length;for(t.effects.createPlaceholder(a),o=a.css(m),u||(u=a["top"===m?"outerHeight":"outerWidth"]()/3),l&&(n={opacity:1},n[m]=o,a.css("opacity",0).css(m,_?2*-u:2*u).animate(n,f,g)),h&&(u/=Math.pow(2,d-1)),n={},n[m]=o;d>v;v++)s={},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g).animate(n,f,g),u=h?2*u:u/2;h&&(s={opacity:0},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g)),a.queue(i),t.effects.unshift(a,b,p+1)}),t.effects.define("clip","hide",function(e,i){var s,n={},o=t(this),a=e.direction||"vertical",r="both"===a,h=r||"horizontal"===a,l=r||"vertical"===a;s=o.cssClip(),n.clip={top:l?(s.bottom-s.top)/2:s.top,right:h?(s.right-s.left)/2:s.right,bottom:l?(s.bottom-s.top)/2:s.bottom,left:h?(s.right-s.left)/2:s.left},t.effects.createPlaceholder(o),"show"===e.mode&&(o.cssClip(n.clip),n.clip=s),o.animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("drop","hide",function(e,i){var s,n=t(this),o=e.mode,a="show"===o,r=e.direction||"left",h="up"===r||"down"===r?"top":"left",l="up"===r||"left"===r?"-=":"+=",c="+="===l?"-=":"+=",u={opacity:0};t.effects.createPlaceholder(n),s=e.distance||n["top"===h?"outerHeight":"outerWidth"](!0)/2,u[h]=l+s,a&&(n.css(u),u[h]=c+s,u.opacity=1),n.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("explode","hide",function(e,i){function s(){b.push(this),b.length===u*d&&n()}function n(){p.css({visibility:"visible"}),t(b).remove(),i()}var o,a,r,h,l,c,u=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=u,p=t(this),f=e.mode,g="show"===f,m=p.show().css("visibility","hidden").offset(),_=Math.ceil(p.outerWidth()/d),v=Math.ceil(p.outerHeight()/u),b=[];for(o=0;u>o;o++)for(h=m.top+o*v,c=o-(u-1)/2,a=0;d>a;a++)r=m.left+a*_,l=a-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*_,top:-o*v}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:_,height:v,left:r+(g?l*_:0),top:h+(g?c*v:0),opacity:g?0:1}).animate({left:r+(g?0:l*_),top:h+(g?0:c*v),opacity:g?1:0},e.duration||500,e.easing,s)}),t.effects.define("fade","toggle",function(e,i){var s="show"===e.mode;t(this).css("opacity",s?0:1).animate({opacity:s?1:0},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("fold","hide",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=e.size||15,h=/([0-9]+)%/.exec(r),l=!!e.horizFirst,c=l?["right","bottom"]:["bottom","right"],u=e.duration/2,d=t.effects.createPlaceholder(s),p=s.cssClip(),f={clip:t.extend({},p)},g={clip:t.extend({},p)},m=[p[c[0]],p[c[1]]],_=s.queue().length;h&&(r=parseInt(h[1],10)/100*m[a?0:1]),f.clip[c[0]]=r,g.clip[c[0]]=r,g.clip[c[1]]=0,o&&(s.cssClip(g.clip),d&&d.css(t.effects.clipToBox(g)),g.clip=p),s.queue(function(i){d&&d.animate(t.effects.clipToBox(f),u,e.easing).animate(t.effects.clipToBox(g),u,e.easing),i()}).animate(f,u,e.easing).animate(g,u,e.easing).queue(i),t.effects.unshift(s,_,4)}),t.effects.define("highlight","show",function(e,i){var s=t(this),n={backgroundColor:s.css("backgroundColor")};"hide"===e.mode&&(n.opacity=0),t.effects.saveStyle(s),s.css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("size",function(e,i){var s,n,o,a=t(this),r=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],l=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],c=e.mode,u="effect"!==c,d=e.scale||"both",p=e.origin||["middle","center"],f=a.css("position"),g=a.position(),m=t.effects.scaledDimensions(a),_=e.from||m,v=e.to||t.effects.scaledDimensions(a,0);t.effects.createPlaceholder(a),"show"===c&&(o=_,_=v,v=o),n={from:{y:_.height/m.height,x:_.width/m.width},to:{y:v.height/m.height,x:v.width/m.width}},("box"===d||"both"===d)&&(n.from.y!==n.to.y&&(_=t.effects.setTransition(a,h,n.from.y,_),v=t.effects.setTransition(a,h,n.to.y,v)),n.from.x!==n.to.x&&(_=t.effects.setTransition(a,l,n.from.x,_),v=t.effects.setTransition(a,l,n.to.x,v))),("content"===d||"both"===d)&&n.from.y!==n.to.y&&(_=t.effects.setTransition(a,r,n.from.y,_),v=t.effects.setTransition(a,r,n.to.y,v)),p&&(s=t.effects.getBaseline(p,m),_.top=(m.outerHeight-_.outerHeight)*s.y+g.top,_.left=(m.outerWidth-_.outerWidth)*s.x+g.left,v.top=(m.outerHeight-v.outerHeight)*s.y+g.top,v.left=(m.outerWidth-v.outerWidth)*s.x+g.left),a.css(_),("content"===d||"both"===d)&&(h=h.concat(["marginTop","marginBottom"]).concat(r),l=l.concat(["marginLeft","marginRight"]),a.find("*[width]").each(function(){var i=t(this),s=t.effects.scaledDimensions(i),o={height:s.height*n.from.y,width:s.width*n.from.x,outerHeight:s.outerHeight*n.from.y,outerWidth:s.outerWidth*n.from.x},a={height:s.height*n.to.y,width:s.width*n.to.x,outerHeight:s.height*n.to.y,outerWidth:s.width*n.to.x};n.from.y!==n.to.y&&(o=t.effects.setTransition(i,h,n.from.y,o),a=t.effects.setTransition(i,h,n.to.y,a)),n.from.x!==n.to.x&&(o=t.effects.setTransition(i,l,n.from.x,o),a=t.effects.setTransition(i,l,n.to.x,a)),u&&t.effects.saveStyle(i),i.css(o),i.animate(a,e.duration,e.easing,function(){u&&t.effects.restoreStyle(i)})})),a.animate(v,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){var e=a.offset();0===v.opacity&&a.css("opacity",_.opacity),u||(a.css("position","static"===f?"relative":f).offset(e),t.effects.saveStyle(a)),i()}})}),t.effects.define("scale",function(e,i){var s=t(this),n=e.mode,o=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"effect"!==n?0:100),a=t.extend(!0,{from:t.effects.scaledDimensions(s),to:t.effects.scaledDimensions(s,o,e.direction||"both"),origin:e.origin||["middle","center"]},e);e.fade&&(a.from.opacity=1,a.to.opacity=0),t.effects.effect.size.call(this,a,i)}),t.effects.define("puff","hide",function(e,i){var s=t.extend(!0,{},e,{fade:!0,percent:parseInt(e.percent,10)||150});t.effects.effect.scale.call(this,s,i)}),t.effects.define("pulsate","show",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=o||a,h=2*(e.times||5)+(r?1:0),l=e.duration/h,c=0,u=1,d=s.queue().length;for((o||!s.is(":visible"))&&(s.css("opacity",0).show(),c=1);h>u;u++)s.animate({opacity:c},l,e.easing),c=1-c;s.animate({opacity:c},l,e.easing),s.queue(i),t.effects.unshift(s,d,h+1)}),t.effects.define("shake",function(e,i){var s=1,n=t(this),o=e.direction||"left",a=e.distance||20,r=e.times||3,h=2*r+1,l=Math.round(e.duration/h),c="up"===o||"down"===o?"top":"left",u="up"===o||"left"===o,d={},p={},f={},g=n.queue().length;for(t.effects.createPlaceholder(n),d[c]=(u?"-=":"+=")+a,p[c]=(u?"+=":"-=")+2*a,f[c]=(u?"-=":"+=")+2*a,n.animate(d,l,e.easing);r>s;s++)n.animate(p,l,e.easing).animate(f,l,e.easing);n.animate(p,l,e.easing).animate(d,l/2,e.easing).queue(i),t.effects.unshift(n,g,h+1)}),t.effects.define("slide","show",function(e,i){var s,n,o=t(this),a={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},r=e.mode,h=e.direction||"left",l="up"===h||"down"===h?"top":"left",c="up"===h||"left"===h,u=e.distance||o["top"===l?"outerHeight":"outerWidth"](!0),d={};t.effects.createPlaceholder(o),s=o.cssClip(),n=o.position()[l],d[l]=(c?-1:1)*u+n,d.clip=o.cssClip(),d.clip[a[h][1]]=d.clip[a[h][0]],"show"===r&&(o.cssClip(d.clip),o.css(l,d[l]),d.clip=s,d[l]=n),o.animate(d,{queue:!1,duration:e.duration,easing:e.easing,complete:i})});var f;t.uiBackCompat!==!1&&(f=t.effects.define("transfer",function(e,i){t(this).transfer(e,i)})),t.ui.focusable=function(i,s){var n,o,a,r,h,l=i.nodeName.toLowerCase();return"area"===l?(n=i.parentNode,o=n.name,i.href&&o&&"map"===n.nodeName.toLowerCase()?(a=t("img[usemap='#"+o+"']"),a.length>0&&a.is(":visible")):!1):(/^(input|select|textarea|button|object)$/.test(l)?(r=!i.disabled,r&&(h=t(i).closest("fieldset")[0],h&&(r=!h.disabled))):r="a"===l?i.href||s:s,r&&t(i).is(":visible")&&e(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function s(e,i,s,o){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?a["inner"+i].call(this):this.each(function(){t(this).css(o,s(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(o,s(this,e,!0,n)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,s,n,o;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),s=this.attr("id"),s&&(e=this.eq(0).parents().last(),o=e.add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(s)+"']",n=n.add(o.find(i).addBack(i))),this.pushStack(n))},t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),s=null!=i;return(!s||i>=0)&&t.ui.focusable(e,s)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var e,i,s=this.options.icons;s&&(e=t("<span>"),this._addClass(e,"ui-accordion-header-icon","ui-icon "+s.header),e.prependTo(this.headers),i=this.active.children(".ui-accordion-header-icon"),this._removeClass(i,s.header)._addClass(i,null,s.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?(this._activate(e),void 0):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),void 0)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!t)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,s=this.headers.length,n=this.headers.index(e.target),o=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:o=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[s-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),t(o).trigger("focus"),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().trigger("focus")},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var t=this.headers,e=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),e&&(this._off(t.not(this.headers)),this._off(e.not(this.panels)))},_refresh:function(){var e,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var e=t(this),i=e.uniqueId().attr("id"),s=e.next(),n=s.uniqueId().attr("id");e.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(e=n.height(),this.element.siblings(":visible").each(function(){var i=t(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===s&&(e=0,this.headers.next().each(function(){var i=t(this).is(":visible");i||t(this).show(),e=Math.max(e,t(this).css("height","").height()),i||t(this).hide()}).height(e))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i,s,n=this.options,o=this.active,a=t(e.currentTarget),r=a[0]===o[0],h=r&&n.collapsible,l=h?t():a.next(),c=o.next(),u={oldHeader:o,oldPanel:c,newHeader:h?t():a,newPanel:l};e.preventDefault(),r&&!n.collapsible||this._trigger("beforeActivate",e,u)===!1||(n.active=h?!1:this.headers.index(a),this.active=r?t():a,this._toggle(u),this._removeClass(o,"ui-accordion-header-active","ui-state-active"),n.icons&&(i=o.children(".ui-accordion-header-icon"),this._removeClass(i,null,n.icons.activeHeader)._addClass(i,null,n.icons.header)),r||(this._removeClass(a,"ui-accordion-header-collapsed")._addClass(a,"ui-accordion-header-active","ui-state-active"),n.icons&&(s=a.children(".ui-accordion-header-icon"),this._removeClass(s,null,n.icons.header)._addClass(s,null,n.icons.activeHeader)),this._addClass(a.next(),"ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,s=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,e):(s.hide(),i.show(),this._toggleComplete(e)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(t(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(t,e,i){var s,n,o,a=this,r=0,h=t.css("box-sizing"),l=t.length&&(!e.length||t.index()<e.index()),c=this.options.animate||{},u=l&&c.down||c,d=function(){a._toggleComplete(i)};return"number"==typeof u&&(o=u),"string"==typeof u&&(n=u),n=n||u.easing||c.easing,o=o||u.duration||c.duration,e.length?t.length?(s=t.show().outerHeight(),e.animate(this.hideProps,{duration:o,easing:n,step:function(t,e){e.now=Math.round(t)}}),t.hide().animate(this.showProps,{duration:o,easing:n,complete:d,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?"content-box"===h&&(r+=i.now):"content"!==a.options.heightStyle&&(i.now=Math.round(s-e.outerHeight()-r),r=0)}}),void 0):e.animate(this.hideProps,o,n,d):t.animate(this.showProps,o,n,d)},_toggleComplete:function(t){var e=t.oldPanel,i=e.prev();this._removeClass(e,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target),s=t(t.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand (e):!this.element.is(":focus")&&s.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if(!this.previousFilter){var i=t(e.target).closest(".ui-menu-item"),s=t(e.currentTarget);i[0]===s[0]&&(this._removeClass(s.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,s))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){var i=!t.contains(this.element[0],t.ui.safeActiveElement(this.document[0]));i&&this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){var e=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),i=e.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),i.children().each(function(){var e=t(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var i,s,n,o,a=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand (e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:a=!1,s=this.previousFilter||"",o=!1,n=e.keyCode>=96&&105>=e.keyCode?""+(e.keyCode-96):String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===s?o=!0:n=s+n,i=this._filterMenuItems(n),i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&e.preventDefault()},_activate:function(t){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand (t):this.select(t))},refresh:function(){var e,i,s,n,o,a=this,r=this.options.icons.submenu,h=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),s=h.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev(),s=t("<span>").data("ui-menu-submenu-caret",!0);a._addClass(s,"ui-menu-icon","ui-icon "+r),i.attr("aria-haspopup","true").prepend(s),e.attr("aria-labelledby",i.attr("id"))}),this._addClass(s,"ui-menu","ui-widget ui-widget-content ui-front"),e=h.add(this.element),i=e.find(this.options.items),i.not(".ui-menu-item").each(function(){var e=t(this);a._isDivider(e)&&a._addClass(e,"ui-menu-divider","ui-widget-content")}),n=i.not(".ui-menu-item, .ui-menu-divider"),o=n.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(o,"ui-menu-item-wrapper"),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){if("icons"===t){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,e.submenu)}this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t+""),this._toggleClass(null,"ui-state-disabled",!!t)},focus:function(t,e){var i,s,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.children(".ui-menu-item-wrapper"),this._addClass(s,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),n=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,o,a,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=e.outerHeight(),0>n?this.activeMenu.scrollTop(o+n):n+r>a&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",t,{item:this.active}),this.active=null)},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this._removeClass(s.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(e),void 0)},previousPage:function(e){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first())),void 0):(this.next(e),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(t.trim(t(this).children(".ui-menu-item-wrapper").text()))})}}),t.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,a="input"===n;
this.isMultiLine=o||!a&&this._isContentEditable(this.element),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,s=!0,i=!0,void 0;e=!1,s=!1,i=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(e)return e=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if(!i){var n=t.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(t){return s?(s=!1,t.preventDefault(),void 0):(this._searchTimeout(t),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(t),this._change(t),void 0)}}),this._initSource(),this.menu=t("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==t.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(e,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:n})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&t.trim(s).length&&(this.liveRegion.children().hide(),t("<div>").text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,i){var s=i.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==t.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=s})),!1!==this._trigger("select",e,{item:s})&&this._value(s.value),this.term=this._value(),this.close(e),this.selectedItem=s}}),this.liveRegion=t("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var i=this.menu.element[0];return e.target===this.element[0]||e.target===i||t.contains(i,e.target)},_closeOnClickOutside:function(t){this._isEventTargetInWidget(t)||this.close()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,s=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,s){s(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){s.xhr&&s.xhr.abort(),s.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),s=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!s)&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var s=this;t.each(i,function(t,i){s._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<div>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[t](e),void 0):(this.search(null,e),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())},_isContentEditable:function(t){if(!t.length)return!1;var e=t.prop("contentEditable");return"inherit"===e?this._isContentEditable(t.parent()):"true"===e}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var s=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return s.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var g=/ui-corner-([a-z]){2,6}/g;t.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(s,n){var o,a={};return n?"controlgroupLabel"===s?(o=e.element.find(n),o.each(function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(o,null,"ui-widget ui-widget-content ui-state-default"),i=i.concat(o.get()),void 0):(t.fn[s]&&(a=e["_"+s+"Options"]?e["_"+s+"Options"]("middle"):{classes:{}},e.element.find(n).each(function(){var n=t(this),o=n[s]("instance"),r=t.widget.extend({},a);if("button"!==s||!n.parent(".ui-spinner").length){o||(o=n[s]()[s]("instance")),o&&(r.classes=e._resolveClassesValues(r.classes,o)),n[s](r);var h=n[s]("widget");t.data(h[0],"ui-controlgroup-data",o?o:n[s]("instance")),i.push(h[0])}})),void 0):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var i=t(this),s=i.data("ui-controlgroup-data");s&&s[e]&&s[e]()})},_updateCornerClass:function(t,e){var i="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all",s=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,i),this._addClass(t,null,s)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,s={classes:{}};return s.classes[e]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[t],s},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:e?"auto":!1,classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(e,i){var s={};return t.each(e,function(n){var o=i.options.classes[n]||"";o=t.trim(o.replace(g,"")),s[n]=(o+" "+e[n]).replace(/\s+/g," ")}),s},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?(this._callChildMethod(e?"disable":"enable"),void 0):(this.refresh(),void 0)},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],function(t,s){var n=e[s]().data("ui-controlgroup-data");if(n&&i["_"+n.widgetName+"Options"]){var o=i["_"+n.widgetName+"Options"](1===e.length?"only":s);o.classes=i._resolveClassesValues(o.classes,n),n.element[n.widgetName](o)}else i._updateCornerClass(e[s](),s)}),this._callChildMethod("refresh"))}}),t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,i,s=this,n=this._super()||{};return this._readType(),i=this.element.labels(),this.label=t(i[i.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){s.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),e=this.element[0].disabled,null!=e&&(n.disabled=e),n},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var e,i=this.element[0].name,s="input[name='"+t.ui.escapeSelector(i)+"']";return i?(e=this.form.length?t(this.form[0].elements).filter(s):t(s).filter(function(){return 0===t(this).form().length}),e.not(this.element)):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),this.element[0].disabled=e,void 0):(this.refresh(),void 0)):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var t=this.label.contents().not(this.element[0]);this.icon&&(t=t.not(this.icon[0])),this.iconSpace&&(t=t.not(this.iconSpace[0])),t.remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio,t.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),t=this.element[0].disabled,null!=t&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,i){var s="iconPosition"!==e,n=s?this.options.iconPosition:i,o="top"===n||"bottom"===n;this.icon?s&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),s&&this._addClass(this.icon,null,i),this._attachIcon(n),o?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,i=void 0===t.icon?this.options.icon:t.icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),t.uiBackCompat!==!1&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?(this._super("showLabel",e),void 0):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),this._superApply(arguments),void 0)}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button,t.extend(t.ui,{datepicker:{version:"1.12.1"}});var m;t.extend(s.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return a(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var s,n,o;s=e.nodeName.toLowerCase(),n="div"===s||"span"===s,e.id||(this.uuid+=1,e.id="dp"+this.uuid),o=this._newInst(t(e),n),o.settings=t.extend({},i||{}),"input"===s?this._connectDatepicker(e,o):n&&this._inlineDatepicker(e,o)},_newInst:function(e,i){var s=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var s=t(e);i.append=t([]),i.trigger=t([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var s,n,o,a=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),a&&(i.append=t("<span class='"+this._appendClass+"'>"+a+"</span>"),e[r?"before":"after"](i.append)),e.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&e.on("focus",this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:n,title:n}):n)),e[r?"before":"after"](i.trigger),i.trigger.on("click",function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,s,n,o=new Date(2009,11,20),a=this._get(t,"dateFormat");a.match(/[DM]/)&&(e=function(t){for(i=0,s=0,n=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,s=n);return s},o.setMonth(e(this._get(t,a.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,i){var s=t(e);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,s,n,o){var r,h,l,c,u,d=this._dialogInst;return d||(this.uuid+=1,r="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+r+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),t("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},t.data(this._dialogInput[0],"datepicker",d)),a(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+c,l/2-150+u]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(e){var i,s=t(e),n=t.data(e,"datepicker");s.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),m===n&&(m=null))},_enableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,s){var n,o,r,h,l=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):l?"all"===i?t.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),o=this._getDateDatepicker(e,!0),r=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),a(l.settings,n),null!==r&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,r)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),l),this._autoSize(l),this._setDate(l,o),this._updateAlternate(l),this._updateDatepicker(l)),void 0)},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,s,n,o=t.datepicker._getInst(e.target),a=!0,r=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),a=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv),n[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,n[0]),i=t.datepicker._get(o,"onSelect"),i?(s=t.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[s,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),a=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),a=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?1:-1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),a=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?-1:1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),a=e.ctrlKey||e.metaKey;break;default:a=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):a=!1;a&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,s,n=t.datepicker._getInst(e.target);return t.datepicker._get(n,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(e){var i,s=t.datepicker._getInst(e.target);if(s.input.val()!==s.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,t.datepicker._getFormatConfig(s)),i&&(t.datepicker._setDateFromField(s),t.datepicker._updateAlternate(s),t.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var s,n,o,r,h,l,c;s=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==s&&(t.datepicker._curInst.dpDiv.stop(!0,!0),s&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),n=t.datepicker._get(s,"beforeShow"),o=n?n.apply(e,[e,s]):{},o!==!1&&(a(s.settings,o),s.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(s),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),r=!1,t(e).parents().each(function(){return r|="fixed"===t(this).css("position"),!r}),h={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,s.dpDiv.empty(),s.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(s),h=t.datepicker._checkOffset(s,h,r),s.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":r?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),s.inline||(l=t.datepicker._get(s,"showAnim"),c=t.datepicker._get(s,"duration"),s.dpDiv.css("z-index",i(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[l]?s.dpDiv.show(l,t.datepicker._get(s,"showOptions"),c):s.dpDiv[l||"show"](l?c:null),t.datepicker._shouldFocusInput(s)&&s.input.trigger("focus"),t.datepicker._curInst=s))
}},_updateDatepicker:function(e){this.maxRows=4,m=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,s=this._getNumberOfMonths(e),n=s[1],a=17,r=e.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),e.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,s){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),a=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:t(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-a:0,i.left-=s&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=s&&i.top===e.input.offset().top+r?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+o>l&&l>o?Math.abs(o+r):0),i},_findPos:function(e){for(var i,s=this._getInst(e),n=this._get(s,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,s,n,o,a=this._curInst;!a||e&&a!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(a,"showAnim"),s=this._get(a,"duration"),n=function(){t.datepicker._tidyDialog(a)},t.effects&&(t.effects.effect[i]||t.effects[i])?a.dpDiv.hide(i,t.datepicker._get(a,"showOptions"),s,n):a.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,o=this._get(a,"onClose"),o&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),s=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==s)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,s){var n=t(e),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===s?this._get(o,"showCurrentAtPos"):0),s),this._updateDatepicker(o))},_gotoToday:function(e){var i,s=t(e),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(e,i,s){var n=t(e),o=this._getInst(n[0]);o["selected"+("M"===s?"Month":"Year")]=o["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(e,i,s,n){var o,a=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(a[0])||(o=this._getInst(a[0]),o.selectedDay=o.currentDay=t("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=s,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var s,n=t(e),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),s=this._get(o,"onSelect"),s?s.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(e){var i,s,n,o=this._get(e,"altField");o&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),s=this._getDate(e),n=this.formatDate(i,s,this._getFormatConfig(e)),t(o).val(n))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,s){if(null==e||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,o,a,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),u=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,d=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,_=-1,v=-1,b=!1,y=function(t){var i=e.length>n+1&&e.charAt(n+1)===t;return i&&n++,i},w=function(t){var e=y(t),s="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n="y"===t?s:1,o=RegExp("^\\d{"+n+","+s+"}"),a=i.substring(h).match(o);if(!a)throw"Missing number at position "+h;return h+=a[0].length,parseInt(a[0],10)},k=function(e,s,n){var o=-1,a=t.map(y(e)?n:s,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(a,function(t,e){var s=e[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(o=e[0],h+=s.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+h},x=function(){if(i.charAt(h)!==e.charAt(n))throw"Unexpected literal at position "+h;h++};for(n=0;e.length>n;n++)if(b)"'"!==e.charAt(n)||y("'")?x():b=!1;else switch(e.charAt(n)){case"d":_=w("d");break;case"D":k("D",u,d);break;case"o":v=w("o");break;case"m":m=w("m");break;case"M":m=k("M",p,f);break;case"y":g=w("y");break;case"@":r=new Date(w("@")),g=r.getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"!":r=new Date((w("!")-this._ticksTo1970)/1e4),g=r.getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"'":y("'")?x():b=!0;break;default:x()}if(i.length>h&&(a=i.substr(h),!/^\s+/.test(a)))throw"Extra/unparsed characters found in date: "+a;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c>=g?0:-100)),v>-1)for(m=1,_=v;;){if(o=this._getDaysInMonth(g,m-1),o>=_)break;m++,_-=o}if(r=this._daylightSavingAdjust(new Date(g,m-1,_)),r.getFullYear()!==g||r.getMonth()+1!==m||r.getDate()!==_)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,a=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(e){var i=t.length>s+1&&t.charAt(s+1)===e;return i&&s++,i},l=function(t,e,i){var s=""+e;if(h(t))for(;i>s.length;)s="0"+s;return s},c=function(t,e,i,s){return h(t)?s[e]:i[e]},u="",d=!1;if(e)for(s=0;t.length>s;s++)if(d)"'"!==t.charAt(s)||h("'")?u+=t.charAt(s):d=!1;else switch(t.charAt(s)){case"d":u+=l("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),n,o);break;case"o":u+=l("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=l("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),a,r);break;case"y":u+=h("y")?e.getFullYear():(10>e.getFullYear()%100?"0":"")+e.getFullYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":h("'")?u+="'":d=!0;break;default:u+=t.charAt(s)}return u},_possibleChars:function(t){var e,i="",s=!1,n=function(i){var s=t.length>e+1&&t.charAt(e+1)===i;return s&&e++,s};for(e=0;t.length>e;e++)if(s)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):s=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),s=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),o=n,a=this._getFormatConfig(t);try{o=this.parseDate(i,s,a)||n}catch(r){s=e?"":s}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=s?o.getDate():0,t.currentMonth=s?o.getMonth():0,t.currentYear=s?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,s){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},o=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,o=n.getFullYear(),a=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":a+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a));break;case"y":case"Y":o+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a))}l=h.exec(i)}return new Date(o,a,r)},a=null==i||""===i?s:"string"==typeof i?o(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return a=a&&"Invalid Date"==""+a?s:a,a&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var s=!e,n=t.selectedMonth,o=t.selectedYear,a=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=a.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=a.getMonth(),t.drawYear=t.selectedYear=t.currentYear=a.getFullYear(),n===t.selectedMonth&&o===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(s?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),s="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(s,-i,"M")},next:function(){t.datepicker._adjustDate(s,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(s)},selectDay:function(){return t.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(s,this,"Y"),!1}};t(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,s,n,o,a,r,h,l,c,u,d,p,f,g,m,_,v,b,y,w,k,x,C,D,I,T,P,M,S,H,z,O,A,N,W,E,F,L,R=new Date,B=this._daylightSavingAdjust(new Date(R.getFullYear(),R.getMonth(),R.getDate())),Y=this._get(t,"isRTL"),j=this._get(t,"showButtonPanel"),q=this._get(t,"hideIfNoPrevNext"),K=this._get(t,"navigationAsDateFormat"),U=this._getNumberOfMonths(t),V=this._get(t,"showCurrentAtPos"),$=this._get(t,"stepMonths"),X=1!==U[0]||1!==U[1],G=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),Q=this._getMinMaxDate(t,"min"),J=this._getMinMaxDate(t,"max"),Z=t.drawMonth-V,te=t.drawYear;if(0>Z&&(Z+=12,te--),J)for(e=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-U[0]*U[1]+1,J.getDate())),e=Q&&Q>e?Q:e;this._daylightSavingAdjust(new Date(te,Z,1))>e;)Z--,0>Z&&(Z=11,te--);for(t.drawMonth=Z,t.drawYear=te,i=this._get(t,"prevText"),i=K?this.formatDate(i,this._daylightSavingAdjust(new Date(te,Z-$,1)),this._getFormatConfig(t)):i,s=this._canAdjustMonth(t,-1,te,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":q?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=K?this.formatDate(n,this._daylightSavingAdjust(new Date(te,Z+$,1)),this._getFormatConfig(t)):n,o=this._canAdjustMonth(t,1,te,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":q?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",a=this._get(t,"currentText"),r=this._get(t,"gotoCurrent")&&t.currentDay?G:B,a=K?this.formatDate(a,r,this._getFormatConfig(t)):a,h=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",l=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(t,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+a+"</button>":"")+(Y?"":h)+"</div>":"",c=parseInt(this._get(t,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),_=this._get(t,"showOtherMonths"),v=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),y="",k=0;U[0]>k;k++){for(x="",this.maxRows=4,C=0;U[1]>C;C++){if(D=this._daylightSavingAdjust(new Date(te,Z,t.selectedDay)),I=" ui-corner-all",T="",X){if(T+="<div class='ui-datepicker-group",U[1]>1)switch(C){case 0:T+=" ui-datepicker-group-first",I=" ui-corner-"+(Y?"right":"left");break;case U[1]-1:T+=" ui-datepicker-group-last",I=" ui-corner-"+(Y?"left":"right");break;default:T+=" ui-datepicker-group-middle",I=""}T+="'>"}for(T+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+I+"'>"+(/all|left/.test(I)&&0===k?Y?o:s:"")+(/all|right/.test(I)&&0===k?Y?s:o:"")+this._generateMonthYearHeader(t,Z,te,Q,J,k>0||C>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",P=u?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)M=(w+c)%7,P+="<th scope='col'"+((w+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+d[M]+"'>"+p[M]+"</span></th>";for(T+=P+"</tr></thead><tbody>",S=this._getDaysInMonth(te,Z),te===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,S)),H=(this._getFirstDayOfMonth(te,Z)-c+7)%7,z=Math.ceil((H+S)/7),O=X?this.maxRows>z?this.maxRows:z:z,this.maxRows=O,A=this._daylightSavingAdjust(new Date(te,Z,1-H)),N=0;O>N;N++){for(T+="<tr>",W=u?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(A)+"</td>":"",w=0;7>w;w++)E=m?m.apply(t.input?t.input[0]:null,[A]):[!0,""],F=A.getMonth()!==Z,L=F&&!v||!E[0]||Q&&Q>A||J&&A>J,W+="<td class='"+((w+c+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(A.getTime()===D.getTime()&&Z===t.selectedMonth&&t._keyEvent||b.getTime()===A.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!_?"":" "+E[1]+(A.getTime()===G.getTime()?" "+this._currentClass:"")+(A.getTime()===B.getTime()?" ui-datepicker-today":""))+"'"+(F&&!_||!E[2]?"":" title='"+E[2].replace(/'/g,"&#39;")+"'")+(L?"":" data-handler='selectDay' data-event='click' data-month='"+A.getMonth()+"' data-year='"+A.getFullYear()+"'")+">"+(F&&!_?"&#xa0;":L?"<span class='ui-state-default'>"+A.getDate()+"</span>":"<a class='ui-state-default"+(A.getTime()===B.getTime()?" ui-state-highlight":"")+(A.getTime()===G.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+A.getDate()+"</a>")+"</td>",A.setDate(A.getDate()+1),A=this._daylightSavingAdjust(A);T+=W+"</tr>"}Z++,Z>11&&(Z=0,te++),T+="</tbody></table>"+(X?"</div>"+(U[0]>0&&C===U[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=T}y+=x}return y+=l,t._keyEvent=!1,y},_generateMonthYearHeader:function(t,e,i,s,n,o,a,r){var h,l,c,u,d,p,f,g,m=this._get(t,"changeMonth"),_=this._get(t,"changeYear"),v=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",y="";if(o||!m)y+="<span class='ui-datepicker-month'>"+a[e]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;12>c;c++)(!h||c>=s.getMonth())&&(!l||n.getMonth()>=c)&&(y+="<option value='"+c+"'"+(c===e?" selected='selected'":"")+">"+r[c]+"</option>");y+="</select>"}if(v||(b+=y+(!o&&m&&_?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!_)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},f=p(u[0]),g=Math.max(f,p(u[1]||"")),f=s?Math.max(f,s.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),v&&(b+=(!o&&m&&_?"":"&#xa0;")+y),b+="</div>"},_adjustInstDate:function(t,e,i){var s=t.selectedYear+("Y"===i?e:0),n=t.selectedMonth+("M"===i?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(s,n))+("D"===i?e:0),a=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(s,n,o)));t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return s&&n>s?s:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,s){var n=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,s+(0>e?e:n[0]*n[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var i,s,n=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),a=null,r=null,h=this._get(t,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),a=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(a+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||e.getTime()>=n.getTime())&&(!o||e.getTime()<=o.getTime())&&(!a||e.getFullYear()>=a)&&(!r||r>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,s){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(s,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).on("mousedown",t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new s,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.12.1",t.datepicker,t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var _=!1;t(document).on("mouseup",function(){_=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!_){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),_=!0,!0)):!0}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,_=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blurActiveElement(e),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]),s=t(e.target);s.closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],s&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),h=t.pageX,l=t.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,h=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(h=this.originalPageX),"x"===a.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,s){var n=t("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(e,i,s){var n=s.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(e,i,s){var n=s.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),o!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){var n,o,a,r,h,l,c,u,d,p,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height;for(d=s.snapElements.length-1;d>=0;d--)h=s.snapElements[d].left-s.margins.left,l=h+s.snapElements[d].width,c=s.snapElements[d].top-s.margins.top,u=c+s.snapElements[d].height,h-g>_||m>l+g||c-g>b||v>u+g||!t.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(u-v),a=g>=Math.abs(h-_),r=g>=Math.abs(l-m),n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||o||a||r,"outer"!==f.snapMode&&(n=g>=Math.abs(c-v),o=g>=Math.abs(u-b),a=g>=Math.abs(h-m),r=g>=Math.abs(l-_),n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=n||o||a||r||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,s){var n,o=s.options,a=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(e,i,s){var n=s.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0?!0:(e[s]=1,n=e[s]>0,e[s]=0,n)},_create:function(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles();break;default:}},_setupHandles:function(){var e,i,s,n,o,a=this.options,r=this;if(this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++)e=t.trim(s[i]),n="ui-resizable-"+e,o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:a.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o);this._renderAxis=function(e){var i,s,n,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:r._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){r.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),r.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,s+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,s,n=this.originalMousePosition,o=this.axis,a=e.pageX-n.left||0,r=e.pageY-n.top||0,h=this._change[o];return this._updatePrevProperties(),h?(i=h.apply(this,[e,a,r]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,s,n,o,a,r,h,l=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=s?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-n},r=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,h=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,l.animate||this.element.css(t.extend(a,{top:h,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!l.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,h=this.originalPosition.top+this.originalSize.height,l=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&l&&(t.left=r-e.minWidth),s&&l&&(t.left=r-e.maxWidth),a&&c&&(t.top=h-e.minHeight),n&&c&&(t.top=h-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(n[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-a},l=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(h,c&&l?{top:c,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,s,n,o,a,r,h=t(this).resizable("instance"),l=h.options,c=h.element,u=l.containment,d=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;d&&(h.containerElement=t(d),/document/.test(u)||u===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=h._num(e.css("padding"+s))}),h.containerOffset=e.offset(),h.containerPosition=e.position(),h.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,o=h.containerSize.width,a=h._hasScroll(d,"left")?d.scrollWidth:o,r=h._hasScroll(d)?d.scrollHeight:n,h.parentData={element:d,left:s.left,top:s.top,width:a,height:r}))},resize:function(e){var i,s,n,o,a=t(this).resizable("instance"),r=a.options,h=a.containerOffset,l=a.position,c=a._aspectRatio||e.shiftKey,u={top:0,left:0},d=a.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=h),l.left<(a._helper?h.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-h.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=r.helper?h.left:0),l.top<(a._helper?h.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-h.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?h.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-u.left:a.offset.left-h.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-u.top:a.offset.top-h.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),h=a.outerWidth()-e.sizeDiff.width,l=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),t.uiBackCompat!==!1&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,c=h[1]||1,u=Math.round((n.width-o.width)/l)*l,d=Math.round((n.height-o.height)/c)*c,p=o.width+u,f=o.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>f;s.grid=h,_&&(p+=l),v&&(f+=c),g&&(p-=l),m&&(f-=c),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=a.top-d):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=a.left-u):((0>=f-c||0>=p-l)&&(e=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=a.top-d):(f=c-e.height,i.size.height=f,i.position.top=a.top+o.height-f),p-l>0?(i.size.width=p,i.position.left=a.left-u):(p=l-e.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),t.ui.resizable,t.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog
},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&this._trigger("beforeClose",e)!==!1&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t.ui.safeBlur(t.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),s=!0),s&&!i&&this._trigger("focus",e),s},open:function(){var e=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=t(t.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"),void 0)},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).trigger("focus")},_keepFocus:function(e){function i(){var e=t.ui.safeActiveElement(this.document[0]),i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),this.close(e),void 0;if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==s[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){n.trigger("focus")}),e.preventDefault()):(this._delay(function(){s.trigger("focus")}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?(this._removeClass(this.uiDialog,"ui-dialog-buttons"),void 0):(t.each(i,function(i,s){var n,o;s=t.isFunction(s)?{click:s,text:i}:s,s=t.extend({type:"button"},s),n=s.click,o={icon:s.icon,iconPosition:s.iconPosition,showLabel:s.showLabel,icons:s.icons,text:s.text},delete s.click,delete s.icon,delete s.iconPosition,delete s.showLabel,delete s.icons,"boolean"==typeof s.text&&delete s.text,t("<button></button>",s).button(o).appendTo(e.uiButtonSet).on("click",function(){n.apply(e.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){i._addClass(t(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,e(n))},drag:function(t,s){i._trigger("drag",t,e(s))},stop:function(n,o){var a=o.offset.left-i.document.scrollLeft(),r=o.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" "+"top"+(r>=0?"+":"")+r,of:i.window},i._removeClass(t(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,s=this.options,n=s.resizable,o=this.uiDialog.css("position"),a="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:a,start:function(s,n){i._addClass(t(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,e(n))},resize:function(t,s){i._trigger("resize",t,e(s))},stop:function(n,o){var a=i.uiDialog.offset(),r=a.left-i.document.scrollLeft(),h=a.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" "+"top"+(h>=0?"+":"")+h,of:i.window},i._removeClass(t(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,s=!1,n={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(s=!0),t in i.resizableRelatedOptions&&(n[t]=e)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,i){var s,n,o=this.uiDialog;"disabled"!==e&&(this._super(e,i),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&(s=o.is(":data(ui-draggable)"),s&&!i&&o.draggable("destroy"),!s&&i&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(n=o.is(":data(ui-resizable)"),n&&!i&&o.resizable("destroy"),n&&"string"==typeof i&&o.resizable("option","handles",i),n||i===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),t=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),e=Math.max(0,s.minHeight-t),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-t):"none","auto"===s.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return t(e.target).closest(".ui-dialog").length?!0:!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?(e=arguments[0],void 0):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var s=t.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&v(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var v=t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,s,n){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,a=(e.positionAbs||e.position.absolute).top+e.margins.top,r=o+e.helperProportions.width,h=a+e.helperProportions.height,l=i.offset.left,c=i.offset.top,u=l+i.proportions().width,d=c+i.proportions().height;switch(s){case"fit":return o>=l&&u>=r&&a>=c&&d>=h;case"intersect":return o+e.helperProportions.width/2>l&&u>r-e.helperProportions.width/2&&a+e.helperProportions.height/2>c&&d>h-e.helperProportions.height/2;case"pointer":return t(n.pageY,c,i.proportions().height)&&t(n.pageX,l,i.proportions().width);case"touch":return(a>=c&&d>=a||h>=c&&d>=h||c>a&&h>d)&&(o>=l&&u>=o||r>=l&&u>=r||l>o&&r>u);default:return!1}}}();t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++)if(!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if(r[n]===o[s].element[0]){o[s].proportions().height=0;continue t}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&v(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,o,a=v(e,this,this.options.tolerance,i),r=!a&&this.isover?"isout":a&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===n}),o.length&&(s=t(o[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.uiBackCompat!==!1&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=t("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),this._refreshValue(),void 0)},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,e===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),s=i.offset(),n={left:s.left-e.elementPos.left,top:s.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,s?"ui-unselecting":"ui-selected")._addClass(n.$element,s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,h=e.pageY;return o>r&&(i=r,r=o,o=i),a>h&&(i=h,h=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:h-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),l=!1,c={};i&&i.element!==s.element[0]&&(c.left=i.left+s.elementPos.left,c.right=i.right+s.elementPos.left,c.top=i.top+s.elementPos.top,c.bottom=i.bottom+s.elementPos.top,"touch"===n.tolerance?l=!(c.left>r||o>c.right||c.top>h||a>c.bottom):"fit"===n.tolerance&&(l=c.left>o&&r>c.right&&c.top>a&&h>c.bottom),l?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.selectmenu",[t.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=t()},_drawButton:function(){var e,i=this,s=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),e=t("<span>").appendTo(this.button),this._addClass(e,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(s).appendTo(this.button),this.options.width!==!1&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(t,i){t.preventDefault(),e._setSelection(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,i){var s=i.item.data("ui-selectmenu-item");null!=e.focusIndex&&s.index!==e.focusIndex&&(e._trigger("focus",t,{item:s}),e.isOpen||e._select(s,t)),e.focusIndex=s.index,e.button.attr("aria-activedescendant",e.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var t,e=this.element.find("option");this.menu.empty(),this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,e.length&&(t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t)))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(e){var i=t("<span>");return this._setText(i,e.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(e,i){var s=this,n="";t.each(i,function(i,o){var a;o.optgroup!==n&&(a=t("<li>",{text:o.optgroup}),s._addClass(a,"ui-selectmenu-optgroup","ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),a.appendTo(e),n=o.optgroup),s._renderItemData(e,o)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var s=t("<li>"),n=t("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(s,null,"ui-state-disabled"),this._setText(n,i.label),s.append(n).appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),n+=":not(.ui-state-disabled)"),s="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](n).eq(-1):i[t+"All"](n).eq(0),s.length&&this.menuInstance.focus(e,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_setSelection:function(){var t;this.range&&(window.getSelection?(t=window.getSelection(),t.removeAllRanges(),t.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+t.ui.escapeSelector(this.ids.button)).length||this.close(e))}},_buttonEvents:{mousedown:function(){var t;window.getSelection?(t=window.getSelection(),t.rangeCount&&(this.range=t.getRangeAt(0))):this.range=document.selection.createRange()},click:function(t){this._setSelection(),this._toggle(t)},keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex).parent("li");e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(t)),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(t){var e=this.menuItems.eq(t.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){if("icons"===t){var i=this.button.find("span.ui-icon");this._removeClass(i,null,this.options.icons.button)._addClass(i,null,e.button)}this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"width"===t&&this._resizeButton()},_setOptionDisabled:function(t){this._super(t),this.menuInstance.option("disabled",t),this.button.attr("aria-disabled",t),this._toggleClass(this.button,null,"ui-state-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;return t===!1?(this.button.css("width",""),void 0):(null===t&&(t=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(t),void 0)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var t=this._super();return t.disabled=this.element.prop("disabled"),t},_parseOptions:function(e){var i=this,s=[];e.each(function(e,n){s.push(i._parseOption(t(n),e))}),this.items=s},_parseOption:function(t,e){var i=t.parent("optgroup");return{element:t,index:e,value:t.val(),label:t.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||t.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),t.widget("ui.slider",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1
},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle"),o="<span tabindex='0'></span>",a=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)a.push(o);this.handles=n.add(t(a.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e).attr("tabIndex",0)})},_createRange:function(){var e=this.options;e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=t("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===e.range||"max"===e.range)&&this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,o,a,r,h,l,c=this,u=this.options;return u.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-c.values(e));(n>i||n===i&&(e===c._lastChangedValue||c.values(e)===u.min))&&(n=i,o=t(this),a=e)}),r=this._start(e,a),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,this._addClass(o,null,"ui-state-active"),o.trigger("focus"),h=o.offset(),l=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:e.pageX-h.left-o.width()/2,top:e.pageY-h.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,o;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/e,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),o=this._valueMin()+s*n,this._trimAlignValue(o)},_uiHash:function(t,e,i){var s={handle:this.handles[t],handleIndex:t,value:void 0!==e?e:this.value()};return this._hasMultipleValues()&&(s.value=void 0!==e?e:this.values(t),s.values=i||this.values()),s},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(t,e){return this._trigger("start",t,this._uiHash(e))},_slide:function(t,e,i){var s,n,o=this.value(),a=this.values();this._hasMultipleValues()&&(n=this.values(e?0:1),o=this.values(e),2===this.options.values.length&&this.options.range===!0&&(i=0===e?Math.min(n,i):Math.max(n,i)),a[e]=i),i!==o&&(s=this._trigger("slide",t,this._uiHash(e,i,a)),s!==!1&&(this._hasMultipleValues()?this.values(e,i):this.value(i)))},_stop:function(t,e){this._trigger("stop",t,this._uiHash(e))},_change:function(t,e){this._keySliding||this._mouseSliding||(this._lastChangedValue=e,this._trigger("change",t,this._uiHash(e)))},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(e,i){var s,n,o;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),this._change(null,e),void 0;if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this._hasMultipleValues()?this._values(e):this.value();for(s=this.options.values,n=arguments[0],o=0;s.length>o;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),this._super(e,i),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=n-1;s>=0;s--)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(t){this._super(t),this._toggleClass(null,"ui-state-disabled",!!t)},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this._hasMultipleValues()){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step,s=Math.round((t-e)/i)*i;t=s+e,t>this.options.max&&(t-=i),this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(t){"vertical"===t&&this.range.css({width:"",left:""}),"horizontal"===t&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var e,i,s,n,o,a=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,c={};this._hasMultipleValues()?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),c["horizontal"===h.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[l?"animate":"css"](c,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?100*((s-n)/(o-n)):0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](c,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:100-i+"%"},r.animate),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:100-i+"%"},r.animate))},_handleEvents:{keydown:function(e){var i,s,n,o,a=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(t(e.target),null,"ui-state-active"),i=this._start(e,a),i===!1))return}switch(o=this.options.step,s=n=this._hasMultipleValues()?this.values(a):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-o)}this._slide(e,a,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),this._removeClass(t(e.target),null,"ui-state-active"))}}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,h=r+t.height,l=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+l>r&&h>s+l,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=s&&n;return o?(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1)):!1},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],h=[],l=this._connectWith();if(l&&e)for(s=l.length-1;s>=0;s--)for(o=t(l[s],this.document[0]),n=o.length-1;n>=0;n--)a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&h.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(h.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,h,l,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i],this.document[0]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],r=u[i][0],s=0,l=r.length;l>s;s++)h=t(r[s]),h.data(this.widgetName+"-item",a),c.push({item:h,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,n,o,a,r,h,l,c,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,c=d.floating||this._isFloating(this.currentItem),a=c?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[a],l=!1,e[u]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(e[u]-h)&&(n=Math.abs(e[u]-h),o=this.items[s],this.direction=l?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;
this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e=this._super(),i=this.element;return t.each(["min","max","step"],function(t,s){var n=i.attr(s);null!=n&&n.length&&(e[s]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",t),void 0)},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var e=this.element[0]===t.ui.safeActiveElement(this.document[0]);e||(this.element.trigger("focus"),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===t.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)===!1?!1:(this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e),void 0):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(e){var i=this.options,s=t.ui.keyCode;switch(e.keyCode){case s.UP:return this._repeat(null,1,e),!0;case s.DOWN:return this._repeat(null,-1,e),!0;case s.PAGE_UP:return this._repeat(null,i.page,e),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_start:function(t){return this.spinning||this._trigger("start",t)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,s=this.options;return e=null!==s.min?s.min:0,i=t-e,i=Math.round(i/s.step)*s.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==s.max&&t>s.max?s.max:null!==s.min&&s.min>t?s.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){var i,s,n;return"culture"===t||"numberFormat"===t?(i=this._parse(this.element.val()),this.options[t]=e,this.element.val(this._format(i)),void 0):(("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(s=this.buttons.first().find(".ui-icon"),this._removeClass(s,null,this.options.icons.up),this._addClass(s,null,e.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,e.down)),this._super(t,e),void 0)},_setOptionDisabled:function(t){this._super(t),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable")},_setOptions:r(function(t){this._super(t)}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null===t?!1:t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:r(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:r(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:r(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:r(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?(r(this._value).call(this,t),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),t.uiBackCompat!==!1&&t.widget("ui.spinner",t.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),t.ui.spinner,t.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i,s;i=e.href.replace(t,""),s=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return e.hash.length>1&&i===s}}(),_create:function(){var e=this,i=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===e&&(s&&this.tabs.each(function(i,n){return t(n).attr("aria-controls")===s?(e=i,!1):void 0}),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===e||-1===e)&&(e=this.tabs.length?0:!1)),e!==!1&&(e=this.tabs.index(this.tabs.eq(e)),-1===e&&(e=i?!1:0)),!i&&e===!1&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(t.ui.safeActiveElement(this.document[0])).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:s++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:n=!1,s--;break;case t.ui.keyCode.END:s=this.anchors.length-1;break;case t.ui.keyCode.HOME:s=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),this._activate(s),void 0;case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),void 0;default:return}e.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),e.ctrlKey||e.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){function s(){return e>n&&(e=0),0>e&&(e=n),e}for(var n=this.tabs.length-1;-1!==t.inArray(s(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).trigger("focus"),t},_setOption:function(t,e){return"active"===t?(this._activate(e),void 0):(this._super(t,e),"collapsible"===t&&(this._toggleClass("ui-tabs-collapsible",null,e),e||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(e),"heightStyle"===t&&this._setupHeightStyle(e),void 0)},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=t(),this.anchors.each(function(i,s){var n,o,a,r=t(s).uniqueId().attr("id"),h=t(s).closest("li"),l=h.attr("aria-controls");e._isLocal(s)?(n=s.hash,a=n.substring(1),o=e.element.find(e._sanitizeSelector(n))):(a=h.attr("aria-controls")||t({}).uniqueId()[0].id,n="#"+a,o=e.element.find(n),o.length||(o=e._createPanel(a),o.insertAfter(e.panels[i-1]||e.tablist)),o.attr("aria-live","polite")),o.length&&(e.panels=e.panels.add(o)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":a,"aria-labelledby":r}),o.attr("aria-labelledby",r)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(e){var i,s,n;for(t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1),n=0;s=this.tabs[n];n++)i=t(s),e===!0||-1!==t.inArray(n,e)?(i.attr("aria-disabled","true"),this._addClass(i,null,"ui-state-disabled")):(i.removeAttr("aria-disabled"),this._removeClass(i,null,"ui-state-disabled"));this.options.disabled=e,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,e===!0)},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,s=this.element.parent();"fill"===e?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),s=e.css("position");"absolute"!==s&&"fixed"!==s&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,s=this.active,n=t(e.currentTarget),o=n.closest("li"),a=o[0]===s[0],r=a&&i.collapsible,h=r?t():this._getPanelForTab(o),l=s.length?this._getPanelForTab(s):t(),c={oldTab:s,oldPanel:l,newTab:r?t():o,newPanel:h};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||a&&!i.collapsible||this._trigger("beforeActivate",e,c)===!1||(i.active=r?!1:this.tabs.index(o),this.active=a?t():o,this.xhr&&this.xhr.abort(),l.length||h.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(o),e),this._toggle(e,c))},_toggle:function(e,i){function s(){o.running=!1,o._trigger("activate",e,i)}function n(){o._addClass(i.newTab.closest("li"),"ui-tabs-active","ui-state-active"),a.length&&o.options.show?o._show(a,o.options.show,s):(a.show(),s())}var o=this,a=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){o._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),n()}):(this._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),a.length&&r.length?i.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),a.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){var i,s=this._findActive(e);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+t.ui.escapeSelector(e)+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;i!==!1&&(void 0===e?i=!1:(e=this._getIndex(e),i=t.isArray(i)?t.map(i,function(t){return t!==e?t:null}):t.map(this.tabs,function(t,i){return i!==e?i:null})),this._setOptionDisabled(i))},disable:function(e){var i=this.options.disabled;if(i!==!0){if(void 0===e)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setOptionDisabled(i)}},load:function(e,i){e=this._getIndex(e);var s=this,n=this.tabs.eq(e),o=n.find(".ui-tabs-anchor"),a=this._getPanelForTab(n),r={tab:n,panel:a},h=function(t,e){"abort"===e&&s.panels.stop(!1,!0),s._removeClass(n,"ui-tabs-loading"),a.removeAttr("aria-busy"),t===s.xhr&&delete s.xhr};this._isLocal(o[0])||(this.xhr=t.ajax(this._ajaxSettings(o,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(n,"ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.done(function(t,e,n){setTimeout(function(){a.html(t),s._trigger("load",i,r),h(n,e)},1)}).fail(function(t,e){setTimeout(function(){h(t,e)},1)})))},_ajaxSettings:function(e,i,s){var n=this;return{url:e.attr("href").replace(/#.*$/,""),beforeSend:function(e,o){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:o},s))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),t.uiBackCompat!==!1&&t.widget("ui.tabs",t.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),t.ui.tabs,t.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var s=(e.attr("aria-describedby")||"").split(/\s+/);s.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(s.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),s=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,s);-1!==n&&s.splice(n,1),e.removeData("ui-tooltip-id"),s=t.trim(s.join(" ")),s?e.attr("aria-describedby",s):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=t([])},_setOption:function(e,i){var s=this;this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){s._updateContent(e.element)})},_setOptionDisabled:function(t){this[t?"_disable":"_enable"]()},_disable:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s.element[0],e.close(n,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var e=t(this);return e.is("[title]")?e.data("ui-tooltip-title",e.attr("title")).removeAttr("title"):void 0}))},_enable:function(){this.disabledTitles.each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))}),this.disabledTitles=t([])},open:function(e){var i=this,s=t(e?e.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&s.parents().each(function(){var e,s=t(this);s.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(e,s),this._updateContent(s,e))},_updateContent:function(t,e){var i,s=this.options.content,n=this,o=e?e.type:null;return"string"==typeof s||s.nodeType||s.jquery?this._open(e,t,s):(i=s.call(t[0],function(i){n._delay(function(){t.data("ui-tooltip-open")&&(e&&(e.type=o),this._open(e,t,i))})}),i&&this._open(e,t,i),void 0)},_open:function(e,i,s){function n(t){l.of=t,a.is(":hidden")||a.position(l)}var o,a,r,h,l=t.extend({},this.options.position);if(s){if(o=this._find(i))return o.tooltip.find(".ui-tooltip-content").html(s),void 0;i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),a=o.tooltip,this._addDescribedBy(i,a.attr("id")),a.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),h=t("<div>").html(a.find(".ui-tooltip-content").html()),h.removeAttr("name").find("[name]").removeAttr("name"),h.removeAttr("id").find("[id]").removeAttr("id"),h.appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:n}),n(e)):a.position(t.extend({of:i},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){a.is(":visible")&&(n(l.of),clearInterval(r))},t.fx.interval)),this._trigger("open",e,{tooltip:a})}},_registerCloseHandlers:function(e,i){var s={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var s=t.Event(e);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),e&&"mouseover"!==e.type||(s.mouseleave="close"),e&&"focusin"!==e.type||(s.focusout="close"),this._on(!0,i,s)},close:function(e){var i,s=this,n=t(e?e.currentTarget:this.element),o=this._find(n);return o?(i=o.tooltip,o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete s.parents[e]}),o.closing=!0,this._trigger("close",e,{tooltip:i}),o.hiding||(o.closing=!1)),void 0):(n.removeData("ui-tooltip-open"),void 0)},_tooltip:function(e){var i=t("<div>").attr("role","tooltip"),s=t("<div>").appendTo(i),n=i.uniqueId().attr("id");return this._addClass(s,"ui-tooltip-content"),this._addClass(i,"ui-tooltip","ui-widget ui-widget-content"),i.appendTo(this._appendTo(e)),this.tooltips[n]={element:e,tooltip:i}},_find:function(t){var e=t.data("ui-tooltip-id");return e?this.tooltips[e]:null},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_appendTo:function(t){var e=t.closest(".ui-front, dialog");return e.length||(e=this.document[0].body),e},_destroy:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur"),o=s.element;n.target=n.currentTarget=o[0],e.close(n,!0),t("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),t.uiBackCompat!==!1&&t.widget("ui.tooltip",t.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var t=this._superApply(arguments);return this.options.tooltipClass&&t.tooltip.addClass(this.options.tooltipClass),t}}),t.ui.tooltip});
(function(root, factory){
if(typeof define==='function'&&define.amd){
define(['jquery','jquery-ui'], factory);
}else if(typeof exports!=='undefined'){
var $, ui;
try {
$=require('jquery');
ui=require('jquery-ui');
} catch (e){}
module.exports=factory($, ui);
}else{
factory(root.jQuery, root.jQuery.ui, true);
}}(this, function($, _ui, toGlobal){
toGlobal=toGlobal||false;
var elFinder=function(elm, opts, bootCallback){
var self=this,
dfrdsBeforeBootup=[],
conflictChecks=['button', 'tooltip'],
node=$(elm),
prevEvents=$.extend(true, {}, $._data(node.get(0), 'events')),
prevContent=$('<div/>').append(node.contents()).attr('class', node.attr('class')||'').attr('style', node.attr('style')||''),
id=node.attr('id')||node.attr('id', 'elfauto' + $('.elfinder').length).attr('id'),
namespace='elfinder-' + id,
mousedown='mousedown.'+namespace,
keydown='keydown.'+namespace,
keypress='keypress.'+namespace,
keyup='keyup.'+namespace,
enabled=false,
prevEnabled=false,
events=['enable', 'disable', 'load', 'open', 'reload', 'select',  'add', 'remove', 'change', 'dblclick', 'getfile', 'lockfiles', 'unlockfiles', 'selectfiles', 'unselectfiles', 'dragstart', 'dragstop', 'search', 'searchend', 'viewchange'],
rules={},
cwd='',
cwdOptionsDefault={
path:'',
url:'',
tmbUrl:'',
disabled:[],
separator:'/',
archives:[],
extract:[],
copyOverwrite:true,
uploadOverwrite:true,
uploadMaxSize:0,
jpgQuality:100,
tmbCrop:false,
tmb:false
},
cwdOptions={},
files={},
hiddenFiles={},
ownFiles={},
selected=[],
listeners={},
shortcuts={},
clipboard=[],
remember={},
queue=[],
cwdQueue=[],
base=new self.command (self),
width='auto',
height=400,
heightBase=null,
textMimes=null,
soundPath='sounds/',
prevSorterStr='',
extToMimeTable,
diableUnloadCheck=false,
beeper=$(document.createElement('audio')).hide().appendTo('body')[0],
syncInterval,
autoSyncStop=0,
uiCmdMapPrev='',
gcJobRes=null,
open=function(data){
var volumeid, contextmenu, emptyDirs={}, stayDirs={},
rmClass, hashes, calc, gc, collapsed, prevcwd, sorterStr;
if(self.api >=2.1){
self.commandMap=(data.options.uiCmdMap&&Object.keys(data.options.uiCmdMap).length)? data.options.uiCmdMap:{};
if(uiCmdMapPrev!==JSON.stringify(self.commandMap)){
uiCmdMapPrev=JSON.stringify(self.commandMap);
}}else{
self.options.sync=0;
}
if(data.init){
files={};
ownFiles={};}else{
prevcwd=cwd;
rmClass='elfinder-subtree-loaded ' + self.res('class', 'navexpand');
collapsed=self.res('class', 'navcollapse');
hashes=Object.keys(files);
calc=function(i){
if(!files[i]){
return true;
}
var isDir=(files[i].mime==='directory'),
phash=files[i].phash,
pnav;
if((!isDir
|| emptyDirs[phash]
|| (!stayDirs[phash]
&& self.navHash2Elm(files[i].hash).is(':hidden')
&& self.navHash2Elm(phash).next('.elfinder-navbar-subtree').children().length > 100
)
)
&& (isDir||phash!==cwd)
&& ! remember[i]
){
if(isDir&&!emptyDirs[phash]){
emptyDirs[phash]=true;
self.navHash2Elm(phash)
.removeClass(rmClass)
.next('.elfinder-navbar-subtree').empty();
}
deleteCache(files[i]);
}else if(isDir){
stayDirs[phash]=true;
}};
gc=function(){
if(hashes.length){
gcJobRes&&gcJobRes._abort();
gcJobRes=self.asyncJob(calc, hashes, {
interval:20,
numPerOnce:100
}).done(function(){
var hd=self.storage('hide')||{items: {}};
if(Object.keys(hiddenFiles).length){
$.each(hiddenFiles, function(h){
if(!hd.items[h]){
delete hiddenFiles[h];
}});
}});
}};
self.trigger('filesgc').one('filesgc', function(){
hashes=[];
});
self.one('opendone', function(){
if(prevcwd!==cwd){
if(! node.data('lazycnt')){
gc();
}else{
self.one('lazydone', gc);
}}
});
}
self.sorters={};
cwd=data.cwd.hash;
cache(data.files);
if(!files[cwd]){
cache([data.cwd]);
}
sorterStr=JSON.stringify(self.sorters);
if(prevSorterStr!==sorterStr){
self.trigger('sorterupdate');
prevSorterStr=sorterStr;
}
self.lastDir(cwd);
self.autoSync();
},
cache=function(data, type){
var defsorter={ name: true, perm: true, date: true,  size: true, kind: true },
sorterChk = !self.sorters._checked,
l=data.length,
setSorter=function(file){
var f=file||{},
sorters=[];
$.each(self.sortRules, function(key){
if(defsorter[key]||typeof f[key]!=='undefined'||(key==='mode'&&typeof f.perm!=='undefined')){
sorters.push(key);
}});
self.sorters=self.arrayFlip(sorters, true);
self.sorters._checked=true;
},
keeps=['sizeInfo'],
changedParents={},
hideData=self.storage('hide')||{},
hides=hideData.items||{},
f, i, keepProp, parents, hidden;
for (i=0; i < l; i++){
f=Object.assign({}, data[i]);
hidden=(!hideData.show&&hides[f.hash])? true:false;
if(f.name&&f.hash&&f.mime){
if(!hidden){
if(sorterChk&&f.phash===cwd){
setSorter(f);
sorterChk=false;
}
if(f.phash&&(type==='add'||type==='change')){
if(parents=self.parents(f.phash)){
$.each(parents, function(){
changedParents[this]=true;
});
}}
}
if(files[f.hash]){
$.each(keeps, function(){
if(files[f.hash][this]&&! f[this]){
f[this]=files[f.hash][this];
}});
if(f.sizeInfo&&!f.size){
f.size=f.sizeInfo.size;
}
deleteCache(files[f.hash], true);
}
if(hides[f.hash]){
hiddenFiles[f.hash]=f;
}
if(hidden){
l--;
data.splice(i--, 1);
}else{
files[f.hash]=f;
if(f.mime==='directory'&&!ownFiles[f.hash]){
ownFiles[f.hash]={};}
if(f.phash){
if(!ownFiles[f.phash]){
ownFiles[f.phash]={};}
ownFiles[f.phash][f.hash]=true;
}}
}}
$.each(Object.keys(changedParents), function(){
var target=files[this];
if(target&&target.sizeInfo){
delete target.sizeInfo;
}});
sorterChk&&setSorter();
},
remove=function(removed){
var l=removed.length,
roots={},
rm=function(hash){
var file=files[hash], i;
if(file){
if(file.mime==='directory'){
if(roots[hash]){
delete self.roots[roots[hash]];
}
$.each(self.leafRoots, function(phash, roots){
var idx, pdir;
if((idx=$.inArray(hash, roots))!==-1){
if(roots.length===1){
if((pdir=Object.assign({}, files[phash]))&&pdir._realStats){
$.each(pdir._realStats, function(k, v){
pdir[k]=v;
});
remove(files[phash]._realStats);
self.change({ changed: [pdir] });
}
delete self.leafRoots[phash];
}else{
self.leafRoots[phash].splice(idx, 1);
}}
});
if(self.searchStatus.state < 2){
$.each(files, function(h, f){
f.phash==hash&&rm(h);
});
}}
if(file.phash){
if(parents=self.parents(file.phash)){
$.each(parents, function(){
changedParents[this]=true;
});
}}
deleteCache(files[hash]);
}},
changedParents={},
parents;
$.each(self.roots, function(k, v){
roots[v]=k;
});
while (l--){
rm(removed[l]);
}
$.each(Object.keys(changedParents), function(){
var target=files[this];
if(target&&target.sizeInfo){
delete target.sizeInfo;
}});
},
change=function(changed){
$.each(changed, function(i, file){
var hash=file.hash;
if(files[hash]){
$.each(Object.keys(files[hash]), function(i, v){
if(typeof file[v]==='undefined'){
delete files[hash][v];
}});
}
files[hash]=files[hash] ? Object.assign(files[hash], file):file;
});
},
deleteCache=function(file, update){
var hash=file.hash,
phash=file.phash;
if(phash&&ownFiles[phash]){
delete ownFiles[phash][hash];
}
if(!update){
ownFiles[hash]&&delete ownFiles[hash];
self.optionsByHashes[hash]&&delete self.optionsByHashes[hash];
}
delete files[hash];
},
requestMaxConn,
requestCnt=0,
requestQueue=[],
requestQueueSkipOpen=false,
execShortcut=function(e){
var code=e.keyCode,
ctrlKey = !!(e.ctrlKey||e.metaKey),
isMousedown=e.type==='mousedown',
ddm;
!isMousedown&&(self.keyState.keyCode=code);
self.keyState.ctrlKey=ctrlKey;
self.keyState.shiftKey=e.shiftKey;
self.keyState.metaKey=e.metaKey;
self.keyState.altKey=e.altKey;
if(isMousedown){
return;
}else if(e.type==='keyup'){
self.keyState.keyCode=null;
return;
}
if(enabled){
$.each(shortcuts, function(i, shortcut){
if(shortcut.type==e.type
&& shortcut.keyCode==code
&& shortcut.shiftKey==e.shiftKey
&& shortcut.ctrlKey==ctrlKey
&& shortcut.altKey==e.altKey){
e.preventDefault();
e.stopPropagation();
shortcut.callback(e, self);
self.debug('shortcut-exec', i+':'+shortcut.description);
}});
if(code==$.ui.keyCode.TAB&&!$(e.target).is(':input')){
e.preventDefault();
}
if(e.type==='keydown'&&code==$.ui.keyCode.ESCAPE){
if(! node.find('.ui-widget:visible').length){
self.clipboard().length&&self.clipboard([]);
}
if($.ui.ddmanager){
ddm=$.ui.ddmanager.current;
ddm&&ddm.helper&&ddm.cancel();
}
self.toHide(node.find('.ui-widget.elfinder-button-menu.elfinder-frontmost:visible'));
self.trigger('keydownEsc', e);
}}
},
date=new Date(),
utc,
i18n,
inFrame=(window.parent!==window),
parentIframe=(function(){
var pifm, ifms;
if(inFrame){
try {
ifms=$('iframe', window.parent.document);
if(ifms.length){
$.each(ifms, function(i, ifm){
if(ifm.contentWindow===window){
pifm=$(ifm);
return false;
}});
}} catch(e){}}
return pifm;
})(),
bootUp,
savedXhrSend;
if(!opts){
opts={};}
if(self.UA.Mobile){
$(window).on('orientationchange.'+namespace, function(){
var a=((screen&&screen.orientation&&screen.orientation.angle)||window.orientation||0) + 0;
if(a===-90){
a=270;
}
self.UA.Angle=a;
self.UA.Rotated=a % 180===0? false:true;
}).trigger('orientationchange.'+namespace);
}
if(opts.bootCallback&&typeof opts.bootCallback==='function'){
(function(){
var func=bootCallback,
opFunc=opts.bootCallback;
bootCallback=function(fm, extraObj){
func&&typeof func==='function'&&func.call(this, fm, extraObj);
opFunc.call(this, fm, extraObj);
};})();
}
delete opts.bootCallback;
this.api=null;
this.newAPI=false;
this.oldAPI=false;
this.netDrivers=[];
this.baseUrl='';
this.i18nBaseUrl='';
this.cssloaded=false;
this.theme=null;
this.mimesCanMakeEmpty={};
this.bootCallback;
this.reloadCallback;
this.id=id;
this.storage=(function(){
try {
if('localStorage' in window&&window.localStorage!==null){
if(self.UA.Safari){
window.localStorage.setItem('elfstoragecheck', 1);
window.localStorage.removeItem('elfstoragecheck');
}
return self.localStorage;
}else{
return self.cookie;
}} catch (e){
return self.cookie;
}})();
this.pauseUnloadCheck=function(state, keep){
if(typeof state==='undefined'){
return diableUnloadCheck;
}else{
diableUnloadCheck = !!state;
if(state&&!keep){
requestAnimationFrame(function(){
diableUnloadCheck=false;
});
}}
};
this.options=Object.assign({}, this._options);
if(opts.uiOptions){
if(opts.uiOptions.toolbar&&Array.isArray(opts.uiOptions.toolbar)){
if($.isPlainObject(opts.uiOptions.toolbar[opts.uiOptions.toolbar.length - 1])){
self.options.uiOptions.toolbarExtra=Object.assign(self.options.uiOptions.toolbarExtra||{}, opts.uiOptions.toolbar.pop());
}}
}
(function(){
var arrOv=function(obj, base){
if($.isPlainObject(obj)){
$.each(obj, function(k, v){
if($.isPlainObject(v)){
if(!base[k]){
base[k]={};}
arrOv(v, base[k]);
}else{
base[k]=v;
}});
}};
arrOv(opts, self.options);
})();
this.options.uiOptions.toolbar.push(this.options.uiOptions.toolbarExtra);
delete this.options.uiOptions.toolbarExtra;
this.toUnbindEvents={};
this.bind=function(event, callback, priorityFirst){
var i, len;
if(callback&&(typeof callback==='function'||typeof callback.done==='function')){
event=('' + event).toLowerCase().replace(/^\s+|\s+$/g, '').split(/\s+/);
len=event.length;
for (i=0; i < len; i++){
if(listeners[event[i]]===void(0)){
listeners[event[i]]=[];
}
listeners[event[i]][priorityFirst? 'unshift':'push'](callback);
}}
return this;
};
this.unbind=function(event, callback){
var i, len, l, ci;
event=('' + event).toLowerCase().split(/\s+/);
len=event.length;
for (i=0; i < len; i++){
if(l=listeners[event[i]]){
ci=$.inArray(callback, l);
ci > -1&&l.splice(ci, 1);
}}
callback=null;
return this;
};
this.trigger=function(evType, data, allowModify){
var type=evType.toLowerCase(),
isopen=(type==='open'),
dataIsObj=(typeof data==='object'),
handlers=listeners[type]||[],
dones=[],
i, l, jst, event;
this.debug('event-'+type, data);
if(! dataIsObj||typeof allowModify==='undefined'){
allowModify=true;
}
if(l=handlers.length){
event=$.Event(type);
if(data){
data._event=event;
}
if(allowModify){
event.data=data;
}
for (i=0; i < l; i++){
if(! handlers[i]){
continue;
}
if(handlers[i].done){
dones.push(handlers[i].done);
continue;
}
if(handlers[i].length){
if(!allowModify){
if(typeof jst==='undefined'){
try {
jst=JSON.stringify(data);
} catch(e){
jst=false;
}}
event.data=jst? JSON.parse(jst):data;
}}
try {
if(handlers[i].call(event, event, this)===false||event.isDefaultPrevented()){
this.debug('event-stoped', event.type);
break;
}} catch (ex){
window.console&&window.console.log&&window.console.log(ex);
}}
if(l=dones.length){
for (i=0; i < l; i++){
try {
if(dones[i].call(event, event, this)===false||event.isDefaultPrevented()){
this.debug('event-stoped', event.type + '(done)');
break;
}} catch (ex){
window.console&&window.console.log&&window.console.log(ex);
}}
}
if(this.toUnbindEvents[type]&&this.toUnbindEvents[type].length){
$.each(this.toUnbindEvents[type], function(i, v){
self.unbind(v.type, v.callback);
});
delete this.toUnbindEvents[type];
}}
return this;
};
this.getListeners=function(event){
return event? listeners[event.toLowerCase()]:listeners;
};
this.baseUrl=(function(){
var myTag, myCss, base, baseUrl;
if(self.options.baseUrl){
return self.options.baseUrl;
}else{
baseUrl='';
myTag=null;
$('head > script').each(function(){
if(this.src&&this.src.match(/js\/elfinder(?:-[a-z0-9_-]+)?\.(?:min|full)\.js$/i)){
myTag=$(this);
return false;
}});
if(myTag){
myCss=$('head > link[href$="css/elfinder.min.css"],link[href$="css/elfinder.full.css"]:first').length;
if(! myCss){
self.cssloaded=null;
}
baseUrl=myTag.attr('src').replace(/js\/[^\/]+$/, '');
if(! baseUrl.match(/^(https?\/\/|\/)/)){
if(base=$('head > base[href]').attr('href')){
baseUrl=base.replace(/\/$/, '') + '/' + baseUrl;
}}
}
if(baseUrl!==''){
self.options.baseUrl=baseUrl;
}else{
if(! self.options.baseUrl){
self.options.baseUrl='./';
}
baseUrl=self.options.baseUrl;
}
return baseUrl;
}})();
this.i18nBaseUrl=(this.options.i18nBaseUrl||this.baseUrl + 'js/i18n').replace(/\/$/, '') + '/';
this.options.maxErrorDialogs=Math.max(1, parseInt(this.options.maxErrorDialogs||5));
cwdOptionsDefault.dispInlineRegex=this.options.dispInlineRegex;
if(this.options.cssAutoLoad){
(function(){
var baseUrl=self.baseUrl;
if(Array.isArray(self.options.cssAutoLoad)){
if(self.cssloaded===true){
self.loadCss(self.options.cssAutoLoad);
}else{
self.bind('cssloaded', function(){
self.loadCss(self.options.cssAutoLoad);
});
}}
if(self.cssloaded===null){
node.data('cssautoloadHide', $('<style>.elfinder{visibility:hidden;overflow:hidden}</style>'));
$('head').append(node.data('cssautoloadHide'));
if(!self.options.themes.default){
self.options.themes=Object.assign({
'default':{
'name': 'default',
'cssurls': 'css/theme.css',
'author': 'elFinder Project',
'license': '3-clauses BSD'
}}, self.options.themes);
if(!self.options.theme){
self.options.theme='default';
}}
self.loadCss([baseUrl+'css/elfinder.min.css'], {
dfd: $.Deferred().always(function(){
if(node.data('cssautoloadHide')){
node.data('cssautoloadHide').remove();
node.removeData('cssautoloadHide');
}}).done(function(){
if(!self.cssloaded){
self.cssloaded=true;
self.trigger('cssloaded');
}}).fail(function(){
self.cssloaded=false;
self.error(['errRead', 'CSS (elfinder or theme)']);
})
});
}
self.options.cssAutoLoad=false;
})();
}
this.changeTheme(this.storage('theme')||this.options.theme);
this.optionProperties={
icon: void(0),
csscls: void(0),
tmbUrl: void(0),
uiCmdMap: {},
netkey: void(0),
disabled: []
};
if(! inFrame&&! this.options.enableAlways&&$('body').children().length===2){
this.options.enableAlways=true;
}
if(this.options.debug===true){
this.options.debug='all';
}else if(Array.isArray(this.options.debug)){
(function(){
var d={};
$.each(self.options.debug, function(){
d[this]=true;
});
self.options.debug=d;
})();
}else{
this.options.debug=false;
}
this.noConflicts={};
this.noConflict=function(){
$.each(conflictChecks, function(i, p){
if($.fn[p]&&typeof $.fn[p].noConflict==='function'){
self.noConflicts[p]=$.fn[p].noConflict();
}});
};
this.noConflict();
this.isCORS=false;
(function(){
if(typeof self.options.cors!=='undefined'&&self.options.cors!==null){
self.isCORS=self.options.cors? true:false;
}else{
var parseUrl=document.createElement('a'),
parseUploadUrl,
selfProtocol=window.location.protocol,
portReg=function(protocol){
protocol=(!protocol||protocol===':')? selfProtocol:protocol;
return protocol==='https:'? /\:443$/:/\:80$/;
},
selfHost=window.location.host.replace(portReg(selfProtocol), '');
parseUrl.href=opts.url;
if(opts.urlUpload&&(opts.urlUpload!==opts.url)){
parseUploadUrl=document.createElement('a');
parseUploadUrl.href=opts.urlUpload;
}
if(selfHost!==parseUrl.host.replace(portReg(parseUrl.protocol), '')
|| (parseUrl.protocol!==':'&&parseUrl.protocol!==''&&(selfProtocol!==parseUrl.protocol))
|| (parseUploadUrl &&
(selfHost!==parseUploadUrl.host.replace(portReg(parseUploadUrl.protocol), '')
|| (parseUploadUrl.protocol!==':'&&parseUploadUrl.protocol!==''&&(selfProtocol!==parseUploadUrl.protocol))
)
)
){
self.isCORS=true;
}}
if(self.isCORS){
if(!$.isPlainObject(self.options.customHeaders)){
self.options.customHeaders={};}
if(!$.isPlainObject(self.options.xhrFields)){
self.options.xhrFields={};}
self.options.requestType='post';
self.options.customHeaders['X-Requested-With']='XMLHttpRequest';
self.options.xhrFields['withCredentials']=true;
}})();
this.requestType=/^(get|post)$/i.test(this.options.requestType) ? this.options.requestType.toLowerCase():'get';
requestMaxConn=Math.max(parseInt(this.options.requestMaxConn), 1);
this.optsCustomData=$.isPlainObject(this.options.customData) ? this.options.customData:{};
this.customData=Object.assign({}, this.optsCustomData);
this.prevCustomData=null;
this.customHeaders=$.isPlainObject(this.options.customHeaders) ? this.options.customHeaders:{};
this.xhrFields=$.isPlainObject(this.options.xhrFields) ? this.options.xhrFields:{};
this.replaceXhrSend=function(){
if(! savedXhrSend){
savedXhrSend=XMLHttpRequest.prototype.send;
}
XMLHttpRequest.prototype.send=function(){
var xhr=this;
if(self.customHeaders){
$.each(self.customHeaders, function(key){
xhr.setRequestHeader(key, this);
});
}
if(self.xhrFields){
$.each(self.xhrFields, function(key){
if(key in xhr){
xhr[key]=this;
}});
}
return savedXhrSend.apply(this, arguments);
};};
this.restoreXhrSend=function(){
savedXhrSend&&(XMLHttpRequest.prototype.send=savedXhrSend);
};
this.abortCmdsOnOpen=this.options.abortCmdsOnOpen||['tmb', 'parents'];
this.navPrefix='nav' + (elFinder.prototype.uniqueid? elFinder.prototype.uniqueid:'') + '-';
this.cwdPrefix=elFinder.prototype.uniqueid? ('cwd' + elFinder.prototype.uniqueid + '-'):'';
++elFinder.prototype.uniqueid;
this.uploadURL=opts.urlUpload||opts.url;
this.namespace=namespace;
this.today=(new Date(date.getFullYear(), date.getMonth(), date.getDate())).getTime()/1000;
this.yesterday=this.today - 86400;
utc=this.options.UTCDate ? 'UTC':'';
this.getHours='get'+utc+'Hours';
this.getMinutes='get'+utc+'Minutes';
this.getSeconds='get'+utc+'Seconds';
this.getDate='get'+utc+'Date';
this.getDay='get'+utc+'Day';
this.getMonth='get'+utc+'Month';
this.getFullYear='get'+utc+'FullYear';
this.zIndex;
this.searchStatus={
state:0,
query:'',
target:'',
mime:'',
mixed:false,
ininc:false
};
this.lang=this.storage('lang')||this.options.lang;
if(this.lang==='jp'){
this.lang=this.options.lang='ja';
}
this.viewType=this.storage('view')||this.options.defaultView||'icons';
this.sortType=this.storage('sortType')||this.options.sortType||'name';
this.sortOrder=this.storage('sortOrder')||this.options.sortOrder||'asc';
this.sortStickFolders=this.storage('sortStickFolders');
if(this.sortStickFolders===null){
this.sortStickFolders = !!this.options.sortStickFolders;
}else{
this.sortStickFolders = !!this.sortStickFolders;
}
this.sortAlsoTreeview=this.storage('sortAlsoTreeview');
if(this.sortAlsoTreeview===null||this.options.sortAlsoTreeview===null){
this.sortAlsoTreeview = !!this.options.sortAlsoTreeview;
}else{
this.sortAlsoTreeview = !!this.sortAlsoTreeview;
}
this.sortRules=$.extend(true, {}, this._sortRules, this.options.sortRules);
$.each(this.sortRules, function(name, method){
if(typeof method!='function'){
delete self.sortRules[name];
}});
this.compare=$.proxy(this.compare, this);
this.notifyDelay=this.options.notifyDelay > 0 ? parseInt(this.options.notifyDelay):500;
this.draggingUiHelper=null;
this.droppable={
greedy:true,
tolerance:'pointer',
accept:'.elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file,.elfinder-cwd-filename',
hoverClass:this.res('class', 'adroppable'),
classes:{
'ui-droppable-hover': this.res('class', 'adroppable')
},
autoDisable: true,
drop:function(e, ui){
var dst=$(this),
targets=$.grep(ui.helper.data('files')||[], function(h){ return h? true:false; }),
result=[],
dups=[],
faults=[],
isCopy=ui.helper.hasClass('elfinder-drag-helper-plus'),
c='class',
cnt, hash, i, h;
if(typeof e.button==='undefined'||ui.helper.data('namespace')!==namespace||! self.insideWorkzone(e.pageX, e.pageY)){
return false;
}
if(dst.hasClass(self.res(c, 'cwdfile'))){
hash=self.cwdId2Hash(dst.attr('id'));
}else if(dst.hasClass(self.res(c, 'navdir'))){
hash=self.navId2Hash(dst.attr('id'));
}else{
hash=cwd;
}
cnt=targets.length;
while (cnt--){
h=targets[cnt];
if(h!=hash&&files[h].phash!=hash){
result.push(h);
}else{
((isCopy&&h!==hash&&files[hash].write)? dups:faults).push(h);
}}
if(faults.length){
return false;
}
ui.helper.data('droped', true);
if(dups.length){
ui.helper.hide();
self.exec('duplicate', dups, {_userAction: true});
}
if(result.length){
ui.helper.hide();
self.clipboard(result, !isCopy);
self.exec('paste', hash, {_userAction: true}, hash).always(function(){
self.clipboard([]);
self.trigger('unlockfiles', {files:targets});
});
self.trigger('drop', {files:targets});
}}
};
this.enabled=function(){
return enabled&&this.visible();
};
this.visible=function(){
return node[0].elfinder&&node.is(':visible');
};
this.isRoot=function(file){
return (file.isroot||! file.phash)? true:false;
};
this.root=function(hash, fake){
hash=hash||cwd;
var dir, i;
if(! fake){
$.each(self.roots, function(id, rhash){
if(hash.indexOf(id)===0){
dir=rhash;
return false;
}});
if(dir){
return dir;
}}
dir=files[hash];
while (dir&&dir.phash&&(fake||! dir.isroot)){
dir=files[dir.phash];
}
if(dir){
return dir.hash;
}
while (i in files&&files.hasOwnProperty(i)){
dir=files[i];
if(dir.mime==='directory'&&!dir.phash&&dir.read){
return dir.hash;
}}
return '';
};
this.cwd=function(){
return files[cwd]||{};};
this.option=function(name, target){
var res, item;
target=target||cwd;
if(self.optionsByHashes[target]&&typeof self.optionsByHashes[target][name]!=='undefined'){
return self.optionsByHashes[target][name];
}
if(self.hasVolOptions&&cwd!==target&&(!(item=self.file(target))||item.phash!==cwd)){
res='';
$.each(self.volOptions, function(id, opt){
if(target.indexOf(id)===0){
res=opt[name]||'';
return false;
}});
return res;
}else{
return cwdOptions[name]||'';
}};
this.getDisabledCmds=function(targets, flip){
var disabled={'hidden': true};
if(! Array.isArray(targets)){
targets=[ targets ];
}
$.each(targets, function(i, h){
var disCmds=self.option('disabledFlip', h);
if(disCmds){
Object.assign(disabled, disCmds);
}});
return flip? disabled:Object.keys(disabled);
};
this.file=function(hash, alsoHidden){
return hash? (files[hash]||(alsoHidden? hiddenFiles[hash]:void(0))):void(0);
};
this.files=function(phash){
var items={};
if(phash){
if(!ownFiles[phash]){
return {};}
$.each(ownFiles[phash], function(h){
if(files[h]){
items[h]=files[h];
}else{
delete ownFiles[phash][h];
}});
return Object.assign({}, items);
}
return Object.assign({}, files);
};
this.parents=function(hash){
var parents=[],
dir;
while (hash&&(dir=this.file(hash))){
parents.unshift(dir.hash);
hash=dir.phash;
}
return parents;
};
this.path2array=function(hash, i18){
var file,
path=[];
while (hash){
if((file=files[hash])&&file.hash){
path.unshift(i18&&file.i18 ? file.i18:file.name);
hash=file.isroot? null:file.phash;
}else{
path=[];
break;
}}
return path;
};
this.path=function(hash, i18, asyncOpt){
var path=files[hash]&&files[hash].path
? files[hash].path
: this.path2array(hash, i18).join(cwdOptions.separator);
if(! asyncOpt||! files[hash]){
return path;
}else{
asyncOpt=Object.assign({notify: {type:'parents', cnt:1, hideCnt:true}}, asyncOpt);
var dfd=$.Deferred(),
notify=asyncOpt.notify,
noreq=false,
req=function(){
self.request({
data:{cmd:'parents', target:files[hash].phash},
notify:notify,
preventFail:true
})
.done(done)
.fail(function(){
dfd.reject();
});
},
done=function(){
self.one('parentsdone', function(){
path=self.path(hash, i18);
if(path===''&&noreq){
noreq=false;
req();
}else{
if(notify){
clearTimeout(ntftm);
notify.cnt=-(parseInt(notify.cnt||0));
self.notify(notify);
}
dfd.resolve(path);
}});
},
ntftm;
if(path){
return dfd.resolve(path);
}else{
if(self.ui['tree']){
if(notify){
ntftm=setTimeout(function(){
self.notify(notify);
}, self.notifyDelay);
}
noreq=true;
done(true);
}else{
req();
}
return dfd;
}}
};
this.url=function(hash, o){
var file=files[hash],
opts=o||{},
async=opts.async||false,
temp=opts.temporary||false,
onetm=(opts.onetime&&self.option('onetimeUrl', hash))||false,
absurl=opts.absurl||false,
dfrd=(async||onetm)? $.Deferred():null,
filter=function(url){
if(url&&absurl){
url=self.convAbsUrl(url);
}
return url;
},
getUrl=function(url){
if(url){
return filter(url);
}
if(file.url){
return filter(file.url);
}
if(typeof baseUrl==='undefined'){
baseUrl=self.option('url', (!self.isRoot(file)&&file.phash)||file.hash);
}
if(baseUrl){
return filter(baseUrl + $.map(self.path2array(hash), function(n){ return encodeURIComponent(n); }).slice(1).join('/'));
}
var params=Object.assign({}, self.customData, {
cmd: 'file',
target: file.hash
});
if(self.oldAPI){
params.cmd='open';
params.current=file.phash;
}
return filter(self.options.url + (self.options.url.indexOf('?')===-1 ? '?':'&') + $.param(params, true));
},
baseUrl, res;
if(!file||!file.read){
return async? dfrd.resolve(''):'';
}
if(onetm){
async=true;
this.request({
data:{ cmd:'url', target:hash, options:{ onetime: 1 }},
preventDefault:true,
options: {async: async},
notify: {type:'file', cnt:1, hideCnt:true}}).done(function(data){
dfrd.resolve(filter(data.url||''));
}).fail(function(){
dfrd.resolve('');
});
}else{
if(file.url=='1'||(temp&&!file.url&&!(baseUrl=self.option('url', (!self.isRoot(file)&&file.phash)||file.hash)))){
this.request({
data:{ cmd:'url', target:hash, options:{ temporary: temp? 1:0 }},
preventDefault:true,
options: {async: async},
notify: async? {type:temp? 'file':'url', cnt:1, hideCnt:true}:{}})
.done(function(data){
file.url=data.url||'';
})
.fail(function(){
file.url='';
})
.always(function(){
var url;
if(file.url&&temp){
url=file.url;
file.url='1';
}
if(async){
dfrd.resolve(getUrl(url));
}else{
return getUrl(url);
}});
}else{
if(async){
dfrd.resolve(getUrl());
}else{
return getUrl();
}}
}
if(async){
return dfrd;
}};
this.forExternalUrl=function(hash, options){
var onetime=self.option('onetimeUrl', hash),
opts={
async: true,
absurl: true
};
opts[onetime? 'onetime':'temporary']=true;
return self.url(hash, Object.assign({}, options, opts));
};
this.openUrl=function(hash, download){
var file=files[hash],
url='';
if(!file||!file.read){
return '';
}
if(!download){
if(file.url){
if(file.url!=1){
url=file.url;
}}else if(cwdOptions.url&&file.hash.indexOf(self.cwd().volumeid)===0){
url=cwdOptions.url + $.map(this.path2array(hash), function(n){ return encodeURIComponent(n); }).slice(1).join('/');
}
if(url){
url +=(url.match(/\?/)? '&':'?') + '_'.repeat((url.match(/[\?&](_+)t=/g)||['&t=']).sort().shift().match(/[\?&](_*)t=/)[1].length + 1) + 't=' + (file.ts||parseInt(+new Date()/1000));
return url;
}}
url=this.options.url;
url=url + (url.indexOf('?')===-1 ? '?':'&')
+ (this.oldAPI ? 'cmd=open&current='+file.phash:'cmd=file')
+ '&target=' + file.hash
+ '&_t=' + (file.ts||parseInt(+new Date()/1000));
if(download){
url +='&download=1';
}
$.each(this.customData, function(key, val){
url +='&' + encodeURIComponent(key) + '=' + encodeURIComponent(val);
});
return url;
};
this.tmb=function(file){
var tmbUrl, tmbCrop,
cls='elfinder-cwd-bgurl',
url='';
if($.isPlainObject(file)){
if(self.searchStatus.state&&file.hash.indexOf(self.cwd().volumeid)!==0){
tmbUrl=self.option('tmbUrl', file.hash);
tmbCrop=self.option('tmbCrop', file.hash);
}else{
tmbUrl=cwdOptions['tmbUrl'];
tmbCrop=cwdOptions['tmbCrop'];
}
if(tmbCrop){
cls +=' elfinder-cwd-bgurl-crop';
}
if(tmbUrl==='self'&&file.mime.indexOf('image/')===0){
url=self.openUrl(file.hash);
cls +=' elfinder-cwd-bgself';
}else if((self.oldAPI||tmbUrl)&&file&&file.tmb&&file.tmb!=1){
url=tmbUrl + file.tmb;
}else if(self.newAPI&&file&&file.tmb&&file.tmb!=1){
url=file.tmb;
}
if(url){
if(file.ts&&tmbUrl!=='self'){
url +=(url.match(/\?/)? '&':'?') + '_t=' + file.ts;
}
return { url: url, className: cls };}}
return false;
};
this.selected=function(){
return selected.slice(0);
};
this.selectedFiles=function(){
return $.map(selected, function(hash){ return files[hash] ? Object.assign({}, files[hash]):null; });
};
this.fileByName=function(name, phash){
var hash;
for (hash in files){
if(files.hasOwnProperty(hash)&&files[hash].phash==phash&&files[hash].name==name){
return files[hash];
}}
};
this.validResponse=function(cmd, data){
return data.error||this.rules[this.rules[cmd] ? cmd:'defaults'](data);
};
this.returnBytes=function(val){
var last;
if(isNaN(val)){
if(! val){
val='';
}
val=val.replace(/b$/i, '');
last=val.charAt(val.length - 1).toLowerCase();
val=val.replace(/[tgmk]$/i, '');
if(last=='t'){
val=val * 1024 * 1024 * 1024 * 1024;
}else if(last=='g'){
val=val * 1024 * 1024 * 1024;
}else if(last=='m'){
val=val * 1024 * 1024;
}else if(last=='k'){
val=val * 1024;
}
val=isNaN(val)? 0:parseInt(val);
}else{
val=parseInt(val);
if(val < 1) val=0;
}
return val;
};
this.request=function(opts){
var self=this,
o=this.options,
dfrd=$.Deferred(),
reqId=(+ new Date()).toString(16) + Math.floor(1000 * Math.random()).toString(16),
data=Object.assign({}, self.customData, {mimes:o.onlyMimes}, opts.data||opts),
cmd=data.cmd,
isBinary=(opts.options||{}).dataType==='binary',
isOpen=(!opts.asNotOpen&&cmd==='open'),
deffail  = !(isBinary||opts.preventDefault||opts.preventFail),
defdone  = !(isBinary||opts.preventDefault||opts.preventDone),
notify=Object.assign({}, opts.notify),
cancel   = !!opts.cancel,
raw=isBinary||!!opts.raw,
syncOnFail=opts.syncOnFail,
lazy     = !!opts.lazy,
prepare=opts.prepare,
navigate=opts.navigate,
timeout,
useCache=(opts.options||{}).cache,
options=Object.assign({
url:o.url,
async:true,
type:this.requestType,
dataType:'json',
cache:(self.api >=2.1029),
data:data,
headers:this.customHeaders,
xhrFields: this.xhrFields
}, opts.options||{}),
done=function(data){
data.warning&&self.error(data.warning);
if(isOpen){
open(data);
}else{
self.updateCache(data);
}
data.changed&&data.changed.length&&change(data.changed);
self.lazy(function(){
data.removed&&data.removed.length&&self.remove(data);
data.added&&data.added.length&&self.add(data);
data.changed&&data.changed.length&&self.change(data);
}).then(function(){
return self.lazy(function(){
self.trigger(cmd, data, false);
});
}).then(function(){
return self.lazy(function(){
self.trigger(cmd + 'done');
});
}).then(function(){
if(data.toasts&&Array.isArray(data.toasts)){
$.each(data.toasts, function(){
this.msg&&self.toast(this);
});
}
data.sync&&self.sync();
});
},
error=function(xhr, status){
var error, data,
d=self.options.debug;
switch (status){
case 'abort':
error=xhr.quiet ? '':['errConnect', 'errAbort'];
break;
case 'timeout':
error=['errConnect', 'errTimeout'];
break;
case 'parsererror':
error=['errResponse', 'errDataNotJSON'];
if(xhr.responseText){
if(! cwd||(d&&(d==='all'||d['backend-error']))){
error.push(xhr.responseText);
}}
break;
default:
if(xhr.responseText){
try {
data=JSON.parse(xhr.responseText);
if(data&&data.error){
error=data.error;
}} catch(e){}}
if(! error){
if(xhr.status==403){
error=['errConnect', 'errAccess', 'HTTP error ' + xhr.status];
}else if(xhr.status==404){
error=['errConnect', 'errNotFound', 'HTTP error ' + xhr.status];
}else if(xhr.status >=500){
error=['errResponse', 'errServerError', 'HTTP error ' + xhr.status];
}else{
if(xhr.status==414&&options.type==='get'){
options.type='post';
self.abortXHR(xhr);
dfrd.xhr=xhr=self.transport.send(options).fail(error).done(success);
return;
}
error=xhr.quiet ? '':['errConnect', 'HTTP error ' + xhr.status];
}}
}
self.trigger(cmd + 'done');
dfrd.reject({error: error}, xhr, status);
},
success=function(response){
var d=self.options.debug;
self.currentReqCmd=cmd;
if(response.debug&&(!d||d!=='all')){
if(!d){
d=self.options.debug={};}
d['backend-error']=true;
d['warning']=true;
}
if(raw){
self.abortXHR(xhr);
response&&response.debug&&self.debug('backend-debug', response);
return dfrd.resolve(response);
}
if(!response){
return dfrd.reject({error :['errResponse', 'errDataEmpty']}, xhr, response);
}else if(!$.isPlainObject(response)){
return dfrd.reject({error :['errResponse', 'errDataNotJSON']}, xhr, response);
}else if(response.error){
if(isOpen){
$.each(self.leafRoots, function(phash, roots){
self.leafRoots[phash]=$.grep(roots, function(h){ return h!==data.target; });
});
}
return dfrd.reject({error :response.error}, xhr, response);
}
var resolve=function(){
var pushLeafRoots=function(name){
if(self.leafRoots[data.target]&&response[name]){
$.each(self.leafRoots[data.target], function(i, h){
var root;
if(root=self.file(h)){
response[name].push(root);
}});
}},
setTextMimes=function(){
self.textMimes={};
$.each(self.res('mimes', 'text'), function(){
self.textMimes[this.toLowerCase()]=true;
});
},
actionTarget;
if(isOpen){
pushLeafRoots('files');
}else if(cmd==='tree'){
pushLeafRoots('tree');
}
response=self.normalize(response);
if(!self.validResponse(cmd, response)){
return dfrd.reject({error :(response.norError||'errResponse')}, xhr, response);
}
if(isOpen){
if(!self.api){
self.api=response.api||1;
if(self.api=='2.0'&&typeof response.options.uploadMaxSize!=='undefined'){
self.api='2.1';
}
self.newAPI=self.api >=2;
self.oldAPI = !self.newAPI;
}
if(response.textMimes&&Array.isArray(response.textMimes)){
self.resources.mimes.text=response.textMimes;
setTextMimes();
}
!self.textMimes&&setTextMimes();
if(response.options){
cwdOptions=Object.assign({}, cwdOptionsDefault, response.options);
}
if(response.netDrivers){
self.netDrivers=response.netDrivers;
}
if(response.maxTargets){
self.maxTargets=response.maxTargets;
}
if(!!data.init){
self.uplMaxSize=self.returnBytes(response.uplMaxSize);
self.uplMaxFile = !!response.uplMaxFile? Math.min(parseInt(response.uplMaxFile), 50):20;
}}
if(typeof prepare==='function'){
prepare(response);
}
if(navigate){
actionTarget=navigate.target||'added';
if(response[actionTarget]&&response[actionTarget].length){
self.one(cmd + 'done', function(){
var targets=response[actionTarget],
newItems=self.findCwdNodes(targets),
inCwdHashes=function(){
var cwdHash=self.cwd().hash;
return $.map(targets, function(f){ return (f.phash&&cwdHash===f.phash)? f.hash:null; });
},
hashes=inCwdHashes(),
makeToast=function(t){
var node=void(0),
data=t.action? t.action.data:void(0),
cmd, msg, done;
if((data||hashes.length)&&t.action&&(msg=t.action.msg)&&(cmd=t.action.cmd)&&(!t.action.cwdNot||t.action.cwdNot!==self.cwd().hash)){
done=t.action.done;
data=t.action.data;
node=$('<div/>')
.append($('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">'
+self.i18n(msg)
+'</span></button>')
.on('mouseenter mouseleave', function(e){
$(this).toggleClass('ui-state-hover', e.type=='mouseenter');
})
.on('click', function(){
self.exec(cmd, data||hashes, {_userAction: true, _currentType: 'toast', _currentNode: $(this) });
if(done){
self.one(cmd+'done', function(){
if(typeof done==='function'){
done();
}else if(done==='select'){
self.trigger('selectfiles', {files:inCwdHashes()});
}});
}})
);
}
delete t.action;
t.extNode=node;
return t;
};
if(! navigate.toast){
navigate.toast={};}
!navigate.noselect&&self.trigger('selectfiles', {files:self.searchStatus.state > 1 ? $.map(targets, function(f){ return f.hash; }):hashes});
if(newItems.length){
if(!navigate.noscroll){
newItems.first().trigger('scrolltoview', {blink:false});
self.resources.blink(newItems, 'lookme');
}
if($.isPlainObject(navigate.toast.incwd)){
self.toast(makeToast(navigate.toast.incwd));
}}else{
if($.isPlainObject(navigate.toast.inbuffer)){
self.toast(makeToast(navigate.toast.inbuffer));
}}
});
}}
dfrd.resolve(response);
response.debug&&self.debug('backend-debug', response);
};
self.abortXHR(xhr);
lazy? self.lazy(resolve):resolve();
},
xhr, _xhr,
xhrAbort=function(e){
if(xhr&&xhr.state()==='pending'){
self.abortXHR(xhr, { quiet: true , abort: true });
if(!e||(e.type!=='unload'&&e.type!=='destroy')){
self.autoSync();
}}
},
abort=function(e){
self.trigger(cmd + 'done');
if(e.type=='autosync'){
if(e.data.action!='stop') return;
}else if(e.type!='unload'&&e.type!='destroy'&&e.type!='openxhrabort'){
if(!e.data.added||!e.data.added.length){
return;
}}
xhrAbort(e);
},
request=function(mode){
var queueAbort=function(){
syncOnFail=false;
dfrd.reject();
};
if(mode){
if(mode==='cmd'){
return cmd;
}}
if(isOpen){
if(requestQueueSkipOpen){
return dfrd.reject();
}
requestQueueSkipOpen=true;
}
dfrd.always(function(){
delete options.headers['X-elFinderReqid'];
}).fail(function(error, xhr, response){
var errData={
cmd: cmd,
err: error,
xhr: xhr,
rc: response
};
if(error===0){
if(requestQueue.length){
requestQueue=$.grep(requestQueue, function(req){
return (req('cmd')===cmd) ? false:true;
});
}}
self.trigger('requestError', errData);
if(errData._event&&errData._event.isDefaultPrevented()){
deffail=false;
syncOnFail=false;
if(error){
error.error='';
}}
xhrAbort();
if(isOpen){
openDir=self.file(data.target);
openDir&&openDir.volumeid&&self.isRoot(openDir)&&delete self.volumeExpires[openDir.volumeid];
}
self.trigger(cmd + 'fail', response);
if(error){
deffail ? self.error(error):self.debug('error', self.i18n(error));
}
syncOnFail&&self.sync();
});
if(!cmd){
syncOnFail=false;
return dfrd.reject({error :'errCmdReq'});
}
if(self.maxTargets&&data.targets&&data.targets.length > self.maxTargets){
syncOnFail=false;
return dfrd.reject({error :['errMaxTargets', self.maxTargets]});
}
defdone&&dfrd.done(done);
if(isOpen){
while ((_xhr=queue.pop())){
_xhr.queueAbort();
}
if(cwd!==data.target){
while ((_xhr=cwdQueue.pop())){
_xhr.queueAbort();
}}
}
if($.inArray(cmd, (self.cmdsToAdd + ' autosync').split(' '))!==-1){
if(cmd!=='autosync'){
self.autoSync('stop');
dfrd.always(function(){
self.autoSync();
});
}
self.trigger('openxhrabort');
}
delete options.preventFail;
if(self.api >=2.1029){
if(useCache){
options.headers['X-elFinderReqid']=reqId;
}else{
Object.assign(options.data, { reqid:reqId });
}}
dfrd.syncOnFail=function(state){
syncOnFail = !!state;
};
requestCnt++;
dfrd.xhr=xhr=self.transport.send(options).always(function(){
if(options._xhr&&typeof options._xhr.responseURL!=='undefined'){
xhr.responseURL=options._xhr.responseURL||'';
}
--requestCnt;
if(requestQueue.length){
requestQueue.shift()();
}else{
requestQueueSkipOpen=false;
}}).fail(error).done(success);
if(self.api >=2.1029){
xhr._requestId=reqId;
}
if(isOpen||(data.compare&&cmd==='info')){
xhr.queueAbort=queueAbort;
queue.unshift(xhr);
data.compare&&self.bind(self.cmdsToAdd + ' autosync openxhrabort', abort);
dfrd.always(function(){
var ndx=$.inArray(xhr, queue);
data.compare&&self.unbind(self.cmdsToAdd + ' autosync openxhrabort', abort);
ndx!==-1&&queue.splice(ndx, 1);
});
}else if($.inArray(cmd, self.abortCmdsOnOpen)!==-1){
xhr.queueAbort=queueAbort;
cwdQueue.unshift(xhr);
dfrd.always(function(){
var ndx=$.inArray(xhr, cwdQueue);
ndx!==-1&&cwdQueue.splice(ndx, 1);
});
}
self.bind('unload destroy', abort);
dfrd.always(function(){
self.unbind('unload destroy', abort);
});
return dfrd;
},
queueingRequest=function(){
if(notify.type&&notify.cnt){
if(cancel){
notify.cancel=dfrd;
opts.eachCancel&&(notify.id=+new Date());
}
timeout=setTimeout(function(){
self.notify(notify);
dfrd.always(function(){
notify.cnt=-(parseInt(notify.cnt)||0);
self.notify(notify);
});
}, self.notifyDelay);
dfrd.always(function(){
clearTimeout(timeout);
});
}
if(isOpen){
requestQueueSkipOpen=false;
}
if(requestCnt < requestMaxConn){
return request();
}else{
if(isOpen){
requestQueue.unshift(request);
}else{
requestQueue.push(request);
}
return dfrd;
}},
bindData={opts: opts, result: true},
openDir;
if(!self.api&&!data.init){
syncOnFail=false;
return dfrd.reject();
}
self.trigger('request.' + cmd, bindData, true);
if(! bindData.result){
self.trigger(cmd + 'done');
return dfrd.reject();
}else if(typeof bindData.result==='object'&&bindData.result.promise){
bindData.result
.done(queueingRequest)
.fail(function(){
self.trigger(cmd + 'done');
dfrd.reject();
});
return dfrd;
}
return queueingRequest();
};
this.cache=function(dataArray){
if(! Array.isArray(dataArray)){
dataArray=[ dataArray ];
}
cache(dataArray);
};
this.updateCache=function(data){
if($.isPlainObject(data)){
data.files&&data.files.length&&cache(data.files, 'files');
data.tree&&data.tree.length&&cache(data.tree, 'tree');
data.removed&&data.removed.length&&remove(data.removed);
data.added&&data.added.length&&cache(data.added, 'add');
data.changed&&data.changed.length&&change(data.changed, 'change');
}};
this.diff=function(incoming, onlydir, excludeProps){
var raw={},
added=[],
removed=[],
changed=[],
excludes=null,
isChanged=function(hash){
var l=changed.length;
while (l--){
if(changed[l].hash==hash){
return true;
}}
};
$.each(incoming, function(i, f){
raw[f.hash]=f;
});
if(excludeProps&&excludeProps.length){
excludes={};
$.each(excludeProps, function(){
excludes[this]=true;
});
}
$.each(files, function(hash, f){
if(! raw[hash]&&(! onlydir||f.phash===onlydir)){
removed.push(hash);
}});
$.each(raw, function(hash, file){
var origin=files[hash],
orgKeys={},
chkKeyLen;
if(!origin){
added.push(file);
}else{
$.each(Object.keys(origin), function(){
orgKeys[this]=true;
});
$.each(file, function(prop){
delete orgKeys[prop];
if(! excludes||! excludes[prop]){
if(file[prop]!==origin[prop]){
changed.push(file);
orgKeys={};
return false;
}}
});
chkKeyLen=Object.keys(orgKeys).length;
if(chkKeyLen!==0){
if(excludes){
$.each(orgKeys, function(prop){
if(excludes[prop]){
--chkKeyLen;
}});
}
(chkKeyLen!==0)&&changed.push(file);
}}
});
$.each(removed, function(i, hash){
var file=files[hash],
phash=file.phash;
if(phash
&& file.mime=='directory'
&& $.inArray(phash, removed)===-1 
&& raw[phash]
&& !isChanged(phash)){
changed.push(raw[phash]);
}});
return {
added:added,
removed:removed,
changed:changed
};};
this.sync=function(onlydir, polling){
this.autoSync('stop');
var self=this,
compare=function(){
var c='', cnt=0, mtime=0;
if(onlydir&&polling){
$.each(files, function(h, f){
if(f.phash&&f.phash===onlydir){
++cnt;
mtime=Math.max(mtime, f.ts);
}
c=cnt+':'+mtime;
});
}
return c;
},
comp=compare(),
dfrd=$.Deferred().done(function(){ self.trigger('sync'); }),
opts=[this.request({
data:{cmd:'open', reload:1, target:cwd, tree:(! onlydir&&this.ui.tree) ? 1:0, compare:comp},
preventDefault:true
})],
exParents=function(){
var parents=[],
curRoot=self.file(self.root(cwd)),
curId=curRoot? curRoot.volumeid:null,
phash=self.cwd().phash,
isroot,pdir;
while(phash){
if(pdir=self.file(phash)){
if(phash.indexOf(curId)!==0){
parents.push({target: phash, cmd: 'tree'});
if(! self.isRoot(pdir)){
parents.push({target: phash, cmd: 'parents'});
}
curRoot=self.file(self.root(phash));
curId=curRoot? curRoot.volumeid:null;
}
phash=pdir.phash;
}else{
phash=null;
}}
return parents;
};
if(! onlydir&&self.api >=2){
(cwd!==this.root())&&opts.push(this.request({
data:{cmd:'parents', target:cwd},
preventDefault:true
}));
$.each(exParents(), function(i, data){
opts.push(self.request({
data:{cmd:data.cmd, target:data.target},
preventDefault:true
}));
});
}
$.when.apply($, opts)
.fail(function(error, xhr){
if(! polling||$.inArray('errOpen', error)!==-1){
dfrd.reject(error);
self.parseError(error)&&self.request({
data:{cmd:'open', target:(self.lastDir('')||self.root()), tree:1, init:1},
notify:{type:'open', cnt:1, hideCnt:true}});
}else{
dfrd.reject((error&&xhr.status!=0)? error:void 0);
}})
.done(function(odata){
var pdata, argLen, i;
if(odata.cwd.compare){
if(comp===odata.cwd.compare){
return dfrd.reject();
}}
pdata={tree:[]};
argLen=arguments.length;
if(argLen > 1){
for(i=1; i < argLen; i++){
if(arguments[i].tree&&arguments[i].tree.length){
pdata.tree.push.apply(pdata.tree, arguments[i].tree);
}}
}
if(self.api < 2.1){
if(! pdata.tree){
pdata.tree=[];
}
pdata.tree.push(odata.cwd);
}
odata=self.normalize(odata);
if(!self.validResponse('open', odata)){
return dfrd.reject((odata.norError||'errResponse'));
}
pdata=self.normalize(pdata);
if(!self.validResponse('tree', pdata)){
return dfrd.reject((pdata.norError||'errResponse'));
}
var diff=self.diff(odata.files.concat(pdata&&pdata.tree ? pdata.tree:[]), onlydir);
diff.added.push(odata.cwd);
self.updateCache(diff);
diff.removed.length&&self.remove(diff);
diff.added.length&&self.add(diff);
diff.changed.length&&self.change(diff);
return dfrd.resolve(diff);
})
.always(function(){
self.autoSync();
});
return dfrd;
};
this.upload=function(files){
return this.transport.upload(files, this);
};
/**
* Bind keybord shortcut to keydown event
*
* @example
*    elfinder.shortcut({
*       pattern:'ctrl+a',
*       description:'Select all files',
*       callback:function(e){ ... },
*       keypress:true|false (bind to keypress instead of keydown)
*    })
*
* @param  Object  shortcut config
* @return elFinder
*/
this.shortcut=function(s){
var patterns, pattern, code, i, parts;
if(this.options.allowShortcuts&&s.pattern&&$.isFunction(s.callback)){
patterns=s.pattern.toUpperCase().split(/\s+/);
for (i=0; i < patterns.length; i++){
pattern=patterns[i];
parts=pattern.split('+');
code=(code=parts.pop()).length==1 
? (code > 0 ? code:code.charCodeAt(0))
: (code > 0 ? code:$.ui.keyCode[code]);
if(code&&!shortcuts[pattern]){
shortcuts[pattern]={
keyCode:code,
altKey:$.inArray('ALT', parts)!=-1,
ctrlKey:$.inArray('CTRL', parts)!=-1,
shiftKey:$.inArray('SHIFT', parts)!=-1,
type:s.type||'keydown',
callback:s.callback,
description:s.description,
pattern:pattern
};}}
}
return this;
};
this.shortcuts=function(){
var ret=[];
$.each(shortcuts, function(i, s){
ret.push([s.pattern, self.i18n(s.description)]);
});
return ret;
};
this.clipboard=function(hashes, cut){
var map=function(){ return $.map(clipboard, function(f){ return f.hash; });};
if(hashes!==void(0)){
clipboard.length&&this.trigger('unlockfiles', {files:map()});
remember={};
clipboard=$.map(hashes||[], function(hash){
var file=files[hash];
if(file){
remember[hash]=true;
return {
hash:hash,
phash:file.phash,
name:file.name,
mime:file.mime,
read:file.read,
locked:file.locked,
cut:!!cut
};}
return null;
});
this.trigger('changeclipboard', {clipboard:clipboard.slice(0, clipboard.length)});
cut&&this.trigger('lockfiles', {files:map()});
}
return clipboard.slice(0, clipboard.length);
};
this.isCommandEnabled=function(name, dstHash){
var disabled, cmd,
cvid=self.cwd().volumeid||'';
if(!dstHash&&self.searchStatus.state > 1&&self.selected().length){
dstHash=self.selected()[0];
}
if(dstHash&&(! cvid||dstHash.indexOf(cvid)!==0)){
disabled=self.option('disabledFlip', dstHash);
}else{
disabled=cwdOptions.disabledFlip;
}
cmd=this._commands[name];
return cmd ? (cmd.alwaysEnabled||!disabled[name]):false;
};
this.exec=function(cmd, files, opts, dstHash){
var dfrd, resType;
if(!dstHash&&this.commandMap[cmd]&&this.commandMap[cmd]!=='hidden'){
cmd=this.commandMap[cmd];
}
if(cmd==='open'){
if(this.searchStatus.state||this.searchStatus.ininc){
this.trigger('searchend', { noupdate: true });
}
this.autoSync('stop');
}
if(!dstHash&&files){
if($.isArray(files)){
if(files.length){
dstHash=files[0];
}}else{
dstHash=files;
}}
dfrd=this._commands[cmd]&&this.isCommandEnabled(cmd, dstHash)
? this._commands[cmd].exec(files, opts)
: $.Deferred().reject('errUnknownCmd');
resType=typeof dfrd;
if(!(resType==='object'&&dfrd.promise)){
self.debug('warning', '"cmd.exec()" should be returned "$.Deferred" but cmd "' + cmd + '" returned "' + resType + '"');
dfrd=$.Deferred().resolve();
}
this.trigger('exec', { dfrd:dfrd, cmd:cmd, files:files, opts:opts, dstHash:dstHash });
return dfrd;
};
this.dialog=function(content, options){
var dialog=$('<div/>').append(content).appendTo(node).elfinderdialog(options, self),
dnode=dialog.closest('.ui-dialog'),
resize=function(){
! dialog.data('draged')&&dialog.is(':visible')&&dialog.elfinderdialog('posInit');
};
if(dnode.length){
self.bind('resize', resize);
dnode.on('remove', function(){
self.unbind('resize', resize);
});
}
return dialog;
};
this.toast=function(options){
return $('<div class="ui-front"/>').appendTo(this.ui.toast).elfindertoast(options||{}, this);
};
this.getUI=function(ui){
return ui? (this.ui[ui]||$()):node;
};
this.getCommand=function(name){
return name===void(0) ? this._commands:this._commands[name];
};
this.resize=function(w, h){
var getMargin=function(){
var m=node.outerHeight(true) - node.innerHeight(),
p=node;
while(p.get(0)!==heightBase.get(0)){
p=p.parent();
m +=p.outerHeight(true) - p.innerHeight();
if(! p.parent().length){
break;
}}
return m;
},
fit = ! node.hasClass('ui-resizable'),
prv=node.data('resizeSize')||{w: 0, h: 0},
mt, size={};
if(heightBase&&heightBase.data('resizeTm')){
clearTimeout(heightBase.data('resizeTm'));
}
if(typeof h==='string'){
if(mt=h.match(/^([0-9.]+)%$/)){
if(! heightBase||! heightBase.length){
heightBase=$(window);
}
if(! heightBase.data('marginToMyNode')){
heightBase.data('marginToMyNode', getMargin());
}
if(! heightBase.data('fitToBaseFunc')){
heightBase.data('fitToBaseFunc', function(e){
var tm=heightBase.data('resizeTm');
e.preventDefault();
e.stopPropagation();
tm&&cancelAnimationFrame(tm);
if(! node.hasClass('elfinder-fullscreen')&&(!self.UA.Mobile||heightBase.data('rotated')!==self.UA.Rotated)){
heightBase.data('rotated', self.UA.Rotated);
heightBase.data('resizeTm', requestAnimationFrame(function(){
self.restoreSize();
}));
}});
}
if(typeof heightBase.data('rotated')==='undefined'){
heightBase.data('rotated', self.UA.Rotated);
}
h=heightBase.height() * (mt[1] / 100) - heightBase.data('marginToMyNode');
heightBase.off('resize.' + self.namespace, heightBase.data('fitToBaseFunc'));
fit&&heightBase.on('resize.' + self.namespace, heightBase.data('fitToBaseFunc'));
}}
node.css({ width:w, height:parseInt(h) });
size.w=Math.round(node.width());
size.h=Math.round(node.height());
node.data('resizeSize', size);
if(size.w!==prv.w||size.h!==prv.h){
node.trigger('resize');
this.trigger('resize', {width:size.w, height:size.h});
}};
this.restoreSize=function(){
this.resize(width, height);
};
this.show=function(){
node.show();
this.enable().trigger('show');
};
this.hide=function(){
if(this.options.enableAlways){
prevEnabled=enabled;
enabled=false;
}
this.disable();
this.trigger('hide');
node.hide();
};
this.lazy=function(func, delay, opts){
var busy=function(state){
var cnt=node.data('lazycnt'),
repaint;
if(state){
repaint=node.data('lazyrepaint')? false:opts.repaint;
if(! cnt){
node.data('lazycnt', 1)
.addClass('elfinder-processing');
}else{
node.data('lazycnt', ++cnt);
}
if(repaint){
node.data('lazyrepaint', true).css('display');
}}else{
if(cnt&&cnt > 1){
node.data('lazycnt', --cnt);
}else{
repaint=node.data('lazyrepaint');
node.data('lazycnt', 0)
.removeData('lazyrepaint')
.removeClass('elfinder-processing');
repaint&&node.css('display');
self.trigger('lazydone');
}}
},
dfd=$.Deferred(),
callFunc=function(){
dfd.resolve(func.call(dfd));
busy(false);
};
delay=delay||0;
opts=opts||{};
busy(true);
if(delay){
setTimeout(callFunc, delay);
}else{
requestAnimationFrame(callFunc);
}
return dfd;
};
this.destroy=function(){
if(node&&node[0].elfinder){
node.hasClass('elfinder-fullscreen')&&self.toggleFullscreen(node);
this.options.syncStart=false;
this.autoSync('forcestop');
this.trigger('destroy').disable();
clipboard=[];
selected=[];
listeners={};
shortcuts={};
$(window).off('.' + namespace);
$(document).off('.' + namespace);
self.trigger=function(){};
$(beeper).remove();
node.off()
.removeData()
.empty()
.append(prevContent.contents())
.attr('class', prevContent.attr('class'))
.attr('style', prevContent.attr('style'));
delete node[0].elfinder;
$.each(prevEvents, function(n, arr){
$.each(arr, function(i, o){
node.on(o.type + (o.namespace? '.'+o.namespace:''), o.selector, o.handler);
});
});
}};
this.autoSync=function(mode){
var sync;
if(self.options.sync >=1000){
if(syncInterval){
clearTimeout(syncInterval);
syncInterval=null;
self.trigger('autosync', {action:'stop'});
}
if(mode==='stop'){
++autoSyncStop;
}else{
autoSyncStop=Math.max(0, --autoSyncStop);
}
if(autoSyncStop||mode==='forcestop'||! self.options.syncStart){
return;
}
sync=function(start){
var timeout;
if(cwdOptions.syncMinMs&&(start||syncInterval)){
start&&self.trigger('autosync', {action:'start'});
timeout=Math.max(self.options.sync, cwdOptions.syncMinMs);
syncInterval&&clearTimeout(syncInterval);
syncInterval=setTimeout(function(){
var dosync=true, hash=cwd, cts;
if(cwdOptions.syncChkAsTs&&files[hash]&&(cts=files[hash].ts)){
self.request({
data:{cmd:'info', targets:[hash], compare:cts, reload:1},
preventDefault:true
})
.done(function(data){
var ts;
dosync=true;
if(data.compare){
ts=data.compare;
if(ts==cts){
dosync=false;
}}
if(dosync){
self.sync(hash).always(function(){
if(ts){
files[hash].ts=ts;
}
sync();
});
}else{
sync();
}})
.fail(function(error, xhr){
var err=self.parseError(error);
if(err&&xhr.status!=0){
self.error(err);
if(Array.isArray(err)&&$.inArray('errOpen', err)!==-1){
self.request({
data:{cmd:'open', target:(self.lastDir('')||self.root()), tree:1, init:1},
notify:{type:'open', cnt:1, hideCnt:true}});
}}else{
syncInterval=setTimeout(function(){
sync();
}, timeout);
}});
}else{
self.sync(cwd, true).always(function(){
sync();
});
}}, timeout);
}};
sync(true);
}};
this.insideWorkzone=function(x, y, margin){
var rectangle=this.getUI('workzone').data('rectangle');
margin=margin||1;
if(x < rectangle.left + margin
|| x > rectangle.left + rectangle.width + margin
|| y < rectangle.top + margin
|| y > rectangle.top + rectangle.height + margin){
return false;
}
return true;
};
this.toFront=function(target){
var nodes=node.children('.ui-front').removeClass('elfinder-frontmost'),
lastnode=nodes.last();
nodes.css('z-index', '');
$(target).addClass('ui-front elfinder-frontmost').css('z-index', lastnode.css('z-index') + 1);
};
this.toHide=function(target, nohide){
var tgt=$(target),
last;
!nohide&&tgt.hide();
if(tgt.hasClass('elfinder-frontmost')){
tgt.removeClass('elfinder-frontmost');
last=node.children('.ui-front:visible:not(.elfinder-frontmost)').last();
if(last.length){
requestAnimationFrame(function(){
if(!node.children('.elfinder-frontmost:visible').length){
self.toFront(last);
last.trigger('frontmost');
}});
}}
};
this.getMaximizeCss=function(){
return {
width:'100%',
height:'100%',
margin:0,
top:0,
left:0,
display:'block',
position: 'fixed',
zIndex:Math.max(self.zIndex? (self.zIndex + 1):0 , 1000),
maxWidth:'',
maxHeight: ''
};};
(function(){
if(inFrame&&self.UA.Fullscreen){
self.UA.Fullscreen=false;
if(parentIframe&&typeof parentIframe.attr('allowfullscreen')!=='undefined'){
self.UA.Fullscreen=true;
}}
var orgStyle, bodyOvf, resizeTm, fullElm, exitFull, toFull, funcObj,
cls='elfinder-fullscreen',
clsN='elfinder-fullscreen-native',
checkDialog=function(){
var t=0,
l=0;
$.each(node.children('.ui-dialog,.ui-draggable'), function(i, d){
var $d=$(d),
pos=$d.position();
if(pos.top < 0){
$d.css('top', t);
t +=20;
}
if(pos.left < 0){
$d.css('left', l);
l +=20;
}});
},
setFuncObj=function(){
var useFullscreen=self.storage('useFullscreen');
funcObj=self.UA.Fullscreen&&(useFullscreen? useFullscreen > 0:self.options.commandsOptions.fullscreen.mode==='screen') ? {
fullElm: function(){
return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||null;
},
exitFull: function(){
if(document.exitFullscreen){
return document.exitFullscreen();
}else if(document.webkitExitFullscreen){
return document.webkitExitFullscreen();
}else if(document.mozCancelFullScreen){
return document.mozCancelFullScreen();
}else if(document.msExitFullscreen){
return document.msExitFullscreen();
}},
toFull: function(elem){
if(elem.requestFullscreen){
return elem.requestFullscreen();
}else if(elem.webkitRequestFullscreen){
return elem.webkitRequestFullscreen();
}else if(elem.mozRequestFullScreen){
return elem.mozRequestFullScreen();
}else if(elem.msRequestFullscreen){
return elem.msRequestFullscreen();
}
return false;
}}:{
fullElm: function(){
var full;
if(node.hasClass(cls)){
return node.get(0);
}else{
full=node.find('.' + cls);
if(full.length){
return full.get(0);
}}
return null;
},
exitFull: function(){
var elm;
$(window).off('resize.' + namespace, resize);
if(bodyOvf!==void(0)){
$('body').css('overflow', bodyOvf);
}
bodyOvf=void(0);
if(orgStyle){
elm=orgStyle.elm;
restoreStyle(elm);
$(elm).trigger('resize', {fullscreen: 'off'});
}
$(window).trigger('resize');
},
toFull: function(elem){
bodyOvf=$('body').css('overflow')||'';
$('body').css('overflow', 'hidden');
$(elem).css(self.getMaximizeCss())
.addClass(cls)
.trigger('resize', {fullscreen: 'on'});
checkDialog();
$(window).on('resize.' + namespace, resize).trigger('resize');
return true;
}};},
restoreStyle=function(elem){
if(orgStyle&&orgStyle.elm==elem){
$(elem).removeClass(cls + ' ' + clsN).attr('style', orgStyle.style);
orgStyle=null;
}},
resize=function(e){
var elm;
if(e.target===window){
resizeTm&&cancelAnimationFrame(resizeTm);
resizeTm=requestAnimationFrame(function(){
if(elm=funcObj.fullElm()){
$(elm).trigger('resize', {fullscreen: 'on'});
}});
}};
setFuncObj();
$(document).on('fullscreenchange.' + namespace + ' webkitfullscreenchange.' + namespace + ' mozfullscreenchange.' + namespace + ' MSFullscreenChange.' + namespace, function(e){
if(self.UA.Fullscreen){
var elm=funcObj.fullElm(),
win=$(window);
resizeTm&&cancelAnimationFrame(resizeTm);
if(elm===null){
win.off('resize.' + namespace, resize);
if(orgStyle){
elm=orgStyle.elm;
restoreStyle(elm);
$(elm).trigger('resize', {fullscreen: 'off'});
}}else{
$(elm).addClass(cls + ' ' + clsN)
.attr('style', 'width:100%; height:100%; margin:0; padding:0;')
.trigger('resize', {fullscreen: 'on'});
win.on('resize.' + namespace, resize);
checkDialog();
}
win.trigger('resize');
}});
self.toggleFullscreen=function(target, full){
var elm=$(target).get(0),
curElm=null;
curElm=funcObj.fullElm();
if(curElm){
if(curElm==elm){
if(full===true){
return curElm;
}}else{
if(full===false){
return curElm;
}}
funcObj.exitFull();
return null;
}else{
if(full===false){
return null;
}}
setFuncObj();
orgStyle={elm: elm, style: $(elm).attr('style')};
if(funcObj.toFull(elm)!==false){
return elm;
}else{
orgStyle=null;
return null;
}};})();
(function(){
var cls='elfinder-maximized',
resizeTm,
resize=function(e){
if(e.target===window&&e.data&&e.data.elm){
var elm=e.data.elm;
resizeTm&&cancelAnimationFrame(resizeTm);
resizeTm=requestAnimationFrame(function(){
elm.trigger('resize', {maximize: 'on'});
});
}},
exitMax=function(elm){
$(window).off('resize.' + namespace, resize);
$('body').css('overflow', elm.data('bodyOvf'));
elm.removeClass(cls)
.attr('style', elm.data('orgStyle'))
.removeData('bodyOvf')
.removeData('orgStyle');
elm.trigger('resize', {maximize: 'off'});
},
toMax=function(elm){
elm.data('bodyOvf', $('body').css('overflow')||'')
.data('orgStyle', elm.attr('style'))
.addClass(cls)
.css(self.getMaximizeCss());
$('body').css('overflow', 'hidden');
$(window).on('resize.' + namespace, {elm: elm}, resize);
elm.trigger('resize', {maximize: 'on'});
};
self.toggleMaximize=function(target, max){
var elm=$(target),
maximized=elm.hasClass(cls);
if(maximized){
if(max===true){
return;
}
exitMax(elm);
}else{
if(max===false){
return;
}
toMax(elm);
}};})();
Object.assign($.ui.keyCode, {
'F1':112,
'F2':113,
'F3':114,
'F4':115,
'F5':116,
'F6':117,
'F7':118,
'F8':119,
'F9':120,
'F10':121,
'F11':122,
'F12':123,
'DIG0':48,
'DIG1':49,
'DIG2':50,
'DIG3':51,
'DIG4':52,
'DIG5':53,
'DIG6':54,
'DIG7':55,
'DIG8':56,
'DIG9':57,
'NUM0':96,
'NUM1':97,
'NUM2':98,
'NUM3':99,
'NUM4':100,
'NUM5':101,
'NUM6':102,
'NUM7':103,
'NUM8':104,
'NUM9':105,
'CONTEXTMENU':93,
'DOT':190
});
this.dragUpload=false;
this.xhrUpload=(typeof XMLHttpRequestUpload!='undefined'||typeof XMLHttpRequestEventTarget!='undefined')&&typeof File!='undefined'&&typeof FormData!='undefined';
this.transport={};
if(typeof(this.options.transport)=='object'){
this.transport=this.options.transport;
if(typeof(this.transport.init)=='function'){
this.transport.init(this);
}}
if(typeof(this.transport.send)!='function'){
this.transport.send=function(opts){
if(!self.UA.IE){
opts._xhr=new XMLHttpRequest();
opts.xhr=function(){ return opts._xhr; };}
return $.ajax(opts);
};}
if(this.transport.upload=='iframe'){
this.transport.upload=$.proxy(this.uploads.iframe, this);
}else if(typeof(this.transport.upload)=='function'){
this.dragUpload = !!this.options.dragUploadAllow;
}else if(this.xhrUpload&&!!this.options.dragUploadAllow){
this.transport.upload=$.proxy(this.uploads.xhr, this);
this.dragUpload=true;
}else{
this.transport.upload=$.proxy(this.uploads.iframe, this);
}
this.decodeRawString=function(str){
var charCodes=function(str){
var i, len, arr;
for (i=0,len=str.length,arr=[]; i<len; i++){
arr.push(str.charCodeAt(i));
}
return arr;
},
scalarValues=function(arr){
var scalars=[], i, len, c;
if(typeof arr==='string'){arr=charCodes(arr);}
for (i=0,len=arr.length; c=arr[i],i<len; i++){
if(c >=0xd800&&c <=0xdbff){
scalars.push((c & 1023) + 64 << 10 | arr[++i] & 1023);
}else{
scalars.push(c);
}}
return scalars;
},
decodeUTF8=function(arr){
var i, len, c, str, char=String.fromCharCode;
for (i=0,len=arr.length,str=""; c=arr[i],i<len; i++){
if(c <=0x7f){
str +=char(c);
}else if(c <=0xdf&&c >=0xc2){
str +=char((c&31)<<6 | arr[++i]&63);
}else if(c <=0xef&&c >=0xe0){
str +=char((c&15)<<12 | (arr[++i]&63)<<6 | arr[++i]&63);
}else if(c <=0xf7&&c >=0xf0){
str +=char(
0xd800 | ((c&7)<<8 | (arr[++i]&63)<<2 | arr[++i]>>>4&3) - 64,
0xdc00 | (arr[i++]&15)<<6 | arr[i]&63
);
}else{
str +=char(0xfffd);
}}
return str;
};
return decodeUTF8(scalarValues(str));
};
this.getContents=function(hash, responseType){
var self=this,
dfd=$.Deferred(),
type=responseType||'arraybuffer',
url, req;
dfd.fail(function(){
req&&req.state()==='pending'&&req.reject();
});
url=self.openUrl(hash);
if(!self.isSameOrigin(url)){
url=self.openUrl(hash, true);
}
req=self.request({
data:{cmd:'get'},
options:{
url: url,
type: 'get',
cache:true,
dataType:'binary',
responseType:type,
processData: false
}})
.fail(function(){
dfd.reject();
})
.done(function(data){
dfd.resolve(data);
});
return dfd;
};
this.getMimetype=function(name, orgMime){
var mime=orgMime,
ext, m;
m=(name + '').match(/\.([^.]+)$/);
if(m&&(ext=m[1])){
if(!extToMimeTable){
extToMimeTable=self.arrayFlip(self.mimeTypes);
}
if(!(mime=extToMimeTable[ext.toLowerCase()])){
mime=orgMime;
}}
return mime;
};
self.hashCheckers=[];
(function(self){
var hashLibs={
check:true
},
md5Calc=function(arr){
var spark=new hashLibs.SparkMD5.ArrayBuffer(),
job;
job=self.asyncJob(function(buf){
spark.append(buf);
}, arr).done(function(){
job._md5=spark.end();
});
return job;
},
shaCalc=function(arr, length){
var sha, job;
try {
sha=new hashLibs.jsSHA('SHA' + (length.substr(0, 1)==='3'? length:('-' + length)), 'ARRAYBUFFER');
job=self.asyncJob(function(buf){
sha.update(buf);
}, arr).done(function(){
job._sha=sha.getHash('HEX');
});
} catch(e){
job=$.Deferred.reject();
}
return job;
};
if(self.options.cdns.sparkmd5){
self.hashCheckers.push('md5');
}
if(self.options.cdns.jssha){
self.hashCheckers=self.hashCheckers.concat(['sha1', 'sha224', 'sha256', 'sha384', 'sha512', 'sha3-224', 'sha3-256', 'sha3-384', 'sha3-512', 'shake128', 'shake256']);
}
self.getContentsHashes=function(target, needHashes){
var dfd=$.Deferred(),
needs=self.arrayFlip(needHashes||['md5'], true),
libs=[],
jobs=[],
res={},
req;
dfd.fail(function(){
req&&req.reject();
});
if(hashLibs.check){
delete hashLibs.check;
var libsmd5=$.Deferred();
if(window.ArrayBuffer&&self.options.cdns.sparkmd5){
libs.push(libsmd5);
self.loadScript([self.options.cdns.sparkmd5],
function(res){
var SparkMD5=res||window.SparkMD5;
window.SparkMD5&&delete window.SparkMD5;
libsmd5.resolve();
if(SparkMD5){
hashLibs.SparkMD5=SparkMD5;
}},
{
tryRequire: true,
error: function(){
libsmd5.reject();
}}
);
}
var libssha=$.Deferred();
if(window.ArrayBuffer&&self.options.cdns.jssha){
libs.push(libssha);
self.loadScript([self.options.cdns.jssha],
function(res){
var jsSHA=res||window.jsSHA;
window.jsSHA&&delete window.jsSHA;
libssha.resolve();
if(jsSHA){
hashLibs.jsSHA=jsSHA;
}},
{
tryRequire: true,
error: function(){
libssha.reject();
}}
);
}}
$.when.apply(null, libs).always(function(){
if(Object.keys(hashLibs).length){
req=self.getContents(target).done(function(arrayBuffer){
var arr=(arrayBuffer instanceof ArrayBuffer&&arrayBuffer.byteLength > 0)? self.sliceArrayBuffer(arrayBuffer, 1048576):false,
i;
if(needs.md5&&hashLibs.SparkMD5){
jobs.push(function(){
var job=md5Calc(arr).done(function(){
var f;
res.md5=job._md5;
if(f=self.file(target)){
f.md5=job._md5;
}
dfd.notify(res);
});
dfd.fail(function(){
job.reject();
});
return job;
});
}
if(hashLibs.jsSHA){
$.each(['1', '224', '256', '384', '512', '3-224', '3-256', '3-384', '3-512', 'ke128', 'ke256'], function(i, v){
if(needs['sha' + v]){
jobs.push(function(){
var job=shaCalc(arr, v).done(function(){
var f;
res['sha' + v]=job._sha;
if(f=self.file(target)){
f['sha' + v]=job._sha;
}
dfd.notify(res);
});
return job;
});
}});
}
if(jobs.length){
self.sequence(jobs).always(function(){
dfd.resolve(res);
});
}else{
dfd.reject();
}}).fail(function(){
dfd.reject();
});
}else{
dfd.reject();
}});
return dfd;
};})(this);
this.parseError=function(error){
var arg=error;
if($.isPlainObject(arg)){
arg=arg.error;
}
return arg;
};
this.error=function(){
var arg=arguments[0],
opts=arguments[1]||null,
err;
if(arguments.length==1&&typeof(arg)==='function'){
return self.bind('error', arg);
}else{
err=this.parseError(arg);
return (err===true||!err)? this:self.trigger('error', {error: err, opts:opts});
}};
$.each(events, function(i, name){
self[name]=function(){
var arg=arguments[0];
return arguments.length==1&&typeof(arg)=='function'
? self.bind(name, arg)
: self.trigger(name, $.isPlainObject(arg) ? arg:{});
};});
this
.enable(function(){
if(!enabled&&self.api&&self.visible()&&self.ui.overlay.is(':hidden')&&! node.children('.elfinder-dialog.' + self.res('class', 'editing') + ':visible').length){
enabled=true;
document.activeElement&&document.activeElement.blur();
node.removeClass('elfinder-disabled');
}})
.disable(function(){
prevEnabled=enabled;
enabled=false;
node.addClass('elfinder-disabled');
})
.open(function(){
selected=[];
})
.select(function(e){
var cnt=0,
unselects=[];
selected=$.grep(e.data.selected||e.data.value||[], function(hash){
if(unselects.length||(self.maxTargets&&++cnt > self.maxTargets)){
unselects.push(hash);
return false;
}else{
return files[hash] ? true:false;
}});
if(unselects.length){
self.trigger('unselectfiles', {files: unselects, inselect: true});
self.toast({mode: 'warning', msg: self.i18n(['errMaxTargets', self.maxTargets])});
}})
.error(function(e){
var opts={
cssClass:'elfinder-dialog-error',
title:self.i18n('error'),
resizable:false,
destroyOnClose:true,
buttons:{}},
node=self.getUI(),
cnt=node.children('.elfinder-dialog-error').length,
last, counter;
if(cnt < self.options.maxErrorDialogs){
opts.buttons[self.i18n(self.i18n('btnClose'))]=function(){ $(this).elfinderdialog('close'); };
if(e.data.opts&&$.isPlainObject(e.data.opts)){
Object.assign(opts, e.data.opts);
}
self.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"/>'+self.i18n(e.data.error), opts);
}else{
last=node.children('.elfinder-dialog-error:last').children('.ui-dialog-content:first');
counter=last.children('.elfinder-error-counter');
if(counter.length){
counter.data('cnt', parseInt(counter.data('cnt')) + 1).html(self.i18n(['moreErrors', counter.data('cnt')]));
}else{
counter=$('<span class="elfinder-error-counter">'+ self.i18n(['moreErrors', 1]) +'</span>').data('cnt', 1);
last.append('<br/>', counter);
}}
})
.bind('tmb', function(e){
$.each(e.data.images||[], function(hash, tmb){
if(files[hash]){
files[hash].tmb=tmb;
}});
})
.bind('searchstart', function(e){
Object.assign(self.searchStatus, e.data);
self.searchStatus.state=1;
})
.bind('search', function(e){
self.searchStatus.state=2;
})
.bind('searchend', function(){
self.searchStatus.state=0;
self.searchStatus.ininc=false;
self.searchStatus.mixed=false;
})
.bind('canMakeEmptyFile', function(e){
var data=e.data,
obj={};
if(data&&Array.isArray(data.mimes)){
if(!data.unshift){
obj=self.mimesCanMakeEmpty;
}
$.each(data.mimes, function(){
if(!obj[this]){
obj[this]=self.mimeTypes[this];
}});
if(data.unshift){
self.mimesCanMakeEmpty=Object.assign(obj, self.mimesCanMakeEmpty);
}}
})
.bind('themechange', function(){
requestAnimationFrame(function(){
self.trigger('uiresize');
});
})
;
if(true===this.options.sound){
this.bind('playsound', function(e){
var play=beeper.canPlayType&&beeper.canPlayType('audio/wav; codecs="1"'),
file=e.data&&e.data.soundFile;
play&&file&&play!=''&&play!='no'&&$(beeper).html('<source src="' + soundPath + file + '" type="audio/wav">')[0].play();
});
}
$.each(this.options.handlers, function(event, callback){
self.bind(event, callback);
});
this.history=new this.history(this);
this.roots={};
this.leafRoots={};
this.volumeExpires={};
this._commands={};
if(!Array.isArray(this.options.commands)){
this.options.commands=[];
}
if($.inArray('*', this.options.commands)!==-1){
this.options.commands=Object.keys(this.commands);
}
this.commandMap={};
this.volOptions={};
this.hasVolOptions=false;
this.trashes={};
this.optionsByHashes={};
this.uiAutoHide=[];
this.one('open', function(){
if(self.uiAutoHide.length){
setTimeout(function(){
self.trigger('uiautohide');
}, 500);
}});
this.bind('uiautohide', function(){
if(self.uiAutoHide.length){
self.uiAutoHide.shift()();
}});
if(this.options.width){
width=this.options.width;
}
if(this.options.height){
height=this.options.height;
}
if(this.options.heightBase){
heightBase=$(this.options.heightBase);
}
if(this.options.soundPath){
soundPath=this.options.soundPath.replace(/\/+$/, '') + '/';
}else{
soundPath=this.baseUrl + soundPath;
}
self.one('opendone', function(){
var tm;
$(document)
.on('click.'+namespace, function(e){ enabled&&! self.options.enableAlways&&!$(e.target).closest(node).length&&self.disable(); })
.on(keydown+' '+keypress+' '+keyup+' '+mousedown, execShortcut);
self.options.useBrowserHistory&&$(window)
.on('popstate.' + namespace, function(ev){
var state=ev.originalEvent.state||{},
hasThash=state.thash? true:false,
dialog=node.find('.elfinder-frontmost:visible'),
input=node.find('.elfinder-navbar-dir,.elfinder-cwd-filename').find('input,textarea'),
onOpen, toast;
if(!hasThash){
state={ thash: self.cwd().hash };
$('html,body').animate({ scrollTop: node.offset().top });
}
if(dialog.length||input.length){
history.pushState(state, null, location.pathname + location.search + '#elf_' + state.thash);
if(dialog.length){
if(!dialog.hasClass(self.res('class', 'preventback'))){
if(dialog.hasClass('elfinder-contextmenu')){
$(document).trigger($.Event('keydown', { keyCode: $.ui.keyCode.ESCAPE, ctrlKey:false, shiftKey:false, altKey:false, metaKey:false }));
}else if(dialog.hasClass('elfinder-dialog')){
dialog.elfinderdialog('close');
}else{
dialog.trigger('close');
}}
}else{
input.trigger($.Event('keydown', { keyCode: $.ui.keyCode.ESCAPE, ctrlKey:false, shiftKey:false, altKey:false, metaKey:false }));
}}else{
if(hasThash){
!$.isEmptyObject(self.files())&&self.request({
data:{cmd:'open', target:state.thash, onhistory:1},
notify:{type:'open', cnt:1, hideCnt:true},
syncOnFail:true
});
}else{
onOpen=function(){
toast.trigger('click');
};
self.one('open', onOpen, true);
toast=self.toast({
msg: self.i18n('pressAgainToExit'),
onHidden: function(){
self.unbind('open', onOpen);
history.pushState(state, null, location.pathname + location.search + '#elf_' + state.thash);
}});
}}
});
$(window).on('resize.' + namespace, function(e){
if(e.target===this){
tm&&cancelAnimationFrame(tm);
tm=requestAnimationFrame(function(){
var prv=node.data('resizeSize')||{w: 0, h: 0},
size={w: Math.round(node.width()), h: Math.round(node.height())};
node.data('resizeSize', size);
if(size.w!==prv.w||size.h!==prv.h){
node.trigger('resize');
self.trigger('resize', {width:size.w, height:size.h});
}});
}})
.on('beforeunload.' + namespace,function(e){
var msg, cnt;
if(!self.pauseUnloadCheck()){
if(node.is(':visible')){
if(self.ui.notify.children().length&&$.inArray('hasNotifyDialog', self.options.windowCloseConfirm)!==-1){
msg=self.i18n('ntfsmth');
}else if(node.find('.'+self.res('class', 'editing')).length&&$.inArray('editingFile', self.options.windowCloseConfirm)!==-1){
msg=self.i18n('editingFile');
}else if((cnt=Object.keys(self.selected()).length)&&$.inArray('hasSelectedItem', self.options.windowCloseConfirm)!==-1){
msg=self.i18n('hasSelected', ''+cnt);
}else if((cnt=Object.keys(self.clipboard()).length)&&$.inArray('hasClipboardData', self.options.windowCloseConfirm)!==-1){
msg=self.i18n('hasClipboard', ''+cnt);
}
if(msg){
e.returnValue=msg;
return msg;
}}
self.trigger('unload');
}});
$(window).on('message.' + namespace, function(e){
var res=e.originalEvent||null,
obj, data;
if(res&&self.uploadURL.indexOf(res.origin)===0){
try {
obj=JSON.parse(res.data);
data=obj.data||null;
if(data){
if(data.error){
if(obj.bind){
self.trigger(obj.bind+'fail', data);
}
self.error(data.error);
}else{
data.warning&&self.error(data.warning);
self.updateCache(data);
data.removed&&data.removed.length&&self.remove(data);
data.added&&data.added.length&&self.add(data);
data.changed&&data.changed.length&&self.change(data);
if(obj.bind){
self.trigger(obj.bind, data);
self.trigger(obj.bind+'done');
}
data.sync&&self.sync();
}}
} catch (e){
self.sync();
}}
});
if(self.options.enableAlways){
$(window).on('focus.' + namespace, function(e){
(e.target===this)&&self.enable();
});
if(inFrame){
$(window.top).on('focus.' + namespace, function(){
if(self.enable()&&(! parentIframe||parentIframe.is(':visible'))){
requestAnimationFrame(function(){
$(window).trigger('focus');
});
}});
}}else if(inFrame){
$(window).on('blur.' + namespace, function(e){
enabled&&e.target===this&&self.disable();
});
}
if(inFrame){
node.on('click', function(e){
$(window).trigger('focus');
});
}
if(self.options.enableByMouseOver){
node.on('mouseenter touchstart', function(e){
(inFrame)&&$(window).trigger('focus');
! self.enabled()&&self.enable();
});
}});
node[0].elfinder=this;
dfrdsBeforeBootup.push((function(){
var lang=self.lang,
langJs=self.i18nBaseUrl + 'elfinder.' + lang + '.js',
dfd=$.Deferred().done(function(){
if(self.i18[lang]){
self.lang=lang;
}
self.trigger('i18load');
i18n=self.lang==='en'
? self.i18['en']
: $.extend(true, {}, self.i18['en'], self.i18[self.lang]);
});
if(!self.i18[lang]){
self.lang='en';
if(self.hasRequire){
require([langJs], function(){
dfd.resolve();
}, function(){
dfd.resolve();
});
}else{
self.loadScript([langJs], function(){
dfd.resolve();
}, {
loadType: 'tag',
error:function(){
dfd.resolve();
}});
}}else{
dfd.resolve();
}
return dfd;
})());
bootUp=function(){
var columnNames;
self.messages=i18n.messages;
if(!($.fn.selectable&&$.fn.draggable&&$.fn.droppable&&$.fn.resizable&&$.fn.button&&$.fn.slider)){
return alert(self.i18n('errJqui'));
}
if(!node.length){
return alert(self.i18n('errNode'));
}
if(!self.options.url){
return alert(self.i18n('errURL'));
}
columnNames=Object.assign({
name:self.i18n('name'),
perm:self.i18n('perms'),
date:self.i18n('modify'),
size:self.i18n('size'),
kind:self.i18n('kind'),
modestr:self.i18n('mode'),
modeoct:self.i18n('mode'),
modeboth:self.i18n('mode')
}, self.options.uiOptions.cwd.listView.columnsCustomName);
self.getColumnName=function(key){
return columnNames[key]||self.i18n(key);
};
self.direction=i18n.direction;
self.dateFormat=self.options.dateFormat||i18n.dateFormat;
self.fancyFormat=self.options.fancyDateFormat||i18n.fancyDateFormat;
self.nonameDateFormat=(self.options.nonameDateFormat||i18n.nonameDateFormat).replace(/[\/\\]/g, '_');
self.cssClass='ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-'
+(self.direction=='rtl' ? 'rtl':'ltr')
+(self.UA.Touch? (' elfinder-touch' + (self.options.resizable ? ' touch-punch':'')):'')
+(self.UA.Mobile? ' elfinder-mobile':'')
+(self.UA.iOS? ' elfinder-ios':'')
+' '+self.options.cssClass;
node.addClass(self.cssClass)
.on(mousedown, function(){
!enabled&&self.enable();
});
(function(){
var ltr, wzRect, wzBottom, wzBottom2, nodeStyle,
keyEvt=keydown + 'draggable' + ' keyup.' + namespace + 'draggable';
self.draggable={
appendTo:node,
addClasses:false,
distance:4,
revert:true,
refreshPositions:false,
cursor:'crosshair',
cursorAt:{left:50, top:47},
scroll:false,
start:function(e, ui){
var helper=ui.helper,
targets=$.grep(helper.data('files')||[], function(h){
if(h){
remember[h]=true;
return true;
}
return false;
}),
locked=false,
cnt, h;
nodeStyle=node.attr('style');
node.width(node.width()).height(node.height());
ltr=(self.direction==='ltr');
wzRect=self.getUI('workzone').data('rectangle');
wzBottom=wzRect.top + wzRect.height;
wzBottom2=wzBottom - self.getUI('navdock').outerHeight(true);
self.draggingUiHelper=helper;
cnt=targets.length;
while (cnt--){
h=targets[cnt];
if(files[h].locked){
locked=true;
helper.data('locked', true);
break;
}}
!locked&&self.trigger('lockfiles', {files:targets});
helper.data('autoScrTm', setInterval(function(){
if(helper.data('autoScr')){
self.autoScroll[helper.data('autoScr')](helper.data('autoScrVal'));
}}, 50));
},
drag:function(e, ui){
var helper=ui.helper,
autoScr, autoUp, bottom;
if((autoUp=wzRect.top > e.pageY)||wzBottom2 < e.pageY){
if(wzRect.cwdEdge > e.pageX){
autoScr=(ltr? 'navbar':'cwd') + (autoUp? 'Up':'Down');
}else{
autoScr=(ltr? 'cwd':'navbar') + (autoUp? 'Up':'Down');
}
if(!autoUp){
if(autoScr.substr(0, 3)==='cwd'){
if(wzBottom < e.pageY){
bottom=wzBottom;
}else{
autoScr=null;
}}else{
bottom=wzBottom2;
}}
if(autoScr){
helper.data('autoScr', autoScr);
helper.data('autoScrVal', Math.pow((autoUp? wzRect.top - e.pageY:e.pageY - bottom), 1.3));
}}
if(! autoScr){
if(helper.data('autoScr')){
helper.data('refreshPositions', 1).data('autoScr', null);
}}
if(helper.data('refreshPositions')&&$(this).elfUiWidgetInstance('draggable')){
if(helper.data('refreshPositions') > 0){
$(this).draggable('option', { refreshPositions:true, elfRefresh:true });
helper.data('refreshPositions', -1);
}else{
$(this).draggable('option', { refreshPositions:false, elfRefresh:false });
helper.data('refreshPositions', null);
}}
},
stop:function(e, ui){
var helper=ui.helper,
files;
$(document).off(keyEvt);
$(this).elfUiWidgetInstance('draggable')&&$(this).draggable('option', { refreshPositions:false });
self.draggingUiHelper=null;
self.trigger('focus').trigger('dragstop');
if(! helper.data('droped')){
files=$.grep(helper.data('files')||[], function(h){ return h? true:false ;});
self.trigger('unlockfiles', {files:files});
self.trigger('selectfiles', {files:self.selected()});
}
self.enable();
node.attr('style', nodeStyle);
helper.data('autoScrTm')&&clearInterval(helper.data('autoScrTm'));
},
helper:function(e, ui){
var element=this.id ? $(this):$(this).parents('[id]:first'),
helper=$('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-status"/></div>'),
icon=function(f){
var mime=f.mime, i, tmb=self.tmb(f);
i='<div class="elfinder-cwd-icon elfinder-cwd-icon-drag '+self.mime2class(mime)+' ui-corner-all"/>';
if(tmb){
i=$(i).addClass(tmb.className).css('background-image', "url('"+tmb.url+"')").get(0).outerHTML;
}else if(f.icon){
i=$(i).css(self.getIconStyle(f, true)).get(0).outerHTML;
}
if(f.csscls){
i='<div class="'+f.csscls+'">' + i + '</div>';
}
return i;
},
hashes, l, ctr;
self.draggingUiHelper&&self.draggingUiHelper.stop(true, true);
self.trigger('dragstart', {target:element[0], originalEvent:e}, true);
hashes=element.hasClass(self.res('class', 'cwdfile'))
? self.selected()
: [self.navId2Hash(element.attr('id'))];
helper.append(icon(files[hashes[0]])).data('files', hashes).data('locked', false).data('droped', false).data('namespace', namespace).data('dropover', 0);
if((l=hashes.length) > 1){
helper.append(icon(files[hashes[l-1]]) + '<span class="elfinder-drag-num">'+l+'</span>');
}
$(document).on(keyEvt, function(e){
var chk=(e.shiftKey||e.ctrlKey||e.metaKey);
if(ctr!==chk){
ctr=chk;
if(helper.is(':visible')&&helper.data('dropover')&&! helper.data('droped')){
helper.toggleClass('elfinder-drag-helper-plus', helper.data('locked')? true:ctr);
self.trigger(ctr? 'unlockfiles':'lockfiles', {files:hashes, helper: helper});
}}
});
return helper;
}};})();
if(self.commands.getfile){
if(typeof(self.options.getFileCallback)=='function'){
self.bind('dblclick', function(e){
e.preventDefault();
self.exec('getfile').fail(function(){
self.exec('open', e.data&&e.data.file? [ e.data.file ]: void(0));
});
});
self.shortcut({
pattern:'enter',
description:self.i18n('cmdgetfile'),
callback:function(){ self.exec('getfile').fail(function(){ self.exec(self.OS=='mac' ? 'rename':'open'); });}})
.shortcut({
pattern:'ctrl+enter',
description:self.i18n(self.OS=='mac' ? 'cmdrename':'cmdopen'),
callback:function(){ self.exec(self.OS=='mac' ? 'rename':'open'); }});
}else{
self.options.getFileCallback=null;
}}
$.each(self.commands, function(name, cmd){
var proto=Object.assign({}, cmd.prototype),
extendsCmd, opts;
if($.isFunction(cmd)&&!self._commands[name]&&(cmd.prototype.forceLoad||$.inArray(name, self.options.commands)!==-1)){
extendsCmd=cmd.prototype.extendsCmd||'';
if(extendsCmd){
if($.isFunction(self.commands[extendsCmd])){
cmd.prototype=Object.assign({}, base, new self.commands[extendsCmd](), cmd.prototype);
}else{
return true;
}}else{
cmd.prototype=Object.assign({}, base, cmd.prototype);
}
self._commands[name]=new cmd();
cmd.prototype=proto;
opts=self.options.commandsOptions[name]||{};
if(extendsCmd&&self.options.commandsOptions[extendsCmd]){
opts=$.extend(true, {}, self.options.commandsOptions[extendsCmd], opts);
}
self._commands[name].setup(name, opts);
if(self._commands[name].linkedCmds.length){
$.each(self._commands[name].linkedCmds, function(i, n){
var lcmd=self.commands[n];
if($.isFunction(lcmd)&&!self._commands[n]){
lcmd.prototype=base;
self._commands[n]=new lcmd();
self._commands[n].setup(n, self.options.commandsOptions[n]||{});
}});
}}
});
self.ui={
workzone:$('<div/>').appendTo(node).elfinderworkzone(self),
navbar:$('<div/>').appendTo(node).elfindernavbar(self, self.options.uiOptions.navbar||{}),
navdock:$('<div/>').appendTo(node).elfindernavdock(self, self.options.uiOptions.navdock||{}),
contextmenu:$('<div/>').appendTo(node).elfindercontextmenu(self),
overlay:$('<div/>').appendTo(node).elfinderoverlay({
show:function(){ self.disable(); },
hide:function(){ prevEnabled&&self.enable(); }}),
cwd:$('<div/>').appendTo(node).elfindercwd(self, self.options.uiOptions.cwd||{}),
notify:self.dialog('', {
cssClass:'elfinder-dialog-notify',
position:self.options.notifyDialog.position,
absolute:true,
resizable:false,
autoOpen:false,
closeOnEscape:false,
title:'&nbsp;',
width:self.options.notifyDialog.width? parseInt(self.options.notifyDialog.width):null,
minHeight:null
}),
statusbar:$('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"/>').hide().appendTo(node),
toast:$('<div class="elfinder-toast"/>').appendTo(node),
bottomtray:$('<div class="elfinder-bottomtray">').appendTo(node)
};
self.trigger('uiready');
$.each(self.options.ui||[], function(i, ui){
var name='elfinder'+ui,
opts=self.options.uiOptions[ui]||{};
if(!self.ui[ui]&&$.fn[name]){
self.ui[ui]=$('<'+(opts.tag||'div')+'/>').appendTo(node);
self.ui[ui][name](self, opts);
}});
self.resize(width, height);
if(self.options.resizable){
node.resizable({
resize:function(e, ui){
self.resize(ui.size.width, ui.size.height);
},
handles:'se',
minWidth:300,
minHeight:200
});
if(self.UA.Touch){
node.addClass('touch-punch');
}}
(function(){
var navbar=self.getUI('navbar'),
cwd=self.getUI('cwd').parent();
self.autoScroll={
navbarUp:function(v){
navbar.scrollTop(Math.max(0, navbar.scrollTop() - v));
},
navbarDown:function(v){
navbar.scrollTop(navbar.scrollTop() + v);
},
cwdUp:function(v){
cwd.scrollTop(Math.max(0, cwd.scrollTop() - v));
},
cwdDown:function(v){
cwd.scrollTop(cwd.scrollTop() + v);
}};})();
if(self.UA.Touch){
(function(){
var lastX, lastY, nodeOffset, nodeWidth, nodeTop, navbarW, toolbarH,
navbar=self.getUI('navbar'),
toolbar=self.getUI('toolbar'),
moveEv='touchmove.stopscroll',
moveTm,
moveUpOn=function(e){
var touches=e.originalEvent.touches||[{}],
y=touches[0].pageY||null;
if(!lastY||y < lastY){
e.preventDefault();
moveTm&&clearTimeout(moveTm);
}},
moveDownOn=function(e){
e.preventDefault();
moveTm&&clearTimeout(moveTm);
},
moveOff=function(){
moveTm=setTimeout(function(){
node.off(moveEv);
}, 100);
},
handleW, handleH=50;
navbar=navbar.children().length? navbar:null;
toolbar=toolbar.length? toolbar:null;
node.on('touchstart touchmove touchend', function(e){
if(e.type==='touchend'){
lastX=false;
lastY=false;
moveOff();
return;
}
var touches=e.originalEvent.touches||[{}],
x=touches[0].pageX||null,
y=touches[0].pageY||null,
ltr=(self.direction==='ltr'),
navbarMode, treeWidth, swipeX, moveX, toolbarT, mode;
if(x===null||y===null||(e.type==='touchstart'&&touches.length > 1)){
return;
}
if(e.type==='touchstart'){
nodeOffset=node.offset();
nodeWidth=node.width();
if(navbar){
lastX=false;
if(navbar.is(':hidden')){
if(! handleW){
handleW=Math.max(50, nodeWidth / 10);
}
if((ltr? (x - nodeOffset.left):(nodeWidth + nodeOffset.left - x)) < handleW){
lastX=x;
}}else if(! e.originalEvent._preventSwipeX){
navbarW=navbar.width();
if(ltr){
swipeX=(x < nodeOffset.left + navbarW);
}else{
swipeX=(x > nodeOffset.left + nodeWidth - navbarW);
}
if(swipeX){
handleW=Math.max(50, nodeWidth / 10);
lastX=x;
}else{
lastX=false;
}}
}
if(toolbar){
lastY=false;
if(! e.originalEvent._preventSwipeY){
toolbarH=toolbar.height();
nodeTop=nodeOffset.top;
if(y - nodeTop < (toolbar.is(':hidden')? handleH:(toolbarH + 30))){
lastY=y;
node.on(moveEv, toolbar.is(':hidden')? moveDownOn: moveUpOn);
}}
}}else{
if(navbar&&lastX!==false){
navbarMode=(ltr? (lastX > x):(lastX < x))? 'navhide':'navshow';
moveX=Math.abs(lastX - x);
if(navbarMode==='navhide'&&moveX > navbarW * 0.6
|| (moveX > (navbarMode==='navhide'? navbarW / 3:45)
&& (navbarMode==='navshow'
|| (ltr? x < nodeOffset.left + 20:x > nodeOffset.left + nodeWidth - 20)
))
){
self.getUI('navbar').trigger(navbarMode, {handleW: handleW});
lastX=false;
}}
if(toolbar&&lastY!==false){
toolbarT=toolbar.offset().top;
if(Math.abs(lastY - y) > Math.min(45, toolbarH / 3)){
mode=(lastY > y)? 'slideUp':'slideDown';
if(mode==='slideDown'||toolbarT + 20 > y){
if(toolbar.is(mode==='slideDown' ? ':hidden':':visible')){
toolbar.stop(true, true).trigger('toggle', {duration: 100, handleH: handleH});
}
lastY=false;
}}
}}
});
})();
}
if(self.dragUpload){
(function(){
var isin=function(e){
return (e.target.nodeName!=='TEXTAREA'&&e.target.nodeName!=='INPUT'&&$(e.target).closest('div.ui-dialog-content').length===0);
},
ent='native-drag-enter',
disable='native-drag-disable',
c='class',
navdir=self.res(c, 'navdir'),
droppable=self.res(c, 'droppable'),
dropover=self.res(c, 'adroppable'),
arrow=self.res(c, 'navarrow'),
clDropActive=self.res(c, 'adroppable'),
wz=self.getUI('workzone'),
ltr=(self.direction==='ltr'),
clearTm=function(){
autoScrTm&&cancelAnimationFrame(autoScrTm);
autoScrTm=null;
},
wzRect, autoScrFn, autoScrTm;
node.on('dragenter', function(e){
clearTm();
if(isin(e)){
e.preventDefault();
e.stopPropagation();
wzRect=wz.data('rectangle');
}})
.on('dragleave', function(e){
clearTm();
if(isin(e)){
e.preventDefault();
e.stopPropagation();
}})
.on('dragover', function(e){
var autoUp;
if(isin(e)){
e.preventDefault();
e.stopPropagation();
e.originalEvent.dataTransfer.dropEffect='none';
if(! autoScrTm){
autoScrTm=requestAnimationFrame(function(){
var wzBottom=wzRect.top + wzRect.height,
wzBottom2=wzBottom - self.getUI('navdock').outerHeight(true),
fn;
if((autoUp=e.pageY < wzRect.top)||e.pageY > wzBottom2){
if(wzRect.cwdEdge > e.pageX){
fn=(ltr? 'navbar':'cwd') + (autoUp? 'Up':'Down');
}else{
fn=(ltr? 'cwd':'navbar') + (autoUp? 'Up':'Down');
}
if(!autoUp){
if(fn.substr(0, 3)==='cwd'){
if(wzBottom < e.pageY){
wzBottom2=wzBottom;
}else{
fn='';
}}
}
fn&&self.autoScroll[fn](Math.pow((autoUp? wzRect.top - e.pageY:e.pageY - wzBottom2), 1.3));
}
autoScrTm=null;
});
}}else{
clearTm();
}})
.on('drop', function(e){
clearTm();
if(isin(e)){
e.stopPropagation();
e.preventDefault();
}});
node.on('dragenter', '.native-droppable', function(e){
if(e.originalEvent.dataTransfer){
var $elm=$(e.currentTarget),
id=e.currentTarget.id||null,
cwd=null,
elfFrom;
if(!id){
cwd=self.cwd();
$elm.data(disable, false);
try {
$.each(e.originalEvent.dataTransfer.types, function(i, v){
if(v.substr(0, 13)==='elfinderfrom:'){
elfFrom=v.substr(13).toLowerCase();
}});
} catch(e){}}
if(!cwd||(cwd.write&&(!elfFrom||elfFrom!==(window.location.href + cwd.hash).toLowerCase()))){
e.preventDefault();
e.stopPropagation();
$elm.data(ent, true);
$elm.addClass(clDropActive);
}else{
$elm.data(disable, true);
}}
})
.on('dragleave', '.native-droppable', function(e){
if(e.originalEvent.dataTransfer){
var $elm=$(e.currentTarget);
e.preventDefault();
e.stopPropagation();
if($elm.data(ent)){
$elm.data(ent, false);
}else{
$elm.removeClass(clDropActive);
}}
})
.on('dragover', '.native-droppable', function(e){
if(e.originalEvent.dataTransfer){
var $elm=$(e.currentTarget);
e.preventDefault();
e.stopPropagation();
e.originalEvent.dataTransfer.dropEffect=$elm.data(disable)? 'none':'copy';
$elm.data(ent, false);
}})
.on('drop', '.native-droppable', function(e){
if(e.originalEvent&&e.originalEvent.dataTransfer){
var $elm=$(e.currentTarget),
id;
e.preventDefault();
e.stopPropagation();
$elm.removeClass(clDropActive);
if(e.currentTarget.id){
id=$elm.hasClass(navdir)? self.navId2Hash(e.currentTarget.id):self.cwdId2Hash(e.currentTarget.id);
}else{
id=self.cwd().hash;
}
e.originalEvent._target=id;
self.exec('upload', {dropEvt: e.originalEvent, target: id}, void 0, id);
}});
})();
}
if(self.cssloaded===null){
(function(){
var loaded=function(){
if(node.data('cssautoloadHide')){
node.data('cssautoloadHide').remove();
node.removeData('cssautoloadHide');
}
self.cssloaded=true;
requestAnimationFrame(function(){
self.trigger('cssloaded');
});
},
cnt, fi;
if(node.css('visibility')==='hidden'){
cnt=1000;
fi=setInterval(function(){
if(--cnt < 0||node.css('visibility')!=='hidden'){
clearInterval(fi);
loaded();
}}, 10);
}else{
loaded();
}})();
}else{
self.cssloaded=true;
self.trigger('cssloaded');
}
self.zIndexCalc();
self.trigger('init')
.request({
data:{cmd:'open', target:self.startDir(), init:1, tree:1},
preventDone:true,
notify:{type:'open', cnt:1, hideCnt:true},
freeze:true
})
.fail(function(){
self.trigger('fail').disable().lastDir('');
listeners={};
shortcuts={};
$(document).add(node).off('.'+namespace);
self.trigger=function(){ };})
.done(function(data){
var trashDisable=function(th){
var src=self.file(self.trashes[th]),
d=self.options.debug,
error;
if(src&&src.volumeid){
delete self.volOptions[src.volumeid].trashHash;
}
self.trashes[th]=false;
self.debug('backend-error', 'Trash hash "'+th+'" was not found or not writable.');
},
toChkTh={};
if(self.options.rawStringDecoder){
self.registRawStringDecoder(self.options.rawStringDecoder);
}
self.zIndexCalc();
self.load().debug('api', self.api);
node.trigger('resize');
open(data);
self.trigger('open', data, false);
self.trigger('opendone');
if(inFrame&&self.options.enableAlways){
$(window).trigger('focus');
}
$.each(self.trashes, function(th){
var dir=self.file(th),
src;
if(! dir){
toChkTh[th]=true;
}else if(dir.mime!=='directory'||! dir.write){
trashDisable(th);
}});
if(Object.keys(toChkTh).length){
self.request({
data:{cmd:'info', targets:Object.keys(toChkTh)},
preventDefault:true
}).done(function(data){
if(data&&data.files){
$.each(data.files, function(i, dir){
if(dir.mime==='directory'&&dir.write){
delete toChkTh[dir.hash];
}});
}}).always(function(){
$.each(toChkTh, trashDisable);
});
}
self[self.options.enableAlways? 'enable':'disable']();
});
};
if(bootCallback&&typeof bootCallback==='function'){
self.bootCallback=bootCallback;
bootCallback.call(node.get(0), self, { dfrdsBeforeBootup: dfrdsBeforeBootup });
}
$.when.apply(null, dfrdsBeforeBootup).done(function(){
bootUp();
}).fail(function(error){
self.error(error);
});
};
if(typeof toGlobal==='undefined'||toGlobal){
window.elFinder=elFinder;
}
elFinder.prototype={
uniqueid:0,
res:function(type, id){
return this.resources[type]&&this.resources[type][id];
},
OS:navigator.userAgent.indexOf('Mac')!==-1 ? 'mac':navigator.userAgent.indexOf('Win')!==-1  ? 'win':'other',
UA:(function(){
var self=this,
webkit = !document.unqueID&&!window.opera&&!window.sidebar&&window.localStorage&&'WebkitAppearance' in document.documentElement.style,
chrome=webkit&&window.chrome,
/*setRotated=function(){
var a=((screen&&screen.orientation&&screen.orientation.angle)||window.orientation||0) + 0;
if(a===-90){
a=270;
}
UA.Angle=a;
UA.Rotated=a % 180===0? false:true;
},*/
UA={
ltIE6:typeof window.addEventListener=="undefined"&&typeof document.documentElement.style.maxHeight=="undefined",
ltIE7:typeof window.addEventListener=="undefined"&&typeof document.querySelectorAll=="undefined",
ltIE8:typeof window.addEventListener=="undefined"&&typeof document.getElementsByClassName=="undefined",
ltIE9:document.uniqueID&&document.documentMode <=9,
ltIE10:document.uniqueID&&document.documentMode <=10,
gtIE11:document.uniqueID&&document.documentMode >=11,
IE:document.uniqueID,
Firefox:window.sidebar,
Opera:window.opera,
Webkit:webkit,
Chrome:chrome,
Edge:(chrome&&window.msCredentials)? true:false,
Safari:webkit&&!window.chrome,
Mobile:typeof window.orientation!="undefined",
Touch:typeof window.ontouchstart!="undefined",
iOS:navigator.platform.match(/^iP(?:[ao]d|hone)/),
Fullscreen:(typeof (document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen)!=='undefined'),
Angle:0,
Rotated:false,
CSS:(function(){
var aStyle=document.createElement('a').style,
pStyle=document.createElement('p').style,
css;
css='position:sticky;position:-webkit-sticky;';
css +='width:-webkit-max-content;width:-moz-max-content;width:-ms-max-content;width:max-content;';
aStyle.cssText=css;
return {
positionSticky:aStyle.position.indexOf('sticky')!==-1,
widthMaxContent:aStyle.width.indexOf('max-content')!==-1,
flex:typeof pStyle.flex!=='undefined'
};})()
};
return UA;
})(),
hasRequire:(typeof define==='function'&&define.amd),
currentReqCmd:'',
keyState:{},
i18:{
en:{
translator:'',
language:'English',
direction:'ltr',
dateFormat:'d.m.Y H:i',
fancyDateFormat:'$1 H:i',
nonameDateFormat:'ymd-His',
messages:{}},
months:['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
monthsShort:['msJan', 'msFeb', 'msMar', 'msApr', 'msMay', 'msJun', 'msJul', 'msAug', 'msSep', 'msOct', 'msNov', 'msDec'],
days:['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
daysShort:['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
},
kinds:{
'unknown':'Unknown',
'directory':'Folder',
'group':'Selects',
'symlink':'Alias',
'symlink-broken':'AliasBroken',
'application/x-empty':'TextPlain',
'application/postscript':'Postscript',
'application/vnd.ms-office':'MsOffice',
'application/msword':'MsWord',
'application/vnd.ms-word':'MsWord',
'application/vnd.openxmlformats-officedocument.wordprocessingml.document':'MsWord',
'application/vnd.ms-word.document.macroEnabled.12':'MsWord',
'application/vnd.openxmlformats-officedocument.wordprocessingml.template':'MsWord',
'application/vnd.ms-word.template.macroEnabled.12':'MsWord',
'application/vnd.ms-excel':'MsExcel',
'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':'MsExcel',
'application/vnd.ms-excel.sheet.macroEnabled.12':'MsExcel',
'application/vnd.openxmlformats-officedocument.spreadsheetml.template':'MsExcel',
'application/vnd.ms-excel.template.macroEnabled.12':'MsExcel',
'application/vnd.ms-excel.sheet.binary.macroEnabled.12':'MsExcel',
'application/vnd.ms-excel.addin.macroEnabled.12':'MsExcel',
'application/vnd.ms-powerpoint':'MsPP',
'application/vnd.openxmlformats-officedocument.presentationml.presentation':'MsPP',
'application/vnd.ms-powerpoint.presentation.macroEnabled.12':'MsPP',
'application/vnd.openxmlformats-officedocument.presentationml.slideshow':'MsPP',
'application/vnd.ms-powerpoint.slideshow.macroEnabled.12':'MsPP',
'application/vnd.openxmlformats-officedocument.presentationml.template':'MsPP',
'application/vnd.ms-powerpoint.template.macroEnabled.12':'MsPP',
'application/vnd.ms-powerpoint.addin.macroEnabled.12':'MsPP',
'application/vnd.openxmlformats-officedocument.presentationml.slide':'MsPP',
'application/vnd.ms-powerpoint.slide.macroEnabled.12':'MsPP',
'application/pdf':'PDF',
'application/xml':'XML',
'application/vnd.oasis.opendocument.text':'OO',
'application/vnd.oasis.opendocument.text-template':'OO',
'application/vnd.oasis.opendocument.text-web':'OO',
'application/vnd.oasis.opendocument.text-master':'OO',
'application/vnd.oasis.opendocument.graphics':'OO',
'application/vnd.oasis.opendocument.graphics-template':'OO',
'application/vnd.oasis.opendocument.presentation':'OO',
'application/vnd.oasis.opendocument.presentation-template':'OO',
'application/vnd.oasis.opendocument.spreadsheet':'OO',
'application/vnd.oasis.opendocument.spreadsheet-template':'OO',
'application/vnd.oasis.opendocument.chart':'OO',
'application/vnd.oasis.opendocument.formula':'OO',
'application/vnd.oasis.opendocument.database':'OO',
'application/vnd.oasis.opendocument.image':'OO',
'application/vnd.openofficeorg.extension':'OO',
'application/x-shockwave-flash':'AppFlash',
'application/flash-video':'Flash video',
'application/x-bittorrent':'Torrent',
'application/javascript':'JS',
'application/rtf':'RTF',
'application/rtfd':'RTF',
'application/x-font-ttf':'TTF',
'application/x-font-otf':'OTF',
'application/x-rpm':'RPM',
'application/x-web-config':'TextPlain',
'application/xhtml+xml':'HTML',
'application/docbook+xml':'DOCBOOK',
'application/x-awk':'AWK',
'application/x-gzip':'GZIP',
'application/x-bzip2':'BZIP',
'application/x-xz':'XZ',
'application/zip':'ZIP',
'application/x-zip':'ZIP',
'application/x-rar':'RAR',
'application/x-tar':'TAR',
'application/x-7z-compressed':'7z',
'application/x-jar':'JAR',
'text/plain':'TextPlain',
'text/x-php':'PHP',
'text/html':'HTML',
'text/javascript':'JS',
'text/css':'CSS',
'text/rtf':'RTF',
'text/rtfd':'RTF',
'text/x-c':'C',
'text/x-csrc':'C',
'text/x-chdr':'CHeader',
'text/x-c++':'CPP',
'text/x-c++src':'CPP',
'text/x-c++hdr':'CPPHeader',
'text/x-shellscript':'Shell',
'application/x-csh':'Shell',
'text/x-python':'Python',
'text/x-java':'Java',
'text/x-java-source':'Java',
'text/x-ruby':'Ruby',
'text/x-perl':'Perl',
'text/x-sql':'SQL',
'text/xml':'XML',
'text/x-comma-separated-values':'CSV',
'text/x-markdown':'Markdown',
'image/x-ms-bmp':'BMP',
'image/jpeg':'JPEG',
'image/gif':'GIF',
'image/png':'PNG',
'image/tiff':'TIFF',
'image/x-targa':'TGA',
'image/vnd.adobe.photoshop':'PSD',
'image/xbm':'XBITMAP',
'image/pxm':'PXM',
'audio/mpeg':'AudioMPEG',
'audio/midi':'AudioMIDI',
'audio/ogg':'AudioOGG',
'audio/mp4':'AudioMPEG4',
'audio/x-m4a':'AudioMPEG4',
'audio/wav':'AudioWAV',
'audio/x-mp3-playlist':'AudioPlaylist',
'video/x-dv':'VideoDV',
'video/mp4':'VideoMPEG4',
'video/mpeg':'VideoMPEG',
'video/x-msvideo':'VideoAVI',
'video/quicktime':'VideoMOV',
'video/x-ms-wmv':'VideoWM',
'video/x-flv':'VideoFlash',
'video/x-matroska':'VideoMKV',
'video/ogg':'VideoOGG'
},
mimeTypes:{},
rules:{
defaults:function(data){
if(!data
|| (data.added&&!Array.isArray(data.added))
||  (data.removed&&!Array.isArray(data.removed))
||  (data.changed&&!Array.isArray(data.changed))){
return false;
}
return true;
},
open:function(data){ return data&&data.cwd&&data.files&&$.isPlainObject(data.cwd)&&Array.isArray(data.files); },
tree:function(data){ return data&&data.tree&&Array.isArray(data.tree); },
parents:function(data){ return data&&data.tree&&Array.isArray(data.tree); },
tmb:function(data){ return data&&data.images&&($.isPlainObject(data.images)||Array.isArray(data.images)); },
upload:function(data){ return data&&($.isPlainObject(data.added)||Array.isArray(data.added));},
search:function(data){ return data&&data.files&&Array.isArray(data.files); }},
commands:{},
cmdsToAdd:'archive duplicate extract mkdir mkfile paste rm upload',
parseUploadData:function(text){
var self=this,
data;
if(!$.trim(text)){
return {error:['errResponse', 'errDataEmpty']};}
try {
data=JSON.parse(text);
} catch (e){
return {error:['errResponse', 'errDataNotJSON']};}
data=self.normalize(data);
if(!self.validResponse('upload', data)){
return {error:(response.norError||['errResponse'])};}
data.removed=$.merge((data.removed||[]), $.map(data.added||[], function(f){ return self.file(f.hash)? f.hash:null; }));
return data;
},
iframeCnt:0,
uploads:{
xhrUploading: false,
failSyncTm: null,
chunkfailReq: {},
checkExists: function(files, target, fm, isDir){
var dfrd=$.Deferred(),
names, renames=[], hashes={}, chkFiles=[],
cancel=function(){
var i=files.length;
while (--i > -1){
files[i]._remove=true;
}},
resolve=function(){
dfrd.resolve(renames, hashes);
},
check=function(){
var existed=[], exists=[], i, c,
pathStr=target!==fm.cwd().hash? fm.path(target, true) + fm.option('separator', target):'',
confirm=function(ndx){
var last=ndx==exists.length-1,
opts={
cssClass:'elfinder-confirm-upload',
title:fm.i18n('cmdupload'),
text:['errExists', pathStr + exists[ndx].name, 'confirmRepl'],
all:!last,
accept:{
label:'btnYes',
callback:function(all){
!last&&!all
? confirm(++ndx)
: resolve();
}},
reject:{
label:'btnNo',
callback:function(all){
var i;
if(all){
i=exists.length;
while (ndx < i--){
files[exists[i].i]._remove=true;
}}else{
files[exists[ndx].i]._remove=true;
}
!last&&!all
? confirm(++ndx)
: resolve();
}},
cancel:{
label:'btnCancel',
callback:function(){
cancel();
resolve();
}},
buttons:[
{
label:'btnBackup',
cssClass:'elfinder-confirm-btn-backup',
callback:function(all){
var i;
if(all){
i=exists.length;
while (ndx < i--){
renames.push(exists[i].name);
}}else{
renames.push(exists[ndx].name);
}
!last&&!all
? confirm(++ndx)
: resolve();
}}
]
};
if(!isDir){
opts.buttons.push({
label:'btnRename' + (last? '':'All'),
cssClass:'elfinder-confirm-btn-rename',
callback:function(){
renames=null;
resolve();
}});
}
if(fm.iframeCnt > 0){
delete opts.reject;
}
fm.confirm(opts);
};
if(! fm.file(target).read){
resolve();
return;
}
names=$.map(files, function(file, i){ return file.name&&(!fm.UA.iOS||file.name!=='image.jpg')? {i: i, name: file.name}:null ;});
fm.request({
data:{cmd:'ls', target:target, intersect:$.map(names, function(item){ return item.name;})},
notify:{type:'preupload', cnt:1, hideCnt:true},
preventDefault:true
})
.done(function(data){
var existedArr, cwdItems;
if(data){
if(data.error){
cancel();
}else{
if(fm.options.overwriteUploadConfirm&&fm.option('uploadOverwrite', target)){
if(data.list){
if(Array.isArray(data.list)){
existed=data.list||[];
}else{
existedArr=[];
existed=$.map(data.list, function(n){
if(typeof n==='string'){
return n;
}else{
existedArr=existedArr.concat(n);
return false;
}});
if(existedArr.length){
existed=existed.concat(existedArr);
}
hashes=data.list;
}
exists=$.grep(names, function(name){
return $.inArray(name.name, existed)!==-1 ? true:false ;
});
if(exists.length&&existed.length&&target==fm.cwd().hash){
cwdItems=$.map(fm.files(target), function(file){ return file.name; });
if($.grep(existed, function(n){
return $.inArray(n, cwdItems)===-1? true:false;
}).length){
fm.sync();
}}
}}
}}
if(exists.length > 0){
confirm(0);
}else{
resolve();
}})
.fail(function(error){
cancel();
resolve();
error&&fm.error(error);
});
};
if(fm.api >=2.1&&typeof files[0]=='object'){
check();
}else{
resolve();
}
return dfrd;
},
checkFile:function(data, fm, target){
if(!!data.checked||data.type=='files'){
return data.files;
}else if(data.type=='data'){
var dfrd=$.Deferred(),
scanDfd=$.Deferred(),
files=[],
paths=[],
dirctorys=[],
processing=0,
items,
mkdirs=[],
cancel=false,
toArray=function(list){
return Array.prototype.slice.call(list||[], 0);
},
doScan=function(items){
var entry, readEntries,
excludes=fm.options.folderUploadExclude[fm.OS]||null,
length=items.length,
check=function(){
if(--processing < 1&&scanDfd.state()==='pending'){
scanDfd.resolve();
}},
pushItem=function(file){
if(! excludes||! file.name.match(excludes)){
paths.push(entry.fullPath||'');
files.push(file);
}
check();
},
readEntries=function(dirReader){
var entries=[],
read=function(){
dirReader.readEntries(function(results){
if(cancel||!results.length){
for (var i=0; i < entries.length; i++){
if(cancel){
scanDfd.reject();
break;
}
doScan([entries[i]]);
}
check();
}else{
entries=entries.concat(toArray(results));
read();
}}, check);
};
read();
};
processing++;
for (var i=0; i < length; i++){
if(cancel){
scanDfd.reject();
break;
}
entry=items[i];
if(entry){
if(entry.isFile){
processing++;
entry.file(pushItem, check);
}else if(entry.isDirectory){
if(fm.api >=2.1){
processing++;
mkdirs.push(entry.fullPath);
readEntries(entry.createReader());
}}
}}
check();
return scanDfd;
}, hasDirs;
items=$.map(data.files.items, function(item){
return item.getAsEntry? item.getAsEntry():item.webkitGetAsEntry();
});
$.each(items, function(i, item){
if(item.isDirectory){
hasDirs=true;
return false;
}});
if(items.length > 0){
fm.uploads.checkExists(items, target, fm, hasDirs).done(function(renames, hashes){
var dfds=[];
if(fm.options.overwriteUploadConfirm&&fm.option('uploadOverwrite', target)){
if(renames===null){
data.overwrite=0;
renames=[];
}
items=$.grep(items, function(item){
var i, bak, hash, dfd, hi;
if(item.isDirectory&&renames.length){
i=$.inArray(item.name, renames);
if(i!==-1){
renames.splice(i, 1);
bak=fm.uniqueName(item.name + fm.options.backupSuffix , null, '');
$.each(hashes, function(h, name){
if(item.name==name){
hash=h;
return false;
}});
if(! hash){
hash=fm.fileByName(item.name, target).hash;
}
fm.lockfiles({files:[hash]});
dfd=fm.request({
data:{cmd:'rename', target:hash, name:bak},
notify:{type:'rename', cnt:1}})
.fail(function(){
item._remove=true;
fm.sync();
})
.always(function(){
fm.unlockfiles({files:[hash]});
});
dfds.push(dfd);
}}
return !item._remove? true:false;
});
}
$.when.apply($, dfds).done(function(){
var notifyto, msg,
id=+new Date();
if(items.length > 0){
msg=fm.escape(items[0].name);
if(items.length > 1){
msg +=' ... ' + items.length + fm.i18n('items');
}
notifyto=setTimeout(function(){
fm.notify({
type:'readdir',
id:id,
cnt:1,
hideCnt: true,
msg:fm.i18n('ntfreaddir') + ' (' + msg + ')',
cancel: function(){
cancel=true;
}});
}, fm.options.notifyDelay);
doScan(items).done(function(){
notifyto&&clearTimeout(notifyto);
fm.notify({type:'readdir', id: id, cnt:-1});
if(cancel){
dfrd.reject();
}else{
dfrd.resolve([files, paths, renames, hashes, mkdirs]);
}}).fail(function(){
dfrd.reject();
});
}else{
dfrd.reject();
}});
});
return dfrd.promise();
}else{
return dfrd.reject();
}}else{
var ret=[];
var check=[];
var str=data.files[0];
if(data.type=='html'){
var tmp=$("<html/>").append($.parseHTML(str.replace(/ src=/ig, ' _elfsrc='))),
atag;
$('img[_elfsrc]', tmp).each(function(){
var url, purl,
self=$(this),
pa=self.closest('a');
if(pa&&pa.attr('href')&&pa.attr('href').match(/\.(?:jpe?g|gif|bmp|png)/i)){
purl=pa.attr('href');
}
url=self.attr('_elfsrc');
if(url){
if(purl){
$.inArray(purl, ret)==-1&&ret.push(purl);
$.inArray(url, check)==-1&&check.push(url);
}else{
$.inArray(url, ret)==-1&&ret.push(url);
}}
if(ret.length===1&&ret[0].match(/^data:image\/png/)){
data.clipdata=true;
}});
atag=$('a[href]', tmp);
atag.each(function(){
var text, loc,
parseUrl=function(url){
var a=document.createElement('a');
a.href=url;
return a;
};
if(text=$(this).text()){
loc=parseUrl($(this).attr('href'));
if(loc.href&&loc.href.match(/^(?:ht|f)tp/i)&&(atag.length===1||! loc.pathname.match(/(?:\.html?|\/[^\/.]*)$/i)||$.trim(text).match(/\.[a-z0-9-]{1,10}$/i))){
if($.inArray(loc.href, ret)==-1&&$.inArray(loc.href, check)==-1) ret.push(loc.href);
}}
});
}else{
var regex, m, url;
regex=/((?:ht|f)tps?:\/\/[-_.!~*\'()a-z0-9;/?:\@&=+\$,%#\*\[\]]+)/ig;
while (m=regex.exec(str)){
url=m[1].replace(/&amp;/g, '&');
if($.inArray(url, ret)==-1) ret.push(url);
}}
return ret;
}},
xhr:function(data, fm){
var self=fm ? fm:this,
node=self.getUI(),
xhr=new XMLHttpRequest(),
notifyto=null, notifyto2=null,
dataChecked=data.checked,
isDataType=(data.isDataType||data.type=='data'),
target=(data.target||self.cwd().hash),
dropEvt=(data.dropEvt||null),
extraData=data.extraData||null,
chunkEnable=(self.option('uploadMaxConn', target)!=-1),
multiMax=Math.min(5, Math.max(1, self.option('uploadMaxConn', target))),
retryWait=10000,
retryMax=30,
retry=0,
getFile=function(files){
var dfd=$.Deferred(),
file;
if(files.promise){
files.always(function(f){
dfd.resolve(Array.isArray(f)&&f.length? (isDataType? f[0][0]:f[0]):{});
});
}else{
dfd.resolve(files.length? (isDataType? files[0][0]:files[0]):{});
}
return dfd;
},
dfrd=$.Deferred()
.fail(function(err){
var error=self.parseError(err),
userAbort;
if(error==='userabort'){
userAbort=true;
error=void 0;
}
if(files&&(self.uploads.xhrUploading||userAbort)){
getFile(files).done(function(file){
if(!userAbort){
triggerError(error, file);
}
if(! file._cid){
self.uploads.failSyncTm&&clearTimeout(self.uploads.failSyncTm);
self.uploads.failSyncTm=setTimeout(function(){
self.sync(target);
}, 1000);
}else if(! self.uploads.chunkfailReq[file._cid]){
self.uploads.chunkfailReq[file._cid]=true;
setTimeout(function(){
fm.request({
data:{
cmd: 'upload',
target: target,
chunk: file._chunk,
cid: file._cid,
upload: ['chunkfail'],
mimes: 'chunkfail'
},
options:{
type: 'post',
url: self.uploadURL
},
preventDefault: true
}).always(function(){
delete self.uploads.chunkfailReq[file._chunk];
});
}, 1000);
}});
}else{
triggerError(error);
}
!userAbort&&self.sync();
self.uploads.xhrUploading=false;
files=null;
})
.done(function(data){
self.uploads.xhrUploading=false;
files=null;
if(data){
self.currentReqCmd='upload';
data.warning&&triggerError(data.warning);
self.updateCache(data);
data.removed&&data.removed.length&&self.remove(data);
data.added&&data.added.length&&self.add(data);
data.changed&&data.changed.length&&self.change(data);
self.trigger('upload', data, false);
self.trigger('uploaddone');
if(data.toasts&&Array.isArray(data.toasts)){
$.each(data.toasts, function(){
this.msg&&self.toast(this);
});
}
data.sync&&self.sync();
data.debug&&fm.debug('backend-debug', data);
}})
.always(function(){
self.abortXHR(xhr);
node.off('uploadabort', fnAbort);
$(window).off('unload', fnAbort);
notifyto&&clearTimeout(notifyto);
notifyto2&&clearTimeout(notifyto2);
dataChecked&&!data.multiupload&&checkNotify()&&self.notify({type:'upload', cnt:-cnt, progress:0, size:0});
chunkMerge&&notifyElm.children('.elfinder-notify-chunkmerge').length&&self.notify({type:'chunkmerge', cnt:-1});
}),
formData=new FormData(),
files=data.input ? data.input.files:self.uploads.checkFile(data, self, target),
cnt=data.checked? (isDataType? files[0].length:files.length):files.length,
loaded=0,
prev=0,
filesize=0,
notify=false,
notifyElm=self.ui.notify,
cancelBtn=true,
abort=false,
checkNotify=function(){
if(!notify&&(ntfUpload=notifyElm.children('.elfinder-notify-upload')).length){
notify=true;
}
return notify;
},
fnAbort=function(e, error){
abort=true;
self.abortXHR(xhr, { quiet: true, abort: true });
dfrd.reject(error);
if(checkNotify()){
self.notify({type:'upload', cnt:ntfUpload.data('cnt') * -1, progress:0, size:0});
}},
cancelToggle=function(show){
ntfUpload.children('.elfinder-notify-cancel')[show? 'show':'hide']();
},
startNotify=function(size){
if(!size) size=filesize;
return setTimeout(function(){
notify=true;
self.notify({type:'upload', cnt:cnt, progress:loaded - prev, size:size,
cancel: function(){
node.trigger('uploadabort', 'userabort');
}});
ntfUpload=notifyElm.children('.elfinder-notify-upload');
prev=loaded;
if(data.multiupload){
cancelBtn&&cancelToggle(true);
}else{
cancelToggle(cancelBtn&&loaded < size);
}}, self.options.notifyDelay);
},
doRetry=function(){
if(retry++ <=retryMax){
if(checkNotify()&&prev){
self.notify({type:'upload', cnt:0, progress:0, size:prev});
}
self.abortXHR(xhr, { quiet: true });
prev=loaded=0;
setTimeout(function(){
var reqId;
if(! abort){
xhr.open('POST', self.uploadURL, true);
if(self.api >=2.1029){
reqId=(+ new Date()).toString(16) + Math.floor(1000 * Math.random()).toString(16);
(typeof formData['delete']==='function')&&formData['delete']('reqid');
formData.append('reqid', reqId);
xhr._requestId=reqId;
}
xhr.send(formData);
}}, retryWait);
}else{
node.trigger('uploadabort', ['errAbort', 'errTimeout']);
}},
progress=function(){
var node;
if(notify){
dfrd.notifyWith(ntfUpload, [{
cnt: ntfUpload.data('cnt'),
progress: ntfUpload.data('progress'),
total: ntfUpload.data('total')
}]);
}},
triggerError=function(err, file, unite){
err&&self.trigger('xhruploadfail', { error: err, file: file });
if(unite){
if(err){
if(errCnt < self.options.maxErrorDialogs){
if(Array.isArray(err)){
errors=errors.concat(err);
}else{
errors.push(err);
}}
errCnt++;
}}else{
if(err){
self.error(err);
}else{
if(errors.length){
if(errCnt >=self.options.maxErrorDialogs){
errors=errors.concat('moreErrors', errCnt - self.options.maxErrorDialogs);
}
self.error(errors);
}
errors=[];
errCnt=0;
}}
},
errors=[],
errCnt=0,
renames=(data.renames||null),
hashes=(data.hashes||null),
chunkMerge=false,
ntfUpload=$();
node.one('uploadabort', fnAbort);
$(window).one('unload.' + fm.namespace, fnAbort);
!chunkMerge&&(prev=loaded);
if(!isDataType&&!cnt){
return dfrd.reject(['errUploadNoFiles']);
}
xhr.addEventListener('error', function(){
if(xhr.status==0){
if(abort){
dfrd.reject();
}else{
if(!isDataType&&data.files&&$.grep(data.files, function(f){return ! f.type&&f.size===(self.UA.Safari? 1802:0)? true:false;}).length){
dfrd.reject(['errAbort', 'errFolderUpload']);
}else if(data.input&&$.grep(data.input.files, function(f){return ! f.type&&f.size===(self.UA.Safari? 1802:0)? true:false;}).length){
dfrd.reject(['errUploadNoFiles']);
}else{
doRetry();
}}
}else{
node.trigger('uploadabort', 'errConnect');
}}, false);
xhr.addEventListener('load', function(e){
var status=xhr.status, res, curr=0, error='', errData, errObj;
if(status >=400){
if(status > 500){
error='errResponse';
}else{
error=['errResponse', 'errServerError'];
}}else{
if(!xhr.responseText){
error=['errResponse', 'errDataEmpty'];
}}
if(error){
node.trigger('uploadabort');
getFile(files).done(function(file){
return dfrd.reject(file._cid? null:error);
});
}
loaded=filesize;
if(checkNotify()&&(curr=loaded - prev)){
self.notify({type:'upload', cnt:0, progress:curr, size:0});
progress();
}
res=self.parseUploadData(xhr.responseText);
if(res._chunkmerged){
formData=new FormData();
var _file=[{_chunkmerged: res._chunkmerged, _name: res._name, _mtime: res._mtime}];
chunkMerge=true;
node.off('uploadabort', fnAbort);
notifyto2=setTimeout(function(){
self.notify({type:'chunkmerge', cnt:1});
}, self.options.notifyDelay);
isDataType? send(_file, files[1]):send(_file);
return;
}
res._multiupload=data.multiupload? true:false;
if(res.error){
errData={
cmd: 'upload',
err: res,
xhr: xhr,
rc: xhr.status
};
self.trigger('uploadfail', res);
self.trigger('requestError', errData);
if(errData._event&&errData._event.isDefaultPrevented()){
res.error='';
}
if(res._chunkfailure||res._multiupload){
abort=true;
self.uploads.xhrUploading=false;
notifyto&&clearTimeout(notifyto);
if(ntfUpload.length){
self.notify({type:'upload', cnt:-cnt, progress:0, size:0});
dfrd.reject(res);
}else{
dfrd.reject();
}}else{
dfrd.reject(res);
}}else{
dfrd.resolve(res);
}}, false);
xhr.upload.addEventListener('loadstart', function(e){
if(!chunkMerge&&e.lengthComputable){
loaded=e.loaded;
retry&&(loaded=0);
filesize=e.total;
if(!loaded){
loaded=parseInt(filesize * 0.05);
}
if(checkNotify()){
self.notify({type:'upload', cnt:0, progress:loaded - prev, size:data.multiupload? 0:filesize});
prev=loaded;
progress();
}}
}, false);
xhr.upload.addEventListener('progress', function(e){
var curr;
if(e.lengthComputable&&!chunkMerge&&xhr.readyState < 2){
loaded=e.loaded;
if(!data.checked&&loaded > 0&&!notifyto){
notifyto=startNotify(xhr._totalSize - loaded);
}
if(!filesize){
filesize=e.total;
if(!loaded){
loaded=parseInt(filesize * 0.05);
}}
curr=loaded - prev;
if(checkNotify()&&(curr/e.total) >=0.05){
self.notify({type:'upload', cnt:0, progress:curr, size:0});
prev=loaded;
progress();
}
if(! data.multiupload&&loaded >=filesize){
cancelBtn=false;
cancelToggle(false);
}}
}, false);
var send=function(files, paths){
var size=0,
fcnt=1,
sfiles=[],
c=0,
total=cnt,
maxFileSize,
totalSize=0,
chunked=[],
chunkID=new Date().getTime().toString().substr(-9),
BYTES_PER_CHUNK=Math.min((fm.uplMaxSize? fm.uplMaxSize:2097152) - 8190, fm.options.uploadMaxChunkSize),
blobSlice=chunkEnable? false:'',
blobSize, blobMtime, blobName, i, start, end, chunks, blob, chunk, added, done, last, failChunk,
multi=function(files, num){
var sfiles=[], cid, sfilesLen=0, cancelChk;
if(!abort){
while(files.length&&sfiles.length < num){
sfiles.push(files.shift());
}
sfilesLen=sfiles.length;
if(sfilesLen){
cancelChk=sfilesLen;
for (var i=0; i < sfilesLen; i++){
if(abort){
break;
}
cid=isDataType? (sfiles[i][0][0]._cid||null):(sfiles[i][0]._cid||null);
if(!!failChunk[cid]){
last--;
continue;
}
fm.exec('upload', {
type: data.type,
isDataType: isDataType,
files: sfiles[i],
checked: true,
target: target,
dropEvt: dropEvt,
renames: renames,
hashes: hashes,
multiupload: true,
overwrite: data.overwrite===0? 0:void 0,
clipdata: data.clipdata
}, void 0, target)
.fail(function(error){
if(error&&error==='No such command'){
abort=true;
fm.error(['errUpload', 'errPerm']);
}
if(cid){
failChunk[cid]=true;
}})
.always(function(e){
if(e&&e.added) added=$.merge(added, e.added);
if(last <=++done){
fm.trigger('multiupload', {added: added});
notifyto&&clearTimeout(notifyto);
if(checkNotify()){
self.notify({type:'upload', cnt:-cnt, progress:0, size:0});
}}
if(files.length){
multi(files, 1);
}else{
if(--cancelChk <=1){
cancelBtn=false;
cancelToggle(false);
}}
});
}}
}
if(sfiles.length < 1||abort){
if(abort){
notifyto&&clearTimeout(notifyto);
if(cid){
failChunk[cid]=true;
}
dfrd.reject();
}else{
dfrd.resolve();
self.uploads.xhrUploading=false;
}}
},
check=function(){
if(!self.uploads.xhrUploading){
self.uploads.xhrUploading=true;
multi(sfiles, multiMax);
}else{
setTimeout(check, 100);
}},
reqId, err;
if(! dataChecked&&(isDataType||data.type=='files')){
if(! (maxFileSize=fm.option('uploadMaxSize', target))){
maxFileSize=0;
}
for (i=0; i < files.length; i++){
try {
blob=files[i];
blobSize=blob.size;
if(blobSlice===false){
blobSlice='';
if(self.api >=2.1){
if('slice' in blob){
blobSlice='slice';
}else if('mozSlice' in blob){
blobSlice='mozSlice';
}else if('webkitSlice' in blob){
blobSlice='webkitSlice';
}}
}} catch(e){
cnt--;
total--;
continue;
}
if((maxFileSize&&blobSize > maxFileSize)||(!blobSlice&&fm.uplMaxSize&&blobSize > fm.uplMaxSize)){
triggerError(['errUploadFile', blob.name, 'errUploadFileSize'], blob, true);
cnt--;
total--;
continue;
}
if(blob.type&&! self.uploadMimeCheck(blob.type, target)){
triggerError(['errUploadFile', blob.name, 'errUploadMime', '(' + blob.type + ')'], blob, true);
cnt--;
total--;
continue;
}
if(blobSlice&&blobSize > BYTES_PER_CHUNK){
start=0;
end=BYTES_PER_CHUNK;
chunks=-1;
total=Math.floor((blobSize - 1) / BYTES_PER_CHUNK);
blobMtime=blob.lastModified? Math.round(blob.lastModified/1000):0;
blobName=data.clipdata? fm.date(fm.nonameDateFormat) + '.png':blob.name;
totalSize +=blobSize;
chunked[chunkID]=0;
while(start < blobSize){
chunk=blob[blobSlice](start, end);
chunk._chunk=blobName + '.' + (++chunks) + '_' + total + '.part';
chunk._cid=chunkID;
chunk._range=start + ',' + chunk.size + ',' + blobSize;
chunk._mtime=blobMtime;
chunked[chunkID]++;
if(size){
c++;
}
if(typeof sfiles[c]=='undefined'){
sfiles[c]=[];
if(isDataType){
sfiles[c][0]=[];
sfiles[c][1]=[];
}}
size=BYTES_PER_CHUNK;
fcnt=1;
if(isDataType){
sfiles[c][0].push(chunk);
sfiles[c][1].push(paths[i]);
}else{
sfiles[c].push(chunk);
}
start=end;
end=start + BYTES_PER_CHUNK;
}
if(chunk==null){
triggerError(['errUploadFile', blob.name, 'errUploadFileSize'], blob, true);
cnt--;
total--;
}else{
total +=chunks;
size=0;
fcnt=1;
c++;
}
continue;
}
if((fm.uplMaxSize&&size + blobSize > fm.uplMaxSize)||fcnt > fm.uplMaxFile){
size=0;
fcnt=1;
c++;
}
if(typeof sfiles[c]=='undefined'){
sfiles[c]=[];
if(isDataType){
sfiles[c][0]=[];
sfiles[c][1]=[];
}}
if(isDataType){
sfiles[c][0].push(blob);
sfiles[c][1].push(paths[i]);
}else{
sfiles[c].push(blob);
}
size +=blobSize;
totalSize +=blobSize;
fcnt++;
}
if(errors.length){
triggerError();
}
if(sfiles.length==0){
data.checked=true;
return false;
}
if(sfiles.length > 1){
notifyto=startNotify(totalSize);
added=[];
done=0;
last=sfiles.length;
failChunk=[];
check();
return true;
}
if(isDataType){
files=sfiles[0][0];
paths=sfiles[0][1];
}else{
files=sfiles[0];
}}
if(!dataChecked){
if(!fm.UA.Safari||!data.files){
notifyto=startNotify(totalSize);
}else{
xhr._totalSize=totalSize;
}}
dataChecked=true;
if(! files.length){
dfrd.reject(['errUploadNoFiles']);
}
xhr.open('POST', self.uploadURL, true);
if(fm.customHeaders){
$.each(fm.customHeaders, function(key){
xhr.setRequestHeader(key, this);
});
}
if(fm.xhrFields){
$.each(fm.xhrFields, function(key){
if(key in xhr){
xhr[key]=this;
}});
}
if(self.api >=2.1029){
reqId=(+ new Date()).toString(16) + Math.floor(1000 * Math.random()).toString(16);
formData.append('reqid', reqId);
xhr._requestId=reqId;
}
formData.append('cmd', 'upload');
formData.append(self.newAPI ? 'target':'current', target);
if(renames&&renames.length){
$.each(renames, function(i, v){
formData.append('renames[]', v);
});
formData.append('suffix', fm.options.backupSuffix);
}
if(hashes){
$.each(hashes, function(i, v){
formData.append('hashes['+ i +']', v);
});
}
$.each(self.customData, function(key, val){
formData.append(key, val);
});
$.each(self.options.onlyMimes, function(i, mime){
formData.append('mimes[]', mime);
});
$.each(files, function(i, file){
var name;
if(file._chunkmerged){
formData.append('chunk', file._chunkmerged);
formData.append('upload[]', file._name);
formData.append('mtime[]', file._mtime);
data.clipdata&&formData.append('overwrite', 0);
}else{
if(file._chunkfail){
formData.append('upload[]', 'chunkfail');
formData.append('mimes', 'chunkfail');
}else{
if(data.clipdata){
if(!file._chunk){
data.overwrite=0;
name=fm.date(fm.nonameDateFormat) + '.png';
}}else{
if(file.name){
name=file.name;
if(fm.UA.iOS){
if(name.match(/^image\.jpe?g$/i)){
data.overwrite=0;
name=fm.date(fm.nonameDateFormat) + '.jpg';
}else if(name.match(/^capturedvideo\.mov$/i)){
data.overwrite=0;
name=fm.date(fm.nonameDateFormat) + '.mov';
}}
}}
name? formData.append('upload[]', file, name):formData.append('upload[]', file);
}
if(file._chunk){
formData.append('chunk', file._chunk);
formData.append('cid'  , file._cid);
formData.append('range', file._range);
formData.append('mtime[]', file._mtime);
}else{
formData.append('mtime[]', file.lastModified? Math.round(file.lastModified/1000):0);
}}
});
if(isDataType){
$.each(paths, function(i, path){
formData.append('upload_path[]', path);
});
}
if(data.overwrite===0){
formData.append('overwrite', 0);
}
if(dropEvt){
formData.append('dropWith', parseInt(
(dropEvt.altKey  ? '1':'0')+
(dropEvt.ctrlKey ? '1':'0')+
(dropEvt.metaKey ? '1':'0')+
(dropEvt.shiftKey? '1':'0'), 2));
}
if(extraData){
$.each(extraData, function(key, val){
formData.append(key, val);
});
}
xhr.send(formData);
return true;
};
if(! isDataType){
if(files.length > 0){
if(! data.clipdata&&renames==null){
var mkdirs=[],
paths=[],
excludes=fm.options.folderUploadExclude[fm.OS]||null;
$.each(files, function(i, file){
var relPath=file.webkitRelativePath||file.relativePath||'',
idx, rootDir;
if(! relPath){
return false;
}
if(excludes&&file.name.match(excludes)){
file._remove=true;
relPath=void(0);
}else{
relPath='/' + relPath.replace(/\/[^\/]*$/, '').replace(/^\//, '');
if(relPath&&$.inArray(relPath, mkdirs)===-1){
mkdirs.push(relPath);
idx=relPath.substr(1).indexOf('/');
if(idx!==-1&&(rootDir=relPath.substr(0, idx + 1))&&$.inArray(rootDir, mkdirs)===-1){
mkdirs.unshift(rootDir);
}}
}
paths.push(relPath);
});
renames=[];
hashes={};
if(mkdirs.length){
(function(){
var checkDirs=$.map(mkdirs, function(name){ return name.substr(1).indexOf('/')===-1 ? {name: name.substr(1)}:null;}),
cancelDirs=[];
fm.uploads.checkExists(checkDirs, target, fm, true).done(function(res, res2){
var dfds=[], dfd, bak, hash;
if(fm.options.overwriteUploadConfirm&&fm.option('uploadOverwrite', target)){
cancelDirs=$.map(checkDirs, function(dir){ return dir._remove? dir.name:null ;});
checkDirs=$.grep(checkDirs, function(dir){ return !dir._remove? true:false ;});
}
if(cancelDirs.length){
$.each(paths.concat(), function(i, path){
if($.inArray(path, cancelDirs)===0){
files[i]._remove=true;
paths[i]=void(0);
}});
}
files=$.grep(files, function(file){ return file._remove? false:true; });
paths=$.grep(paths, function(path){ return path===void 0 ? false:true; });
if(checkDirs.length){
dfd=$.Deferred();
if(res.length){
$.each(res, function(i, existName){
bak=fm.uniqueName(existName + fm.options.backupSuffix , null, '');
$.each(res2, function(h, name){
if(res[0]==name){
hash=h;
return false;
}});
if(! hash){
hash=fm.fileByName(res[0], target).hash;
}
fm.lockfiles({files:[hash]});
dfds.push(fm.request({
data:{cmd:'rename', target:hash, name:bak},
notify:{type:'rename', cnt:1}})
.fail(function(error){
dfrd.reject(error);
fm.sync();
})
.always(function(){
fm.unlockfiles({files:[hash]});
})
);
});
}else{
dfds.push(null);
}
$.when.apply($, dfds).done(function(){
fm.request({
data:{cmd:'mkdir', target:target, dirs:mkdirs},
notify:{type:'mkdir', cnt:mkdirs.length},
preventFail: true
})
.fail(function(error){
error=error||['errUnknown'];
if(error[0]==='errCmdParams'){
multiMax=1;
}else{
multiMax=0;
dfrd.reject(error);
}})
.done(function(data){
var rm=false;
if(!data.hashes){
data.hashes={};}
paths=$.map(paths.concat(), function(p, i){
if(p==='/'){
return target;
}else{
if(data.hashes[p]){
return data.hashes[p];
}else{
rm=true;
files[i]._remove=true;
return null;
}}
});
if(rm){
files=$.grep(files, function(file){ return file._remove? false:true; });
}})
.always(function(data){
if(multiMax){
isDataType=true;
if(! send(files, paths)){
dfrd.reject();
}}
});
});
}else{
dfrd.reject();
}}
);
})();
}else{
fm.uploads.checkExists(files, target, fm).done(function(res, res2){
if(fm.options.overwriteUploadConfirm&&fm.option('uploadOverwrite', target)){
hashes=res2;
if(res===null){
data.overwrite=0;
}else{
renames=res;
}
files=$.grep(files, function(file){return !file._remove? true:false ;});
}
cnt=files.length;
if(cnt > 0){
if(! send(files)){
dfrd.reject();
}}else{
dfrd.reject();
}}
);
}}else{
if(! send(files)){
dfrd.reject();
}}
}else{
dfrd.reject();
}}else{
if(dataChecked){
send(files[0], files[1]);
}else{
files.done(function(result){
renames=[];
cnt=result[0].length;
if(cnt){
if(result[4]&&result[4].length){
fm.request({
data:{cmd:'mkdir', target:target, dirs:result[4]},
notify:{type:'mkdir', cnt:result[4].length},
preventFail: true
})
.fail(function(error){
error=error||['errUnknown'];
if(error[0]==='errCmdParams'){
multiMax=1;
}else{
multiMax=0;
dfrd.reject(error);
}})
.done(function(data){
var rm=false;
if(!data.hashes){
data.hashes={};}
result[1]=$.map(result[1], function(p, i){
p=p.replace(/\/[^\/]*$/, '');
if(p===''){
return target;
}else{
if(data.hashes[p]){
return data.hashes[p];
}else{
rm=true;
result[0][i]._remove=true;
return null;
}}
});
if(rm){
result[0]=$.grep(result[0], function(file){ return file._remove? false:true; });
}})
.always(function(data){
if(multiMax){
renames=result[2];
hashes=result[3];
send(result[0], result[1]);
}});
return;
}else{
result[1]=$.map(result[1], function(){ return target; });
}
renames=result[2];
hashes=result[3];
send(result[0], result[1]);
}else{
dfrd.reject(['errUploadNoFiles']);
}}).fail(function(){
dfrd.reject();
});
}}
return dfrd;
},
iframe:function(data, fm){
var self=fm ? fm:this,
input=data.input? data.input:false,
files  = !input ? self.uploads.checkFile(data, self):false,
dfrd=$.Deferred()
.fail(function(error){
error&&self.error(error);
}),
name='iframe-'+fm.namespace+(++self.iframeCnt),
form=$('<form action="'+self.uploadURL+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" target="'+name+'" style="display:none"><input type="hidden" name="cmd" value="upload" /></form>'),
msie=this.UA.IE,
onload=function(){
abortto&&clearTimeout(abortto);
notifyto&&clearTimeout(notifyto);
notify&&self.notify({type:'upload', cnt:-cnt});
setTimeout(function(){
msie&&$('<iframe src="javascript:false;"/>').appendTo(form);
form.remove();
iframe.remove();
}, 100);
},
iframe=$('<iframe src="'+(msie ? 'javascript:false;':'about:blank')+'" name="'+name+'" style="position:absolute;left:-1000px;top:-1000px" />')
.on('load', function(){
iframe.off('load')
.on('load', function(){
onload();
dfrd.resolve();
});
notifyto=setTimeout(function(){
notify=true;
self.notify({type:'upload', cnt:cnt});
}, self.options.notifyDelay);
if(self.options.iframeTimeout > 0){
abortto=setTimeout(function(){
onload();
dfrd.reject(['errConnect', 'errTimeout']);
}, self.options.iframeTimeout);
}
form.submit();
}),
target=(data.target||self.cwd().hash),
names=[],
dfds=[],
renames=[],
hashes={},
cnt, notify, notifyto, abortto;
if(files&&files.length){
$.each(files, function(i, val){
form.append('<input type="hidden" name="upload[]" value="'+val+'"/>');
});
cnt=1;
}else if(input&&$(input).is(':file')&&$(input).val()){
if(fm.options.overwriteUploadConfirm&&fm.option('uploadOverwrite', target)){
names=input.files? input.files:[{ name: $(input).val().replace(/^(?:.+[\\\/])?([^\\\/]+)$/, '$1') }];
dfds.push(self.uploads.checkExists(names, target, self).done(function(res, res2){
hashes=res2;
if(res===null){
data.overwrite=0;
}else{
renames=res;
cnt=$.grep(names, function(file){return !file._remove? true:false ;}).length;
if(cnt!=names.length){
cnt=0;
}}
}
));
}
cnt=input.files ? input.files.length:1;
form.append(input);
}else{
return dfrd.reject();
}
$.when.apply($, dfds).done(function(){
if(cnt < 1){
return dfrd.reject();
}
form.append('<input type="hidden" name="'+(self.newAPI ? 'target':'current')+'" value="'+target+'"/>')
.append('<input type="hidden" name="html" value="1"/>')
.append('<input type="hidden" name="node" value="'+self.id+'"/>')
.append($(input).attr('name', 'upload[]'));
if(renames.length > 0){
$.each(renames, function(i, rename){
form.append('<input type="hidden" name="renames[]" value="'+self.escape(rename)+'"/>');
});
form.append('<input type="hidden" name="suffix" value="'+fm.options.backupSuffix+'"/>');
}
if(hashes){
$.each(renames, function(i, v){
form.append('<input type="hidden" name="['+i+']" value="'+self.escape(v)+'"/>');
});
}
if(data.overwrite===0){
form.append('<input type="hidden" name="overwrite" value="0"/>');
}
$.each(self.options.onlyMimes||[], function(i, mime){
form.append('<input type="hidden" name="mimes[]" value="'+self.escape(mime)+'"/>');
});
$.each(self.customData, function(key, val){
form.append('<input type="hidden" name="'+key+'" value="'+self.escape(val)+'"/>');
});
form.appendTo('body');
iframe.appendTo('body');
});
return dfrd;
}},
one:function(ev, callback, priorityFirst){
var self=this,
event=ev.toLowerCase(),
h=function(e, f){
if(!self.toUnbindEvents[event]){
self.toUnbindEvents[event]=[];
}
self.toUnbindEvents[event].push({
type: event,
callback: h
});
return (callback.done? callback.done:callback).apply(this, arguments);
};
if(callback.done){
h={done: h};}
return this.bind(event, h, priorityFirst);
},
localStorage:function(key, val){
var self=this,
s=window.localStorage,
oldkey='elfinder-'+(key||'')+this.id,
prefix=window.location.pathname+'-elfinder-',
suffix=this.id,
clrs=[],
retval, oldval, t, precnt, sufcnt;
if(typeof(key)==='undefined'){
precnt=prefix.length;
sufcnt=suffix.length * -1;
$.each(s, function(key){
if(key.substr(0, precnt)===prefix&&key.substr(sufcnt)===suffix){
clrs.push(key);
}});
$.each(clrs, function(i, key){
s.removeItem(key);
});
return true;
}
key=prefix+key+suffix;
if(val===null){
return s.removeItem(key);
}
if(val===void(0)&&!(retval=s.getItem(key))&&(oldval=s.getItem(oldkey))){
val=oldval;
s.removeItem(oldkey);
}
if(val!==void(0)){
t=typeof val;
if(t!=='string'&&t!=='number'){
val=JSON.stringify(val);
}
try {
s.setItem(key, val);
} catch (e){
try {
s.clear();
s.setItem(key, val);
} catch (e){
self.debug('error', e.toString());
}}
retval=s.getItem(key);
}
if(retval&&(retval.substr(0,1)==='{'||retval.substr(0,1)==='[')){
try {
return JSON.parse(retval);
} catch(e){}}
return retval;
},
cookie:function(name, value){
var d, o, c, i, retval, t;
name='elfinder-'+name+this.id;
if(value===void(0)){
if(document.cookie&&document.cookie!=''){
c=document.cookie.split(';');
name +='=';
for (i=0; i<c.length; i++){
c[i]=$.trim(c[i]);
if(c[i].substring(0, name.length)==name){
retval=decodeURIComponent(c[i].substring(name.length));
if(retval.substr(0,1)==='{'||retval.substr(0,1)==='['){
try {
return JSON.parse(retval);
} catch(e){}}
return retval;
}}
}
return null;
}
o=Object.assign({}, this.options.cookie);
if(value===null){
value='';
o.expires=-1;
}else{
t=typeof value;
if(t!=='string'&&t!=='number'){
value=JSON.stringify(value);
}}
if(typeof(o.expires)=='number'){
d=new Date();
d.setTime(d.getTime()+(o.expires * 86400000));
o.expires=d;
}
document.cookie=name+'='+encodeURIComponent(value)+'; expires='+o.expires.toUTCString()+(o.path ? '; path='+o.path:'')+(o.domain ? '; domain='+o.domain:'')+(o.secure ? '; secure':'');
if(value&&(value.substr(0,1)==='{'||value.substr(0,1)==='[')){
try {
return JSON.parse(value);
} catch(e){}}
return value;
},
startDir:function(){
var locHash=window.location.hash;
if(locHash&&locHash.match(/^#elf_/)){
return locHash.replace(/^#elf_/, '');
}else if(this.options.startPathHash){
return this.options.startPathHash;
}else{
return this.lastDir();
}},
lastDir:function(hash){
return this.options.rememberLastDir ? this.storage('lastdir', hash):'';
},
_node:$('<span/>'),
escape:function(name){
return this._node.text(name).html().replace(/"/g, '&quot;').replace(/'/g, '&#039;');
},
normalize:function(data){
var self=this,
fileFilter=(function(){
var func, filter;
if(filter=self.options.fileFilter){
if(typeof filter==='function'){
func=function(file){
return filter.call(self, file);
};}else if(filter instanceof RegExp){
func=function(file){
return filter.test(file.name);
};}}
return func? func:null;
})(),
chkCmdMap=function(opts){
var disabled;
if(opts.uiCmdMap){
if($.isPlainObject(opts.uiCmdMap)&&Object.keys(opts.uiCmdMap).length){
if(!opts.disabledFlip){
opts.disabledFlip={};}
disabled=opts.disabledFlip;
$.each(opts.uiCmdMap, function(f, t){
if(t==='hidden'&&!disabled[f]){
opts.disabled.push(f);
opts.disabledFlip[f]=true;
}});
}else{
delete opts.uiCmdMap;
}}
},
normalizeOptions=function(opts){
var getType=function(v){
var type=typeof v;
if(type==='object'&&Array.isArray(v)){
type='array';
}
return type;
};
$.each(self.optionProperties, function(k, empty){
if(empty!==void(0)){
if(opts[k]&&getType(opts[k])!==getType(empty)){
opts[k]=empty;
}}
});
if(opts['disabled']){
opts['disabledFlip']=self.arrayFlip(opts['disabled'], true);
}else{
opts['disabledFlip']={};}
return opts;
},
filter=function(file, asMap, type){
var res=asMap? file:true,
ign=asMap? null:false,
vid, targetOptions, isRoot, rootNames;
if(file&&file.hash&&file.name&&file.mime){
if(file.mime==='application/x-empty'){
file.mime='text/plain';
}
isRoot=self.isRoot(file);
if(isRoot&&! file.volumeid){
self.debug('warning', 'The volume root statuses requires `volumeid` property.');
}
if(isRoot||file.mime==='directory'){
if(file.phash){
if(file.phash===file.hash){
error=error.concat(['Parent folder of "$1" is itself.', file.name]);
return ign;
}
if(isRoot&&file.volumeid&&file.phash.indexOf(file.volumeid)===0){
error=error.concat(['Parent folder of "$1" is inner itself.', file.name]);
return ign;
}}
if(file.volumeid){
vid=file.volumeid;
if(isRoot){
if(file.phash){
if(! self.leafRoots[file.phash]){
self.leafRoots[file.phash]=[ file.hash ];
}else{
if($.inArray(file.hash, self.leafRoots[file.phash])===-1){
self.leafRoots[file.phash].push(file.hash);
}}
}
self.hasVolOptions=true;
if(! self.volOptions[vid]){
self.volOptions[vid]={
dispInlineRegex: self.options.dispInlineRegex
};}
targetOptions=self.volOptions[vid];
if(file.options){
Object.assign(targetOptions, file.options);
}
if(file.disabled){
targetOptions.disabled=file.disabled;
targetOptions.disabledFlip=self.arrayFlip(file.disabled, true);
}
if(file.tmbUrl){
targetOptions.tmbUrl=file.tmbUrl;
}
if(targetOptions.url&&targetOptions.url.substr(-1)!=='/'){
targetOptions.url +='/';
}
chkCmdMap(targetOptions);
if(targetOptions.trashHash){
if(self.trashes[targetOptions.trashHash]===false){
delete targetOptions.trashHash;
}else{
self.trashes[targetOptions.trashHash]=file.hash;
}}
$.each(self.optionProperties, function(k){
if(targetOptions[k]){
file[k]=targetOptions[k];
}});
if(type!=='cwd'){
self.roots[vid]=file.hash;
}
if(file.expires){
self.volumeExpires[vid]=file.expires;
}}
if(prevId!==vid){
prevId=vid;
i18nFolderName=self.option('i18nFolderName', vid);
}}
if(isRoot&&! file.i18){
name='volume_' + file.name,
i18=self.i18n(false, name);
if(name!==i18){
file.i18=i18;
}}
if(i18nFolderName&&! file.i18){
name='folder_' + file.name,
i18=self.i18n(false, name);
if(name!==i18){
file.i18=i18;
}}
if(isRoot){
if(rootNames=self.storage('rootNames')){
if(rootNames[file.hash]){
file._name=file.name;
file._i18=file.i18;
file.name=rootNames[file.hash]=rootNames[file.hash];
delete file.i18;
}
self.storage('rootNames', rootNames);
}}
if(self.trashes[file.hash]){
file.locked=true;
}}else{
if(fileFilter){
try {
if(! fileFilter(file)){
return ign;
}} catch(e){
self.debug(e);
}}
if(file.size==0){
file.mime=self.getMimetype(file.name, file.mime);
}}
if(file.options){
self.optionsByHashes[file.hash]=normalizeOptions(file.options);
}
delete file.options;
return res;
}
return ign;
},
getDescendants=function(hashes){
var res=[];
$.each(self.files(), function(h, f){
$.each(self.parents(h), function(i, ph){
if($.inArray(ph, hashes)!==-1&&$.inArray(h, hashes)===-1){
res.push(h);
return false;
}});
});
return res;
},
applyLeafRootStats=function(dataArr, type){
$.each(dataArr, function(i, f){
var pfile, done;
if(self.leafRoots[f.hash]){
self.applyLeafRootStats(f);
}
if(type!=='change'&&f.phash&&self.isRoot(f)&&(pfile=self.file(f.phash))){
self.applyLeafRootStats(pfile);
if(!data.changed){
data.changed=[pfile];
}else{
$.each(data.changed, function(i, f){
if(f.hash===pfile.hash){
data.changed[i]=pfile;
done=true;
return false;
}});
if(!done){
data.changed.push(pfile);
}}
}});
},
error=[],
name, i18, i18nFolderName, prevId, cData;
if(data.customData&&data.customData!==self.prevCustomData){
self.prevCustomData=data.customData;
try {
cData=JSON.parse(data.customData);
if($.isPlainObject(cData)){
self.prevCustomData=cData;
$.each(Object.keys(cData), function(i, key){
if(cData[key]===null){
delete cData[key];
delete self.optsCustomData[key];
}});
self.customData=Object.assign({}, self.optsCustomData, cData);
}} catch(e){}}
if(data.options){
normalizeOptions(data.options);
}
if(data.cwd){
if(data.cwd.volumeid&&data.options&&Object.keys(data.options).length&&self.isRoot(data.cwd)){
self.hasVolOptions=true;
self.volOptions[data.cwd.volumeid]=data.options;
}
data.cwd=filter(data.cwd, true, 'cwd');
}
if(data.files){
data.files=$.grep(data.files, filter);
}
if(data.tree){
data.tree=$.grep(data.tree, filter);
}
if(data.added){
data.added=$.grep(data.added, filter);
}
if(data.changed){
data.changed=$.grep(data.changed, filter);
}
if(data.removed&&data.removed.length&&self.searchStatus.state===2){
data.removed=data.removed.concat(getDescendants(data.removed));
}
if(data.api){
data.init=true;
}
if(Object.keys(self.leafRoots).length){
data.files&&applyLeafRootStats(data.files);
data.tree&&applyLeafRootStats(data.tree);
data.added&&applyLeafRootStats(data.added);
data.changed&&applyLeafRootStats(data.changed, 'change');
}
if(data.cwd&&data.cwd.options&&data.options){
Object.assign(data.options, normalizeOptions(data.cwd.options));
}
if(data.options&&data.options.url&&data.options.url.substr(-1)!=='/'){
data.options.url +='/';
}
if(error.length){
data.norError=['errResponse'].concat(error);
}
return data;
},
setSort:function(type, order, stickFolders, alsoTreeview){
this.storage('sortType', (this.sortType=this.sortRules[type] ? type:'name'));
this.storage('sortOrder', (this.sortOrder=/asc|desc/.test(order) ? order:'asc'));
this.storage('sortStickFolders', (this.sortStickFolders = !!stickFolders) ? 1:'');
this.storage('sortAlsoTreeview', (this.sortAlsoTreeview = !!alsoTreeview) ? 1:'');
this.trigger('sortchange');
},
_sortRules:{
name:function(file1, file2){
return elFinder.prototype.naturalCompare(file1.i18||file1.name, file2.i18||file2.name);
},
size:function(file1, file2){
var size1=parseInt(file1.size)||0,
size2=parseInt(file2.size)||0;
return size1===size2 ? 0:size1 > size2 ? 1:-1;
},
kind:function(file1, file2){
return elFinder.prototype.naturalCompare(file1.mime, file2.mime);
},
date:function(file1, file2){
var date1=file1.ts||file1.date||0,
date2=file2.ts||file2.date||0;
return date1===date2 ? 0:date1 > date2 ? 1:-1;
},
perm:function(file1, file2){
var val=function(file){ return (file.write? 2:0) + (file.read? 1:0); },
v1=val(file1),
v2=val(file2);
return v1===v2 ? 0:v1 > v2 ? 1:-1;
},
mode:function(file1, file2){
var v1=file1.mode||(file1.perm||''),
v2=file2.mode||(file2.perm||'');
return elFinder.prototype.naturalCompare(v1, v2);
},
owner:function(file1, file2){
var v1=file1.owner||'',
v2=file2.owner||'';
return elFinder.prototype.naturalCompare(v1, v2);
},
group:function(file1, file2){
var v1=file1.group||'',
v2=file2.group||'';
return elFinder.prototype.naturalCompare(v1, v2);
}},
sorters:{},
naturalCompare:function(a, b){
var self=elFinder.prototype.naturalCompare;
if(typeof self.loc=='undefined'){
self.loc=(navigator.userLanguage||navigator.browserLanguage||navigator.language||'en-US');
}
if(typeof self.sort=='undefined'){
if('11'.localeCompare('2', self.loc, {numeric: true}) > 0){
if(window.Intl&&window.Intl.Collator){
self.sort=new Intl.Collator(self.loc, {numeric: true}).compare;
}else{
self.sort=function(a, b){
return a.localeCompare(b, self.loc, {numeric: true});
};}}else{
self.sort=function(a, b){
var re=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,
sre=/(^[ ]*|[ ]*$)/g,
dre=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,
hre=/^0x[0-9a-f]+$/i,
ore=/^0/,
syre=/^[\x01\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e]/,
i=function(s){ return self.sort.insensitive&&(''+s).toLowerCase()||''+s; },
x=i(a).replace(sre, '').replace(/^_/, "\x01")||'',
y=i(b).replace(sre, '').replace(/^_/, "\x01")||'',
xN=x.replace(re, '\0$1\0').replace(/\0$/,'').replace(/^\0/,'').split('\0'),
yN=y.replace(re, '\0$1\0').replace(/\0$/,'').replace(/^\0/,'').split('\0'),
xD=parseInt(x.match(hre))||(xN.length!=1&&x.match(dre)&&Date.parse(x)),
yD=parseInt(y.match(hre))||xD&&y.match(dre)&&Date.parse(y)||null,
oFxNcL, oFyNcL,
locRes=0;
if(yD){
if(xD < yD) return -1;
else if(xD > yD) return 1;
}
for(var cLoc=0, numS=Math.max(xN.length, yN.length); cLoc < numS; cLoc++){
oFxNcL = !(xN[cLoc]||'').match(ore)&&parseFloat(xN[cLoc])||xN[cLoc]||0;
oFyNcL = !(yN[cLoc]||'').match(ore)&&parseFloat(yN[cLoc])||yN[cLoc]||0;
if(isNaN(oFxNcL)!==isNaN(oFyNcL)){
if(isNaN(oFxNcL)&&(typeof oFxNcL!=='string'||! oFxNcL.match(syre))){
return 1;
}else if(typeof oFyNcL!=='string'||! oFyNcL.match(syre)){
return -1;
}}
if(parseInt(oFxNcL, 10)===0) oFxNcL=0;
if(parseInt(oFyNcL, 10)===0) oFyNcL=0;
if(typeof oFxNcL!==typeof oFyNcL){
oFxNcL +='';
oFyNcL +='';
}
if(self.sort.insensitive&&typeof oFxNcL==='string'&&typeof oFyNcL==='string'){
locRes=oFxNcL.localeCompare(oFyNcL, self.loc);
if(locRes!==0) return locRes;
}
if(oFxNcL < oFyNcL) return -1;
if(oFxNcL > oFyNcL) return 1;
}
return 0;
};
self.sort.insensitive=true;
}}
return self.sort(a, b);
},
compare:function(file1, file2){
var self=this,
type=self.sortType,
asc=self.sortOrder=='asc',
stick=self.sortStickFolders,
rules=self.sortRules,
sort=rules[type],
d1=file1.mime=='directory',
d2=file2.mime=='directory',
res;
if(stick){
if(d1&&!d2){
return -1;
}else if(!d1&&d2){
return 1;
}}
res=asc ? sort(file1, file2):sort(file2, file1);
return type!=='name'&&res===0
? res=asc ? rules.name(file1, file2):rules.name(file2, file1)
: res;
},
sortFiles:function(files){
return files.sort(this.compare);
},
notify:function(opts){
var type=opts.type,
id=opts.id? 'elfinder-notify-'+opts.id:'',
msg=this.i18n((typeof opts.msg!=='undefined')? opts.msg:(this.messages['ntf'+type] ? 'ntf'+type:'ntfsmth')),
ndialog=this.ui.notify,
notify=ndialog.children('.elfinder-notify-'+type+(id? ('.'+id):'')),
button=notify.children('div.elfinder-notify-cancel').children('button'),
ntpl='<div class="elfinder-notify elfinder-notify-{type}'+(id? (' '+id):'')+'"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"/><span class="elfinder-notify-msg">{msg}</span> <span class="elfinder-notify-cnt"/><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"/></div><div class="elfinder-notify-cancel"/></div>',
delta=opts.cnt,
size=(typeof opts.size!='undefined')? parseInt(opts.size):null,
progress=(typeof opts.progress!='undefined'&&opts.progress >=0) ? opts.progress:null,
cancel=opts.cancel,
clhover='ui-state-hover',
close=function(){
notify._esc&&$(document).off('keydown', notify._esc);
notify.remove();
!ndialog.children().length&&ndialog.elfinderdialog('close');
},
cnt, total, prc;
if(!type){
return this;
}
if(!notify.length){
notify=$(ntpl.replace(/\{type\}/g, type).replace(/\{msg\}/g, msg))
.appendTo(ndialog)
.data('cnt', 0);
if(progress!=null){
notify.data({progress:0, total:0});
}
if(cancel){
button=$('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+this.i18n('btnCancel')+'</span></button>')
.on('mouseenter mouseleave', function(e){
$(this).toggleClass(clhover, e.type==='mouseenter');
});
notify.children('div.elfinder-notify-cancel').append(button);
}}else if(typeof opts.msg!=='undefined'){
notify.children('span.elfinder-notify-msg').html(msg);
}
cnt=delta + parseInt(notify.data('cnt'));
if(cnt > 0){
if(cancel&&button.length){
if($.isFunction(cancel)||(typeof cancel==='object'&&cancel.promise)){
notify._esc=function(e){
if(e.type=='keydown'&&e.keyCode!=$.ui.keyCode.ESCAPE){
return;
}
e.preventDefault();
e.stopPropagation();
close();
if(cancel.promise){
cancel.reject(0);
}else{
cancel(e);
}};
button.on('click', function(e){
notify._esc(e);
});
$(document).on('keydown.' + this.namespace, notify._esc);
}}
!opts.hideCnt&&notify.children('.elfinder-notify-cnt').text('('+cnt+')');
ndialog.is(':hidden')&&ndialog.elfinderdialog('open', this).height('auto');
notify.data('cnt', cnt);
if((progress!=null)
&& (total=notify.data('total')) >=0
&& (prc=notify.data('progress')) >=0){
total +=size!=null? size:delta;
prc   +=progress;
(size==null&&delta < 0)&&(prc +=delta * 100);
notify.data({progress:prc, total:total});
if(size!=null){
prc *=100;
total=Math.max(1, total);
}
progress=parseInt(prc/total);
notify.find('.elfinder-notify-progress')
.animate({
width:(progress < 100 ? progress:100)+'%'
}, 20);
}}else{
close();
}
return this;
},
/**
* Open confirmation dialog
*
* @param  Object  options
* @example
* this.confirm({
*    cssClass:'elfinder-confirm-mydialog',
*    title:'Remove files',
*    text:'Here is question text',
*    accept:{
*      label:'Continue',
*      callback:function(applyToAll){ fm.log('Ok') }
*    },
*    cancel:{
*      label:'Cancel',
*      callback:function(){ fm.log('Cancel')}
*    },
*    reject:{
*      label:'No',
*      callback:function(applyToAll){ fm.log('No')}
*    },
*    buttons:[
*      {
*        label:'Btn1',
*        callback:function(applyToAll){ fm.log('Btn1')}
*      }
*    ],
*    all:true
* })
* @return elFinder
*/
confirm:function(opts){
var self=this,
complete=false,
options={
cssClass:'elfinder-dialog-confirm',
modal:true,
resizable:false,
title:this.i18n(opts.title||'confirmReq'),
buttons:{},
close:function(){
!complete&&opts.cancel.callback();
$(this).elfinderdialog('destroy');
}},
apply=this.i18n('apllyAll'),
label, checkbox, btnNum;
if(opts.cssClass){
options.cssClass +=' ' + opts.cssClass;
}
options.buttons[this.i18n(opts.accept.label)]=function(){
opts.accept.callback(!!(checkbox&&checkbox.prop('checked')));
complete=true;
$(this).elfinderdialog('close');
};
options.buttons[this.i18n(opts.accept.label)]._cssClass='elfinder-confirm-accept';
if(opts.reject){
options.buttons[this.i18n(opts.reject.label)]=function(){
opts.reject.callback(!!(checkbox&&checkbox.prop('checked')));
complete=true;
$(this).elfinderdialog('close');
};
options.buttons[this.i18n(opts.reject.label)]._cssClass='elfinder-confirm-reject';
}
if(opts.buttons&&opts.buttons.length > 0){
btnNum=1;
$.each(opts.buttons, function(i, v){
options.buttons[self.i18n(v.label)]=function(){
v.callback(!!(checkbox&&checkbox.prop('checked')));
complete=true;
$(this).elfinderdialog('close');
};
options.buttons[self.i18n(v.label)]._cssClass='elfinder-confirm-extbtn' + (btnNum++);
if(v.cssClass){
options.buttons[self.i18n(v.label)]._cssClass +=' ' + v.cssClass;
}});
}
options.buttons[this.i18n(opts.cancel.label)]=function(){
$(this).elfinderdialog('close');
};
options.buttons[this.i18n(opts.cancel.label)]._cssClass='elfinder-confirm-cancel';
if(opts.all){
options.create=function(){
var base=$('<div class="elfinder-dialog-confirm-applyall"/>');
checkbox=$('<input type="checkbox" />');
$(this).next().find('.ui-dialog-buttonset')
.prepend(base.append($('<label>'+apply+'</label>').prepend(checkbox)));
};}
if(opts.optionsCallback&&$.isFunction(opts.optionsCallback)){
opts.optionsCallback(options);
}
return this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"/>' + this.i18n(opts.text), options);
},
uniqueName:function(prefix, phash, glue){
var i=0, ext='', p, name;
prefix=this.i18n(false, prefix);
phash=phash||this.cwd().hash;
glue=(typeof glue==='undefined')? ' ':glue;
if(p=prefix.match(/^(.+)(\.[^.]+)$/)){
ext=p[2];
prefix=p[1];
}
name=prefix+ext;
if(!this.fileByName(name, phash)){
return name;
}
while (i < 10000){
name=prefix + glue + (++i) + ext;
if(!this.fileByName(name, phash)){
return name;
}}
return prefix + Math.random() + ext;
},
i18n:function(){
var self=this,
messages=this.messages,
input=[],
ignore=[],
message=function(m){
var file;
if(m.indexOf('#')===0){
if((file=self.file(m.substr(1)))){
return file.name;
}}
return m;
},
i, j, m, escFunc, start=0, isErr;
if(arguments.length&&arguments[0]===false){
escFunc=function(m){ return m; };
start=1;
}
for (i=start; i< arguments.length; i++){
m=arguments[i];
if(Array.isArray(m)){
for (j=0; j < m.length; j++){
if(m[j] instanceof jQuery){
input.push(m[j]);
}else if(typeof m[j]!=='undefined'){
input.push(message('' + m[j]));
}}
}else if(m instanceof jQuery){
input.push(m[j]);
}else if(typeof m!=='undefined'){
input.push(message('' + m));
}}
for (i=0; i < input.length; i++){
if($.inArray(i, ignore)!==-1){
continue;
}
m=input[i];
if(typeof m=='string'){
isErr = !!(messages[m]&&m.match(/^err/));
m=messages[m]||(escFunc? escFunc(m):self.escape(m));
m=m.replace(/\$(\d+)/g, function(match, placeholder){
var res;
placeholder=i + parseInt(placeholder);
if(placeholder > 0&&input[placeholder]){
ignore.push(placeholder);
}
res=escFunc? escFunc(input[placeholder]):self.escape(input[placeholder]);
if(isErr){
res='<span class="elfinder-err-var elfinder-err-var' + placeholder + '">' + res + '</span>';
}
return res;
});
}else{
m=m.get(0).outerHTML;
}
input[i]=m;
}
return $.grep(input, function(m, i){ return $.inArray(i, ignore)===-1 ? true:false; }).join('<br>');
},
getIconStyle:function(file, asObject){
var self=this,
template={
'background':'url(\'{url}\') 0 0 no-repeat',
'background-size':'contain'
},
style='',
cssObj={},
i=0;
if(file.icon){
style='style="';
$.each(template, function(k, v){
if(i++===0){
v=v.replace('{url}', self.escape(file.icon));
}
if(asObject){
cssObj[k]=v;
}else{
style +=k+':'+v+';';
}});
style +='"';
}
return asObject? cssObj:style;
},
mime2class:function(mimeType){
var prefix='elfinder-cwd-icon-',
mime=mimeType.toLowerCase(),
isText=this.textMimes[mime];
mime=mime.split('/');
if(isText){
mime[0] +=' ' + prefix + 'text';
}else if(mime[1]&&mime[1].match(/\+xml$/)){
mime[0] +=' ' + prefix + 'xml';
}
return prefix + mime[0] + (mime[1] ? ' ' + prefix + mime[1].replace(/(\.|\+)/g, '-'):'');
},
mime2kind:function(f){
var isObj=typeof(f)=='object' ? true:false,
mime=isObj ? f.mime:f,
kind;
if(isObj&&f.alias&&mime!='symlink-broken'){
kind='Alias';
}else if(this.kinds[mime]){
if(isObj&&mime==='directory'&&(! f.phash||f.isroot)){
kind='Root';
}else{
kind=this.kinds[mime];
}}
if(! kind){
if(mime.indexOf('text')===0){
kind='Text';
}else if(mime.indexOf('image')===0){
kind='Image';
}else if(mime.indexOf('audio')===0){
kind='Audio';
}else if(mime.indexOf('video')===0){
kind='Video';
}else if(mime.indexOf('application')===0){
kind='App';
}else{
kind=mime;
}}
return this.messages['kind'+kind] ? this.i18n('kind'+kind):mime;
},
mimeIsText:function(mime){
return (this.textMimes[mime.toLowerCase()]||(mime.indexOf('text/')===0&&mime.substr(5, 3)!=='rtf')||mime.match(/^application\/.+\+xml$/))? true:false;
},
date:function(format, date){
var self=this,
output, d, dw, m, y, h, g, i, s;
if(! date){
date=new Date();
}
h=date[self.getHours]();
g=h > 12 ? h - 12:h;
i=date[self.getMinutes]();
s=date[self.getSeconds]();
d=date[self.getDate]();
dw=date[self.getDay]();
m=date[self.getMonth]() + 1;
y=date[self.getFullYear]();
output=format.replace(/[a-z]/gi, function(val){
switch (val){
case 'd': return d > 9 ? d:'0'+d;
case 'j': return d;
case 'D': return self.i18n(self.i18.daysShort[dw]);
case 'l': return self.i18n(self.i18.days[dw]);
case 'm': return m > 9 ? m:'0'+m;
case 'n': return m;
case 'M': return self.i18n(self.i18.monthsShort[m-1]);
case 'F': return self.i18n(self.i18.months[m-1]);
case 'Y': return y;
case 'y': return (''+y).substr(2);
case 'H': return h > 9 ? h:'0'+h;
case 'G': return h;
case 'g': return g;
case 'h': return g > 9 ? g:'0'+g;
case 'a': return h >=12 ? 'pm':'am';
case 'A': return h >=12 ? 'PM':'AM';
case 'i': return i > 9 ? i:'0'+i;
case 's': return s > 9 ? s:'0'+s;
}
return val;
});
return output;
},
formatDate:function(file, t){
var self=this,
ts=t||file.ts,
i18=self.i18,
date, format, output, d, dw, m, y, h, g, i, s;
if(self.options.clientFormatDate&&ts > 0){
date=new Date(ts*1000);
format=ts >=this.yesterday
? this.fancyFormat
: this.dateFormat;
output=self.date(format, date);
return ts >=this.yesterday
? output.replace('$1', this.i18n(ts >=this.today ? 'Today':'Yesterday'))
: output;
}else if(file.date){
return file.date.replace(/([a-z]+)\s/i, function(a1, a2){ return self.i18n(a2)+' '; });
}
return self.i18n('dateUnknown');
},
toLocaleString:function(num){
var v=new Number(num);
if(v){
if(v.toLocaleString){
return v.toLocaleString();
}else{
return String(num).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, '$1,');
}}
return num;
},
perms2class:function(o){
var c='';
if(!o.read&&!o.write){
c='elfinder-na';
}else if(!o.read){
c='elfinder-wo';
}else if(!o.write){
c='elfinder-ro';
}
if(o.type){
c +=' elfinder-' + this.escape(o.type);
}
return c;
},
formatPermissions:function(f){
var p=[];
f.read&&p.push(this.i18n('read'));
f.write&&p.push(this.i18n('write'));
return p.length ? p.join(' '+this.i18n('and')+' '):this.i18n('noaccess');
},
formatSize:function(s){
var n=1, u='b';
if(s=='unknown'){
return this.i18n('unknown');
}
if(s > 1073741824){
n=1073741824;
u='GB';
}else if(s > 1048576){
n=1048576;
u='MB';
}else if(s > 1024){
n=1024;
u='KB';
}
s=s/n;
return (s > 0 ? n >=1048576 ? s.toFixed(2):Math.round(s):0) +' '+u;
},
formatFileMode:function(p, style){
var i, o, s, b, sticy, suid, sgid, str, oct;
if(!style){
style=this.options.fileModeStyle.toLowerCase();
}
p=$.trim(p);
if(p.match(/[rwxs-]{9}$/i)){
str=p = p.substr(-9);
if(style=='string'){
return str;
}
oct='';
s=0;
for (i=0; i<7; i=i+3){
o=p.substr(i, 3);
b=0;
if(o.match(/[r]/i)){
b +=4;
}
if(o.match(/[w]/i)){
b +=2;
}
if(o.match(/[xs]/i)){
if(o.match(/[xs]/)){
b +=1;
}
if(o.match(/[s]/i)){
if(i==0){
s +=4;
}else if(i==3){
s +=2;
}}
}
oct +=b.toString(8);
}
if(s){
oct=s.toString(8) + oct;
}}else{
p=parseInt(p, 8);
oct=p? p.toString(8):'';
if(!p||style=='octal'){
return oct;
}
o=p.toString(8);
s=0;
if(o.length > 3){
o=o.substr(-4);
s=parseInt(o.substr(0, 1), 8);
o=o.substr(1);
}
sticy=((s & 1)==1);
sgid=((s & 2)==2);
suid=((s & 4)==4);
str='';
for(i=0; i<3; i++){
if((parseInt(o.substr(i, 1), 8) & 4)==4){
str +='r';
}else{
str +='-';
}
if((parseInt(o.substr(i, 1), 8) & 2)==2){
str +='w';
}else{
str +='-';
}
if((parseInt(o.substr(i, 1), 8) & 1)==1){
str +=((i==0&&suid)||(i==1&&sgid))? 's':'x';
}else{
str +='-';
}}
}
if(style=='both'){
return str + ' (' + oct + ')';
}else if(style=='string'){
return str;
}else{
return oct;
}},
registRawStringDecoder:function(rawStringDecoder){
if($.isFunction(rawStringDecoder)){
this.decodeRawString=this.options.rawStringDecoder=rawStringDecoder;
}},
uploadMimeCheck:function(mime, target){
target=target||this.cwd().hash;
var res=true,
mimeChecker=this.option('uploadMime', target),
allow,
deny,
check=function(checker){
var ret=false;
if(typeof checker==='string'&&checker.toLowerCase()==='all'){
ret=true;
}else if(Array.isArray(checker)&&checker.length){
$.each(checker, function(i, v){
v=v.toLowerCase();
if(v==='all'||mime.indexOf(v)===0){
ret=true;
return false;
}});
}
return ret;
};
if(mime&&$.isPlainObject(mimeChecker)){
mime=mime.toLowerCase();
allow=check(mimeChecker.allow);
deny=check(mimeChecker.deny);
if(mimeChecker.firstOrder==='allow'){
res=false;
if(! deny&&allow===true){
res=true;
}}else{
res=true;
if(deny===true&&! allow){
res=false;
}}
}
return res;
},
sequence:function(tasks){
var l=tasks.length,
chain=function(task, idx){
++idx;
if(tasks[idx]){
return chain(task.then(tasks[idx]), idx);
}else{
return task;
}};
if(l > 1){
return chain(tasks[0](), 0);
}else{
return tasks[0]();
}},
reloadContents:function(url){
var dfd=$.Deferred(),
ifm;
try {
ifm=$('<iframe width="1" height="1" scrolling="no" frameborder="no" style="position:absolute; top:-1px; left:-1px" crossorigin="use-credentials">')
.attr('src', url)
.one('load', function(){
var ifm=$(this);
try {
this.contentDocument.location.reload(true);
ifm.one('load', function(){
ifm.remove();
dfd.resolve();
});
} catch(e){
ifm.attr('src', '').attr('src', url).one('load', function(){
ifm.remove();
dfd.resolve();
});
}})
.appendTo('body');
} catch(e){
ifm&&ifm.remove();
dfd.reject();
}
return dfd;
},
makeNetmountOptionOauth:function(protocol, name, host, opt){
var noOffline=typeof opt==='boolean'? opt:null,
opts=Object.assign({
noOffline:false,
root:'root',
pathI18n:'folderId',
folders:true
}, (noOffline===null? (opt||{}):{noOffline:noOffline})),
addFolders=function(fm, bro, folders){
var self=this,
cnt=Object.keys($.isPlainObject(folders)? folders:{}).length,
select;
bro.next().remove();
if(cnt){
select=$('<select class="ui-corner-all elfinder-tabstop" style="max-width:200px;">').append($($.map(folders, function(n,i){return '<option value="'+fm.escape((i+'').trim())+'">'+fm.escape(n)+'</option>';}).join(''))
).on('change click', function(e){
var node=$(this),
path=node.val(),
spn;
self.inputs.path.val(path);
if(opts.folders&&(e.type==='change'||node.data('current')!==path)){
node.next().remove();
node.data('current', path);
if(path!=opts.root){
spn=spinner();
if(xhr&&xhr.state()==='pending'){
fm.abortXHR(xhr, { quiet: true , abort: true });
}
node.after(spn);
xhr=fm.request({
data:{cmd:'netmount', protocol: protocol, host: host, user: 'init', path: path, pass: 'folders'},
preventDefault:true
}).done(function(data){
addFolders.call(self, fm, node, data.folders);
}).always(function(){
fm.abortXHR(xhr, { quiet: true });
spn.remove();
}).xhr;
}}
});
bro.after($('<div/>').append(select))
.closest('.ui-dialog').trigger('tabstopsInit');
select.trigger('focus');
}},
spinner=function(){
return $('<div class="elfinder-netmount-spinner"/>').append('<span class="elfinder-spinner"/>');
},
xhr;
return {
vars:{},
name:name,
inputs: {
offline:$('<input type="checkbox"/>').on('change', function(){
$(this).parents('table.elfinder-netmount-tb').find('select:first').trigger('change', 'reset');
}),
host:$('<span><span class="elfinder-spinner"/></span><input type="hidden"/>'),
path:$('<input type="text" value="'+opts.root+'"/>'),
user:$('<input type="hidden"/>'),
pass:$('<input type="hidden"/>')
},
select: function(fm, ev, d){
var f=this.inputs,
oline=f.offline,
f0=$(f.host[0]),
data=d||null;
this.vars.mbtn=f.host.closest('.ui-dialog').children('.ui-dialog-buttonpane:first').find('button.elfinder-btncnt-0');
if(! f0.data('inrequest')
&& (f0.find('span.elfinder-spinner').length
|| data==='reset'
|| (data==='winfocus'&&! f0.siblings('span.elfinder-button-icon-reload').length))
){
if(oline.parent().children().length===1){
f.path.parent().prev().html(fm.i18n(opts.pathI18n));
oline.attr('title', fm.i18n('offlineAccess'));
oline.uniqueId().after($('<label/>').attr('for', oline.attr('id')).html(' '+fm.i18n('offlineAccess')));
}
f0.data('inrequest', true).empty().addClass('elfinder-spinner')
.parent().find('span.elfinder-button-icon').remove();
fm.request({
data:{cmd:'netmount', protocol: protocol, host: host, user: 'init', options: {id: fm.id, offline: oline.prop('checked')? 1:0, pass: f.host[1].value}},
preventDefault:true
}).done(function(data){
f0.removeClass("elfinder-spinner").html(data.body.replace(/\{msg:([^}]+)\}/g, function(whole,s1){return fm.i18n(s1, host);}));
});
opts.noOffline&&oline.closest('tr').hide();
}else{
oline.closest('tr')[(opts.noOffline||f.user.val())? 'hide':'show']();
f0.data('funcexpup')&&f0.data('funcexpup')();
}
this.vars.mbtn[$(f.host[1]).val()? 'show':'hide']();
},
done: function(fm, data){
var f=this.inputs,
p=this.protocol,
f0=$(f.host[0]),
f1=$(f.host[1]),
expires='&nbsp;';
opts.noOffline&&f.offline.closest('tr').hide();
if(data.mode=='makebtn'){
f0.removeClass('elfinder-spinner').removeData('expires').removeData('funcexpup');
f.host.find('input').on('mouseenter mouseleave', function(){$(this).toggleClass('ui-state-hover');});
f1.val('');
f.path.val(opts.root).next().remove();
f.user.val('');
f.pass.val('');
! opts.noOffline&&f.offline.closest('tr').show();
this.vars.mbtn.hide();
}else if(data.mode=='folders'){
if(data.folders){
addFolders.call(this, fm, f.path.nextAll(':last'), data.folders);
}}else{
if(data.expires){
expires='()';
f0.data('expires', data.expires);
}
f0.html(host + expires).removeClass('elfinder-spinner');
if(data.expires){
f0.data('funcexpup', function(){
var rem=Math.floor((f0.data('expires') - (+new Date()) / 1000) / 60);
if(rem < 3){
f0.parent().children('.elfinder-button-icon-reload').click();
}else{
f0.text(f0.text().replace(/\(.*\)/, '('+fm.i18n(['minsLeft', rem])+')'));
setTimeout(function(){
if(f0.is(':visible')){
f0.data('funcexpup')();
}}, 60000);
}});
f0.data('funcexpup')();
}
if(data.reset){
p.trigger('change', 'reset');
return;
}
f0.parent().append($('<span class="elfinder-button-icon elfinder-button-icon-reload" title="'+fm.i18n('reAuth')+'">')
.on('click', function(){
f1.val('reauth');
p.trigger('change', 'reset');
}));
f1.val(protocol);
this.vars.mbtn.show();
if(data.folders){
addFolders.call(this, fm, f.path, data.folders);
}
f.user.val('done');
f.pass.val('done');
f.offline.closest('tr').hide();
}
f0.removeData('inrequest');
},
fail: function(fm, err){
$(this.inputs.host[0]).removeData('inrequest');
this.protocol.trigger('change', 'reset');
},
integrateInfo: opts.integrate
};},
findCwdNodes:function(files, opts){
var self=this,
cwd=this.getUI('cwd'),
cwdHash=this.cwd().hash,
newItem=$();
opts=opts||{};
$.each(files, function(i, f){
if(f.phash===cwdHash||self.searchStatus.state > 1){
newItem=newItem.add(self.cwdHash2Elm(f.hash));
if(opts.firstOnly){
return false;
}}
});
return newItem;
},
convAbsUrl:function(url){
if(url.match(/^http/i)){
return url;
}
if(url.substr(0,2)==='//'){
return window.location.protocol + url;
}
var root=window.location.protocol + '//' + window.location.host,
reg=/[^\/]+\/\.\.\//,
ret;
if(url.substr(0, 1)==='/'){
ret=root + url;
}else{
ret=root + window.location.pathname.replace(/\/[^\/]+$/, '/') + url;
}
ret=ret.replace('/./', '/');
while(reg.test(ret)){
ret=ret.replace(reg, '');
}
return ret;
},
isSameOrigin:function (checkUrl){
var url;
checkUrl=this.convAbsUrl(checkUrl);
if(location.origin&&window.URL){
try {
url=new URL(checkUrl);
return location.origin===url.origin;
} catch(e){}}
url=document.createElement('a');
url.href=checkUrl;
return location.protocol===url.protocol&&location.host===url.host&&location.port&&url.port;
},
navHash2Id:function(hash){
return this.navPrefix + hash;
},
navId2Hash:function(id){
return typeof(id)=='string' ? id.substr(this.navPrefix.length):false;
},
cwdHash2Id:function(hash){
return this.cwdPrefix + hash;
},
cwdId2Hash:function(id){
return typeof(id)=='string' ? id.substr(this.cwdPrefix.length):false;
},
navHash2Elm:function(hash){
return $(document.getElementById(this.navHash2Id(hash)));
},
cwdHash2Elm:function(hash){
return $(document.getElementById(this.cwdHash2Id(hash)));
},
isInWindow:function(elem, nochkHide){
var elm, rect;
if(! (elm=elem.get(0))){
return false;
}
if(! nochkHide&&elm.offsetParent===null){
return false;
}
rect=elm.getBoundingClientRect();
return document.elementFromPoint(rect.left, rect.top)? true:false;
},
zIndexCalc:function(){
var self=this,
node=this.getUI(),
ni=node.css('z-index');
if(ni&&ni!=='auto'&&ni!=='inherit'){
self.zIndex=ni;
}else{
node.parents().each(function(i, n){
var z=$(n).css('z-index');
if(z!=='auto'&&z!=='inherit'&&(z=parseInt(z))){
self.zIndex=z;
return false;
}});
}},
loadScript:function(urls, callback, opts, check){
var defOpts={
dataType:'script',
cache:true
},
success, cnt, scripts={}, results={};
opts=opts||{};
if(opts.tryRequire&&this.hasRequire){
require(urls, callback, opts.error);
}else{
success=function(){
var cnt, fi, hasError;
$.each(results, function(i, status){
if(status!=='success'&&status!=='notmodified'){
hasError=true;
return false;
}});
if(!hasError){
if($.isFunction(callback)){
if(check){
if(typeof check.obj[check.name]==='undefined'){
cnt=check.timeout? (check.timeout / 10):1;
fi=setInterval(function(){
if(--cnt < 0||typeof check.obj[check.name]!=='undefined'){
clearInterval(fi);
callback();
}}, 10);
}else{
callback();
}}else{
callback();
}}
}else{
if(opts.error&&$.isFunction(opts.error)){
opts.error({ loadResults: results });
}}
};
if(opts.loadType==='tag'){
$('head > script').each(function(){
scripts[this.src]=this;
});
cnt=urls.length;
$.each(urls, function(i, url){
var done=false,
script;
if(scripts[url]){
results[i]=scripts[url]._error||'success';
(--cnt < 1)&&success();
}else{
script=document.createElement('script');
script.charset=opts.charset||'UTF-8';
$('head').append(script);
script.onload=script.onreadystatechange=function(){
if(!done&&(!this.readyState ||
this.readyState==='loaded'||this.readyState==='complete')){
done=true;
results[i]='success';
(--cnt < 1)&&success();
}};
script.onerror=function(err){
results[i]=script._error=(err&&err.type)? err.type:'error';
(--cnt < 1)&&success();
};
script.src=url;
}});
}else{
opts=$.isPlainObject(opts)? Object.assign(defOpts, opts):defOpts;
cnt=0;
(function appendScript(d, status){
if(d!==void(0)){
results[cnt++]=status;
}
if(urls.length){
$.ajax(Object.assign({}, opts, {
url: urls.shift(),
success: appendScript,
error: appendScript
}));
}else{
success();
}})();
}}
return this;
},
loadCss:function(urls, opts){
var self=this,
clName, dfds;
if(typeof urls==='string'){
urls=[ urls ];
}
if(opts){
if(opts.className){
clName=opts.className;
}
if(opts.dfd&&opts.dfd.promise){
dfds=[];
}}
$.each(urls, function(i, url){
var link, df;
url=self.convAbsUrl(url).replace(/^https?:/i, '');
if(dfds){
dfds[i]=$.Deferred();
}
if(! $("head > link[href='+url+']").length){
link=document.createElement('link');
link.type='text/css';
link.rel='stylesheet';
link.href=url;
if(clName){
link.className=clName;
}
if(dfds){
link.onload=function(){
dfds[i].resolve();
};
link.onerror=function(){
dfds[i].reject();
};}
$('head').append(link);
}else{
dfds&&dfds[i].resolve();
}});
if(dfds){
$.when.apply(null, dfds).done(function(){
opts.dfd.resolve();
}).fail(function(){
opts.dfd.reject();
});
}
return this;
},
asyncJob:function(func, arr, opts){
var dfrd=$.Deferred(),
abortFlg=false,
parms=Object.assign({
interval:0,
numPerOnce:1
}, opts||{}),
resArr=[],
vars=[],
curVars=[],
exec,
tm;
dfrd._abort=function(resolve){
tm&&clearTimeout(tm);
vars=[];
abortFlg=true;
if(dfrd.state()==='pending'){
dfrd[resolve? 'resolve':'reject'](resArr);
}};
dfrd.fail(function(){
dfrd._abort();
}).always(function(){
dfrd._abort=function(){};});
if(typeof func==='function'&&Array.isArray(arr)){
vars=arr.concat();
exec=function(){
var i, len, res;
if(abortFlg){
return;
}
curVars=vars.splice(0, parms.numPerOnce);
len=curVars.length;
for (i=0; i < len; i++){
if(abortFlg){
break;
}
res=func(curVars[i]);
(res!==null)&&resArr.push(res);
}
if(abortFlg){
return;
}
if(vars.length){
tm=setTimeout(exec, parms.interval);
}else{
dfrd.resolve(resArr);
}};
if(vars.length){
tm=setTimeout(exec, 0);
}else{
dfrd.resolve(resArr);
}}else{
dfrd.reject();
}
return dfrd;
},
getSize:function(targets){
var self=this,
reqs=[],
tgtlen=targets.length,
dfrd=$.Deferred().fail(function(){
$.each(reqs, function(i, req){
if(req){
req.syncOnFail&&req.syncOnFail(false);
req.reject();
}});
}),
getLeafRoots=function(file){
var targets=[];
if(file.mime==='directory'){
$.each(self.leafRoots, function(hash, roots){
var phash;
if(hash===file.hash){
targets.push.apply(targets, roots);
}else{
phash=(self.file(hash)||{}).phash;
while(phash){
if(phash===file.hash){
targets.push.apply(targets, roots);
}
phash=(self.file(phash)||{}).phash;
}}
});
}
return targets;
},
checkPhash=function(hash){
var dfd=$.Deferred(),
dir=self.file(hash),
target=dir? dir.phash:hash;
if(target&&! self.file(target)){
self.request({
data:{
cmd:'parents',
target:target
},
preventFail:true
}).done(function(){
self.one('parentsdone', function(){
dfd.resolve();
});
}).fail(function(){
dfd.resolve();
});
}else{
dfd.resolve();
}
return dfd;
},
cache=function(){
var dfd=$.Deferred(),
cnt=Object.keys(self.leafRoots).length;
if(cnt > 0){
$.each(self.leafRoots, function(hash){
checkPhash(hash).done(function(){
--cnt;
if(cnt < 1){
dfd.resolve();
}});
});
}else{
dfd.resolve();
}
return dfd;
};
self.autoSync('stop');
cache().done(function(){
var files=[], grps={}, dfds=[], cache=[], singles={};
$.each(targets, function(){
files.push.apply(files, getLeafRoots(self.file(this)));
});
targets.push.apply(targets, files);
$.each(targets, function(){
var root=self.root(this),
file=self.file(this);
if(file&&(file.sizeInfo||file.mime!=='directory')){
cache.push($.Deferred().resolve(file.sizeInfo? file.sizeInfo:{size: file.size, dirCnt: 0, fileCnt:1}));
}else{
if(! grps[root]){
grps[root]=[ this.toString() ];
}else{
grps[root].push(this.toString());
}}
});
$.each(grps, function(){
var idx=dfds.length;
if(this.length===1){
singles[idx]=this[0];
}
dfds.push(self.request({
data:{cmd:'size', targets:this},
preventDefault:true
}));
});
reqs.push.apply(reqs, dfds);
dfds.push.apply(dfds, cache);
$.when.apply($, dfds).fail(function(){
dfrd.reject();
}).done(function(){
var cache=function(h, data){
var file;
if(file=self.file(h)){
file.sizeInfo={ isCache: true };
$.each(['size', 'dirCnt', 'fileCnt'], function(){
file.sizeInfo[this]=data[this]||0;
});
file.size=parseInt(file.sizeInfo.size);
changed.push(file);
}},
size=0,
fileCnt=0,
dirCnt=0,
argLen=arguments.length,
cnts=[],
cntsTxt='',
changed=[],
i, file, data;
for (i=0; i < argLen; i++){
data=arguments[i];
file=null;
if(!data.isCache){
if(singles[i]&&(file=self.file(singles[i]))){
cache(singles[i], data);
}else if(data.sizes&&$.isPlainObject(data.sizes)){
$.each(data.sizes, function(h, sizeInfo){
cache(h, sizeInfo);
});
}}
size +=parseInt(data.size);
if(fileCnt!==false){
if(typeof data.fileCnt==='undefined'){
fileCnt=false;
}
fileCnt +=parseInt(data.fileCnt||0);
}
if(dirCnt!==false){
if(typeof data.dirCnt==='undefined'){
dirCnt=false;
}
dirCnt +=parseInt(data.dirCnt||0);
}}
changed.length&&self.change({changed: changed});
if(dirCnt!==false){
cnts.push(self.i18n('folders') + ': ' + (dirCnt - (tgtlen > 1? 0:1)));
}
if(fileCnt!==false){
cnts.push(self.i18n('files') + ': ' + fileCnt);
}
if(cnts.length){
cntsTxt='<br>' + cnts.join(', ');
}
dfrd.resolve({
size: size,
fileCnt: fileCnt,
dirCnt: dirCnt,
formated: (size >=0 ? self.formatSize(size):self.i18n('unknown')) + cntsTxt
});
});
self.autoSync();
});
return dfrd;
},
getTheme:function(themeid){
var self=this,
dfd=$.Deferred(),
absUrl=function(url, base){
if(!base){
base=self.convAbsUrl(self.baseUrl);
}
if(Array.isArray(url)){
return $.map(url, function(v){
return absUrl(v, base);
});
}else{
return url.match(/^(?:http|\/\/)/i)? url:base + url.replace(/^(?:\.\/|\/)/, '');
}},
themeObj, m;
if(themeid&&(themeObj=self.options.themes[themeid])){
if(typeof themeObj==='string'){
url=absUrl(themeObj);
if(m=url.match(/^(.+\/)[^/]+\.json$/i)){
$.getJSON(url).done(function(data){
themeObj=data;
themeObj.id=themeid;
if(themeObj.cssurls){
themeObj.cssurls=absUrl(themeObj.cssurls, m[1]);
}
dfd.resolve(themeObj);
}).fail(function(){
dfd.reject();
});
}else{
dfd.resolve({
id: themeid,
name: themeid,
cssurls: [url]
});
}}else if($.isPlainObject(themeObj)&&themeObj.cssurls){
themeObj.id=themeid;
themeObj.cssurls=absUrl(themeObj.cssurls);
if(!Array.isArray(themeObj.cssurls)){
themeObj.cssurls=[themeObj.cssurls];
}
if(!themeObj.name){
themeObj.name=themeid;
}
dfd.resolve(themeObj);
}else{
dfd.reject();
}}else{
dfd.reject();
}
return dfd;
},
changeTheme:function(themeid){
var self=this;
if(themeid){
if(self.options.themes[themeid]&&(!self.theme||self.theme.id!==themeid)){
self.getTheme(themeid).done(function(themeObj){
if(themeObj.cssurls){
$('head>link.elfinder-theme-ext').remove();
self.loadCss(themeObj.cssurls, {
className: 'elfinder-theme-ext',
dfd: $.Deferred().done(function(){
self.theme=themeObj;
self.trigger&&self.trigger('themechange');
})
});
}});
}else if(themeid==='default'&&self.theme){
$('head>link.elfinder-theme-ext').remove();
self.theme=null;
self.trigger&&self.trigger('themechange');
}}
return this;
},
applyLeafRootStats:function(dir, update){
var self=this,
prev=update? dir:(self.file(dir.hash)||dir),
prevTs=prev.ts,
change=false;
if(update||!dir._realStats){
dir._realStats={
locked: dir.locked||0,
dirs: dir.dirs||0,
ts: dir.ts
};}
dir.locked=1;
if(!prev.locked){
change=true;
}
dir.dirs=1;
if(!prev.dirs){
change=true;
}
$.each(self.leafRoots[dir.hash], function(){
var f=self.file(this);
if(f&&f.ts&&(dir.ts||0) < f.ts){
dir.ts=f.ts;
}});
if(prevTs!==dir.ts){
change=true;
}
return change;
},
abortXHR:function(xhr, o){
var opts=o||{};
if(xhr){
opts.quiet&&(xhr.quiet=true);
if(opts.abort&&xhr._requestId){
this.request({
data: {
cmd: 'abort',
id: xhr._requestId
},
preventDefault: true
});
}
xhr.abort();
xhr=void 0;
}},
getRequestId:function(){
return (+ new Date()).toString(16) + Math.floor(1000 * Math.random()).toString(16);
},
arrayFlip:function (trans, val){
var key,
tmpArr={},
isArr=$.isArray(trans);
for (key in trans){
if(isArr||trans.hasOwnProperty(key)){
tmpArr[trans[key]]=val||key;
}}
return tmpArr;
},
splitFileExtention:function(name){
var m;
if(m=name.match(/^(.+?)?\.((?:tar\.(?:gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(?:gz|bz2)|[a-z0-9]{1,10})$/i)){
if(typeof m[1]==='undefined'){
m[1]='';
}
return [m[1], m[2]];
}else{
return [name, ''];
}},
sliceArrayBuffer:function(arrayBuffer, sliceSize){
var segments=[],
fi=0;
while(fi * sliceSize < arrayBuffer.byteLength){
segments.push(arrayBuffer.slice(fi * sliceSize, (fi + 1) * sliceSize));
fi++;
}
return segments;
},
arrayBufferToBase64:function(ab){
if(!window.btoa){
return '';
}
var dView=new Uint8Array(ab),
arr=Array.prototype.slice.call(dView),
arr1=arr.map(function(item){
return String.fromCharCode(item);
});
return window.btoa(arr1.join(''));
},
log:function(m){ window.console&&window.console.log&&window.console.log(m); return this; },
debug:function(type, m){
var d=this.options.debug;
if(d&&(d==='all'||d[type])){
window.console&&window.console.log&&window.console.log('elfinder debug: ['+type+'] ['+this.id+']', m);
}
if(type==='backend-error'){
if(! this.cwd().hash||(d&&(d==='all'||d['backend-error']))){
m=Array.isArray(m)? m:[ m ];
this.error(m);
}}else if(type==='backend-debug'){
this.trigger('backenddebug', m);
}
return this;
},
time:function(l){ window.console&&window.console.time&&window.console.time(l); },
timeEnd:function(l){ window.console&&window.console.timeEnd&&window.console.timeEnd(l); }};
if(!Object.keys){
Object.keys=(function (){
var hasOwnProperty=Object.prototype.hasOwnProperty,
hasDontEnumBug = !({toString: null}).propertyIsEnumerable('toString'),
dontEnums=[
'toString',
'toLocaleString',
'valueOf',
'hasOwnProperty',
'isPrototypeOf',
'propertyIsEnumerable',
'constructor'
],
dontEnumsLength=dontEnums.length;
return function (obj){
if(typeof obj!=='object'&&typeof obj!=='function'||obj===null) throw new TypeError('Object.keys called on non-object');
var result=[];
for (var prop in obj){
if(hasOwnProperty.call(obj, prop)) result.push(prop);
}
if(hasDontEnumBug){
for (var i=0; i < dontEnumsLength; i++){
if(hasOwnProperty.call(obj, dontEnums[i])) result.push(dontEnums[i]);
}}
return result;
};})();
}
if(!Array.isArray){
Array.isArray=function(arr){
return jQuery.isArray(arr);
};}
if(!Object.assign){
Object.assign=function(){
return jQuery.extend.apply(null, arguments);
};}
if(!String.prototype.repeat){
String.prototype.repeat=function(count){
'use strict';
if(this==null){
throw new TypeError('can\'t convert ' + this + ' to object');
}
var str='' + this;
count=+count;
if(count!=count){
count=0;
}
if(count < 0){
throw new RangeError('repeat count must be non-negative');
}
if(count==Infinity){
throw new RangeError('repeat count must be less than infinity');
}
count=Math.floor(count);
if(str.length==0||count==0){
return '';
}
if(str.length * count >=1 << 28){
throw new RangeError('repeat count must not overflow maximum string size');
}
var rpt='';
for (var i=0; i < count; i++){
rpt +=str;
}
return rpt;
};}
if(!String.prototype.trim){
String.prototype.trim=function(){
return this.replace(/^\s+|\s+$/g, '');
};}
(function (){
try {
Array.apply(null, {});
return;
} catch (e){ }
var toString=Object.prototype.toString,
arrayType='[object Array]',
_apply=Function.prototype.apply,
slice=/*@cc_on @if(@_jscript_version <=5.8)
function (){
var a=[], i=this.length;
while (i-- > 0) a[i]=this[i];
return a;
}@else@*/Array.prototype.slice;
Function.prototype.apply=function apply(thisArg, argArray){
return _apply.call(this, thisArg,
toString.call(argArray)===arrayType ? argArray:slice.call(argArray));
};})();
if(!Array.from){
Array.from=function(obj){
return obj.length===1 ? [obj[0]]:Array.apply(null, obj);
};}
if(!window.cancelAnimationFrame){
(function(){
var lastTime=0;
var vendors=['ms', 'moz', 'webkit', 'o'];
for(var x=0; x < vendors.length&&!window.requestAnimationFrame; ++x){
window.requestAnimationFrame=window[vendors[x]+'RequestAnimationFrame'];
window.cancelAnimationFrame=window[vendors[x]+'CancelAnimationFrame']
|| window[vendors[x]+'CancelRequestAnimationFrame'];
}
if(!window.requestAnimationFrame)
window.requestAnimationFrame=function(callback, element){
var currTime=new Date().getTime();
var timeToCall=Math.max(0, 16 - (currTime - lastTime));
var id=window.setTimeout(function(){ callback(currTime + timeToCall); },
timeToCall);
lastTime=currTime + timeToCall;
return id;
};
if(!window.cancelAnimationFrame)
window.cancelAnimationFrame=function(id){
clearTimeout(id);
};}());
}
elFinder.prototype.version='2.1.48';
(function(){
if($.ui){
if($.ui.ddmanager){
var origin=$.ui.ddmanager.prepareOffsets;
$.ui.ddmanager.prepareOffsets=function(t, event){
var isOutView=function(elem){
if(elem.is(':hidden')){
return true;
}
var rect=elem[0].getBoundingClientRect();
return document.elementFromPoint(rect.left, rect.top)||document.elementFromPoint(rect.left + rect.width, rect.top + rect.height)? false:true;
};
if(event.type==='mousedown'||t.options.elfRefresh){
var i, d,
m=$.ui.ddmanager.droppables[ t.options.scope ]||[],
l=m.length;
for(i=0; i < l; i++){
d=m[ i ];
if(d.options.autoDisable&&(!d.options.disabled||d.options.autoDisable > 1)){
d.options.disabled=isOutView(d.element);
d.options.autoDisable=d.options.disabled? 2:1;
}}
}
return origin(t, event);
};}}
})();
$.ajaxTransport('+binary', function(options, originalOptions, jqXHR){
if(window.FormData&&((options.dataType&&(options.dataType=='binary'))||(options.data&&((window.ArrayBuffer&&options.data instanceof ArrayBuffer)||(window.Blob&&options.data instanceof Blob))))){
var xhr;
return {
send: function(headers, callback){
xhr=new XMLHttpRequest();
var url=options.url,
type=options.type,
async=options.async||true,
dataType=options.responseType||'blob',
data=options.data||null,
username=options.username,
password=options.password;
xhr.addEventListener('load', function(){
var data={};
data[options.dataType]=xhr.response;
callback(xhr.status, xhr.statusText, data, xhr.getAllResponseHeaders());
});
xhr.open(type, url, async, username, password);
for (var i in headers){
xhr.setRequestHeader(i, headers[i]);
}
if(options.xhrFields){
for (var key in options.xhrFields){
if(key in xhr){
xhr[key]=options.xhrFields[key];
}}
}
xhr.responseType=dataType;
xhr.send(data);
},
abort: function(){
xhr.abort();
}};}});
(function ($){
$.support.touch='ontouchend' in document;
if(!$.support.touch){
return;
}
var mouseProto=$.ui.mouse.prototype,
_mouseInit=mouseProto._mouseInit,
_mouseDestroy=mouseProto._mouseDestroy,
touchHandled,
posX, posY;
function simulateMouseEvent (event, simulatedType){
if(event.originalEvent.touches.length > 1){
return;
}
if(! $(event.currentTarget).hasClass('touch-punch-keep-default')){
event.preventDefault();
}
var touch=event.originalEvent.changedTouches[0],
simulatedEvent=document.createEvent('MouseEvents');
simulatedEvent.initMouseEvent(simulatedType,
true,
true,
window,
1,
touch.screenX,
touch.screenY,
touch.clientX,
touch.clientY,
false,
false,
false,
false,
0,
null
);
event.target.dispatchEvent(simulatedEvent);
}
mouseProto._touchStart=function (event){
var self=this;
if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){
return;
}
posX=event.originalEvent.changedTouches[0].screenX.toFixed(0);
posY=event.originalEvent.changedTouches[0].screenY.toFixed(0);
touchHandled=true;
self._touchMoved=false;
simulateMouseEvent(event, 'mouseover');
simulateMouseEvent(event, 'mousemove');
simulateMouseEvent(event, 'mousedown');
};
mouseProto._touchMove=function (event){
if(!touchHandled){
return;
}
var x=event.originalEvent.changedTouches[0].screenX.toFixed(0);
var y=event.originalEvent.changedTouches[0].screenY.toFixed(0);
if(Math.abs(posX - x) <=4&&Math.abs(posY - y) <=4){
return;
}
this._touchMoved=true;
simulateMouseEvent(event, 'mousemove');
};
mouseProto._touchEnd=function (event){
if(!touchHandled){
return;
}
simulateMouseEvent(event, 'mouseup');
simulateMouseEvent(event, 'mouseout');
if(!this._touchMoved){
simulateMouseEvent(event, 'click');
}
touchHandled=false;
this._touchMoved=false;
};
mouseProto._mouseInit=function (){
var self=this;
if(self.element.hasClass('touch-punch')){
self.element.on({
touchstart: $.proxy(self, '_touchStart'),
touchmove: $.proxy(self, '_touchMove'),
touchend: $.proxy(self, '_touchEnd')
});
}
_mouseInit.call(self);
};
mouseProto._mouseDestroy=function (){
var self=this;
if(self.element.hasClass('touch-punch')){
self.element.off({
touchstart: $.proxy(self, '_touchStart'),
touchmove: $.proxy(self, '_touchMove'),
touchend: $.proxy(self, '_touchEnd')
});
}
_mouseDestroy.call(self);
};})(jQuery);
$.fn.elfinder=function(o, o2){
if(o==='instance'){
return this.getElFinder();
}else if(o==='ondemand'){
}
return this.each(function(){
var cmd=typeof o==='string'  ? o:'',
bootCallback=typeof o2==='function'? o2:void(0),
elfinder=this.elfinder,
opts, reloadCallback;
if(!elfinder){
if($.isPlainObject(o)){
new elFinder(this, o, bootCallback);
}}else{
switch(cmd){
case 'close':
case 'hide':
elfinder.hide();
break;
case 'open':
case 'show':
elfinder.show();
break;
case 'destroy':
elfinder.destroy();
break;
case 'reload':
case 'restart':
if(elfinder){
opts=$.extend(true, elfinder.options, $.isPlainObject(o2)? o2:{});
bootCallback=elfinder.bootCallback;
if(elfinder.reloadCallback&&$.isFunction(elfinder.reloadCallback)){
elfinder.reloadCallback(opts, bootCallback);
}else{
elfinder.destroy();
new elFinder(this, opts, bootCallback);
}}
break;
}}
});
};
$.fn.getElFinder=function(){
var instance;
this.each(function(){
if(this.elfinder){
instance=this.elfinder;
return false;
}});
return instance;
};
$.fn.elfUiWidgetInstance=function(name){
try {
return this[name]('instance');
} catch(e){
var data=this.data('ui-' + name);
if(data&&typeof data==='object'&&data.widgetFullName==='ui-' + name){
return data;
}
return null;
}};
if(! $.fn.scrollRight){
$.fn.extend({
scrollRight: function (val){
var node=this.get(0);
if(val===undefined){
return Math.max(0, node.scrollWidth - (node.scrollLeft + node.clientWidth));
}
return this.scrollLeft(node.scrollWidth - node.clientWidth - val);
}});
}
if(! $.fn.scrollBottom){
$.fn.extend({
scrollBottom: function(val){
var node=this.get(0);
if(val===undefined){
return Math.max(0, node.scrollHeight - (node.scrollTop + node.clientHeight));
}
return this.scrollTop(node.scrollHeight - node.clientHeight - val);
}});
}
elFinder.prototype.mimeTypes={"application\/x-executable":"exe","application\/x-jar":"jar","application\/x-gzip":"gz","application\/x-bzip2":"tbz","application\/x-rar":"rar","text\/x-php":"php","text\/javascript":"js","application\/rtfd":"rtfd","text\/x-python":"py","text\/x-ruby":"rb","text\/x-shellscript":"sh","text\/x-perl":"pl","text\/xml":"xml","text\/x-csrc":"c","text\/x-chdr":"h","text\/x-c++src":"cpp","text\/x-c++hdr":"hh","text\/x-markdown":"md","text\/x-yaml":"yml","image\/x-ms-bmp":"bmp","image\/x-targa":"tga","image\/xbm":"xbm","image\/pxm":"pxm","audio\/wav":"wav","video\/x-dv":"dv","video\/x-ms-wmv":"wm","video\/ogg":"ogm","video\/MP2T":"m2ts","application\/x-mpegURL":"m3u8","application\/dash+xml":"mpd","application\/andrew-inset":"ez","application\/applixware":"aw","application\/atom+xml":"atom","application\/atomcat+xml":"atomcat","application\/atomsvc+xml":"atomsvc","application\/ccxml+xml":"ccxml","application\/cdmi-capability":"cdmia","application\/cdmi-container":"cdmic","application\/cdmi-domain":"cdmid","application\/cdmi-object":"cdmio","application\/cdmi-queue":"cdmiq","application\/cu-seeme":"cu","application\/davmount+xml":"davmount","application\/docbook+xml":"dbk","application\/dssc+der":"dssc","application\/dssc+xml":"xdssc","application\/ecmascript":"ecma","application\/emma+xml":"emma","application\/epub+zip":"epub","application\/exi":"exi","application\/font-tdpfr":"pfr","application\/gml+xml":"gml","application\/gpx+xml":"gpx","application\/gxf":"gxf","application\/hyperstudio":"stk","application\/inkml+xml":"ink","application\/ipfix":"ipfix","application\/java-serialized-object":"ser","application\/java-vm":"class","application\/json":"json","application\/jsonml+json":"jsonml","application\/lost+xml":"lostxml","application\/mac-binhex40":"hqx","application\/mac-compactpro":"cpt","application\/mads+xml":"mads","application\/marc":"mrc","application\/marcxml+xml":"mrcx","application\/mathematica":"ma","application\/mathml+xml":"mathml","application\/mbox":"mbox","application\/mediaservercontrol+xml":"mscml","application\/metalink+xml":"metalink","application\/metalink4+xml":"meta4","application\/mets+xml":"mets","application\/mods+xml":"mods","application\/mp21":"m21","application\/mp4":"mp4s","application\/msword":"doc","application\/mxf":"mxf","application\/octet-stream":"bin","application\/oda":"oda","application\/oebps-package+xml":"opf","application\/ogg":"ogx","application\/omdoc+xml":"omdoc","application\/onenote":"onetoc","application\/oxps":"oxps","application\/patch-ops-error+xml":"xer","application\/pdf":"pdf","application\/pgp-encrypted":"pgp","application\/pgp-signature":"asc","application\/pics-rules":"prf","application\/pkcs10":"p10","application\/pkcs7-mime":"p7m","application\/pkcs7-signature":"p7s","application\/pkcs8":"p8","application\/pkix-attr-cert":"ac","application\/pkix-cert":"cer","application\/pkix-crl":"crl","application\/pkix-pkipath":"pkipath","application\/pkixcmp":"pki","application\/pls+xml":"pls","application\/postscript":"ai","application\/prs.cww":"cww","application\/pskc+xml":"pskcxml","application\/rdf+xml":"rdf","application\/reginfo+xml":"rif","application\/relax-ng-compact-syntax":"rnc","application\/resource-lists+xml":"rl","application\/resource-lists-diff+xml":"rld","application\/rls-services+xml":"rs","application\/rpki-ghostbusters":"gbr","application\/rpki-manifest":"mft","application\/rpki-roa":"roa","application\/rsd+xml":"rsd","application\/rss+xml":"rss","application\/rtf":"rtf","application\/sbml+xml":"sbml","application\/scvp-cv-request":"scq","application\/scvp-cv-response":"scs","application\/scvp-vp-request":"spq","application\/scvp-vp-response":"spp","application\/sdp":"sdp","application\/set-payment-initiation":"setpay","application\/set-registration-initiation":"setreg","application\/shf+xml":"shf","application\/smil+xml":"smi","application\/sparql-query":"rq","application\/sparql-results+xml":"srx","application\/srgs":"gram","application\/srgs+xml":"grxml","application\/sru+xml":"sru","application\/ssdl+xml":"ssdl","application\/ssml+xml":"ssml","application\/tei+xml":"tei","application\/thraud+xml":"tfi","application\/timestamped-data":"tsd","application\/vnd.3gpp.pic-bw-large":"plb","application\/vnd.3gpp.pic-bw-small":"psb","application\/vnd.3gpp.pic-bw-var":"pvb","application\/vnd.3gpp2.tcap":"tcap","application\/vnd.3m.post-it-notes":"pwn","application\/vnd.accpac.simply.aso":"aso","application\/vnd.accpac.simply.imp":"imp","application\/vnd.acucobol":"acu","application\/vnd.acucorp":"atc","application\/vnd.adobe.air-application-installer-package+zip":"air","application\/vnd.adobe.formscentral.fcdt":"fcdt","application\/vnd.adobe.fxp":"fxp","application\/vnd.adobe.xdp+xml":"xdp","application\/vnd.adobe.xfdf":"xfdf","application\/vnd.ahead.space":"ahead","application\/vnd.airzip.filesecure.azf":"azf","application\/vnd.airzip.filesecure.azs":"azs","application\/vnd.amazon.ebook":"azw","application\/vnd.americandynamics.acc":"acc","application\/vnd.amiga.ami":"ami","application\/vnd.android.package-archive":"apk","application\/vnd.anser-web-certificate-issue-initiation":"cii","application\/vnd.anser-web-funds-transfer-initiation":"fti","application\/vnd.antix.game-component":"atx","application\/vnd.apple.installer+xml":"mpkg","application\/vnd.aristanetworks.swi":"swi","application\/vnd.astraea-software.iota":"iota","application\/vnd.audiograph":"aep","application\/vnd.blueice.multipass":"mpm","application\/vnd.bmi":"bmi","application\/vnd.businessobjects":"rep","application\/vnd.chemdraw+xml":"cdxml","application\/vnd.chipnuts.karaoke-mmd":"mmd","application\/vnd.cinderella":"cdy","application\/vnd.claymore":"cla","application\/vnd.cloanto.rp9":"rp9","application\/vnd.clonk.c4group":"c4g","application\/vnd.cluetrust.cartomobile-config":"c11amc","application\/vnd.cluetrust.cartomobile-config-pkg":"c11amz","application\/vnd.commonspace":"csp","application\/vnd.contact.cmsg":"cdbcmsg","application\/vnd.cosmocaller":"cmc","application\/vnd.crick.clicker":"clkx","application\/vnd.crick.clicker.keyboard":"clkk","application\/vnd.crick.clicker.palette":"clkp","application\/vnd.crick.clicker.template":"clkt","application\/vnd.crick.clicker.wordbank":"clkw","application\/vnd.criticaltools.wbs+xml":"wbs","application\/vnd.ctc-posml":"pml","application\/vnd.cups-ppd":"ppd","application\/vnd.curl.car":"car","application\/vnd.curl.pcurl":"pcurl","application\/vnd.dart":"dart","application\/vnd.data-vision.rdz":"rdz","application\/vnd.dece.data":"uvf","application\/vnd.dece.ttml+xml":"uvt","application\/vnd.dece.unspecified":"uvx","application\/vnd.dece.zip":"uvz","application\/vnd.denovo.fcselayout-link":"fe_launch","application\/vnd.dna":"dna","application\/vnd.dolby.mlp":"mlp","application\/vnd.dpgraph":"dpg","application\/vnd.dreamfactory":"dfac","application\/vnd.ds-keypoint":"kpxx","application\/vnd.dvb.ait":"ait","application\/vnd.dvb.service":"svc","application\/vnd.dynageo":"geo","application\/vnd.ecowin.chart":"mag","application\/vnd.enliven":"nml","application\/vnd.epson.esf":"esf","application\/vnd.epson.msf":"msf","application\/vnd.epson.quickanime":"qam","application\/vnd.epson.salt":"slt","application\/vnd.epson.ssf":"ssf","application\/vnd.eszigno3+xml":"es3","application\/vnd.ezpix-album":"ez2","application\/vnd.ezpix-package":"ez3","application\/vnd.fdf":"fdf","application\/vnd.fdsn.mseed":"mseed","application\/vnd.fdsn.seed":"seed","application\/vnd.flographit":"gph","application\/vnd.fluxtime.clip":"ftc","application\/vnd.framemaker":"fm","application\/vnd.frogans.fnc":"fnc","application\/vnd.frogans.ltf":"ltf","application\/vnd.fsc.weblaunch":"fsc","application\/vnd.fujitsu.oasys":"oas","application\/vnd.fujitsu.oasys2":"oa2","application\/vnd.fujitsu.oasys3":"oa3","application\/vnd.fujitsu.oasysgp":"fg5","application\/vnd.fujitsu.oasysprs":"bh2","application\/vnd.fujixerox.ddd":"ddd","application\/vnd.fujixerox.docuworks":"xdw","application\/vnd.fujixerox.docuworks.binder":"xbd","application\/vnd.fuzzysheet":"fzs","application\/vnd.genomatix.tuxedo":"txd","application\/vnd.geogebra.file":"ggb","application\/vnd.geogebra.tool":"ggt","application\/vnd.geometry-explorer":"gex","application\/vnd.geonext":"gxt","application\/vnd.geoplan":"g2w","application\/vnd.geospace":"g3w","application\/vnd.gmx":"gmx","application\/vnd.google-earth.kml+xml":"kml","application\/vnd.google-earth.kmz":"kmz","application\/vnd.grafeq":"gqf","application\/vnd.groove-account":"gac","application\/vnd.groove-help":"ghf","application\/vnd.groove-identity-message":"gim","application\/vnd.groove-injector":"grv","application\/vnd.groove-tool-message":"gtm","application\/vnd.groove-tool-template":"tpl","application\/vnd.groove-vcard":"vcg","application\/vnd.hal+xml":"hal","application\/vnd.handheld-entertainment+xml":"zmm","application\/vnd.hbci":"hbci","application\/vnd.hhe.lesson-player":"les","application\/vnd.hp-hpgl":"hpgl","application\/vnd.hp-hpid":"hpid","application\/vnd.hp-hps":"hps","application\/vnd.hp-jlyt":"jlt","application\/vnd.hp-pcl":"pcl","application\/vnd.hp-pclxl":"pclxl","application\/vnd.hydrostatix.sof-data":"sfd-hdstx","application\/vnd.ibm.minipay":"mpy","application\/vnd.ibm.modcap":"afp","application\/vnd.ibm.rights-management":"irm","application\/vnd.ibm.secure-container":"sc","application\/vnd.iccprofile":"icc","application\/vnd.igloader":"igl","application\/vnd.immervision-ivp":"ivp","application\/vnd.immervision-ivu":"ivu","application\/vnd.insors.igm":"igm","application\/vnd.intercon.formnet":"xpw","application\/vnd.intergeo":"i2g","application\/vnd.intu.qbo":"qbo","application\/vnd.intu.qfx":"qfx","application\/vnd.ipunplugged.rcprofile":"rcprofile","application\/vnd.irepository.package+xml":"irp","application\/vnd.is-xpr":"xpr","application\/vnd.isac.fcs":"fcs","application\/vnd.jam":"jam","application\/vnd.jcp.javame.midlet-rms":"rms","application\/vnd.jisp":"jisp","application\/vnd.joost.joda-archive":"joda","application\/vnd.kahootz":"ktz","application\/vnd.kde.karbon":"karbon","application\/vnd.kde.kchart":"chrt","application\/vnd.kde.kformula":"kfo","application\/vnd.kde.kivio":"flw","application\/vnd.kde.kontour":"kon","application\/vnd.kde.kpresenter":"kpr","application\/vnd.kde.kspread":"ksp","application\/vnd.kde.kword":"kwd","application\/vnd.kenameaapp":"htke","application\/vnd.kidspiration":"kia","application\/vnd.kinar":"kne","application\/vnd.koan":"skp","application\/vnd.kodak-descriptor":"sse","application\/vnd.las.las+xml":"lasxml","application\/vnd.llamagraphics.life-balance.desktop":"lbd","application\/vnd.llamagraphics.life-balance.exchange+xml":"lbe","application\/vnd.lotus-1-2-3":123,"application\/vnd.lotus-approach":"apr","application\/vnd.lotus-freelance":"pre","application\/vnd.lotus-notes":"nsf","application\/vnd.lotus-organizer":"org","application\/vnd.lotus-screencam":"scm","application\/vnd.lotus-wordpro":"lwp","application\/vnd.macports.portpkg":"portpkg","application\/vnd.mcd":"mcd","application\/vnd.medcalcdata":"mc1","application\/vnd.mediastation.cdkey":"cdkey","application\/vnd.mfer":"mwf","application\/vnd.mfmp":"mfm","application\/vnd.micrografx.flo":"flo","application\/vnd.micrografx.igx":"igx","application\/vnd.mif":"mif","application\/vnd.mobius.daf":"daf","application\/vnd.mobius.dis":"dis","application\/vnd.mobius.mbk":"mbk","application\/vnd.mobius.mqy":"mqy","application\/vnd.mobius.msl":"msl","application\/vnd.mobius.plc":"plc","application\/vnd.mobius.txf":"txf","application\/vnd.mophun.application":"mpn","application\/vnd.mophun.certificate":"mpc","application\/vnd.mozilla.xul+xml":"xul","application\/vnd.ms-artgalry":"cil","application\/vnd.ms-cab-compressed":"cab","application\/vnd.ms-excel":"xls","application\/vnd.ms-excel.addin.macroenabled.12":"xlam","application\/vnd.ms-excel.sheet.binary.macroenabled.12":"xlsb","application\/vnd.ms-excel.sheet.macroenabled.12":"xlsm","application\/vnd.ms-excel.template.macroenabled.12":"xltm","application\/vnd.ms-fontobject":"eot","application\/vnd.ms-htmlhelp":"chm","application\/vnd.ms-ims":"ims","application\/vnd.ms-lrm":"lrm","application\/vnd.ms-officetheme":"thmx","application\/vnd.ms-pki.seccat":"cat","application\/vnd.ms-pki.stl":"stl","application\/vnd.ms-powerpoint":"ppt","application\/vnd.ms-powerpoint.addin.macroenabled.12":"ppam","application\/vnd.ms-powerpoint.presentation.macroenabled.12":"pptm","application\/vnd.ms-powerpoint.slide.macroenabled.12":"sldm","application\/vnd.ms-powerpoint.slideshow.macroenabled.12":"ppsm","application\/vnd.ms-powerpoint.template.macroenabled.12":"potm","application\/vnd.ms-project":"mpp","application\/vnd.ms-word.document.macroenabled.12":"docm","application\/vnd.ms-word.template.macroenabled.12":"dotm","application\/vnd.ms-works":"wps","application\/vnd.ms-wpl":"wpl","application\/vnd.ms-xpsdocument":"xps","application\/vnd.mseq":"mseq","application\/vnd.musician":"mus","application\/vnd.muvee.style":"msty","application\/vnd.mynfc":"taglet","application\/vnd.neurolanguage.nlu":"nlu","application\/vnd.nitf":"ntf","application\/vnd.noblenet-directory":"nnd","application\/vnd.noblenet-sealer":"nns","application\/vnd.noblenet-web":"nnw","application\/vnd.nokia.n-gage.data":"ngdat","application\/vnd.nokia.n-gage.symbian.install":"n-gage","application\/vnd.nokia.radio-preset":"rpst","application\/vnd.nokia.radio-presets":"rpss","application\/vnd.novadigm.edm":"edm","application\/vnd.novadigm.edx":"edx","application\/vnd.novadigm.ext":"ext","application\/vnd.oasis.opendocument.chart":"odc","application\/vnd.oasis.opendocument.chart-template":"otc","application\/vnd.oasis.opendocument.database":"odb","application\/vnd.oasis.opendocument.formula":"odf","application\/vnd.oasis.opendocument.formula-template":"odft","application\/vnd.oasis.opendocument.graphics":"odg","application\/vnd.oasis.opendocument.graphics-template":"otg","application\/vnd.oasis.opendocument.image":"odi","application\/vnd.oasis.opendocument.image-template":"oti","application\/vnd.oasis.opendocument.presentation":"odp","application\/vnd.oasis.opendocument.presentation-template":"otp","application\/vnd.oasis.opendocument.spreadsheet":"ods","application\/vnd.oasis.opendocument.spreadsheet-template":"ots","application\/vnd.oasis.opendocument.text":"odt","application\/vnd.oasis.opendocument.text-master":"odm","application\/vnd.oasis.opendocument.text-template":"ott","application\/vnd.oasis.opendocument.text-web":"oth","application\/vnd.olpc-sugar":"xo","application\/vnd.oma.dd2+xml":"dd2","application\/vnd.openofficeorg.extension":"oxt","application\/vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","application\/vnd.openxmlformats-officedocument.presentationml.slide":"sldx","application\/vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx","application\/vnd.openxmlformats-officedocument.presentationml.template":"potx","application\/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","application\/vnd.openxmlformats-officedocument.spreadsheetml.template":"xltx","application\/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application\/vnd.openxmlformats-officedocument.wordprocessingml.template":"dotx","application\/vnd.osgeo.mapguide.package":"mgp","application\/vnd.osgi.dp":"dp","application\/vnd.osgi.subsystem":"esa","application\/vnd.palm":"pdb","application\/vnd.pawaafile":"paw","application\/vnd.pg.format":"str","application\/vnd.pg.osasli":"ei6","application\/vnd.picsel":"efif","application\/vnd.pmi.widget":"wg","application\/vnd.pocketlearn":"plf","application\/vnd.powerbuilder6":"pbd","application\/vnd.previewsystems.box":"box","application\/vnd.proteus.magazine":"mgz","application\/vnd.publishare-delta-tree":"qps","application\/vnd.pvi.ptid1":"ptid","application\/vnd.quark.quarkxpress":"qxd","application\/vnd.realvnc.bed":"bed","application\/vnd.recordare.musicxml":"mxl","application\/vnd.recordare.musicxml+xml":"musicxml","application\/vnd.rig.cryptonote":"cryptonote","application\/vnd.rim.cod":"cod","application\/vnd.rn-realmedia":"rm","application\/vnd.rn-realmedia-vbr":"rmvb","application\/vnd.route66.link66+xml":"link66","application\/vnd.sailingtracker.track":"st","application\/vnd.seemail":"see","application\/vnd.sema":"sema","application\/vnd.semd":"semd","application\/vnd.semf":"semf","application\/vnd.shana.informed.formdata":"ifm","application\/vnd.shana.informed.formtemplate":"itp","application\/vnd.shana.informed.interchange":"iif","application\/vnd.shana.informed.package":"ipk","application\/vnd.simtech-mindmapper":"twd","application\/vnd.smaf":"mmf","application\/vnd.smart.teacher":"teacher","application\/vnd.solent.sdkm+xml":"sdkm","application\/vnd.spotfire.dxp":"dxp","application\/vnd.spotfire.sfs":"sfs","application\/vnd.stardivision.calc":"sdc","application\/vnd.stardivision.draw":"sda","application\/vnd.stardivision.impress":"sdd","application\/vnd.stardivision.math":"smf","application\/vnd.stardivision.writer":"sdw","application\/vnd.stardivision.writer-global":"sgl","application\/vnd.stepmania.package":"smzip","application\/vnd.stepmania.stepchart":"sm","application\/vnd.sun.xml.calc":"sxc","application\/vnd.sun.xml.calc.template":"stc","application\/vnd.sun.xml.draw":"sxd","application\/vnd.sun.xml.draw.template":"std","application\/vnd.sun.xml.impress":"sxi","application\/vnd.sun.xml.impress.template":"sti","application\/vnd.sun.xml.math":"sxm","application\/vnd.sun.xml.writer":"sxw","application\/vnd.sun.xml.writer.global":"sxg","application\/vnd.sun.xml.writer.template":"stw","application\/vnd.sus-calendar":"sus","application\/vnd.svd":"svd","application\/vnd.symbian.install":"sis","application\/vnd.syncml+xml":"xsm","application\/vnd.syncml.dm+wbxml":"bdm","application\/vnd.syncml.dm+xml":"xdm","application\/vnd.tao.intent-module-archive":"tao","application\/vnd.tcpdump.pcap":"pcap","application\/vnd.tmobile-livetv":"tmo","application\/vnd.trid.tpt":"tpt","application\/vnd.triscape.mxs":"mxs","application\/vnd.trueapp":"tra","application\/vnd.ufdl":"ufd","application\/vnd.uiq.theme":"utz","application\/vnd.umajin":"umj","application\/vnd.unity":"unityweb","application\/vnd.uoml+xml":"uoml","application\/vnd.vcx":"vcx","application\/vnd.visio":"vsd","application\/vnd.visionary":"vis","application\/vnd.vsf":"vsf","application\/vnd.wap.wbxml":"wbxml","application\/vnd.wap.wmlc":"wmlc","application\/vnd.wap.wmlscriptc":"wmlsc","application\/vnd.webturbo":"wtb","application\/vnd.wolfram.player":"nbp","application\/vnd.wordperfect":"wpd","application\/vnd.wqd":"wqd","application\/vnd.wt.stf":"stf","application\/vnd.xara":"xar","application\/vnd.xfdl":"xfdl","application\/vnd.yamaha.hv-dic":"hvd","application\/vnd.yamaha.hv-script":"hvs","application\/vnd.yamaha.hv-voice":"hvp","application\/vnd.yamaha.openscoreformat":"osf","application\/vnd.yamaha.openscoreformat.osfpvg+xml":"osfpvg","application\/vnd.yamaha.smaf-audio":"saf","application\/vnd.yamaha.smaf-phrase":"spf","application\/vnd.yellowriver-custom-menu":"cmp","application\/vnd.zul":"zir","application\/vnd.zzazz.deck+xml":"zaz","application\/voicexml+xml":"vxml","application\/widget":"wgt","application\/winhlp":"hlp","application\/wsdl+xml":"wsdl","application\/wspolicy+xml":"wspolicy","application\/x-7z-compressed":"7z","application\/x-abiword":"abw","application\/x-ace-compressed":"ace","application\/x-apple-diskimage":"dmg","application\/x-authorware-bin":"aab","application\/x-authorware-map":"aam","application\/x-authorware-seg":"aas","application\/x-bcpio":"bcpio","application\/x-bittorrent":"torrent","application\/x-blorb":"blb","application\/x-bzip":"bz","application\/x-cbr":"cbr","application\/x-cdlink":"vcd","application\/x-cfs-compressed":"cfs","application\/x-chat":"chat","application\/x-chess-pgn":"pgn","application\/x-conference":"nsc","application\/x-cpio":"cpio","application\/x-csh":"csh","application\/x-debian-package":"deb","application\/x-dgc-compressed":"dgc","application\/x-director":"dir","application\/x-doom":"wad","application\/x-dtbncx+xml":"ncx","application\/x-dtbook+xml":"dtb","application\/x-dtbresource+xml":"res","application\/x-dvi":"dvi","application\/x-envoy":"evy","application\/x-eva":"eva","application\/x-font-bdf":"bdf","application\/x-font-ghostscript":"gsf","application\/x-font-linux-psf":"psf","application\/x-font-pcf":"pcf","application\/x-font-snf":"snf","application\/x-font-type1":"pfa","application\/x-freearc":"arc","application\/x-futuresplash":"spl","application\/x-gca-compressed":"gca","application\/x-glulx":"ulx","application\/x-gnumeric":"gnumeric","application\/x-gramps-xml":"gramps","application\/x-gtar":"gtar","application\/x-hdf":"hdf","application\/x-install-instructions":"install","application\/x-iso9660-image":"iso","application\/x-java-jnlp-file":"jnlp","application\/x-latex":"latex","application\/x-lzh-compressed":"lzh","application\/x-mie":"mie","application\/x-mobipocket-ebook":"prc","application\/x-ms-application":"application","application\/x-ms-shortcut":"lnk","application\/x-ms-wmd":"wmd","application\/x-ms-wmz":"wmz","application\/x-ms-xbap":"xbap","application\/x-msaccess":"mdb","application\/x-msbinder":"obd","application\/x-mscardfile":"crd","application\/x-msclip":"clp","application\/x-msdownload":"dll","application\/x-msmediaview":"mvb","application\/x-msmetafile":"wmf","application\/x-msmoney":"mny","application\/x-mspublisher":"pub","application\/x-msschedule":"scd","application\/x-msterminal":"trm","application\/x-mswrite":"wri","application\/x-netcdf":"nc","application\/x-nzb":"nzb","application\/x-pkcs12":"p12","application\/x-pkcs7-certificates":"p7b","application\/x-pkcs7-certreqresp":"p7r","application\/x-research-info-systems":"ris","application\/x-shar":"shar","application\/x-shockwave-flash":"swf","application\/x-silverlight-app":"xap","application\/x-sql":"sql","application\/x-stuffit":"sit","application\/x-stuffitx":"sitx","application\/x-subrip":"srt","application\/x-sv4cpio":"sv4cpio","application\/x-sv4crc":"sv4crc","application\/x-t3vm-image":"t3","application\/x-tads":"gam","application\/x-tar":"tar","application\/x-tcl":"tcl","application\/x-tex":"tex","application\/x-tex-tfm":"tfm","application\/x-texinfo":"texinfo","application\/x-tgif":"obj","application\/x-ustar":"ustar","application\/x-wais-source":"src","application\/x-x509-ca-cert":"der","application\/x-xfig":"fig","application\/x-xliff+xml":"xlf","application\/x-xpinstall":"xpi","application\/x-xz":"xz","application\/x-zmachine":"z1","application\/xaml+xml":"xaml","application\/xcap-diff+xml":"xdf","application\/xenc+xml":"xenc","application\/xhtml+xml":"xhtml","application\/xml":"xsl","application\/xml-dtd":"dtd","application\/xop+xml":"xop","application\/xproc+xml":"xpl","application\/xslt+xml":"xslt","application\/xspf+xml":"xspf","application\/xv+xml":"mxml","application\/yang":"yang","application\/yin+xml":"yin","application\/zip":"zip","audio\/adpcm":"adp","audio\/basic":"au","audio\/midi":"mid","audio\/mp4":"m4a","audio\/mpeg":"mpga","audio\/ogg":"oga","audio\/s3m":"s3m","audio\/silk":"sil","audio\/vnd.dece.audio":"uva","audio\/vnd.digital-winds":"eol","audio\/vnd.dra":"dra","audio\/vnd.dts":"dts","audio\/vnd.dts.hd":"dtshd","audio\/vnd.lucent.voice":"lvp","audio\/vnd.ms-playready.media.pya":"pya","audio\/vnd.nuera.ecelp4800":"ecelp4800","audio\/vnd.nuera.ecelp7470":"ecelp7470","audio\/vnd.nuera.ecelp9600":"ecelp9600","audio\/vnd.rip":"rip","audio\/webm":"weba","audio\/x-aac":"aac","audio\/x-aiff":"aif","audio\/x-caf":"caf","audio\/x-flac":"flac","audio\/x-matroska":"mka","audio\/x-mpegurl":"m3u","audio\/x-ms-wax":"wax","audio\/x-ms-wma":"wma","audio\/x-pn-realaudio":"ram","audio\/x-pn-realaudio-plugin":"rmp","audio\/xm":"xm","chemical\/x-cdx":"cdx","chemical\/x-cif":"cif","chemical\/x-cmdf":"cmdf","chemical\/x-cml":"cml","chemical\/x-csml":"csml","chemical\/x-xyz":"xyz","font\/collection":"ttc","font\/otf":"otf","font\/ttf":"ttf","font\/woff":"woff","font\/woff2":"woff2","image\/cgm":"cgm","image\/g3fax":"g3","image\/gif":"gif","image\/ief":"ief","image\/jpeg":"jpeg","image\/ktx":"ktx","image\/png":"png","image\/prs.btif":"btif","image\/sgi":"sgi","image\/svg+xml":"svg","image\/tiff":"tiff","image\/vnd.adobe.photoshop":"psd","image\/vnd.dece.graphic":"uvi","image\/vnd.djvu":"djvu","image\/vnd.dvb.subtitle":"sub","image\/vnd.dwg":"dwg","image\/vnd.dxf":"dxf","image\/vnd.fastbidsheet":"fbs","image\/vnd.fpx":"fpx","image\/vnd.fst":"fst","image\/vnd.fujixerox.edmics-mmr":"mmr","image\/vnd.fujixerox.edmics-rlc":"rlc","image\/vnd.ms-modi":"mdi","image\/vnd.ms-photo":"wdp","image\/vnd.net-fpx":"npx","image\/vnd.wap.wbmp":"wbmp","image\/vnd.xiff":"xif","image\/webp":"webp","image\/x-3ds":"3ds","image\/x-cmu-raster":"ras","image\/x-cmx":"cmx","image\/x-freehand":"fh","image\/x-icon":"ico","image\/x-mrsid-image":"sid","image\/x-pcx":"pcx","image\/x-pict":"pic","image\/x-portable-anymap":"pnm","image\/x-portable-bitmap":"pbm","image\/x-portable-graymap":"pgm","image\/x-portable-pixmap":"ppm","image\/x-rgb":"rgb","image\/x-xpixmap":"xpm","image\/x-xwindowdump":"xwd","message\/rfc822":"eml","model\/iges":"igs","model\/mesh":"msh","model\/vnd.collada+xml":"dae","model\/vnd.dwf":"dwf","model\/vnd.gdl":"gdl","model\/vnd.gtw":"gtw","model\/vnd.vtu":"vtu","model\/vrml":"wrl","model\/x3d+binary":"x3db","model\/x3d+vrml":"x3dv","model\/x3d+xml":"x3d","text\/cache-manifest":"appcache","text\/calendar":"ics","text\/css":"css","text\/csv":"csv","text\/html":"html","text\/n3":"n3","text\/plain":"txt","text\/prs.lines.tag":"dsc","text\/richtext":"rtx","text\/sgml":"sgml","text\/tab-separated-values":"tsv","text\/troff":"t","text\/turtle":"ttl","text\/uri-list":"uri","text\/vcard":"vcard","text\/vnd.curl":"curl","text\/vnd.curl.dcurl":"dcurl","text\/vnd.curl.mcurl":"mcurl","text\/vnd.curl.scurl":"scurl","text\/vnd.fly":"fly","text\/vnd.fmi.flexstor":"flx","text\/vnd.graphviz":"gv","text\/vnd.in3d.3dml":"3dml","text\/vnd.in3d.spot":"spot","text\/vnd.sun.j2me.app-descriptor":"jad","text\/vnd.wap.wml":"wml","text\/vnd.wap.wmlscript":"wmls","text\/x-asm":"s","text\/x-c":"cc","text\/x-fortran":"f","text\/x-java-source":"java","text\/x-nfo":"nfo","text\/x-opml":"opml","text\/x-pascal":"p","text\/x-setext":"etx","text\/x-sfv":"sfv","text\/x-uuencode":"uu","text\/x-vcalendar":"vcs","text\/x-vcard":"vcf","video\/3gpp":"3gp","video\/3gpp2":"3g2","video\/h261":"h261","video\/h263":"h263","video\/h264":"h264","video\/jpeg":"jpgv","video\/jpm":"jpm","video\/mj2":"mj2","video\/mp4":"mp4","video\/mpeg":"mpeg","video\/quicktime":"qt","video\/vnd.dece.hd":"uvh","video\/vnd.dece.mobile":"uvm","video\/vnd.dece.pd":"uvp","video\/vnd.dece.sd":"uvs","video\/vnd.dece.video":"uvv","video\/vnd.dvb.file":"dvb","video\/vnd.fvt":"fvt","video\/vnd.mpegurl":"mxu","video\/vnd.ms-playready.media.pyv":"pyv","video\/vnd.uvvu.mp4":"uvu","video\/vnd.vivo":"viv","video\/webm":"webm","video\/x-f4v":"f4v","video\/x-fli":"fli","video\/x-flv":"flv","video\/x-m4v":"m4v","video\/x-matroska":"mkv","video\/x-mng":"mng","video\/x-ms-asf":"asf","video\/x-ms-vob":"vob","video\/x-ms-wmx":"wmx","video\/x-ms-wvx":"wvx","video\/x-msvideo":"avi","video\/x-sgi-movie":"movie","video\/x-smv":"smv","x-conference\/x-cooltalk":"ice","text\/x-sql":"sql","image\/x-pixlr-data":"pxd","image\/x-adobe-dng":"dng","image\/x-sketch":"sketch","image\/x-xcf":"xcf","audio\/amr":"amr","application\/plt":"plt","application\/sat":"sat","application\/step":"step","text\/x-httpd-cgi":"cgi","text\/x-asap":"asp","text\/x-jsp":"jsp"};
elFinder.prototype._options={
cdns:{
ace:'https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.2',
codemirror:'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.43.0',
ckeditor:'https://cdnjs.cloudflare.com/ajax/libs/ckeditor/4.11.2',
ckeditor5:'https://cdn.ckeditor.com/ckeditor5/11.2.0',
tinymce:'https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.0.0',
simplemde:'https://cdnjs.cloudflare.com/ajax/libs/simplemde/1.11.2',
fabric16:'https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.6.7',
tui:'https://uicdn.toast.com',
hls:'https://cdnjs.cloudflare.com/ajax/libs/hls.js/0.10.1/hls.min.js',
dash:'https://cdnjs.cloudflare.com/ajax/libs/dashjs/2.9.3/dash.all.min.js',
flv:'https://cdnjs.cloudflare.com/ajax/libs/flv.js/1.5.0/flv.min.js',
prettify:'https://cdn.jsdelivr.net/gh/google/code-prettify@453bd5f51e61245339b738b1bbdd42d7848722ba/loader/run_prettify.js',
psd:'https://cdnjs.cloudflare.com/ajax/libs/psd.js/3.2.0/psd.min.js',
rar:'https://cdn.jsdelivr.net/gh/nao-pon/rar.js@6cef13ec66dd67992fc7f3ea22f132d770ebaf8b/rar.min.js',
zlibUnzip:'https://cdn.jsdelivr.net/gh/imaya/zlib.js@0.3.1/bin/unzip.min.js', // need check unzipFiles() in quicklook.plugins.js when update
zlibGunzip:'https://cdn.jsdelivr.net/gh/imaya/zlib.js@0.3.1/bin/gunzip.min.js',
marked:'https://cdnjs.cloudflare.com/ajax/libs/marked/0.6.1:/marked.min.js',
sparkmd5:'https://cdnjs.cloudflare.com/ajax/libs/spark-md5/3.0.0/spark-md5.min.js',
jssha:'https://cdnjs.cloudflare.com/ajax/libs/jsSHA/2.3.1/sha.js',
amr:'https://cdn.jsdelivr.net/gh/yxl/opencore-amr-js@dcf3d2b5f384a1d9ded2a54e4c137a81747b222b/js/amrnb.js'
},
url:'',
requestType:'get',
cors:null,
requestMaxConn:3,
/**
* Transport to send request to backend.
* Required for future extensions using websockets/webdav etc.
* Must be an object with "send" method.
* transport.send must return $.Deferred() object
*
* @type Object
* @default null
* @example
*  transport:{
*    init:function(elfinderInstance){ },
*    send:function(options){
*      var dfrd=$.Deferred();
*
*      return dfrd;
*    },
*    upload:function(data){
*      var dfrd=$.Deferred();
*
*      return dfrd;
*    }
*
*  }
**/
transport:{},
urlUpload:'',
dragUploadAllow:'auto',
overwriteUploadConfirm:true,
uploadMaxChunkSize:10485760,
folderUploadExclude:{
win: /^(?:desktop\.ini|thumbs\.db)$/i,
mac: /^\.ds_store$/i
},
iframeTimeout:0,
customData:{},
handlers:{},
customHeaders:{},
xhrFields:{},
lang:'en',
baseUrl:'',
i18nBaseUrl:'',
cssAutoLoad:true,
themes:{},
theme:null,
maxErrorDialogs:5,
cssClass:'',
commands:['*'],
commandsOptions:{
getfile:{
onlyURL:false,
multiple:false,
folders:false,
oncomplete:'',
onerror:'',
getPath:true,
getImgSize:false
},
open:{
method:'post',
into:'window',
selectAction:'open'
},
opennew:{
url:'',
useOriginQuery:true
},
upload:{
ui:'button'
},
download:{
maxRequests:10,
minFilesZipdl:2
},
quicklook:{
autoplay:true,
width:450,
height:300,
mediaControlsList:'',
pdfToolbar:true,
textMaxlen:2000,
contain:false,
docked:0,
dockHeight:'auto',
dockAutoplay:false,
googleMapsApiKey:'',
googleMapsOpts:{
maps:{},
kml:{
suppressInfoWindows:false,
preserveViewport:false
}},
viewerjs:{
url: '',
mimes: ['application/pdf', 'application/vnd.oasis.opendocument.text', 'application/vnd.oasis.opendocument.spreadsheet', 'application/vnd.oasis.opendocument.presentation']
},
sharecadMimes:[],
googleDocsMimes:[],
officeOnlineMimes:[],
getDimThreshold:200000,
mimeRegexNotEmptyCheck:/^application\/vnd\.google-apps\./
},
edit:{
dialogWidth:void(0),
mimes:[],
makeTextMimes:['text/plain', 'text/css', 'text/html'],
useStoredEditor:false,
editorMaximized:false,
editors:[
],
encodings:['Big5', 'Big5-HKSCS', 'Cp437', 'Cp737', 'Cp775', 'Cp850', 'Cp852', 'Cp855', 'Cp857', 'Cp858',
'Cp862', 'Cp866', 'Cp874', 'EUC-CN', 'EUC-JP', 'EUC-KR', 'GB18030', 'ISO-2022-CN', 'ISO-2022-JP', 'ISO-2022-KR',
'ISO-8859-1', 'ISO-8859-2', 'ISO-8859-3', 'ISO-8859-4', 'ISO-8859-5', 'ISO-8859-6', 'ISO-8859-7',
'ISO-8859-8', 'ISO-8859-9', 'ISO-8859-13', 'ISO-8859-15', 'KOI8-R', 'KOI8-U', 'Shift-JIS',
'Windows-1250', 'Windows-1251', 'Windows-1252', 'Windows-1253', 'Windows-1254', 'Windows-1257'],
extraOptions:{
uploadOpts:{},
tuiImgEditOpts:{
iconsPath:void(0),
theme:{}},
pixo: {
apikey: ''
},
creativeCloudApiKey:'',
managerUrl:null,
ckeditor: {},
ckeditor5: {
mode: 'inline'
},
tinymce:{},
onlineConvert:{
maxSize:100,
showLink:true
}}
},
fullscreen:{
mode: 'screen' // 'screen' or 'window'
},
search:{
incsearch:{
enable:true,
minlen:1,
wait:500 
},
searchTypes:{
SearchMime:{
name:'btnMime',
title:'searchMime'
}}
},
info:{
nullUrlDirLinkSelf:true,
hideItems:[],
showHashMaxsize:104857600,
showHashAlgorisms:['md5', 'sha256'],
custom:{
//  */
}},
mkdir: {
intoNewFolderToolbtn: false
},
resize: {
grid8px:'disable',
presetSize:[[320, 240], [400, 400], [640, 480], [800,600]],
getDimThreshold:204800,
dimSubImgSize:307200
},
rm: {
quickTrash:true,
infoCheckWait:10,
toTrashMaxItems:1000
},
help:{
view:['about', 'shortcuts', 'help', 'integrations', 'debug'],
helpSource:''
},
preference:{
width: 600,
height: 400,
categories: null,
prefs: null,
langs: null,
selectActions:['open', 'edit/download', 'resize/edit/download', 'download', 'quicklook']
}},
bootCallback:null,
getFileCallback:null,
defaultView:'icons',
/**
* Hash of default directory path to open
*
* NOTE: This setting will be disabled if the target folder is specified in location.hash.
*
* If you want to find the hash in Javascript
* can be obtained with the following code. (In the case of a standard hashing method)
*
* var volumeId='l1_';
* var path='path/to/target';
*
* var hash=volumeId + btoa(path).replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '.').replace(/\.+$/, '');
*
* @type String
* @default ""
*/
startPathHash:'',
sound:true,
ui:['toolbar', 'places', 'tree', 'path', 'stat'],
uiOptions:{
toolbar:[
['home', 'back', 'forward', 'up', 'reload'],
['netmount'],
['mkdir', 'mkfile', 'upload'],
['open', 'download', 'getfile'],
['undo', 'redo'],
['copy', 'cut', 'paste', 'rm', 'empty', 'hide'],
['duplicate', 'rename', 'edit', 'resize', 'chmod'],
['selectall', 'selectnone', 'selectinvert'],
['quicklook', 'info'],
['extract', 'archive'],
['search'],
['view', 'sort'],
['preference', 'help'],
['fullscreen']
],
toolbarExtra:{
displayTextLabel: false,
labelExcludeUA: ['Mobile'],
autoHideUA: ['Mobile'],
defaultHides: ['home', 'reload'],
showPreferenceButton: 'none',
preferenceInContextmenu: true
},
tree:{
attrTitle:true,
openRootOnLoad:true,
openCwdOnOpen:true,
syncTree:true,
subTreeMax:100,
subdirsMaxConn:2,
subdirsAtOnce:5,
durations:{
slideUpDown:'fast',
autoScroll:'fast'
}
//  */
},
navbar:{
minWidth:150,
maxWidth:500,
autoHideUA: []
},
navdock:{
disabled:false,
initMaxHeight:'50%',
maxHeight:'90%'
},
cwd:{
oldSchool:false,
showSelectCheckboxUA:['Touch'],
listView:{
columns:['perm', 'date', 'size', 'kind'],
columnsCustomName:{},
fixedHeader:true
},
iconsView:{
size: 0,
sizeMax: 3,
sizeNames: {
0: 'viewSmall',
1: 'viewMedium',
2: 'viewLarge',
3: 'viewExtraLarge'
}},
//  */
},
path:{
toWorkzoneWithoutNavbar:true
},
dialog:{
focusOnMouseOver:true
},
toast:{
animate:{
showMethod: 'fadeIn',
showDuration: 300,
showEasing: 'swing',
timeOut: 3000,
hideMethod: 'fadeOut',
hideDuration: 1500,
hideEasing: 'swing'
}}
},
dispInlineRegex:'^(?:(?:image|video|audio)|application/(?:x-mpegURL|dash\+xml)|(?:text/plain|application/pdf)$)',
onlyMimes:[],
/**
* Custom files sort rules.
* All default rules (name/size/kind/date/perm/mode/owner/group) set in elFinder._sortRules
*
* @type {Object}
* @example
* sortRules:{
*   name:function(file1, file2){ return file1.name.toLowerCase().localeCompare(file2.name.toLowerCase()); }
* }
*/
sortRules:{},
sortType:'name',
sortOrder:'asc',
sortStickFolders:true,
sortAlsoTreeview:false,
clientFormatDate:true,
UTCDate:false,
dateFormat:'',
fancyDateFormat:'',
fileModeStyle:'both',
width:'auto',
height:400,
heightBase:null,
resizable:true,
notifyDelay:500,
notifyDialog:{position: {}, width:null},
dialogContained:false,
allowShortcuts:true,
rememberLastDir:true,
reloadClearHistory:false,
useBrowserHistory:true,
showFiles:50,
showThreshold:50,
validName:false,
/**
* Additional rule to filtering for browsing.
* This setting does not have a sense of security.
*
* The object `this` is elFinder instance object in this function
*
* @type false|RegExp|function
* @default  false
* @example
*  show only png and jpg files:
*  fileFilter:/.*\.(png|jpg)$/i,
*
*  show only image type files:
*  fileFilter:function(file){ return file.mime&&file.mime.match(/^image\//i); },
*/
fileFilter:false,
backupSuffix:'~',
sync:0,
syncStart:true,
loadTmbs:5,
cookie:{
expires:30,
domain:'',
path:'/',
secure:false
},
contextmenu:{
navbar:['open', 'opennew', 'download', '|', 'upload', 'mkdir', '|', 'copy', 'cut', 'paste', 'duplicate', '|', 'rm', 'empty', 'hide', '|', 'rename', '|', 'archive', '|', 'places', 'info', 'chmod', 'netunmount'],
cwd:['undo', 'redo', '|', 'back', 'up', 'reload', '|', 'upload', 'mkdir', 'mkfile', 'paste', '|', 'empty', 'hide', '|', 'view', 'sort', 'selectall', 'colwidth', '|', 'places', 'info', 'chmod', 'netunmount', '|', 'fullscreen', '|', 'preference'],
files:['getfile', '|' ,'open', 'opennew', 'download', 'opendir', 'quicklook', '|', 'upload', 'mkdir', '|', 'copy', 'cut', 'paste', 'duplicate', '|', 'rm', 'empty', 'hide', '|', 'rename', 'edit', 'resize', '|', 'archive', 'extract', '|', 'selectall', 'selectinvert', '|', 'places', 'info', 'chmod', 'netunmount']
},
enableAlways:false,
enableByMouseOver:true,
windowCloseConfirm:['hasNotifyDialog', 'editingFile'],
rawStringDecoder:typeof Encoding==='object'&&$.isFunction(Encoding.convert)? function(str){
return Encoding.convert(str, {
to: 'UNICODE',
type: 'string'
});
}:null,
debug:['error', 'warning', 'event-destroy']
};
elFinder.prototype._options.commandsOptions.netmount={
ftp: {
name:'FTP',
inputs: {
host:$('<input type="text"/>'),
port:$('<input type="number" placeholder="21" class="elfinder-input-optional"/>'),
path:$('<input type="text" value="/"/>'),
user:$('<input type="text"/>'),
pass:$('<input type="password" autocomplete="new-password"/>'),
FTPS:$('<input type="checkbox" value="1" title="File Transfer Protocol over SSL/TLS"/>'),
encoding:$('<input type="text" placeholder="Optional" class="elfinder-input-optional"/>'),
locale:$('<input type="text" placeholder="Optional" class="elfinder-input-optional"/>')
}},
dropbox2: elFinder.prototype.makeNetmountOptionOauth('dropbox2', 'Dropbox', 'Dropbox', {noOffline:true,
root:'/',
pathI18n:'path',
integrate:{
title: 'Dropbox.com',
link: 'https://www.dropbox.com'
}}),
googledrive: elFinder.prototype.makeNetmountOptionOauth('googledrive', 'Google Drive', 'Google', {
integrate:{
title: 'Google Drive',
link: 'https://www.google.com/drive/'
}}),
onedrive: elFinder.prototype.makeNetmountOptionOauth('onedrive', 'One Drive', 'OneDrive', {
integrate:{
title: 'Microsoft OneDrive',
link: 'https://onedrive.live.com'
}}),
box: elFinder.prototype.makeNetmountOptionOauth('box', 'Box', 'Box', {
noOffline:true,
integrate:{
title: 'Box.com',
link: 'https://www.box.com'
}})
};
elFinder.prototype.history=function(fm){
var self=this,
update=true,
history=[],
current,
reset=function(){
history=[fm.cwd().hash];
current=0;
update=true;
},
nativeHistory=(fm.options.useBrowserHistory&&window.history&&window.history.pushState)? window.history:null,
go=function(fwd){
if((fwd&&self.canForward())||(!fwd&&self.canBack())){
update=false;
return fm.exec('open', history[fwd ? ++current:--current]).fail(reset);
}
return $.Deferred().reject();
},
setNativeHistory=function(thash){
if(nativeHistory&&(! nativeHistory.state||nativeHistory.state.thash!==thash)){
nativeHistory.pushState({thash: thash}, null, location.pathname + location.search + (thash? '#elf_' + thash:''));
}};
this.canBack=function(){
return current > 0;
};
this.canForward=function(){
return current < history.length - 1;
};
this.back=go;
this.forward=function(){
return go(true);
};
fm.bind('init', function(){
if(nativeHistory&&!nativeHistory.state){
setNativeHistory(fm.startDir());
}})
.open(function(){
var l=history.length,
cwd=fm.cwd().hash;
if(update){
current >=0&&l > current + 1&&history.splice(current+1);
history[history.length-1]!=cwd&&history.push(cwd);
current=history.length - 1;
}
update=true;
setNativeHistory(cwd);
})
.reload(fm.options.reloadClearHistory&&reset);
};
elFinder.prototype.command=function(fm){
this.fm=fm;
this.name='';
this.dialogClass='';
this.className='';
this.title='';
this.linkedCmds=[];
this.state=-1;
this.alwaysEnabled=false;
this.noChangeDirOnRemovedCwd=false;
this._disabled=false;
this.disableOnSearch=false;
this.updateOnSelect=true;
this.syncTitleOnChange=false;
this.keepContextmenu=false;
this._handlers={
enable:function(){ this.update(void(0), this.value); },
disable:function(){ this.update(-1, this.value); },
'open reload load sync':function(){
this._disabled = !(this.alwaysEnabled||this.fm.isCommandEnabled(this.name));
this.update(void(0), this.value);
this.change();
}};
this.handlers={};
this.shortcuts=[];
this.options={ui:'button'};
this.listeners=[];
this.setup=function(name, opts){
var self=this,
fm=this.fm,
setCallback=function(s){
var cb=s.callback||function(e){
fm.exec(self.name, void(0), {
_userAction: true,
_currentType: 'shortcut'
});
};
s.callback=function(e){
var enabled, checks={};
if(self.enabled()){
if(fm.searchStatus.state < 2){
enabled=fm.isCommandEnabled(self.name);
}else{
$.each(fm.selected(), function(i, h){
if(fm.optionsByHashes[h]){
checks[h]=true;
}else{
$.each(fm.volOptions, function(id){
if(!checks[id]&&h.indexOf(id)===0){
checks[id]=true;
return false;
}});
}});
$.each(checks, function(h){
enabled=fm.isCommandEnabled(self.name, h);
if(! enabled){
return false;
}});
}
if(enabled){
self.event=e;
cb.call(self);
delete self.event;
}}
};},
i, s, sc;
this.name=name;
this.title=fm.messages['cmd'+name] ? fm.i18n('cmd'+name)
: ((this.extendsCmd&&fm.messages['cmd'+this.extendsCmd]) ? fm.i18n('cmd'+this.extendsCmd):name);
this.options=Object.assign({}, this.options, opts);
this.listeners=[];
this.dialogClass='elfinder-dialog-' + name;
if(opts.shortcuts){
if(typeof opts.shortcuts==='function'){
sc=opts.shortcuts(this.fm, this.shortcuts);
}else if(Array.isArray(opts.shortcuts)){
sc=opts.shortcuts;
}
this.shortcuts=sc||[];
}
if(this.updateOnSelect){
this._handlers.select=function(){ this.update(void(0), this.value); };}
$.each(Object.assign({}, self._handlers, self.handlers), function(cmd, handler){
fm.bind(cmd, $.proxy(handler, self));
});
for (i=0; i < this.shortcuts.length; i++){
s=this.shortcuts[i];
setCallback(s);
!s.description&&(s.description=this.title);
fm.shortcut(s);
}
if(this.disableOnSearch){
fm.bind('search searchend', function(){
self._disabled=this.type==='search'? true:! (this.alwaysEnabled||fm.isCommandEnabled(name));
self.update(void(0), self.value);
});
}
this.init();
};
this.init=function(){};
this.exec=function(files, opts){
return $.Deferred().reject();
};
this.getUndo=function(opts, resData){
return false;
};
this.disabled=function(){
return this.state < 0;
};
this.enabled=function(){
return this.state > -1;
};
this.active=function(){
return this.state > 0;
};
this.getstate=function(){
return -1;
};
this.update=function(s, v){
var state=this.state,
value=this.value;
if(this._disabled&&this.fm.searchStatus===0){
this.state=-1;
}else{
this.state=s!==void(0) ? s:this.getstate();
}
this.value=v;
if(state!=this.state||value!=this.value){
this.change();
}};
this.change=function(c){
var cmd, i;
if(typeof(c)==='function'){
this.listeners.push(c);
}else{
for (i=0; i < this.listeners.length; i++){
cmd=this.listeners[i];
try {
cmd(this.state, this.value);
} catch (e){
this.fm.debug('error', e);
}}
}
return this;
};
this.hashes=function(hashes){
return hashes
? $.grep(Array.isArray(hashes) ? hashes:[hashes], function(hash){ return fm.file(hash) ? true:false; })
: fm.selected();
};
this.files=function(hashes){
var fm=this.fm;
return hashes
? $.map(Array.isArray(hashes) ? hashes:[hashes], function(hash){ return fm.file(hash)||null; })
: fm.selectedFiles();
};
this.fmDialog=function(content, options){
if(options.cssClass){
options.cssClass +=' ' + this.dialogClass;
}else{
options.cssClass=this.dialogClass;
}
return this.fm.dialog(content, options);
};};
elFinder.prototype.resources={
'class':{
hover:'ui-state-hover',
active:'ui-state-active',
disabled:'ui-state-disabled',
draggable:'ui-draggable',
droppable:'ui-droppable',
adroppable:'elfinder-droppable-active',
cwdfile:'elfinder-cwd-file',
cwd:'elfinder-cwd',
tree:'elfinder-tree',
treeroot:'elfinder-navbar-root',
navdir:'elfinder-navbar-dir',
navdirwrap:'elfinder-navbar-dir-wrapper',
navarrow:'elfinder-navbar-arrow',
navsubtree:'elfinder-navbar-subtree',
navcollapse:'elfinder-navbar-collapsed',
navexpand:'elfinder-navbar-expanded',
treedir:'elfinder-tree-dir',
placedir:'elfinder-place-dir',
searchbtn:'elfinder-button-search',
editing:'elfinder-to-editing',
preventback:'elfinder-prevent-back',
tabstab:'ui-state-default ui-tabs-tab ui-corner-top ui-tab',
tabsactive:'ui-tabs-active ui-state-active'
},
tpl:{
perms:'<span class="elfinder-perms"/>',
lock:'<span class="elfinder-lock"/>',
symlink:'<span class="elfinder-symlink"/>',
navicon:'<span class="elfinder-nav-icon"/>',
navspinner:'<span class="elfinder-spinner elfinder-navbar-spinner"/>',
navdir:'<div class="elfinder-navbar-wrapper{root}"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"{title}><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon" {style}/>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree" style="display:none"/></div>',
placedir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"{title}><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon" {style}/>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree" style="display:none"/></div>'
},
mimes:{
text:[
'application/dash+xml',
'application/docbook+xml',
'application/javascript',
'application/json',
'application/plt',
'application/sat',
'application/sql',
'application/step',
'application/vnd.hp-hpgl',
'application/x-awk',
'application/x-config',
'application/x-csh',
'application/x-empty',
'application/x-mpegurl',
'application/x-perl',
'application/x-php',
'application/x-web-config',
'application/xhtml+xml',
'application/xml',
'audio/x-mp3-playlist',
'image/cgm',
'image/svg+xml',
'image/vnd.dxf',
'model/iges'
]
},
mixin:{
make:function(){
var self=this,
fm=this.fm,
cmd=this.name,
req=this.requestCmd||cmd,
wz=fm.getUI('workzone'),
org=(this.origin&&this.origin==='navbar')? 'tree':'cwd',
tree=(org==='tree'),
find=tree? 'navHash2Elm':'cwdHash2Elm',
tarea=(! tree&&fm.storage('view')!='list'),
sel=fm.selected(),
move=this.move||false,
empty=wz.hasClass('elfinder-cwd-wrapper-empty'),
unselect=function(){
requestAnimationFrame(function(){
input&&input.trigger('blur');
});
},
rest=function(){
if(!overlay.is(':hidden')){
overlay.elfinderoverlay('hide').off('click close', cancel);
}
pnode.removeClass('ui-front')
.css('position', '')
.off('unselect.'+fm.namespace, unselect);
if(tarea){
nnode&&nnode.css('max-height', '');
}else if(!tree){
pnode.css('width', '')
.parent('td').css('overflow', '');
}}, colwidth,
dfrd=$.Deferred()
.fail(function(error){
dstCls&&dst.attr('class', dstCls);
empty&&wz.addClass('elfinder-cwd-wrapper-empty');
if(sel){
move&&fm.trigger('unlockfiles', {files: sel});
fm.clipboard([]);
fm.trigger('selectfiles', { files: sel });
}
error&&fm.error(error);
})
.always(function(){
rest();
cleanup();
fm.enable().unbind('open', openCallback).trigger('resMixinMake');
}),
id='tmp_'+parseInt(Math.random()*100000),
phash=this.data&&this.data.target? this.data.target:(tree? fm.file(sel[0]).hash:fm.cwd().hash),
date=new Date(),
file={
hash:id,
phash:phash,
name:fm.uniqueName(this.prefix, phash),
mime:this.mime,
read:true,
write:true,
date:'Today '+date.getHours()+':'+date.getMinutes(),
move:move
},
dum=fm.getUI(org).trigger('create.'+fm.namespace, file),
data=this.data||{},
node=fm[find](id),
nnode, pnode,
overlay=fm.getUI('overlay'),
cleanup=function(){
if(node&&node.length){
input.off();
node.hide();
fm.unselectfiles({files:[id]}).unbind('resize', resize);
requestAnimationFrame(function(){
if(tree){
node.closest('.elfinder-navbar-wrapper').remove();
}else{
node.remove();
}});
}},
cancel=function(e){
if(!overlay.is(':hidden')){
pnode.css('z-index', '');
}
if(! inError){
cleanup();
dfrd.reject();
if(e){
e.stopPropagation();
e.preventDefault();
}}
},
input=$(tarea? '<textarea/>':'<input type="text"/>')
.on('keyup text', function(){
if(tarea){
this.style.height='1px';
this.style.height=this.scrollHeight + 'px';
}else if(colwidth){
this.style.width=colwidth + 'px';
if(this.scrollWidth > colwidth){
this.style.width=this.scrollWidth + 10 + 'px';
}}
})
.on('keydown', function(e){
e.stopImmediatePropagation();
if(e.keyCode==$.ui.keyCode.ESCAPE){
dfrd.reject();
}else if(e.keyCode==$.ui.keyCode.ENTER){
e.preventDefault();
input.trigger('blur');
}})
.on('mousedown click dblclick', function(e){
e.stopPropagation();
if(e.type==='dblclick'){
e.preventDefault();
}})
.on('blur', function(){
var name=$.trim(input.val()),
parent=input.parent(),
valid=true,
cut;
if(!overlay.is(':hidden')){
pnode.css('z-index', '');
}
if(name===''){
return cancel();
}
if(!inError&&parent.length){
if(fm.options.validName&&fm.options.validName.test){
try {
valid=fm.options.validName.test(name);
} catch(e){
valid=false;
}}
if(!name||name==='.'||name==='..'||!valid){
inError=true;
fm.error(file.mime==='directory'? 'errInvDirname':'errInvName', {modal: true, close: function(){setTimeout(select, 120);}});
return false;
}
if(fm.fileByName(name, phash)){
inError=true;
fm.error(['errExists', name], {modal: true, close: function(){setTimeout(select, 120);}});
return false;
}
cut=(sel&&move)? fm.exec('cut', sel):null;
$.when(cut)
.done(function(){
var toast={},
nextAct={};
rest();
input.hide().before($('<span>').text(name));
fm.lockfiles({files:[id]});
fm.request({
data:Object.assign({cmd:req, name:name, target:phash}, data||{}),
notify:{type:req, cnt:1},
preventFail:true,
syncOnFail:true,
navigate:{toast:toast},
})
.fail(function(error){
fm.unlockfiles({files:[id]});
inError=true;
input.show().prev().remove();
fm.error(error, {
modal: true,
close: function(){
if(Array.isArray(error)&&$.inArray('errUploadMime', error)!==-1){
dfrd.notify('errUploadMime').reject();
}else{
setTimeout(select, 120);
}}
});
})
.done(function(data){
if(data&&data.added&&data.added[0]){
var item=data.added[0],
dirhash=item.hash,
newItem=fm[find](dirhash),
acts={
'directory':{ cmd: 'open', msg: 'cmdopendir' },
'text':{ cmd: 'edit', msg: 'cmdedit' },
'default':{ cmd: 'open', msg: 'cmdopen' }},
tmpMimes;
if(sel&&move){
fm.one(req+'done', function(){
fm.exec('paste', dirhash);
});
}
if(!move){
if(fm.mimeIsText(item.mime)&&!fm.mimesCanMakeEmpty[item.mime]&&fm.mimeTypes[item.mime]){
fm.trigger('canMakeEmptyFile', {mimes: [item.mime], unshift: true});
tmpMimes={};
tmpMimes[item.mime]=fm.mimeTypes[item.mime];
fm.storage('mkfileTextMimes', Object.assign(tmpMimes, fm.storage('mkfileTextMimes')||{}));
}
Object.assign(nextAct, nextAction||acts[item.mime]||acts[item.mime.split('/')[0]]||acts[(fm.mimesCanMakeEmpty[item.mime]||$.inArray(item.mime, fm.resources.mimes.text)!==-1) ? 'text':'none']||acts['default']);
Object.assign(toast, nextAct.cmd ? {
incwd:{msg: fm.i18n(['complete', fm.i18n('cmd'+cmd)]), action: nextAct},
inbuffer:{msg: fm.i18n(['complete', fm.i18n('cmd'+cmd)]), action: nextAct}}:{
inbuffer:{msg: fm.i18n(['complete', fm.i18n('cmd'+cmd)])}});
}}
dfrd.resolve(data);
});
})
.fail(function(){
dfrd.reject();
});
}})
.on('dragenter dragleave dragover drop', function(e){
e.stopPropagation();
}),
select=function(){
var name=fm.splitFileExtention(input.val())[0];
if(!inError&&fm.UA.Mobile&&!fm.UA.iOS){
overlay.on('click close', cancel).elfinderoverlay('show');
pnode.css('z-index', overlay.css('z-index') + 1);
}
inError=false;
! fm.enabled()&&fm.enable();
input.trigger('focus').trigger('select');
input[0].setSelectionRange&&input[0].setSelectionRange(0, name.length);
},
resize=function(){
node.trigger('scrolltoview', {blink:false});
},
openCallback=function(){
dfrd&&(dfrd.state()==='pending')&&dfrd.reject();
},
inError=false,
nextAction,
dst, dstCls, collapsed, expanded, arrow, subtree;
if(!fm.isCommandEnabled(req, phash)||!node.length){
return dfrd.reject();
}
if($.isPlainObject(self.nextAction)){
nextAction=Object.assign({}, self.nextAction);
}
if(tree){
dst=fm[find](phash);
collapsed=fm.res('class', 'navcollapse');
expanded=fm.res('class', 'navexpand');
arrow=fm.res('class', 'navarrow');
subtree=fm.res('class', 'navsubtree');
node.closest('.'+subtree).show();
if(! dst.hasClass(collapsed)){
dstCls=dst.attr('class');
dst.addClass(collapsed+' '+expanded+' elfinder-subtree-loaded');
}
if(dst.is('.'+collapsed+':not(.'+expanded+')')){
dst.children('.'+arrow).trigger('click').data('dfrd').done(function(){
if(input.val()===file.name){
input.val(fm.uniqueName(self.prefix, phash)).trigger('select').trigger('focus');
}});
}
nnode=node.contents().filter(function(){ return this.nodeType==3&&$(this).parent().attr('id')===fm.navHash2Id(file.hash); });
pnode=nnode.parent();
nnode.replaceWith(input.val(file.name));
}else{
empty&&wz.removeClass('elfinder-cwd-wrapper-empty');
nnode=node.find('.elfinder-cwd-filename');
pnode=nnode.parent();
if(tarea){
nnode.css('max-height', 'none');
}else{
colwidth=pnode.width();
pnode.width(colwidth - 15)
.parent('td').css('overflow', 'visible');
}
nnode.empty().append(input.val(file.name));
}
pnode.addClass('ui-front')
.css('position', 'relative')
.on('unselect.'+fm.namespace, unselect);
fm.bind('resize', resize).one('open', openCallback);
input.trigger('keyup');
select();
return dfrd;
}},
blink: function(elm, mode){
var acts={
slowonce:function(){elm.hide().delay(250).fadeIn(750).delay(500).fadeOut(3500);},
lookme:function(){elm.show().fadeOut(500).fadeIn(750);}}, func;
mode=mode||'slowonce';
func=acts[mode]||acts['lookme'];
elm.stop(true, true);
func();
}};
$.fn.dialogelfinder=function(opts, opts2){
var position='elfinderPosition',
destroy='elfinderDestroyOnClose',
node, pos;
if($.isPlainObject(opts)){
this.not('.elfinder').each(function(){
opts.handlers=opts.handlers||{};
var node=$(this),
doc=$(document),
toolbar=$('<div class="ui-widget-header dialogelfinder-drag ui-corner-top">'+(opts.title||'Files')+'</div>'),
button=$('<a href="#" class="dialogelfinder-drag-close ui-corner-all"><span class="ui-icon ui-icon-closethick"> </span></a>')
.appendTo(toolbar)
.on('click', function(e){
e.preventDefault();
node.dialogelfinder('close');
}),
init=opts.handlers.init,
elfinder;
opts.handlers.init=function(e, fm){
node.prepend(toolbar);
init&&init(e, fm);
};
elfinder=node.addClass('elfinder dialogelfinder touch-punch')
.css('position', 'absolute')
.hide()
.appendTo('body')
.draggable({
handle:'.dialogelfinder-drag',
containment:'window',
stop:function(){
node.trigger('resize');
elfinder.trigger('resize');
}})
.elfinder(opts, opts2)
.elfinder('instance');
elfinder.reloadCallback=function(o, o2){
elfinder.destroy();
o.handlers.init=init;
node.dialogelfinder(o, o2).dialogelfinder('open');
};
node.width(parseInt(node.width())||840)
.data(destroy, !!opts.destroyOnClose)
.find('.elfinder-toolbar').removeClass('ui-corner-top');
opts.position&&node.data(position, opts.position);
opts.autoOpen!==false&&$(this).dialogelfinder('open');
});
}else{
if(opts==='open'){
node=$(this);
pos=node.data(position)||{
top:parseInt($(document).scrollTop() + ($(window).height() < node.height() ? 2:($(window).height() - node.height())/2)),
left:parseInt($(document).scrollLeft() + ($(window).width() < node.width()  ? 2:($(window).width()  - node.width())/2))
};
if(node.is(':hidden')){
node.addClass('ui-front').css(pos).show().trigger('resize');
setTimeout(function(){
node.trigger('resize').trigger('mousedown');
}, 200);
}}else if(opts==='close'){
node=$(this).removeClass('ui-front');
if(node.is(':visible')){
!!node.data(destroy)
? node.elfinder('destroy').remove()
: node.elfinder('close');
}}else if(opts==='instance'){
return $(this).getElFinder();
}}
return this;
};
if(typeof elFinder==='function'&&elFinder.prototype.i18){
elFinder.prototype.i18.en={
translator:'Troex Nevelin &lt;troex@fury.scancode.ru&gt;, Naoki Sawada &lt;hypweb+elfinder@gmail.com&gt;',
language:'English',
direction:'ltr',
dateFormat:'M d, Y h:i A',
fancyDateFormat:'$1 h:i A',
nonameDateFormat:'ymd-His',
messages:{
'error':'Error',
'errUnknown':'Unknown error.',
'errUnknownCmd':'Unknown command.',
'errJqui':'Invalid jQuery UI configuration. Selectable, draggable and droppable components must be included.',
'errNode':'elFinder requires DOM Element to be created.',
'errURL':'Invalid elFinder configuration! URL option is not set.',
'errAccess':'Access denied.',
'errConnect':'Unable to connect to backend.',
'errAbort':'Connection aborted.',
'errTimeout':'Connection timeout.',
'errNotFound':'Backend not found.',
'errResponse':'Invalid backend response.',
'errConf':'Invalid backend configuration.',
'errJSON':'PHP JSON module not installed.',
'errNoVolumes':'Readable volumes not available.',
'errCmdParams':'Invalid parameters for command "$1".',
'errDataNotJSON':'Data is not JSON.',
'errDataEmpty':'Data is empty.',
'errCmdReq':'Backend request requires command name.',
'errOpen':'Unable to open "$1".',
'errNotFolder':'Object is not a folder.',
'errNotFile':'Object is not a file.',
'errRead':'Unable to read "$1".',
'errWrite':'Unable to write into "$1".',
'errPerm':'Permission denied.',
'errLocked':'"$1" is locked and can not be renamed, moved or removed.',
'errExists':'Item named "$1" already exists.',
'errInvName':'Invalid file name.',
'errInvDirname':'Invalid folder name.',
'errFolderNotFound':'Folder not found.',
'errFileNotFound':'File not found.',
'errTrgFolderNotFound':'Target folder "$1" not found.',
'errPopup':'Browser prevented opening popup window. To open file enable it in browser options.',
'errMkdir':'Unable to create folder "$1".',
'errMkfile':'Unable to create file "$1".',
'errRename':'Unable to rename "$1".',
'errCopyFrom':'Copying files from volume "$1" not allowed.',
'errCopyTo':'Copying files to volume "$1" not allowed.',
'errMkOutLink':'Unable to create a link to outside the volume root.',
'errUpload':'Upload error.',
'errUploadFile':'Unable to upload "$1".',
'errUploadNoFiles':'No files found for upload.',
'errUploadTotalSize':'Data exceeds the maximum allowed size.',
'errUploadFileSize':'File exceeds maximum allowed size.',
'errUploadMime':'File type not allowed.',
'errUploadTransfer':'"$1" transfer error.',
'errUploadTemp':'Unable to make temporary file for upload.',
'errNotReplace':'Object "$1" already exists at this location and can not be replaced by object with another type.',
'errReplace':'Unable to replace "$1".',
'errSave':'Unable to save "$1".',
'errCopy':'Unable to copy "$1".',
'errMove':'Unable to move "$1".',
'errCopyInItself':'Unable to copy "$1" into itself.',
'errRm':'Unable to remove "$1".',
'errTrash':'Unable into trash.',
'errRmSrc':'Unable remove source file(s).',
'errExtract':'Unable to extract files from "$1".',
'errArchive':'Unable to create archive.',
'errArcType':'Unsupported archive type.',
'errNoArchive':'File is not archive or has unsupported archive type.',
'errCmdNoSupport':'Backend does not support this command.',
'errReplByChild':'The folder "$1" can\'t be replaced by an item it contains.',
'errArcSymlinks':'For security reason denied to unpack archives contains symlinks or files with not allowed names.',
'errArcMaxSize':'Archive files exceeds maximum allowed size.',
'errResize':'Unable to resize "$1".',
'errResizeDegree':'Invalid rotate degree.',
'errResizeRotate':'Unable to rotate image.',
'errResizeSize':'Invalid image size.',
'errResizeNoChange':'Image size not changed.',
'errUsupportType':'Unsupported file type.',
'errNotUTF8Content':'File "$1" is not in UTF-8 and cannot be edited.',
'errNetMount':'Unable to mount "$1".',
'errNetMountNoDriver':'Unsupported protocol.',
'errNetMountFailed':'Mount failed.',
'errNetMountHostReq':'Host required.',
'errSessionExpires':'Your session has expired due to inactivity.',
'errCreatingTempDir':'Unable to create temporary directory: "$1"',
'errFtpDownloadFile':'Unable to download file from FTP: "$1"',
'errFtpUploadFile':'Unable to upload file to FTP: "$1"',
'errFtpMkdir':'Unable to create remote directory on FTP: "$1"',
'errArchiveExec':'Error while archiving files: "$1"',
'errExtractExec':'Error while extracting files: "$1"',
'errNetUnMount':'Unable to unmount.',
'errConvUTF8':'Not convertible to UTF-8',
'errFolderUpload':'Try the modern browser, If you\'d like to upload the folder.',
'errSearchTimeout':'Timed out while searching "$1". Search result is partial.',
'errReauthRequire':'Re-authorization is required.',
'errMaxTargets':'Max number of selectable items is $1.',
'errRestore':'Unable to restore from the trash. Can\'t identify the restore destination.',
'errEditorNotFound':'Editor not found to this file type.',
'errServerError':'Error occurred on the server side.',
'errEmpty':'Unable to empty folder "$1".',
'moreErrors':'There are $1 more errors.',
'cmdarchive':'Create archive',
'cmdback':'Back',
'cmdcopy':'Copy',
'cmdcut':'Cut',
'cmddownload':'Download',
'cmdduplicate':'Duplicate',
'cmdedit':'Edit file',
'cmdextract':'Extract files from archive',
'cmdforward':'Forward',
'cmdgetfile':'Select files',
'cmdhelp':'About this software',
'cmdhome':'Root',
'cmdinfo':'Get info',
'cmdmkdir':'New folder',
'cmdmkdirin':'Into New Folder',
'cmdmkfile':'New file',
'cmdopen':'Open',
'cmdpaste':'Paste',
'cmdquicklook':'Preview',
'cmdreload':'Reload',
'cmdrename':'Rename',
'cmdrm':'Delete',
'cmdtrash':'Into trash',
'cmdrestore':'Restore',
'cmdsearch':'Find files',
'cmdup':'Go to parent folder',
'cmdupload':'Upload files',
'cmdview':'View',
'cmdresize':'Resize & Rotate',
'cmdsort':'Sort',
'cmdnetmount':'Mount network volume',
'cmdnetunmount': 'Unmount',
'cmdplaces':'To Places',
'cmdchmod':'Change mode',
'cmdopendir':'Open a folder',
'cmdcolwidth':'Reset column width',
'cmdfullscreen': 'Full Screen',
'cmdmove':'Move',
'cmdempty':'Empty the folder',
'cmdundo':'Undo',
'cmdredo':'Redo',
'cmdpreference': 'Preferences',
'cmdselectall':'Select all',
'cmdselectnone': 'Select none',
'cmdselectinvert': 'Invert selection',
'cmdopennew':'Open in new window',
'cmdhide':'Hide (Preference)',
'btnClose':'Close',
'btnSave':'Save',
'btnRm':'Remove',
'btnApply':'Apply',
'btnCancel':'Cancel',
'btnNo':'No',
'btnYes':'Yes',
'btnMount':'Mount',
'btnApprove': 'Goto $1 & approve',
'btnUnmount': 'Unmount',
'btnConv':'Convert',
'btnCwd':'Here',
'btnVolume':'Volume',
'btnAll':'All',
'btnMime':'MIME Type',
'btnFileName':'Filename',
'btnSaveClose': 'Save & Close',
'btnBackup':'Backup',
'btnRename':'Rename',
'btnRenameAll':'Rename(All)',
'btnPrevious':'Prev ($1/$2)',
'btnNext':'Next ($1/$2)',
'btnSaveAs':'Save As',
'ntfopen':'Open folder',
'ntffile':'Open file',
'ntfreload':'Reload folder content',
'ntfmkdir':'Creating folder',
'ntfmkfile':'Creating files',
'ntfrm':'Delete items',
'ntfcopy':'Copy items',
'ntfmove':'Move items',
'ntfprepare':'Checking existing items',
'ntfrename':'Rename files',
'ntfupload':'Uploading files',
'ntfdownload':'Downloading files',
'ntfsave':'Save files',
'ntfarchive':'Creating archive',
'ntfextract':'Extracting files from archive',
'ntfsearch':'Searching files',
'ntfresize':'Resizing images',
'ntfsmth':'Doing something',
'ntfloadimg':'Loading image',
'ntfnetmount':'Mounting network volume',
'ntfnetunmount': 'Unmounting network volume',
'ntfdim':'Acquiring image dimension',
'ntfreaddir':'Reading folder infomation',
'ntfurl':'Getting URL of link',
'ntfchmod':'Changing file mode',
'ntfpreupload': 'Verifying upload file name',
'ntfzipdl':'Creating a file for download',
'ntfparents':'Getting path infomation',
'ntfchunkmerge': 'Processing the uploaded file',
'ntftrash':'Doing throw in the trash',
'ntfrestore':'Doing restore from the trash',
'ntfchkdir':'Checking destination folder',
'ntfundo':'Undoing previous operation',
'ntfredo':'Redoing previous undone',
'ntfchkcontent':'Checking contents',
'volume_Trash':'Trash',
'dateUnknown':'unknown',
'Today':'Today',
'Yesterday':'Yesterday',
'msJan':'Jan',
'msFeb':'Feb',
'msMar':'Mar',
'msApr':'Apr',
'msMay':'May',
'msJun':'Jun',
'msJul':'Jul',
'msAug':'Aug',
'msSep':'Sep',
'msOct':'Oct',
'msNov':'Nov',
'msDec':'Dec',
'January':'January',
'February':'February',
'March':'March',
'April':'April',
'May':'May',
'June':'June',
'July':'July',
'August':'August',
'September':'September',
'October':'October',
'November':'November',
'December':'December',
'Sunday':'Sunday',
'Monday':'Monday',
'Tuesday':'Tuesday',
'Wednesday':'Wednesday',
'Thursday':'Thursday',
'Friday':'Friday',
'Saturday':'Saturday',
'Sun':'Sun',
'Mon':'Mon',
'Tue':'Tue',
'Wed':'Wed',
'Thu':'Thu',
'Fri':'Fri',
'Sat':'Sat',
'sortname':'by name',
'sortkind':'by kind',
'sortsize':'by size',
'sortdate':'by date',
'sortFoldersFirst':'Folders first',
'sortperm':'by permission',
'sortmode':'by mode',
'sortowner':'by owner',
'sortgroup':'by group',
'sortAlsoTreeview':'Also Treeview',
'untitled file.txt':'NewFile.txt',
'untitled folder':'NewFolder',
'Archive':'NewArchive',
'untitled file':'NewFile.$1',
'extentionfile':'$1: File',
'extentiontype':'$1: $2',
'confirmReq':'Confirmation required',
'confirmRm':'Are you sure you want to permanently remove items?<br/>This cannot be undone!',
'confirmRepl':'Replace old file with new one? (If it contains folders, it will be merged. To backup and replace, select Backup.)',
'confirmRest':'Replace existing item with the item in trash?',
'confirmConvUTF8':'Not in UTF-8<br/>Convert to UTF-8?<br/>Contents become UTF-8 by saving after conversion.',
'confirmNonUTF8':'Character encoding of this file couldn\'t be detected. It need to temporarily convert to UTF-8 for editting.<br/>Please select character encoding of this file.',
'confirmNotSave':'It has been modified.<br/>Losing work if you do not save changes.',
'confirmTrash':'Are you sure you want to move items to trash bin?',
'apllyAll':'Apply to all',
'name':'Name',
'size':'Size',
'perms':'Permissions',
'modify':'Modified',
'kind':'Kind',
'read':'read',
'write':'write',
'noaccess':'no access',
'and':'and',
'unknown':'unknown',
'selectall':'Select all items',
'selectfiles':'Select item(s)',
'selectffile':'Select first item',
'selectlfile':'Select last item',
'viewlist':'List view',
'viewicons':'Icons view',
'viewSmall':'Small icons',
'viewMedium':'Medium icons',
'viewLarge':'Large icons',
'viewExtraLarge':'Extra large icons',
'places':'Places',
'calc':'Calculate',
'path':'Path',
'aliasfor':'Alias for',
'locked':'Locked',
'dim':'Dimensions',
'files':'Files',
'folders':'Folders',
'items':'Items',
'yes':'yes',
'no':'no',
'link':'Link',
'searcresult':'Search results',
'selected':'selected items',
'about':'About',
'shortcuts':'Shortcuts',
'help':'Help',
'webfm':'Web file manager',
'ver':'Version',
'protocolver':'protocol version',
'homepage':'Project home',
'docs':'Documentation',
'github':'Fork us on GitHub',
'twitter':'Follow us on Twitter',
'facebook':'Join us on Facebook',
'team':'Team',
'chiefdev':'chief developer',
'developer':'developer',
'contributor':'contributor',
'maintainer':'maintainer',
'translator':'translator',
'icons':'Icons',
'dontforget':'and don\'t forget to take your towel',
'shortcutsof':'Shortcuts disabled',
'dropFiles':'Drop files here',
'or':'or',
'selectForUpload':'Select files',
'moveFiles':'Move items',
'copyFiles':'Copy items',
'restoreFiles':'Restore items',
'rmFromPlaces':'Remove from places',
'aspectRatio':'Aspect ratio',
'scale':'Scale',
'width':'Width',
'height':'Height',
'resize':'Resize',
'crop':'Crop',
'rotate':'Rotate',
'rotate-cw':'Rotate 90 degrees CW',
'rotate-ccw':'Rotate 90 degrees CCW',
'degree':'°',
'netMountDialogTitle':'Mount network volume',
'protocol':'Protocol',
'host':'Host',
'port':'Port',
'user':'User',
'pass':'Password',
'confirmUnmount':'Are you sure to unmount $1?',
'dropFilesBrowser': 'Drop or Paste files from browser',
'dropPasteFiles':'Drop files, Paste URLs or images(clipboard) here',
'encoding':'Encoding',
'locale':'Locale',
'searchTarget':'Target: $1',
'searchMime':'Search by input MIME Type',
'owner':'Owner',
'group':'Group',
'other':'Other',
'execute':'Execute',
'perm':'Permission',
'mode':'Mode',
'emptyFolder':'Folder is empty',
'emptyFolderDrop':'Folder is empty\\A Drop to add items',
'emptyFolderLTap':'Folder is empty\\A Long tap to add items',
'quality':'Quality',
'autoSync':'Auto sync',
'moveUp':'Move up',
'getLink':'Get URL link',
'selectedItems':'Selected items ($1)',
'folderId':'Folder ID',
'offlineAccess':'Allow offline access',
'reAuth':'To re-authenticate',
'nowLoading':'Now loading...',
'openMulti':'Open multiple files',
'openMultiConfirm': 'You are trying to open the $1 files. Are you sure you want to open in browser?',
'emptySearch':'Search results is empty in search target.',
'editingFile':'It is editing a file.',
'hasSelected':'You have selected $1 items.',
'hasClipboard':'You have $1 items in the clipboard.',
'incSearchOnly':'Incremental search is only from the current view.',
'reinstate':'Reinstate',
'complete':'$1 complete',
'contextmenu':'Context menu',
'pageTurning':'Page turning',
'volumeRoots':'Volume roots',
'reset':'Reset',
'bgcolor':'Background color',
'colorPicker':'Color picker',
'8pxgrid':'8px Grid',
'enabled':'Enabled',
'disabled':'Disabled',
'emptyIncSearch':'Search results is empty in current view.\\A Press [Enter] to expand search target.',
'emptyLetSearch':'First letter search results is empty in current view.',
'textLabel':'Text label',
'minsLeft':'$1 mins left',
'openAsEncoding':'Reopen with selected encoding',
'saveAsEncoding':'Save with the selected encoding',
'selectFolder':'Select folder',
'firstLetterSearch': 'First letter search',
'presets':'Presets',
'tooManyToTrash':'It\'s too many items so it can\'t into trash.',
'TextArea':'TextArea',
'folderToEmpty':'Empty the folder "$1".',
'filderIsEmpty':'There are no items in a folder "$1".',
'preference':'Preference',
'language':'Language',
'clearBrowserData': 'Initialize the settings saved in this browser',
'toolbarPref':'Toolbar settings',
'charsLeft':'... $1 chars left.',
'sum':'Sum',
'roughFileSize':'Rough file size',
'autoFocusDialog':'Focus on the element of dialog with mouseover',
'select':'Select',
'selectAction':'Action when select file',
'useStoredEditor':'Open with the editor used last time',
'selectinvert':'Invert selection',
'renameMultiple':'Are you sure you want to rename $1 selected items like $2?<br/>This cannot be undone!',
'batchRename':'Batch rename',
'plusNumber':'+ Number',
'asPrefix':'Add prefix',
'asSuffix':'Add suffix',
'changeExtention':'Change extention',
'columnPref':'Columns settings (List view)',
'reflectOnImmediate':'All changes will reflect immediately to the archive.',
'reflectOnUnmount':'Any changes will not reflect until un-mount this volume.',
'unmountChildren':'The following volume(s) mounted on this volume also unmounted. Are you sure to unmount it?',
'selectionInfo':'Selection Info',
'hashChecker':'Algorithms to show the file hash',
'infoItems':'Info Items (Selection Info Panel)',
'pressAgainToExit': 'Press again to exit.',
'toolbar':'Toolbar',
'workspace':'Work Space',
'dialog':'Dialog',
'all':'All',
'iconSize':'Icon Size (Icons view)',
'editorMaximized':'Open the maximized editor window',
'editorConvNoApi':'Because conversion by API is not currently available, please convert on the website.',
'editorConvNeedUpload':'After conversion, you must be upload with the item URL or a downloaded file to save the converted file.',
'convertOn':'Convert on the site of $1',
'integrations':'Integrations',
'integrationWith':'This elFinder has the following external services integrated. Please check the terms of use, privacy policy, etc. before using it.',
'showHidden':'Show hidden items',
'hideHidden':'Hide hidden items',
'toggleHidden':'Show/Hide hidden items',
'makefileTypes':'File types to enable with "New file"',
'typeOfTextfile':'Type of the Text file',
'add':'Add',
'theme':'Theme',
'default':'Default',
'description':'Description',
'website':'Website',
'author':'Author',
'email':'Email',
'license':'License',
'exportToSave':'This item can\'t be saved. To avoid losing the edits you need to export to your PC.',
'dblclickToSelect': 'Double click on the file to select it.',
'useFullscreen':'Use fullscreen mode',
'kindUnknown':'Unknown',
'kindRoot':'Volume Root',
'kindFolder':'Folder',
'kindSelects':'Selections',
'kindAlias':'Alias',
'kindAliasBroken':'Broken alias',
'kindApp':'Application',
'kindPostscript':'Postscript document',
'kindMsOffice':'Microsoft Office document',
'kindMsWord':'Microsoft Word document',
'kindMsExcel':'Microsoft Excel document',
'kindMsPP':'Microsoft Powerpoint presentation',
'kindOO':'Open Office document',
'kindAppFlash':'Flash application',
'kindPDF':'Portable Document Format (PDF)',
'kindTorrent':'Bittorrent file',
'kind7z':'7z archive',
'kindTAR':'TAR archive',
'kindGZIP':'GZIP archive',
'kindBZIP':'BZIP archive',
'kindXZ':'XZ archive',
'kindZIP':'ZIP archive',
'kindRAR':'RAR archive',
'kindJAR':'Java JAR file',
'kindTTF':'True Type font',
'kindOTF':'Open Type font',
'kindRPM':'RPM package',
'kindText':'Text document',
'kindTextPlain':'Plain text',
'kindPHP':'PHP source',
'kindCSS':'Cascading style sheet',
'kindHTML':'HTML document',
'kindJS':'Javascript source',
'kindRTF':'Rich Text Format',
'kindC':'C source',
'kindCHeader':'C header source',
'kindCPP':'C++ source',
'kindCPPHeader':'C++ header source',
'kindShell':'Unix shell script',
'kindPython':'Python source',
'kindJava':'Java source',
'kindRuby':'Ruby source',
'kindPerl':'Perl script',
'kindSQL':'SQL source',
'kindXML':'XML document',
'kindAWK':'AWK source',
'kindCSV':'Comma separated values',
'kindDOCBOOK':'Docbook XML document',
'kindMarkdown':'Markdown text',
'kindImage':'Image',
'kindBMP':'BMP image',
'kindJPEG':'JPEG image',
'kindGIF':'GIF Image',
'kindPNG':'PNG Image',
'kindTIFF':'TIFF image',
'kindTGA':'TGA image',
'kindPSD':'Adobe Photoshop image',
'kindXBITMAP':'X bitmap image',
'kindPXM':'Pixelmator image',
'kindAudio':'Audio media',
'kindAudioMPEG':'MPEG audio',
'kindAudioMPEG4':'MPEG-4 audio',
'kindAudioMIDI':'MIDI audio',
'kindAudioOGG':'Ogg Vorbis audio',
'kindAudioWAV':'WAV audio',
'AudioPlaylist':'MP3 playlist',
'kindVideo':'Video media',
'kindVideoDV':'DV movie',
'kindVideoMPEG':'MPEG movie',
'kindVideoMPEG4':'MPEG-4 movie',
'kindVideoAVI':'AVI movie',
'kindVideoMOV':'Quick Time movie',
'kindVideoWM':'Windows Media movie',
'kindVideoFlash':'Flash movie',
'kindVideoMKV':'Matroska movie',
'kindVideoOGG':'Ogg movie'
}};}
$.fn.elfinderbutton=function(cmd){
return this.each(function(){
var c='class',
fm=cmd.fm,
disabled=fm.res(c, 'disabled'),
active=fm.res(c, 'active'),
hover=fm.res(c, 'hover'),
item='elfinder-button-menu-item',
selected='elfinder-button-menu-item-selected',
menu,
text=$('<span class="elfinder-button-text">'+cmd.title+'</span>'),
prvCname=cmd.className? cmd.className:cmd.name,
button=$(this).addClass('ui-state-default elfinder-button')
.attr('title', cmd.title)
.append('<span class="elfinder-button-icon elfinder-button-icon-' + prvCname + '"/>', text)
.on('mouseenter mouseleave', function(e){ !button.hasClass(disabled)&&button[e.type=='mouseleave' ? 'removeClass':'addClass'](hover);})
.on('click', function(e){
if(!button.hasClass(disabled)){
if(menu&&cmd.variants.length >=1){
menu.is(':hidden')&&fm.getUI().click();
e.stopPropagation();
menu.css(getMenuOffset()).slideToggle({
duration: 100,
done: function(e){
fm[menu.is(':visible')? 'toFront':'toHide'](menu);
}});
}else{
fm.exec(cmd.name, getSelected(), {_userAction: true, _currentType: 'toolbar', _currentNode: button });
}}
}),
hideMenu=function(){
fm.toHide(menu);
},
getMenuOffset=function(){
var fmNode=fm.getUI(),
baseOffset=fmNode.offset(),
buttonOffset=button.offset();
return {
top:buttonOffset.top - baseOffset.top,
left:buttonOffset.left - baseOffset.left,
maxHeight:fmNode.height() - 40
};},
getSelected=function(){
var sel=fm.selected(),
cwd;
if(!sel.length){
if(cwd=fm.cwd()){
sel=[ fm.cwd().hash ];
}else{
sel=void(0);
}}
return sel;
},
tm;
text.hide();
cmd.button=button;
if(Array.isArray(cmd.variants)){
button.addClass('elfinder-menubutton');
menu=$('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-' + prvCname + '-menu ui-corner-all"/>')
.hide()
.appendTo(fm.getUI())
.on('mouseenter mouseleave', '.'+item, function(){ $(this).toggleClass(hover); })
.on('click', '.'+item, function(e){
var opts=$(this).data('value');
e.preventDefault();
e.stopPropagation();
button.removeClass(hover);
fm.toHide(menu);
if(typeof opts==='undefined'){
opts={};}
if(typeof opts==='object'){
opts._userAction=true;
}
fm.exec(cmd.name, getSelected(), opts);
})
.on('close', hideMenu);
fm.bind('disable select', hideMenu).getUI().on('click', hideMenu);
cmd.change(function(){
menu.html('');
$.each(cmd.variants, function(i, variant){
menu.append($('<div class="'+item+'">'+variant[1]+'</div>').data('value', variant[0]).addClass(variant[0]==cmd.value ? selected:''));
});
});
}
cmd.change(function(){
var cName;
tm&&cancelAnimationFrame(tm);
tm=requestAnimationFrame(function(){
if(cmd.disabled()){
button.removeClass(active+' '+hover).addClass(disabled);
}else{
button.removeClass(disabled);
button[cmd.active() ? 'addClass':'removeClass'](active);
}
if(cmd.syncTitleOnChange){
cName=cmd.className? cmd.className:cmd.name;
if(prvCname!==cName){
button.children('.elfinder-button-icon').removeClass('elfinder-button-icon-' + prvCname).addClass('elfinder-button-icon-' + cName);
if(menu){
menu.removeClass('elfinder-button-' + prvCname + '-menu').addClass('elfinder-button-' + cName + '-menu');
}
prvCname=cName;
}
text.html(cmd.title);
button.attr('title', cmd.title);
}});
})
.change();
});
};
$.fn.elfindercontextmenu=function(fm){
return this.each(function(){
var self=$(this),
cmItem='elfinder-contextmenu-item',
smItem='elfinder-contextsubmenu-item',
exIcon='elfinder-contextmenu-extra-icon',
cHover=fm.res('class', 'hover'),
dragOpt={
distance: 8,
start: function(){
menu.data('drag', true).data('touching')&&menu.find('.'+cHover).removeClass(cHover);
},
stop: function(){
menu.data('draged', true).removeData('drag');
}},
menu=$(this).addClass('touch-punch ui-helper-reset ui-front ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-'+fm.direction)
.hide()
.on('touchstart', function(e){
menu.data('touching', true).children().removeClass(cHover);
})
.on('touchend', function(e){
menu.removeData('touching');
})
.on('mouseenter mouseleave', '.'+cmItem, function(e){
$(this).toggleClass(cHover, (e.type==='mouseenter'||(! menu.data('draged')&&menu.data('submenuKeep'))? true:false));
if(menu.data('draged')&&menu.data('submenuKeep')){
menu.find('.elfinder-contextmenu-sub:visible').parent().addClass(cHover);
}})
.on('mouseenter mouseleave', '.'+exIcon, function(e){
$(this).parent().toggleClass(cHover, e.type==='mouseleave');
})
.on('mouseenter mouseleave', '.'+cmItem+',.'+smItem, function(e){
var setIndex=function(target, sub){
$.each(sub? subnodes:nodes, function(i, n){
if(target[0]===n){
(sub? subnodes:nodes)._cur=i;
if(sub){
subselected=target;
}else{
selected=target;
}
return false;
}});
};
if(e.originalEvent){
var target=$(this),
unHover=function(){
if(selected&&!selected.children('div.elfinder-contextmenu-sub:visible').length){
selected.removeClass(cHover);
}};
if(e.type==='mouseenter'){
if(target.hasClass(smItem)){
if(subselected){
subselected.removeClass(cHover);
}
if(selected){
subnodes=selected.find('div.'+smItem);
}
setIndex(target, true);
}else{
unHover();
setIndex(target);
}}else{
if(target.hasClass(smItem)){
subselected=null;
subnodes=null;
}else{
unHover();
(function(sel){
setTimeout(function(){
if(sel===selected){
selected=null;
}}, 250);
})(selected);
}}
}})
.on('contextmenu', function(){return false;})
.on('mouseup', function(){
setTimeout(function(){
menu.removeData('draged');
}, 100);
})
.draggable(dragOpt),
ltr=fm.direction==='ltr',
subpos=ltr? 'left':'right',
types=Object.assign({}, fm.options.contextmenu),
tpl='<div class="'+cmItem+'{className}"><span class="elfinder-button-icon {icon} elfinder-contextmenu-icon"{style}/><span>{label}</span></div>',
item=function(label, icon, callback, opts){
var className='',
style='',
iconClass='',
v, pos;
if(opts){
if(opts.className){
className=' ' + opts.className;
}
if(opts.iconClass){
iconClass=opts.iconClass;
icon='';
}
if(opts.iconImg){
v=opts.iconImg.split(/ +/);
pos=v[1]&&v[2]? fm.escape(v[1] + 'px ' + v[2] + 'px'):'';
style=' style="background:url(\''+fm.escape(v[0])+'\') '+(pos? pos:'0 0')+' no-repeat;'+(pos? '':'posbackground-size:contain;')+'"';
}}
return $(tpl.replace('{icon}', icon ? 'elfinder-button-icon-'+icon:(iconClass? iconClass:''))
.replace('{label}', label)
.replace('{style}', style)
.replace('{className}', className))
.on('click', function(e){
e.stopPropagation();
e.preventDefault();
callback();
});
},
urlIcon=function(iconUrl){
var v=iconUrl.split(/ +/),
pos=v[1]&&v[2]? (v[1] + 'px ' + v[2] + 'px'):'';
return {
backgroundImage: 'url("'+v[0]+'")',
backgroundRepeat: 'no-repeat',
backgroundPosition: pos? pos:'',
backgroundSize: pos? '':'contain'
};},
base, cwd,
nodes, selected, subnodes, subselected, autoSyncStop, subHoverTm,
autoToggle=function(){
var evTouchStart='touchstart.contextmenuAutoToggle';
menu.data('hideTm')&&clearTimeout(menu.data('hideTm'));
if(menu.is(':visible')){
menu.on('touchstart', function(e){
if(e.originalEvent.touches.length > 1){
return;
}
menu.stop();
fm.toFront(menu);
menu.data('hideTm')&&clearTimeout(menu.data('hideTm'));
})
.data('hideTm', setTimeout(function(){
if(menu.is(':visible')){
cwd.find('.elfinder-cwd-file').off(evTouchStart);
cwd.find('.elfinder-cwd-file.ui-selected')
.one(evTouchStart, function(e){
if(e.originalEvent.touches.length > 1){
return;
}
var tgt=$(e.target);
if(menu.first().length&&!tgt.is('input:checkbox')&&!tgt.hasClass('elfinder-cwd-select')){
e.stopPropagation();
open(e.originalEvent.touches[0].pageX, e.originalEvent.touches[0].pageY);
cwd.data('longtap', true)
tgt.one('touchend', function(){
setTimeout(function(){
cwd.removeData('longtap');
}, 80);
});
return;
}
cwd.find('.elfinder-cwd-file').off(evTouchStart);
})
.one('unselect.'+fm.namespace, function(){
cwd.find('.elfinder-cwd-file').off(evTouchStart);
});
menu.fadeOut({
duration: 300,
fail: function(){
menu.css('opacity', '1').show();
},
done: function(){
fm.toHide(menu);
}});
}}, 4500));
}},
keyEvts=function(e){
var code=e.keyCode,
ESC=$.ui.keyCode.ESCAPE,
ENT=$.ui.keyCode.ENTER,
LEFT=$.ui.keyCode.LEFT,
RIGHT=$.ui.keyCode.RIGHT,
UP=$.ui.keyCode.UP,
DOWN=$.ui.keyCode.DOWN,
subent=fm.direction==='ltr'? RIGHT:LEFT,
sublev=subent===RIGHT? LEFT:RIGHT;
if($.inArray(code, [ESC, ENT, LEFT, RIGHT, UP, DOWN])!==-1){
e.preventDefault();
e.stopPropagation();
e.stopImmediatePropagation();
if(code==ESC||code===sublev){
if(selected&&subnodes&&subselected){
subselected.trigger('mouseleave').trigger('submenuclose');
selected.addClass(cHover);
subnodes=null;
subselected=null;
}else{
code==ESC&&close();
}}else if(code==UP||code==DOWN){
if(subnodes){
if(subselected){
subselected.trigger('mouseleave');
}
if(code==DOWN&&(! subselected||subnodes.length <=++subnodes._cur)){
subnodes._cur=0;
}else if(code==UP&&(! subselected||--subnodes._cur < 0)){
subnodes._cur=subnodes.length - 1;
}
subselected=subnodes.eq(subnodes._cur).trigger('mouseenter');
}else{
subnodes=null;
if(selected){
selected.trigger('mouseleave');
}
if(code==DOWN&&(! selected||nodes.length <=++nodes._cur)){
nodes._cur=0;
}else if(code==UP&&(! selected||--nodes._cur < 0)){
nodes._cur=nodes.length - 1;
}
selected=nodes.eq(nodes._cur).addClass(cHover);
}}else if(selected&&(code==ENT||code===subent)){
if(selected.hasClass('elfinder-contextmenu-group')){
if(subselected){
code==ENT&&subselected.click();
}else{
selected.trigger('mouseenter');
subnodes=selected.find('div.'+smItem);
subnodes._cur=0;
subselected=subnodes.first().addClass(cHover);
}}else{
code==ENT&&selected.click();
}}
}},
open=function(x, y, css){
var width=menu.outerWidth(),
height=menu.outerHeight(),
bstyle=base.attr('style'),
bpos=base.offset(),
bwidth=base.width(),
bheight=base.height(),
mw=fm.UA.Mobile? 40:2,
mh=fm.UA.Mobile? 20:2,
x=x - (bpos? bpos.left:0),
y=y - (bpos? bpos.top:0),
css=Object.assign(css||{}, {
top:Math.max(0, y + mh + height < bheight ? y + mh:y - (y + height - bheight)),
left:Math.max(0, (x < width + mw||x + mw + width < bwidth)? x + mw:x - mw - width),
opacity:'1'
}),
evts;
autoSyncStop=true;
fm.autoSync('stop');
base.width(bwidth);
menu.stop().removeAttr('style').css(css);
fm.toFront(menu);
menu.show();
base.attr('style', bstyle);
css[subpos]=parseInt(menu.width());
menu.find('.elfinder-contextmenu-sub').css(css);
if(fm.UA.iOS){
$('div.elfinder div.overflow-scrolling-touch').css('-webkit-overflow-scrolling', 'auto');
}
selected=null;
subnodes=null;
subselected=null;
$(document).on('keydown.' + fm.namespace, keyEvts);
evts=$._data(document).events;
if(evts&&evts.keydown){
evts.keydown.unshift(evts.keydown.pop());
}
fm.UA.Mobile&&autoToggle();
requestAnimationFrame(function(){
fm.getUI().one('click.' + fm.namespace, close);
});
},
close=function(){
fm.getUI().off('click.' + fm.namespace, close);
$(document).off('keydown.' + fm.namespace, keyEvts);
currentType=currentTargets=null;
if(menu.is(':visible')||menu.children().length){
fm.toHide(menu.removeAttr('style').empty().removeData('submenuKeep'));
try {
if(! menu.draggable('instance')){
menu.draggable(dragOpt);
}} catch(e){
if(! menu.hasClass('ui-draggable')){
menu.draggable(dragOpt);
}}
if(menu.data('prevNode')){
menu.data('prevNode').after(menu);
menu.removeData('prevNode');
}
fm.trigger('closecontextmenu');
if(fm.UA.iOS){
$('div.elfinder div.overflow-scrolling-touch').css('-webkit-overflow-scrolling', 'touch');
}}
autoSyncStop&&fm.searchStatus.state < 1&&! fm.searchStatus.ininc&&fm.autoSync();
autoSyncStop=false;
},
create=function(type, targets){
var sep=false,
insSep=false,
disabled=[],
isCwd=type==='cwd',
selcnt=0,
cmdMap;
currentType=type;
currentTargets=targets;
if(!(cmdMap=fm.option('uiCmdMap', isCwd? void(0):targets[0]))){
cmdMap={};}
if(!isCwd){
disabled=fm.getDisabledCmds(targets);
}
selcnt=fm.selected().length;
if(selcnt > 1){
menu.append('<div class="ui-corner-top ui-widget-header elfinder-contextmenu-header"><span>'
+ fm.i18n('selectedItems', ''+selcnt)
+ '</span></div>');
}
nodes=$();
$.each(types[type]||[], function(i, name){
var cmd, cmdName, useMap, node, submenu, hover;
if(name==='|'){
if(sep){
insSep=true;
}
return;
}
if(cmdMap[name]){
cmdName=cmdMap[name];
useMap=true;
}else{
cmdName=name;
}
cmd=fm.getCommand (cmdName);
if(cmd&&!isCwd&&(!fm.searchStatus.state||!cmd.disableOnSearch)){
cmd.__disabled=cmd._disabled;
cmd._disabled = !(cmd.alwaysEnabled||(fm._commands[cmdName] ? $.inArray(name, disabled)===-1&&(!useMap||!disabled[cmdName]):false));
$.each(cmd.linkedCmds, function(i, n){
var c;
if(c=fm.getCommand (n)){
c.__disabled=c._disabled;
c._disabled = !(c.alwaysEnabled||(fm._commands[n] ? !disabled[n]:false));
}});
}
if(cmd&&!cmd._disabled&&cmd.getstate(targets)!=-1){
if(cmd.variants){
if(!cmd.variants.length){
return;
}
node=item(cmd.title, cmd.className? cmd.className:cmd.name, function(){}, cmd.contextmenuOpts);
submenu=$('<div class="ui-front ui-corner-all elfinder-contextmenu-sub"/>')
.hide()
.css('max-height', fm.getUI().height() - 30)
.appendTo(node.append('<span class="elfinder-contextmenu-arrow"/>'));
hover=function(show){
if(! show){
submenu.hide();
}else{
var bstyle=base.attr('style');
base.width(base.width());
submenu.css({ top: '-1000px', left: 'auto', right: 'auto' });
var nodeOffset=node.offset(),
nodeleft=nodeOffset.left,
nodetop=nodeOffset.top,
nodewidth=node.outerWidth(),
width=submenu.outerWidth(true),
height=submenu.outerHeight(true),
baseOffset=base.offset(),
wwidth=baseOffset.left + base.width(),
wheight=baseOffset.top + base.height(),
cltr=ltr,
x=nodewidth,
y, over;
if(ltr){
over=(nodeleft + nodewidth + width) - wwidth;
if(over > 10){
if(nodeleft > width - 5){
x=x - 5;
cltr=false;
}else{
if(!fm.UA.Mobile){
x=nodewidth - over;
}}
}}else{
over=width - nodeleft;
if(over > 0){
if((nodeleft + nodewidth + width - 15) < wwidth){
x=x - 5;
cltr=true;
}else{
if(!fm.UA.Mobile){
x=nodewidth - over;
}}
}}
over=(nodetop + 5 + height) - wheight;
y=(over > 0&&nodetop < wheight)? 5 - over:(over > 0? 30 - height:5);
menu.find('.elfinder-contextmenu-sub:visible').hide();
submenu.css({
top:y,
left:cltr? x:'auto',
right: cltr? 'auto':x,
overflowY: 'auto'
}).show();
base.attr('style', bstyle);
}};
node.addClass('elfinder-contextmenu-group')
.on('mouseleave', '.elfinder-contextmenu-sub', function(e){
if(! menu.data('draged')){
menu.removeData('submenuKeep');
}})
.on('submenuclose', '.elfinder-contextmenu-sub', function(e){
hover(false);
})
.on('click', '.'+smItem, function(e){
var opts, $this;
e.stopPropagation();
if(! menu.data('draged')){
$this=$(this);
if(!cmd.keepContextmenu){
menu.hide();
}else{
$this.removeClass(cHover);
node.addClass(cHover);
}
opts=$this.data('exec');
if(typeof opts==='undefined'){
opts={};}
if(typeof opts==='object'){
opts._userAction=true;
opts._currentType=type;
opts._currentNode=$this;
}
!cmd.keepContextmenu&&close();
fm.exec(cmd.name, targets, opts);
}})
.on('touchend', function(e){
if(! menu.data('drag')){
hover(true);
menu.data('submenuKeep', true);
}})
.on('mouseenter mouseleave', function(e){
if(! menu.data('touching')){
if(node.data('timer')){
clearTimeout(node.data('timer'));
node.removeData('timer');
}
if(!$(e.target).closest('.elfinder-contextmenu-sub', menu).length){
if(e.type==='mouseleave'){
if(! menu.data('submenuKeep')){
node.data('timer', setTimeout(function(){
node.removeData('timer');
hover(false);
}, 250));
}}else{
node.data('timer', setTimeout(function(){
node.removeData('timer');
hover(true);
}, nodes.find('div.elfinder-contextmenu-sub:visible').length? 250:0));
}}
}});
$.each(cmd.variants, function(i, variant){
var item=variant==='|' ? '<div class="elfinder-contextmenu-separator"/>' :
$('<div class="'+cmItem+' '+smItem+'"><span>'+variant[1]+'</span></div>').data('exec', variant[0]),
iconClass, icon;
if(typeof variant[2]!=='undefined'){
icon=$('<span/>').addClass('elfinder-button-icon elfinder-contextmenu-icon');
if(! /\//.test(variant[2])){
icon.addClass('elfinder-button-icon-'+variant[2]);
}else{
icon.css(urlIcon(variant[2]));
}
item.prepend(icon).addClass(smItem+'-icon');
}
submenu.append(item);
});
}else{
node=item(cmd.title, cmd.className? cmd.className:cmd.name, function(){
if(! menu.data('draged')){
!cmd.keepContextmenu&&close();
fm.exec(cmd.name, targets, {_userAction: true, _currentType: type, _currentNode: node});
}}, cmd.contextmenuOpts);
if(cmd.extra&&cmd.extra.node){
$('<span class="elfinder-button-icon elfinder-button-icon-'+(cmd.extra.icon||'')+' '+exIcon+'"/>')
.append(cmd.extra.node).appendTo(node);
$(cmd.extra.node).trigger('ready', {targets: targets});
}else{
node.remove('.'+exIcon);
}}
if(cmd.extendsCmd){
node.children('span.elfinder-button-icon').addClass('elfinder-button-icon-' + cmd.extendsCmd);
}
if(insSep){
menu.append('<div class="elfinder-contextmenu-separator"/>');
}
menu.append(node);
sep=true;
insSep=false;
}
if(cmd&&typeof cmd.__disabled!=='undefined'){
cmd._disabled=cmd.__disabled;
delete cmd.__disabled;
$.each(cmd.linkedCmds, function(i, n){
var c;
if(c=fm.getCommand (n)){
c._disabled=c.__disabled;
delete c.__disabled;
}});
}});
nodes=menu.children('div.'+cmItem);
},
createFromRaw=function(raw){
currentType='raw';
$.each(raw, function(i, data){
var node;
if(data==='|'){
menu.append('<div class="elfinder-contextmenu-separator"/>');
}else if(data.label&&typeof data.callback=='function'){
node=item(data.label, data.icon, function(){
if(! menu.data('draged')){
!data.remain&&close();
data.callback();
}}, data.options||null);
menu.append(node);
}});
nodes=menu.children('div.'+cmItem);
},
currentType=null,
currentTargets=null;
fm.one('load', function(){
base=fm.getUI();
cwd=fm.getUI('cwd');
fm.bind('contextmenu', function(e){
var data=e.data,
css={},
prevNode;
if(data.type&&data.type!=='files'){
cwd.trigger('unselectall');
}
close();
if(data.type&&data.targets){
fm.trigger('contextmenucreate', data);
create(data.type, data.targets);
fm.trigger('contextmenucreatedone', data);
}else if(data.raw){
createFromRaw(data.raw);
}
if(menu.children().length){
prevNode=data.prevNode||null;
if(prevNode){
menu.data('prevNode', menu.prev());
prevNode.after(menu);
}
if(data.fitHeight){
css={maxHeight: Math.min(fm.getUI().height(), $(window).height()), overflowY: 'auto'};
menu.draggable('destroy').removeClass('ui-draggable');
}
open(data.x, data.y, css);
if(data.opened&&typeof data.opened==='function'){
data.opened.call(menu);
}}
})
.one('destroy', function(){ menu.remove(); })
.bind('disable', close)
.bind('select', function(e){
(currentType==='files'&&(!e.data||e.data.selected.toString()!==currentTargets.toString()))&&close();
});
})
.shortcut({
pattern:fm.OS==='mac' ? 'ctrl+m':'contextmenu shift+f10',
description:'contextmenu',
callback:function(e){
e.stopPropagation();
e.preventDefault();
$(document).one('contextmenu.' + fm.namespace, function(e){
e.preventDefault();
e.stopPropagation();
});
var sel=fm.selected(),
type, targets, pos, elm;
if(sel.length){
type='files';
targets=sel;
elm=fm.cwdHash2Elm(sel[0]);
}else{
type='cwd';
targets=[ fm.cwd().hash ];
pos=fm.getUI('workzone').offset();
}
if(! elm||! elm.length){
elm=fm.getUI('workzone');
}
pos=elm.offset();
pos.top +=(elm.height() / 2);
pos.left +=(elm.width() / 2);
fm.trigger('contextmenu', {
'type':type,
'targets':targets,
'x':pos.left,
'y':pos.top
});
}});
});
};
$.fn.elfindercwd=function(fm, options){
this.not('.elfinder-cwd').each(function(){
var mobile=fm.UA.Mobile,
list=fm.viewType=='list',
undef='undefined',
evtSelect='select.'+fm.namespace,
evtUnselect='unselect.'+fm.namespace,
evtDisable='disable.'+fm.namespace,
evtEnable='enable.'+fm.namespace,
c='class',
clFile=fm.res(c, 'cwdfile'),
fileSelector='.'+clFile,
clSelected='ui-selected',
clDisabled=fm.res(c, 'disabled'),
clDraggable=fm.res(c, 'draggable'),
clDroppable=fm.res(c, 'droppable'),
clHover=fm.res(c, 'hover'),
clActive=fm.res(c, 'active'),
clDropActive=fm.res(c, 'adroppable'),
clTmp=clFile+'-tmp',
clSelChk='elfinder-cwd-selectchk',
tmbNum=fm.options.loadTmbs > 0 ? fm.options.loadTmbs:5,
query='',
clipCuts={},
cwdParents=[],
cwdHashes=[],
incHashes=void 0,
customCols=[],
curClickId='',
customColsBuild=function(){
var cols='';
for (var i=0; i < customCols.length; i++){
cols +='<td class="elfinder-col-'+customCols[i]+'">{' + customCols[i] + '}</td>';
}
return cols;
},
makeTemplateRow=function(){
return '<tr id="{id}" class="'+clFile+' {permsclass} {dirclass}" title="{tooltip}"{css}><td class="elfinder-col-name"><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"{style}/>{marker}<span class="elfinder-cwd-filename">{name}</span></div>'+selectCheckbox+'</td>'+customColsBuild()+'</tr>';
},
selectCheckbox=($.map(options.showSelectCheckboxUA, function(t){return (fm.UA[t]||t.match(/^all$/i))? true:null;}).length)? '<div class="elfinder-cwd-select"><input type="checkbox" class="'+clSelChk+'"></div>':'',
colResizing=false,
colWidth=null,
thHeight,
templates={
icon:'<div id="{id}" class="'+clFile+' {permsclass} {dirclass} ui-corner-all" title="{tooltip}"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on"{style}/>{marker}</div><div class="elfinder-cwd-filename" title="{nametitle}">{name}</div>'+selectCheckbox+'</div>',
row:''
},
permsTpl=fm.res('tpl', 'perms'),
lockTpl=fm.res('tpl', 'lock'),
symlinkTpl=fm.res('tpl', 'symlink'),
replacement={
id:function(f){
return fm.cwdHash2Id(f.hash);
},
name:function(f){
var name=fm.escape(f.i18||f.name);
!list&&(name=name.replace(/([_.])/g, '&#8203;$1'));
return name;
},
nametitle:function(f){
return fm.escape(f.i18||f.name);
},
permsclass:function(f){
return fm.perms2class(f);
},
perm:function(f){
return fm.formatPermissions(f);
},
dirclass:function(f){
var cName=f.mime=='directory' ? 'directory':'';
f.isroot&&(cName +=' isroot');
f.csscls&&(cName +=' ' + fm.escape(f.csscls));
options.getClass&&(cName +=' ' + options.getClass(f));
return cName;
},
style:function(f){
return f.icon? fm.getIconStyle(f):'';
},
mime:function(f){
var cName=fm.mime2class(f.mime);
f.icon&&(cName +=' elfinder-cwd-bgurl');
return cName;
},
size:function(f){
return (f.mime==='directory'&&!f.size)? '-':fm.formatSize(f.size);
},
date:function(f){
return fm.formatDate(f);
},
kind:function(f){
return fm.mime2kind(f);
},
mode:function(f){
return f.perm? fm.formatFileMode(f.perm):'';
},
modestr:function(f){
return f.perm? fm.formatFileMode(f.perm, 'string'):'';
},
modeoct:function(f){
return f.perm? fm.formatFileMode(f.perm, 'octal'):'';
},
modeboth:function(f){
return f.perm? fm.formatFileMode(f.perm, 'both'):'';
},
marker:function(f){
return (f.alias||f.mime=='symlink-broken' ? symlinkTpl:'')+(!f.read||!f.write ? permsTpl:'')+(f.locked ? lockTpl:'');
},
tooltip:function(f){
var title=fm.formatDate(f) + (f.size > 0 ? ' ('+fm.formatSize(f.size)+')':''),
info='';
if(query&&f.path){
info=fm.escape(f.path.replace(/\/[^\/]*$/, ''));
}else{
info=f.tooltip? fm.escape(f.tooltip).replace(/\r/g, '&#13;'):'';
}
if(list){
info +=(info? '&#13;':'') + fm.escape(f.i18||f.name);
}
return info? info + '&#13;' + title:title;
}},
addedBadges={},
addBadgeStyleSheet,
addBadgeStyle=function(mime, name){
var sel, ext, type;
if(mime&&! addedBadges[mime]){
if(typeof addBadgeStyleSheet==='undefined'){
if($('#elfinderAddBadgeStyle'+fm.namespace).length){
$('#elfinderAddBadgeStyle'+fm.namespace).remove();
}
addBadgeStyleSheet=$('<style id="addBadgeStyle'+fm.namespace+'"/>').insertBefore($('head').children(':first')).get(0).sheet||null;
}
if(addBadgeStyleSheet){
mime=mime.toLowerCase();
type=mime.split('/');
ext=fm.escape(fm.mimeTypes[mime]||(name.replace(/.bac?k$/i, '').match(/\.([^.]+)$/)||['',''])[1]);
if(ext){
sel='.elfinder-cwd-icon-' + type[0].replace(/(\.|\+)/g, '-');
if(typeof type[1]!=='undefined'){
sel +='.elfinder-cwd-icon-' + type[1].replace(/(\.|\+)/g, '-');
}
try {
addBadgeStyleSheet.insertRule(sel + ':before{content:"' + ext.toLowerCase() + '"}', 0);
} catch(e){}}
addedBadges[mime]=true;
}}
},
itemhtml=function(f){
f.mime&&f.mime!=='directory'&&!addedBadges[f.mime]&&addBadgeStyle(f.mime, f.name);
return templates[list ? 'row':'icon']
.replace(/\{([a-z0-9_]+)\}/g, function(s, e){
return replacement[e] ? replacement[e](f, fm):(f[e] ? f[e]:'');
});
},
selectedNext=$(),
selectLock=false,
select=function(keyCode, append){
var code=$.ui.keyCode,
prev=keyCode==code.LEFT||keyCode==code.UP,
sel=cwd.find('[id].'+clSelected),
selector=prev ? 'first:':'last',
s, n, sib, top, left;
function sibling(n, direction){
return n[direction+'All']('[id]:not(.'+clDisabled+'):not(.elfinder-cwd-parent):first');
}
if(sel.length){
s=sel.filter(prev ? ':first':':last');
sib=sibling(s, prev ? 'prev':'next');
if(!sib.length){
n=s;
}else if(list||keyCode==code.LEFT||keyCode==code.RIGHT){
n=sib;
}else{
top=s.position().top;
left=s.position().left;
n=s;
if(prev){
do {
n=n.prev('[id]');
} while (n.length&&!(n.position().top < top&&n.position().left <=left));
if(n.hasClass(clDisabled)){
n=sibling(n, 'next');
}}else{
do {
n=n.next('[id]');
} while (n.length&&!(n.position().top > top&&n.position().left >=left));
if(n.hasClass(clDisabled)){
n=sibling(n, 'prev');
}
if(!n.length){
sib=cwd.find('[id]:not(.'+clDisabled+'):last');
if(sib.position().top > top){
n=sib;
}}
}}
}else{
if(selectedNext.length){
n=prev? selectedNext.prev():selectedNext;
}else{
n=cwd.find('[id]:not(.'+clDisabled+'):not(.elfinder-cwd-parent):'+(prev ? 'last':'first'));
}}
if(n&&n.length&&!n.hasClass('elfinder-cwd-parent')){
if(s&&append){
n=s.add(s[prev ? 'prevUntil':'nextUntil']('#'+n.attr('id'))).add(n);
}else{
sel.trigger(evtUnselect);
}
n.trigger(evtSelect);
scrollToView(n.filter(prev ? ':first':':last'));
trigger();
}},
selectedFiles={},
selectFile=function(hash){
fm.cwdHash2Elm(hash).trigger(evtSelect);
},
allSelected=false,
selectAll=function(){
var phash=fm.cwd().hash;
selectCheckbox&&selectAllCheckbox.find('input').prop('checked', true);
fm.lazy(function(){
var files;
if(fm.maxTargets&&(incHashes||cwdHashes).length > fm.maxTargets){
unselectAll({ notrigger: true });
files=$.map(incHashes||cwdHashes, function(hash){ return fm.file(hash)||null; });
files=files.slice(0, fm.maxTargets);
selectedFiles={};
$.each(files, function(i, v){
selectedFiles[v.hash]=true;
fm.cwdHash2Elm(v.hash).trigger(evtSelect);
});
fm.toast({mode: 'warning', msg: fm.i18n(['errMaxTargets', fm.maxTargets])});
}else{
cwd.find('[id]:not(.'+clSelected+'):not(.elfinder-cwd-parent)').trigger(evtSelect);
selectedFiles=fm.arrayFlip(incHashes||cwdHashes, true);
}
trigger();
selectCheckbox&&selectAllCheckbox.data('pending', false);
}, 0, {repaint: true});
},
unselectAll=function(opts){
var o=opts||{};
selectCheckbox&&selectAllCheckbox.find('input').prop('checked', false);
if(Object.keys(selectedFiles).length){
selectLock=false;
selectedFiles={};
cwd.find('[id].'+clSelected).trigger(evtUnselect);
selectCheckbox&&cwd.find('input:checkbox.'+clSelChk).prop('checked', false);
}
!o.notrigger&&trigger();
selectCheckbox&&selectAllCheckbox.data('pending', false);
cwd.removeClass('elfinder-cwd-allselected');
},
selectInvert=function(){
var invHashes={};
if(allSelected){
unselectAll();
}else if(! Object.keys(selectedFiles).length){
selectAll();
}else{
$.each((incHashes||cwdHashes), function(i, h){
var itemNode=fm.cwdHash2Elm(h);
if(! selectedFiles[h]){
invHashes[h]=true;
itemNode.length&&itemNode.trigger(evtSelect);
}else{
itemNode.length&&itemNode.trigger(evtUnselect);
}});
selectedFiles=invHashes;
trigger();
}},
selected=function(){
return Object.keys(selectedFiles);
},
lastSelect=void 0,
trigger=function(){
var selected=Object.keys(selectedFiles),
opts={
selected:selected,
origin:'cwd'
};
if(oldSchoolItem&&(selected.length > 1||selected[0]!==fm.cwdId2Hash(
oldSchoolItem.attr('id')))&&oldSchoolItem.hasClass(clSelected)){
oldSchoolItem.trigger(evtUnselect);
}
allSelected=selected.length&&(selected.length===(incHashes||cwdHashes).length)&&(!fm.maxTargets||selected.length <=fm.maxTargets);
if(selectCheckbox){
selectAllCheckbox.find('input').prop('checked', allSelected);
cwd[allSelected? 'addClass':'removeClass']('elfinder-cwd-allselected');
}
if(allSelected){
opts.selectall=true;
}else if(! selected.length){
opts.unselectall=true;
}
fm.trigger('select', opts);
},
scrollToView=function(o, blink){
if(! o.length){
return;
}
var ftop=o.position().top,
fheight=o.outerHeight(true),
wtop=wrapper.scrollTop(),
wheight=wrapper.get(0).clientHeight,
thheight=tableHeader? tableHeader.outerHeight(true):0;
if(ftop + thheight + fheight > wtop + wheight){
wrapper.scrollTop(parseInt(ftop + thheight + fheight - wheight));
}else if(ftop < wtop){
wrapper.scrollTop(ftop);
}
list&&wrapper.scrollLeft(0);
!!blink&&fm.resources.blink(o, 'lookme');
},
buffer=[],
bufferExt={},
index=function(hash){
var l=buffer.length;
while (l--){
if(buffer[l].hash==hash){
return l;
}}
return -1;
},
scrollStartEvent='elfscrstart',
scrollEvent='elfscrstop',
scrolling=false,
selectableOption={
disabled:true,
filter:'[id]:first',
stop:trigger,
delay:250,
appendTo:'body',
autoRefresh: false,
selected:function(e, ui){ $(ui.selected).trigger(evtSelect); },
unselected:function(e, ui){ $(ui.unselected).trigger(evtUnselect); }},
inViewHashes={},
wrapperRepaint=function(init, recnt){
if(!bufferExt.renderd){
return;
}
var firstNode=(list? cwd.find('tbody:first'):cwd).children('[id]'+(options.oldSchool? ':not(.elfinder-cwd-parent)':'')+':first');
if(!firstNode.length){
return;
}
var selectable=cwd.data('selectable'),
rec=(function(){
var wos=wrapper.offset(),
ww=wrapper.width(),
w=$(window),
x=firstNode.width() / 2,
l=Math.min(wos.left - w.scrollLeft() + (fm.direction==='ltr'? x:ww - x), wos.left + ww - 10),
t=wos.top - w.scrollTop() + 10 + (list? thHeight:0);
return {left: Math.max(0, Math.round(l)), top: Math.max(0, Math.round(t))};})(),
tgt=init? firstNode:$(document.elementFromPoint(rec.left , rec.top)),
ids={},
tmbs={},
multi=5,
cnt=Math.ceil((bufferExt.hpi? Math.ceil((wz.data('rectangle').height / bufferExt.hpi) * 1.5):showFiles) / multi),
chk=function(){
var id, hash, file, i;
for (i=0; i < multi; i++){
id=tgt.attr('id');
if(id){
bufferExt.getTmbs=[];
hash=fm.cwdId2Hash(id);
inViewHashes[hash]=id;
if(bufferExt.attachTmbs[hash]){
tmbs[hash]=bufferExt.attachTmbs[hash];
}
selectable&&(ids[id]=true);
}
tgt=tgt.next();
if(!tgt.length){
break;
}}
},
done=function(){
var idsArr;
if(cwd.data('selectable')){
Object.assign(ids, selectedFiles);
idsArr=Object.keys(ids);
if(idsArr.length){
selectableOption.filter='#'+idsArr.join(', #');
cwd.selectable('enable').selectable('option', {filter:selectableOption.filter}).selectable('refresh');
}}
if(Object.keys(tmbs).length){
bufferExt.getTmbs=[];
attachThumbnails(tmbs);
}},
setTarget=function(){
if(!tgt.hasClass(clFile)){
tgt=tgt.closest(fileSelector);
}},
arr, widget;
inViewHashes={};
selectable&&cwd.selectable('option', 'disabled');
if(tgt.length){
if(!tgt.hasClass(clFile)&&!tgt.closest(fileSelector).length){
widget=fm.getUI().find('.ui-dialog:visible,.ui-widget:visible');
if(widget.length){
widget.hide();
tgt=$(document.elementFromPoint(rec.left , rec.top));
widget.show();
}else{
widget=null;
}}
setTarget();
if(!tgt.length){
widget&&widget.hide();
tgt=$(document.elementFromPoint(rec.left , rec.top + 5));
widget&&widget.show();
setTarget();
}}
if(tgt.length){
if(tgt.attr('id')){
if(init){
for (var i=0; i < cnt; i++){
chk();
if(! tgt.length){
break;
}}
done();
}else{
bufferExt.repaintJob&&bufferExt.repaintJob.state()==='pending'&&bufferExt.repaintJob.reject();
arr=new Array(cnt);
bufferExt.repaintJob=fm.asyncJob(function(){
chk();
if(! tgt.length){
done();
bufferExt.repaintJob&&bufferExt.repaintJob.state()==='pending'&&bufferExt.repaintJob.reject();
}}, arr).done(done);
}}
}else if(init&&bufferExt.renderd){
recnt=recnt||0;
if(recnt < 10){
requestAnimationFrame(function(){
wrapperRepaint(init, ++recnt);
});
}}
},
oldSchoolItem=null,
oldSchool=function(p){
var phash=fm.cwd().phash,
pdir=fm.file(phash)||null,
set=function(pdir){
if(pdir){
oldSchoolItem=$(itemhtml($.extend(true, {}, pdir, {name:'..', i18:'..', mime:'directory'})))
.addClass('elfinder-cwd-parent')
.on('dblclick', function(){
var hash=fm.cwdId2Hash(this.id);
fm.trigger('select', {selected:[hash]}).exec('open', hash);
});
(list ? oldSchoolItem.children('td:first'):oldSchoolItem).children('.elfinder-cwd-select').remove();
(list ? cwd.find('tbody'):cwd).prepend(oldSchoolItem);
fm.draggingUiHelper&&fm.draggingUiHelper.data('refreshPositions', 1);
}};
if(pdir){
set(pdir);
}else{
if(fm.getUI('tree').length){
fm.one('parents', function(){
set(fm.file(phash)||null);
wrapper.trigger(scrollEvent);
});
}else{
fm.request({
data:{cmd:'parents', target:fm.cwd().hash},
preventFail:true
})
.done(function(data){
set(fm.file(phash)||null);
wrapper.trigger(scrollEvent);
});
}}
},
showFiles=fm.options.showFiles,
render=function(){
if(bufferExt.rendering||(bufferExt.renderd&&! buffer.length)){
return;
}
var place=(list ? cwd.children('table').children('tbody'):cwd),
phash,
chk,
docFlag=$.htmlPrefilter? true:false,
tempDom=docFlag? $(document.createDocumentFragment()):$('<div/>'),
go=function(o){
var over=o||null,
html=[],
dirs=false,
atmb={},
stmb=(fm.option('tmbUrl')==='self'),
init=bufferExt.renderd? false:true,
files, locks, selected;
files=buffer.splice(0, showFiles + (over||0) / (bufferExt.hpi||1));
bufferExt.renderd +=files.length;
if(! buffer.length){
bottomMarker.hide();
wrapper.off(scrollEvent, render);
}
locks=[];
html=$.map(files, function(f){
if(f.hash&&f.name){
if(f.mime=='directory'){
dirs=true;
}
if((f.tmb&&(f.tmb!=1||f.size > 0))||(stmb&&f.mime.indexOf('image/')===0)){
atmb[f.hash]=f.tmb||'self';
}
clipCuts[f.hash]&&locks.push(f.hash);
return itemhtml(f);
}
return null;
});
tempDom.empty().append(html.join(''));
dirs&&!mobile&&makeDroppable(tempDom);
selected=[];
if(Object.keys(selectedFiles).length){
tempDom.find('[id]:not(.'+clSelected+'):not(.elfinder-cwd-parent)').each(function(){
selectedFiles[fm.cwdId2Hash(this.id)]&&selected.push($(this));
});
}
place.append(docFlag? tempDom:tempDom.children());
if(selected.length){
$.each(selected, function(i, n){ n.trigger(evtSelect); });
trigger();
}
locks.length&&fm.trigger('lockfiles', {files: locks});
!bufferExt.hpi&&bottomMarkerShow(place, files.length);
if(list){
cwd.find('thead').show();
fixTableHeader({fitWidth: ! colWidth});
}
if(Object.keys(atmb).length){
Object.assign(bufferExt.attachTmbs, atmb);
}
if(init){
if(! mobile&&! cwd.data('selectable')){
cwd.selectable(selectableOption).data('selectable', true);
}}
! scrolling&&wrapper.trigger(scrollEvent);
};
if(! bufferExt.renderd){
bufferExt.rendering=true;
wrapper.scrollTop(0);
phash=fm.cwd().phash;
go();
if(options.oldSchool){
if(phash&&!query){
oldSchool(phash);
}else{
oldSchoolItem=$();
}}
if(list){
colWidth&&setColwidth();
fixTableHeader({fitWidth: true});
}
bufferExt.itemH=(list? place.find('tr:first'):place.find('[id]:first')).outerHeight(true);
fm.trigger('cwdrender');
bufferExt.rendering=false;
wrapperRepaint(true);
}
if(! bufferExt.rendering&&buffer.length){
if((chk=(wrapper.height() + wrapper.scrollTop() + fm.options.showThreshold + bufferExt.row) - (bufferExt.renderd * bufferExt.hpi)) > 0){
bufferExt.rendering=true;
fm.lazy(function(){
go(chk);
bufferExt.rendering=false;
});
}else{
!fm.enabled()&&resize();
}}else{
resize();
}},
tableHeader=null,
cssSticky=fm.UA.CSS.positionSticky&&fm.UA.CSS.widthMaxContent,
fixTableHeader=function(optsArg){
thHeight=0;
if(! options.listView.fixedHeader){
return;
}
var setPos=function(){
var val, pos;
pos=(fm.direction==='ltr')? 'left':'right';
val=((fm.direction==='ltr')? wrapper.scrollLeft():table.outerWidth(true) - wrapper.width() - wrapper.scrollLeft()) * -1;
if(base.css(pos)!==val){
base.css(pos, val);
}},
opts=optsArg||{},
cnt, base, table, htable, thead, tbody, hheight, htr, btr, htd, btd, htw, btw, init;
tbody=cwd.find('tbody');
btr=tbody.children('tr:first');
if(btr.length&&btr.is(':visible')){
table=tbody.parent();
if(! tableHeader){
init=true;
tbody.addClass('elfinder-cwd-fixheader');
thead=cwd.find('thead').attr('id', fm.namespace+'-cwd-thead');
htr=thead.children('tr:first');
hheight=htr.outerHeight(true);
cwd.css('margin-top', hheight - parseInt(table.css('padding-top')));
if(cssSticky){
tableHeader=$('<div class="elfinder-table-header-sticky"/>').addClass(cwd.attr('class')).append($('<table/>').append(thead));
cwd.after(tableHeader);
wrapper.on('resize.fixheader', function(e){
e.stopPropagation();
fixTableHeader({fitWidth: true});
});
}else{
base=$('<div/>').addClass(cwd.attr('class')).append($('<table/>').append(thead));
tableHeader=$('<div/>').addClass(wrapper.attr('class') + ' elfinder-cwd-fixheader')
.removeClass('ui-droppable native-droppable')
.css(wrapper.position())
.css({ height: hheight, width: cwd.outerWidth() })
.append(base);
if(fm.direction==='rtl'){
tableHeader.css('left', (wrapper.data('width') - wrapper.width()) + 'px');
}
setPos();
wrapper.after(tableHeader)
.on('scroll.fixheader resize.fixheader', function(e){
setPos();
if(e.type==='resize'){
e.stopPropagation();
tableHeader.css(wrapper.position());
wrapper.data('width', wrapper.css('overflow', 'hidden').width());
wrapper.css('overflow', 'auto');
fixTableHeader();
}});
}}else{
thead=$('#'+fm.namespace+'-cwd-thead');
htr=thead.children('tr:first');
}
if(init||opts.fitWidth||Math.abs(btr.outerWidth() - htr.outerWidth()) > 2){
cnt=customCols.length + 1;
for (var i=0; i < cnt; i++){
htd=htr.children('td:eq('+i+')');
btd=btr.children('td:eq('+i+')');
htw=htd.width();
btw=btd.width();
if(typeof htd.data('delta')==='undefined'){
htd.data('delta', (htd.outerWidth() - htw) - (btd.outerWidth() - btw));
}
btw -=htd.data('delta');
if(! init&&! opts.fitWidth&&htw===btw){
break;
}
htd.css('width', btw + 'px');
}}
if(!cssSticky){
tableHeader.data('widthTimer')&&cancelAnimationFrame(tableHeader.data('widthTimer'));
tableHeader.data('widthTimer', requestAnimationFrame(function(){
if(tableHeader){
tableHeader.css('width', mBoard.width() + 'px');
if(fm.direction==='rtl'){
tableHeader.css('left', (wrapper.data('width') - wrapper.width()) + 'px');
}}
}));
}
thHeight=thead.height();
}},
setColwidth=function(){
if(list&&colWidth){
var cl='elfinder-cwd-colwidth',
first=cwd.find('tr[id]:first'),
former;
if(! first.hasClass(cl)){
former=cwd.find('tr.'+cl);
former.removeClass(cl).find('td').css('width', '');
first.addClass(cl);
cwd.find('table:first').css('table-layout', 'fixed');
$.each($.merge(['name'], customCols), function(i, k){
var w=colWidth[k]||first.find('td.elfinder-col-'+k).width();
first.find('td.elfinder-col-'+k).width(w);
});
}}
},
droppable=Object.assign({}, fm.droppable, {
over:function(e, ui){
var dst=$(this),
helper=ui.helper,
ctr=(e.shiftKey||e.ctrlKey||e.metaKey),
hash, status, inParent;
e.stopPropagation();
helper.data('dropover', helper.data('dropover') + 1);
dst.data('dropover', true);
helper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');
if(helper.data('namespace')!==fm.namespace||! fm.insideWorkzone(e.pageX, e.pageY)){
dst.removeClass(clDropActive);
return;
}
if(dst.hasClass(fm.res(c, 'cwdfile'))){
hash=fm.cwdId2Hash(dst.attr('id'));
dst.data('dropover', hash);
}else{
hash=fm.cwd().hash;
fm.cwd().write&&dst.data('dropover', hash);
}
inParent=(fm.file(helper.data('files')[0]).phash===hash);
if(dst.data('dropover')===hash){
$.each(helper.data('files'), function(i, h){
if(h===hash||(inParent&&!ctr&&!helper.hasClass('elfinder-drag-helper-plus'))){
dst.removeClass(clDropActive);
return false;
}});
}else{
dst.removeClass(clDropActive);
}
if(helper.data('locked')||inParent){
status='elfinder-drag-helper-plus';
}else{
status='elfinder-drag-helper-move';
if(ctr){
status +=' elfinder-drag-helper-plus';
}}
dst.hasClass(clDropActive)&&helper.addClass(status);
requestAnimationFrame(function(){ dst.hasClass(clDropActive)&&helper.addClass(status); });
},
out:function(e, ui){
var helper=ui.helper;
e.stopPropagation();
helper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus').data('dropover', Math.max(helper.data('dropover') - 1, 0));
$(this).removeData('dropover')
.removeClass(clDropActive);
},
deactivate:function(){
$(this).removeData('dropover')
.removeClass(clDropActive);
},
drop:function(e, ui){
unselectAll({ notrigger: true });
fm.droppable.drop.call(this, e, ui);
}}),
makeDroppable=function(place){
place=place? place:(list ? cwd.find('tbody'):cwd);
var targets=place.children('.directory:not(.'+clDroppable+',.elfinder-na,.elfinder-ro)');
if(fm.isCommandEnabled('paste')){
targets.droppable(droppable);
}
if(fm.isCommandEnabled('upload')){
targets.addClass('native-droppable');
}
place.children('.isroot').each(function(i, n){
var $n=$(n),
hash=fm.cwdId2Hash(n.id);
if(fm.isCommandEnabled('paste', hash)){
if(! $n.hasClass(clDroppable+',elfinder-na,elfinder-ro')){
$n.droppable(droppable);
}}else{
if($n.hasClass(clDroppable)){
$n.droppable('destroy');
}}
if(fm.isCommandEnabled('upload', hash)){
if(! $n.hasClass('native-droppable,elfinder-na,elfinder-ro')){
$n.addClass('native-droppable');
}}else{
if($n.hasClass('native-droppable')){
$n.removeClass('native-droppable');
}}
});
},
attachThumbnails=function(tmbs, reload){
var attach=function(node, tmb){
$('<img/>')
.on('load', function(){
node.find('.elfinder-cwd-icon').addClass(tmb.className).css('background-image', "url('"+tmb.url+"')");
})
.attr('src', tmb.url);
},
chk=function(hash, tmb){
var node=fm.cwdHash2Elm(hash),
file, tmbObj, reloads=[];
if(node.length){
if(tmb!='1'){
file=fm.file(hash);
if(file.tmb!==tmb){
file.tmb=tmb;
}
tmbObj=fm.tmb(file);
if(reload){
node.find('.elfinder-cwd-icon').addClass(tmbObj.className).css('background-image', "url('"+tmbObj.url+"')");
}else{
attach(node, tmbObj);
}
delete bufferExt.attachTmbs[hash];
}else{
if(reload){
loadThumbnails([hash]);
}else if(! bufferExt.tmbLoading[hash]){
bufferExt.getTmbs.push(hash);
}}
}};
if($.isPlainObject(tmbs)&&Object.keys(tmbs).length){
Object.assign(bufferExt.attachTmbs, tmbs);
$.each(tmbs, chk);
if(! reload&&bufferExt.getTmbs.length&&! Object.keys(bufferExt.tmbLoading).length){
loadThumbnails();
}}
},
loadThumbnails=function(reloads){
var tmbs=[],
reload=false;
if(fm.oldAPI){
fm.request({
data:{cmd:'tmb', current:fm.cwd().hash},
preventFail:true
})
.done(function(data){
if(data.images&&Object.keys(data.images).length){
attachThumbnails(data.images);
}
if(data.tmb){
loadThumbnails();
}});
return;
}
if(reloads){
reload=true;
tmbs=reloads.splice(0, tmbNum);
}else{
tmbs=bufferExt.getTmbs.splice(0, tmbNum);
}
if(tmbs.length){
if(reload||inViewHashes[tmbs[0]]||inViewHashes[tmbs[tmbs.length-1]]){
$.each(tmbs, function(i, h){
bufferExt.tmbLoading[h]=true;
});
fm.request({
data:{cmd:'tmb', targets:tmbs},
preventFail:true
})
.done(function(data){
var errs=[],
resLen;
if(data.images){
if(resLen=Object.keys(data.images).length){
if(resLen < tmbs.length){
$.each(tmbs, function(i, h){
if(! data.images[h]){
errs.push(h);
}});
}
attachThumbnails(data.images, reload);
}else{
errs=tmbs;
}
if(errs.length){
$.each(errs, function(i, h){
delete bufferExt.attachTmbs[h];
});
}}
if(reload){
if(reloads.length){
loadThumbnails(reloads);
}}
})
.always(function(){
bufferExt.tmbLoading={};
if(! reload&&bufferExt.getTmbs.length){
loadThumbnails();
}});
}}
},
add=function(files, mode){
var place=list ? cwd.find('tbody'):cwd,
l=files.length,
atmb={},
findNode=function(file){
var pointer=cwd.find('[id]:first'), file2;
while (pointer.length){
file2=fm.file(fm.cwdId2Hash(pointer.attr('id')));
if(!pointer.hasClass('elfinder-cwd-parent')&&file2&&fm.compare(file, file2) < 0){
return pointer;
}
pointer=pointer.next('[id]');
}},
findIndex=function(file){
var l=buffer.length, i;
for (i=0; i < l; i++){
if(fm.compare(file, buffer[i]) < 0){
return i;
}}
return l||-1;
},
docFlag=$.htmlPrefilter? true:false,
tempDom=docFlag? $(document.createDocumentFragment()):$('<div/>'),
file, hash, node, nodes, ndx, stmb;
if(l > showFiles){
content();
selectedFiles=fm.arrayFlip($.map(files, function(f){ return f.hash; }), true);
trigger();
}else{
l&&wz.removeClass('elfinder-cwd-wrapper-empty');
stmb=(fm.option('tmbUrl')==='self');
while (l--){
file=files[l];
hash=file.hash;
if(fm.cwdHash2Elm(hash).length){
continue;
}
if((node=findNode(file))&&! node.length){
node=null;
}
if(! node&&(ndx=findIndex(file)) >=0){
buffer.splice(ndx, 0, file);
}else{
tempDom.empty().append(itemhtml(file));
(file.mime==='directory')&&!mobile&&makeDroppable(tempDom);
nodes=docFlag? tempDom:tempDom.children();
if(node){
node.before(nodes);
}else{
place.append(nodes);
}
++bufferExt.renderd;
}
if(fm.cwdHash2Elm(hash).length){
if((file.tmb&&(file.tmb!=1||file.size > 0))||(stmb&&file.mime.indexOf('image/')===0)){
atmb[hash]=file.tmb||'self';
}}
}
if(list){
setColwidth();
fixTableHeader({fitWidth: ! colWidth});
}
bottomMarkerShow(place);
if(Object.keys(atmb).length){
Object.assign(bufferExt.attachTmbs, atmb);
}}
},
remove=function(files){
var l=files.length,
inSearch=fm.searchStatus.state > 1,
curCmd=fm.getCommand (fm.currentReqCmd)||{},
hash, n, ndx, found;
if(!fm.cwd().hash&&!curCmd.noChangeDirOnRemovedCwd){
$.each(cwdParents.reverse(), function(i, h){
if(fm.file(h)){
found=true;
fm.one(fm.currentReqCmd + 'done', function(){
!fm.cwd().hash&&fm.exec('open', h);
});
return false;
}});
!found&&!fm.cwd().hash&&fm.exec('open', fm.roots[Object.keys(fm.roots)[0]]);
return;
}
while (l--){
hash=files[l];
if((n=fm.cwdHash2Elm(hash)).length){
try {
n.remove();
--bufferExt.renderd;
} catch(e){
fm.debug('error', e);
}}else if((ndx=index(hash))!==-1){
buffer.splice(ndx, 1);
}
selectedFiles[hash]&&delete selectedFiles[hash];
if(inSearch){
if((ndx=$.inArray(hash, cwdHashes))!==-1){
cwdHashes.splice(ndx, 1);
}}
}
inSearch&&fm.trigger('cwdhasheschange', cwdHashes);
if(list){
setColwidth();
fixTableHeader({fitWidth: ! colWidth});
}},
customColsNameBuild=function(){
var name='',
customColsName='';
for (var i=0; i < customCols.length; i++){
name=fm.getColumnName(customCols[i]);
customColsName +='<td class="elfinder-cwd-view-th-'+customCols[i]+' sortable-item">'+name+'</td>';
}
return customColsName;
},
setItemBoxSize=function(boxSize){
var place, elm;
if(!boxSize.height){
place=(list ? cwd.find('tbody'):cwd);
elm=place.find(list? 'tr:first':'[id]:first');
boxSize.height=elm.outerHeight(true);
if(!list){
boxSize.width=elm.outerWidth(true);
}}
},
bottomMarkerShow=function(cur, cnt){
var place=cur||(list ? cwd.find('tbody'):cwd),
boxSize=itemBoxSize[fm.viewType],
col=1,
row;
if(buffer.length > 0){
if(!bufferExt.hpi){
setItemBoxSize(boxSize);
if(! list){
col=Math.floor(place.width() / boxSize.width);
bufferExt.row=boxSize.height;
bufferExt.hpi=bufferExt.row / col;
}else{
bufferExt.row=bufferExt.hpi=boxSize.height;
}}else if(!list){
col=Math.floor(place.width() / boxSize.width);
}
row=Math.ceil((buffer.length + (cnt||0)) / col);
if(list&&tableHeader){
++row;
}
bottomMarker.css({top: (bufferExt.row * row) + 'px'}).show();
}},
wrapperContextMenu={
contextmenu:function(e){
e.preventDefault();
if(cwd.data('longtap')!==void(0)){
e.stopPropagation();
return;
}
fm.trigger('contextmenu', {
'type':'cwd',
'targets':[fm.cwd().hash],
'x':e.pageX,
'y':e.pageY
});
},
touchstart:function(e){
if(e.originalEvent.touches.length > 1){
return;
}
if(cwd.data('longtap')!==false){
wrapper.data('touching', {x: e.originalEvent.touches[0].pageX, y: e.originalEvent.touches[0].pageY});
cwd.data('tmlongtap', setTimeout(function(){
cwd.data('longtap', true);
fm.trigger('contextmenu', {
'type':'cwd',
'targets':[fm.cwd().hash],
'x':wrapper.data('touching').x,
'y':wrapper.data('touching').y
});
}, 500));
}
cwd.data('longtap', null);
},
touchend:function(e){
if(e.type==='touchmove'){
if(! wrapper.data('touching') ||
(Math.abs(wrapper.data('touching').x - e.originalEvent.touches[0].pageX)
+ Math.abs(wrapper.data('touching').y - e.originalEvent.touches[0].pageY)) > 4){
wrapper.data('touching', null);
}}else{
setTimeout(function(){
cwd.removeData('longtap');
}, 80);
}
clearTimeout(cwd.data('tmlongtap'));
},
click:function(e){
if(cwd.data('longtap')){
e.preventDefault();
e.stopPropagation();
}}
},
content=function(){
fm.lazy(function(){
var phash, emptyMethod, thtr;
wz.append(selectAllCheckbox).removeClass('elfinder-cwd-wrapper-empty elfinder-search-result elfinder-incsearch-result elfinder-letsearch-result');
if(fm.searchStatus.state > 1||fm.searchStatus.ininc){
wz.addClass('elfinder-search-result' + (fm.searchStatus.ininc? ' elfinder-'+(query.substr(0,1)==='/' ? 'let':'inc')+'search-result':''));
}
bufferExt.attachThumbJob&&bufferExt.attachThumbJob._abort();
cwd.data('selectable')&&cwd.selectable('disable').selectable('destroy').removeData('selectable');
fm.trigger('cwdinit');
selectedNext=$();
try {
cwd.empty();
} catch (e){
cwd.html('');
}
if(tableHeader){
wrapper.off('scroll.fixheader resize.fixheader');
tableHeader.remove();
tableHeader=null;
}
cwd.removeClass('elfinder-cwd-view-icons elfinder-cwd-view-list')
.addClass('elfinder-cwd-view-'+(list ? 'list' :'icons'))
.attr('style', '')
.css('height', 'auto');
bottomMarker.hide();
wrapper[list ? 'addClass':'removeClass']('elfinder-cwd-wrapper-list')._padding=parseInt(wrapper.css('padding-top')) + parseInt(wrapper.css('padding-bottom'));
if(fm.UA.iOS){
wrapper.removeClass('overflow-scrolling-touch').addClass('overflow-scrolling-touch');
}
if(list){
cwd.html('<table><thead/><tbody/></table>');
thtr=$('<tr class="ui-state-default"><td class="elfinder-cwd-view-th-name">'+fm.getColumnName('name')+'</td>'+customColsNameBuild()+'</tr>');
cwd.find('thead').hide().append(thtr).find('td:first').append(selectAllCheckbox);
if($.fn.sortable){
thtr.addClass('touch-punch touch-punch-keep-default')
.sortable({
axis: 'x',
distance: 8,
items: '> .sortable-item',
start: function(e, ui){
$(ui.item[0]).data('dragging', true);
ui.placeholder
.width(ui.helper.removeClass('ui-state-hover').width())
.removeClass('ui-state-active')
.addClass('ui-state-hover')
.css('visibility', 'visible');
},
update: function(e, ui){
var target=$(ui.item[0]).attr('class').split(' ')[0].replace('elfinder-cwd-view-th-', ''),
prev, done;
customCols=$.map($(this).children(), function(n){
var name=$(n).attr('class').split(' ')[0].replace('elfinder-cwd-view-th-', '');
if(! done){
if(target===name){
done=true;
}else{
prev=name;
}}
return (name==='name')? null:name;
});
templates.row=makeTemplateRow();
fm.storage('cwdCols', customCols);
prev='.elfinder-col-'+prev+':first';
target='.elfinder-col-'+target+':first';
fm.lazy(function(){
cwd.find('tbody tr').each(function(){
var $this=$(this);
$this.children(prev).after($this.children(target));
});
});
},
stop: function(e, ui){
setTimeout(function(){
$(ui.item[0]).removeData('dragging');
}, 100);
}});
}
thtr.find('td').addClass('touch-punch').resizable({
handles: fm.direction==='ltr'? 'e':'w',
start: function(e, ui){
var target=cwd.find('td.elfinder-col-'
+ ui.element.attr('class').split(' ')[0].replace('elfinder-cwd-view-th-', '')
+ ':first');
ui.element
.data('dragging', true)
.data('resizeTarget', target)
.data('targetWidth', target.width());
colResizing=true;
if(cwd.find('table').css('table-layout')!=='fixed'){
cwd.find('tbody tr:first td').each(function(){
$(this).width($(this).width());
});
cwd.find('table').css('table-layout', 'fixed');
}},
resize: function(e, ui){
ui.element.data('resizeTarget').width(ui.element.data('targetWidth') - (ui.originalSize.width - ui.size.width));
},
stop:function(e, ui){
colResizing=false;
fixTableHeader({fitWidth: true});
colWidth={};
cwd.find('tbody tr:first td').each(function(){
var name=$(this).attr('class').split(' ')[0].replace('elfinder-col-', '');
colWidth[name]=$(this).width();
});
fm.storage('cwdColWidth', colWidth);
setTimeout(function(){
ui.element.removeData('dragging');
}, 100);
}})
.find('.ui-resizable-handle').addClass('ui-icon ui-icon-grip-dotted-vertical');
}
buffer=$.map(incHashes||cwdHashes, function(hash){ return fm.file(hash)||null; });
buffer=fm.sortFiles(buffer);
if(incHashes){
incHashes=$.map(buffer, function(f){ return f.hash; });
}else{
cwdHashes=$.map(buffer, function(f){ return f.hash; });
}
bufferExt={
renderd: 0,
attachTmbs: {},
getTmbs: [],
tmbLoading: {},
lazyOpts: { tm:0 }};
wz[(buffer.length < 1) ? 'addClass':'removeClass']('elfinder-cwd-wrapper-empty');
wrapper.off(scrollEvent, render).on(scrollEvent, render).trigger(scrollEvent);
if(!fm.cwd().write){
wrapper.removeClass('native-droppable')
.droppable('disable')
.removeClass('ui-state-disabled');
}else{
wrapper[fm.isCommandEnabled('upload')? 'addClass':'removeClass']('native-droppable');
wrapper.droppable(fm.isCommandEnabled('paste')? 'enable':'disable');
}});
},
cwd=$(this)
.addClass('ui-helper-clearfix elfinder-cwd')
.attr('unselectable', 'on')
.on('click.'+fm.namespace, fileSelector, function(e){
var p=this.id ? $(this):$(this).parents('[id]:first'),
tgt=$(e.target),
prev,
next,
pl,
nl,
sib;
if(selectCheckbox&&(tgt.is('input:checkbox.'+clSelChk)||tgt.hasClass('elfinder-cwd-select'))){
e.stopPropagation();
e.preventDefault();
p.trigger(p.hasClass(clSelected) ? evtUnselect:evtSelect);
trigger();
requestAnimationFrame(function(){
tgt.prop('checked', p.hasClass(clSelected));
});
return;
}
if(cwd.data('longtap')||tgt.hasClass('elfinder-cwd-nonselect')){
e.stopPropagation();
return;
}
if(!curClickId){
curClickId=p.attr('id');
setTimeout(function(){
curClickId='';
}, 500);
}
if(e.shiftKey){
prev=p.prevAll(lastSelect||'.'+clSelected+':first');
next=p.nextAll(lastSelect||'.'+clSelected+':first');
pl=prev.length;
nl=next.length;
}
if(e.shiftKey&&(pl||nl)){
sib=pl ? p.prevUntil('#'+prev.attr('id')):p.nextUntil('#'+next.attr('id'));
sib.add(p).trigger(evtSelect);
}else if(e.ctrlKey||e.metaKey){
p.trigger(p.hasClass(clSelected) ? evtUnselect:evtSelect);
}else{
if(wrapper.data('touching')&&p.hasClass(clSelected)){
wrapper.data('touching', null);
fm.dblclick({file:fm.cwdId2Hash(this.id)});
return;
}else{
unselectAll({ notrigger: true });
p.trigger(evtSelect);
}}
trigger();
})
.on('dblclick.'+fm.namespace, fileSelector, function(e){
if(curClickId){
var hash=fm.cwdId2Hash(curClickId);
e.stopPropagation();
if(this.id!==curClickId){
$(this).trigger(evtUnselect);
$('#'+curClickId).trigger(evtSelect);
trigger();
}
fm.dblclick({file:hash});
}})
.on('touchstart.'+fm.namespace, fileSelector, function(e){
if(e.originalEvent.touches.length > 1){
return;
}
var p=this.id ? $(this):$(this).parents('[id]:first'),
tgt=$(e.target),
nodeName=e.target.nodeName,
sel;
if((nodeName==='INPUT'&&e.target.type==='text')||nodeName==='TEXTAREA'||tgt.hasClass('elfinder-cwd-nonselect')){
e.stopPropagation();
return;
}
if(p.find('input:text,textarea').length){
e.stopPropagation();
e.preventDefault();
return;
}
wrapper.data('touching', {x: e.originalEvent.touches[0].pageX, y: e.originalEvent.touches[0].pageY});
if(selectCheckbox&&(tgt.is('input:checkbox.'+clSelChk)||tgt.hasClass('elfinder-cwd-select'))){
return;
}
sel=p.prevAll('.'+clSelected+':first').length +
p.nextAll('.'+clSelected+':first').length;
cwd.data('longtap', null);
if(Object.keys(selectedFiles).length
||
(list&&e.target.nodeName!=='TD')
||
(!list&&this!==e.target)
){
cwd.data('longtap', false);
p.addClass(clHover);
p.data('tmlongtap', setTimeout(function(){
cwd.data('longtap', true);
p.trigger(evtSelect);
trigger();
fm.trigger('contextmenu', {
'type':'files',
'targets':fm.selected(),
'x':e.originalEvent.touches[0].pageX,
'y':e.originalEvent.touches[0].pageY
});
}, 500));
}})
.on('touchmove.'+fm.namespace+' touchend.'+fm.namespace, fileSelector, function(e){
var tgt=$(e.target),
p;
if(selectCheckbox&&(tgt.is('input:checkbox.'+clSelChk)||tgt.hasClass('elfinder-cwd-select'))){
return;
}
if(e.target.nodeName=='INPUT'||e.target.nodeName=='TEXTAREA'){
e.stopPropagation();
return;
}
p=this.id ? $(this):$(this).parents('[id]:first');
clearTimeout(p.data('tmlongtap'));
if(e.type==='touchmove'){
wrapper.data('touching', null);
p.removeClass(clHover);
}else{
if(wrapper.data('touching')&&!cwd.data('longtap')&&p.hasClass(clSelected)){
e.preventDefault();
wrapper.data('touching', null);
fm.dblclick({file:fm.cwdId2Hash(this.id)});
}
setTimeout(function(){
cwd.removeData('longtap');
}, 80);
}})
.on('mouseenter.'+fm.namespace, fileSelector, function(e){
if(scrolling){ return; }
var $this=$(this), helper=null;
if(!mobile&&!$this.data('dragRegisted')&&!$this.hasClass(clTmp)&&!$this.hasClass(clDraggable)&&!$this.hasClass(clDisabled)){
$this.data('dragRegisted', true);
if(!fm.isCommandEnabled('copy', fm.searchStatus.state > 1||$this.hasClass('isroot')? fm.cwdId2Hash($this.attr('id')):void 0)){
return;
}
$this.on('mousedown', function(e){
var metaKey=e.shiftKey||e.altKey,
disable=false;
if(metaKey&&!fm.UA.IE&&cwd.data('selectable')){
cwd.selectable('disable').selectable('destroy').removeData('selectable');
requestAnimationFrame(function(){
cwd.selectable(selectableOption).selectable('option', {disabled: false}).selectable('refresh').data('selectable', true);
});
}
$this.removeClass('ui-state-disabled');
if(metaKey){
$this.draggable('option', 'disabled', true).attr('draggable', 'true');
}else{
if(!$this.hasClass(clSelected)){
if(list){
disable=$(e.target).closest('span,tr').is('tr');
}else{
disable=$(e.target).hasClass('elfinder-cwd-file');
}}
if(disable){
$this.draggable('option', 'disabled', true);
}else{
$this.draggable('option', 'disabled', false)
.removeAttr('draggable')
.draggable('option', 'cursorAt', {left: 50 - parseInt($(e.currentTarget).css('margin-left')), top: 47});
}}
})
.on('dragstart', function(e){
var dt=e.dataTransfer||e.originalEvent.dataTransfer||null;
helper=null;
if(dt&&!fm.UA.IE){
var p=this.id ? $(this):$(this).parents('[id]:first'),
elm=$('<span>'),
url='',
durl=null,
murl=null,
files=[],
icon=function(f){
var mime=f.mime, i, tmb=fm.tmb(f);
i='<div class="elfinder-cwd-icon elfinder-cwd-icon-drag '+fm.mime2class(mime)+' ui-corner-all"/>';
if(tmb){
i=$(i).addClass(tmb.className).css('background-image', "url('"+tmb.url+"')").get(0).outerHTML;
}
return i;
}, l, geturl=[];
p.trigger(evtSelect);
trigger();
$.each(selectedFiles, function(v){
var file=fm.file(v),
furl=file.url;
if(file&&file.mime!=='directory'){
if(!furl){
furl=fm.url(file.hash);
}else if(furl=='1'){
geturl.push(v);
return true;
}
if(furl){
furl=fm.convAbsUrl(furl);
files.push(v);
$('<a>').attr('href', furl).text(furl).appendTo(elm);
url +=furl + "\n";
if(!durl){
durl=file.mime + ':' + file.name + ':' + furl;
}
if(!murl){
murl=furl + "\n" + file.name;
}}
}});
if(geturl.length){
$.each(geturl, function(i, v){
var rfile=fm.file(v);
rfile.url='';
fm.request({
data:{cmd:'url', target:v},
notify:{type:'url', cnt:1},
preventDefault:true
})
.always(function(data){
rfile.url=data.url? data.url:'1';
});
});
return false;
}else if(url){
if(dt.setDragImage){
helper=$('<div class="elfinder-drag-helper html5-native"></div>').append(icon(fm.file(files[0]))).appendTo($(document.body));
if((l=files.length) > 1){
helper.append(icon(fm.file(files[l-1])) + '<span class="elfinder-drag-num">'+l+'</span>');
}
dt.setDragImage(helper.get(0), 50, 47);
}
dt.effectAllowed='copyLink';
dt.setData('DownloadURL', durl);
dt.setData('text/x-moz-url', murl);
dt.setData('text/uri-list', url);
dt.setData('text/plain', url);
dt.setData('text/html', elm.html());
dt.setData('elfinderfrom', window.location.href + fm.cwd().hash);
dt.setData('elfinderfrom:' + dt.getData('elfinderfrom'), '');
}else{
return false;
}}
})
.on('dragend', function(e){
unselectAll({ notrigger: true });
helper&&helper.remove();
})
.draggable(fm.draggable);
}})
.on(evtSelect, fileSelector, function(e){
var $this=$(this),
id=fm.cwdId2Hash($this.attr('id'));
if(!selectLock&&!$this.hasClass(clDisabled)){
lastSelect='#'+ this.id;
$this.addClass(clSelected).children().addClass(clHover).find('input:checkbox.'+clSelChk).prop('checked', true);
if(! selectedFiles[id]){
selectedFiles[id]=true;
}
selectedNext=cwd.find('[id].'+clSelected+':last').next();
}})
.on(evtUnselect, fileSelector, function(e){
var $this=$(this),
id=fm.cwdId2Hash($this.attr('id'));
if(!selectLock){
$this.removeClass(clSelected).children().removeClass(clHover).find('input:checkbox.'+clSelChk).prop('checked', false);
if(cwd.hasClass('elfinder-cwd-allselected')){
selectCheckbox&&selectAllCheckbox.children('input').prop('checked', false);
cwd.removeClass('elfinder-cwd-allselected');
}
selectedFiles[id]&&delete selectedFiles[id];
}})
.on(evtDisable, fileSelector, function(){
var $this=$(this).removeClass(clHover+' '+clSelected).addClass(clDisabled),
child=$this.children(),
target=(list ? $this:child.find('div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename'));
child.removeClass(clHover+' '+clSelected);
$this.hasClass(clDroppable)&&$this.droppable('disable');
target.hasClass(clDraggable)&&target.draggable('disable');
})
.on(evtEnable, fileSelector, function(){
var $this=$(this).removeClass(clDisabled),
target=list ? $this:$this.children('div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename');
$this.hasClass(clDroppable)&&$this.droppable('enable');
target.hasClass(clDraggable)&&target.draggable('enable');
})
.on('scrolltoview', fileSelector, function(e, data){
scrollToView($(this), (data&&typeof data.blink!=='undefined')? data.blink:true);
})
.on('mouseenter.'+fm.namespace+' mouseleave.'+fm.namespace, fileSelector, function(e){
var enter=(e.type==='mouseenter');
if(enter&&(scrolling||fm.UA.Mobile)){ return; }
fm.trigger('hover', {hash:fm.cwdId2Hash($(this).attr('id')), type:e.type});
$(this).toggleClass(clHover, (e.type=='mouseenter'));
})
.on('mouseenter.'+fm.namespace+' mouseleave.'+fm.namespace, '.elfinder-cwd-file-wrapper,.elfinder-cwd-filename', function(e){
var enter=(e.type==='mouseenter');
if(enter&&scrolling){ return; }
$(this).closest(fileSelector).children('.elfinder-cwd-file-wrapper,.elfinder-cwd-filename').toggleClass(clActive, (e.type=='mouseenter'));
})
.on('contextmenu.'+fm.namespace, function(e){
var file=$(e.target).closest(fileSelector);
if(file.get(0)===e.target&&!selectedFiles[fm.cwdId2Hash(file.get(0).id)]){
return;
}
if(file.find('input:text,textarea').length){
e.stopPropagation();
return;
}
if(file.length&&(e.target.nodeName!='TD'||selectedFiles[fm.cwdId2Hash(file.get(0).id)])){
e.stopPropagation();
e.preventDefault();
if(!file.hasClass(clDisabled)&&!wrapper.data('touching')){
if(!file.hasClass(clSelected)){
unselectAll({ notrigger: true });
file.trigger(evtSelect);
trigger();
}
fm.trigger('contextmenu', {
'type':'files',
'targets':fm.selected(),
'x':e.pageX,
'y':e.pageY
});
}}
})
.on('click.'+fm.namespace, function(e){
if(e.target===this&&! cwd.data('longtap')){
!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&unselectAll();
}})
.on('create.'+fm.namespace, function(e, f){
var parent=list ? cwd.find('tbody'):cwd,
p=parent.find('.elfinder-cwd-parent'),
lock=f.move||false,
file=$(itemhtml(f)).addClass(clTmp),
selected=fm.selected();
if(selected.length){
lock&&fm.trigger('lockfiles', {files: selected});
}else{
unselectAll();
}
if(p.length){
p.after(file);
}else{
parent.prepend(file);
}
setColwidth();
wrapper.scrollTop(0).scrollLeft(0);
})
.on('unselectall', unselectAll)
.on('selectfile', function(e, id){
fm.cwdHash2Elm(id).trigger(evtSelect);
trigger();
})
.on('colwidth', function(){
if(list){
cwd.find('table').css('table-layout', '')
.find('td').css('width', '');
fixTableHeader({fitWidth: true});
fm.storage('cwdColWidth', colWidth=null);
}})
.on('iconpref', function(e, data){
cwd.removeClass(function(i, cName){
return (cName.match(/\belfinder-cwd-size\S+/g)||[]).join(' ');
});
iconSize=data? (parseInt(data.size)||0):0;
if(!list){
if(iconSize > 0){
cwd.addClass('elfinder-cwd-size' + iconSize);
}
if(bufferExt.renderd){
requestAnimationFrame(function(){
itemBoxSize.icons={};
bufferExt.hpi=null;
bottomMarkerShow(cwd, bufferExt.renderd);
wrapperRepaint();
});
}}
})
.on('onwheel' in document ? 'wheel':'mousewheel', function(e){
var tm, size, delta;
if(!list&&((e.ctrlKey&&!e.metaKey)||(!e.ctrlKey&&e.metaKey))){
e.stopPropagation();
e.preventDefault();
tm=cwd.data('wheelTm');
if(typeof tm!=='undefined'){
clearTimeout(tm);
cwd.data('wheelTm', setTimeout(function(){
cwd.removeData('wheelTm');
}, 200));
}else{
cwd.data('wheelTm', false);
size=iconSize||0;
delta=e.originalEvent.deltaY ? e.originalEvent.deltaY:-(e.originalEvent.wheelDelta);
if(delta > 0){
if(iconSize > 0){
size=iconSize - 1;
}}else{
if(iconSize < options.iconsView.sizeMax){
size=iconSize + 1;
}}
if(size!==iconSize){
fm.storage('iconsize', size);
cwd.trigger('iconpref', {size: size});
}}
}}),
wrapper=$('<div class="elfinder-cwd-wrapper"/>')
.droppable(Object.assign({}, droppable, {autoDisable: false}))
.on('contextmenu.'+fm.namespace, wrapperContextMenu.contextmenu)
.on('touchstart.'+fm.namespace, wrapperContextMenu.touchstart)
.on('touchmove.'+fm.namespace+' touchend.'+fm.namespace, wrapperContextMenu.touchend)
.on('click.'+fm.namespace, wrapperContextMenu.click)
.on('scroll.'+fm.namespace, function(){
if(! scrolling){
cwd.data('selectable')&&cwd.selectable('disable');
wrapper.trigger(scrollStartEvent);
}
scrolling=true;
bufferExt.scrtm&&cancelAnimationFrame(bufferExt.scrtm);
if(bufferExt.scrtm&&Math.abs((bufferExt.scrolltop||0) - (bufferExt.scrolltop=(this.scrollTop||$(this).scrollTop()))) < 5){
bufferExt.scrtm=0;
wrapper.trigger(scrollEvent);
}
bufferExt.scrtm=requestAnimationFrame(function(){
bufferExt.scrtm=0;
wrapper.trigger(scrollEvent);
});
})
.on(scrollEvent, function(){
scrolling=false;
wrapperRepaint();
}),
bottomMarker=$('<div>&nbsp;</div>')
.css({position: 'absolute', width: '1px', height: '1px'})
.hide(),
selectAllCheckbox=selectCheckbox? $('<div class="elfinder-cwd-selectall"><input type="checkbox"/></div>')
.attr('title', fm.i18n('selectall'))
.on('touchstart mousedown click', function(e){
e.stopPropagation();
e.preventDefault();
if($(this).data('pending')||e.type==='click'){
return false;
}
selectAllCheckbox.data('pending', true);
if(cwd.hasClass('elfinder-cwd-allselected')){
selectAllCheckbox.find('input').prop('checked', false);
requestAnimationFrame(function(){
unselectAll();
});
}else{
selectAll();
}}):$(),
restm=null,
resize=function(init){
var initHeight=function(){
if(typeof bufferExt.renderd!=='undefined'){
var h=0;
wrapper.siblings('div.elfinder-panel:visible').each(function(){
h +=$(this).outerHeight(true);
});
wrapper.height(wz.height() - h - wrapper._padding);
}};
init&&initHeight();
restm&&cancelAnimationFrame(restm);
restm=requestAnimationFrame(function(){
!init&&initHeight();
var wph, cwdoh;
cwd.css('height', 'auto');
wph=wrapper[0].clientHeight - parseInt(wrapper.css('padding-top')) - parseInt(wrapper.css('padding-bottom')) - parseInt(cwd.css('margin-top')),
cwdoh=cwd.outerHeight(true);
if(cwdoh < wph){
cwd.height(wph);
}});
list&&! colResizing&&(init? wrapper.trigger('resize.fixheader'):fixTableHeader());
wrapperRepaint();
},
parent=$(this).parent().on('resize', resize),
wz=parent.children('.elfinder-workzone').append(wrapper.append(this).append(bottomMarker)),
mBoard=$('<div class="elfinder-cwd-message-board"/>').insertAfter(cwd),
vExpires=$('<div class="elfinder-cwd-expires" />'),
vExpiresTm,
showVolumeExpires=function(){
var remain, sec, int;
vExpiresTm&&clearTimeout(vExpiresTm);
if(curVolId&&fm.volumeExpires[curVolId]){
sec=fm.volumeExpires[curVolId] - ((+new Date()) / 1000);
int=(sec % 60) + 0.1;
remain=Math.floor(sec / 60);
vExpires.html(fm.i18n(['minsLeft', remain])).show();
if(remain){
vExpiresTm=setTimeout(showVolumeExpires, int * 1000);
}}
},
itemBoxSize={
icons:{},
list:{}},
hasUiTree,
iconSize,
curVolId,
winScrTm;
if(!fm.UA.ltIE10){
mBoard.append($('<div class="elfinder-cwd-trash" />').html(fm.i18n('volume_Trash')))
.append(vExpires);
}
replacement=Object.assign(replacement, options.replacement||{});
try {
colWidth=fm.storage('cwdColWidth')? fm.storage('cwdColWidth'):null;
} catch(e){
colWidth=null;
}
fm.bind('columnpref', function(e){
var opts=e.data||{};
if(customCols=fm.storage('cwdCols')){
customCols=$.grep(customCols, function(n){
return (options.listView.columns.indexOf(n)!==-1)? true:false;
});
if(options.listView.columns.length > customCols.length){
$.each(options.listView.columns, function(i, n){
if(customCols.indexOf(n)===-1){
customCols.push(n);
}});
}}else{
customCols=options.listView.columns;
}
var columnhides=fm.storage('columnhides')||null;
if(columnhides&&Object.keys(columnhides).length)
customCols=$.grep(customCols, function(n){
return columnhides[n]? false:true;
});
templates.row=makeTemplateRow();
list&&opts.repaint&&content();
}).trigger('columnpref');
if(mobile){
$('body').on('touchstart touchmove touchend', function(e){});
}
selectCheckbox&&cwd.addClass('elfinder-has-checkbox');
$(window).on('scroll.'+fm.namespace, function(){
winScrTm&&cancelAnimationFrame(winScrTm);
winScrTm=requestAnimationFrame(function(){
wrapper.trigger(scrollEvent);
});
});
$(document).on('keydown.'+fm.namespace, function(e){
if(e.keyCode==$.ui.keyCode.ESCAPE){
if(! fm.getUI().find('.ui-widget:visible').length){
unselectAll();
}}
});
fm
.one('init', function(){
var style=document.createElement('style'),
sheet, node, base, resizeTm, iconSize, i=0;
if(document.head){
document.head.appendChild(style);
sheet=style.sheet;
sheet.insertRule('.elfinder-cwd-wrapper-empty .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+fm.i18n('emptyFolder')+'" }', i++);
sheet.insertRule('.elfinder-cwd-wrapper-empty .native-droppable .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+fm.i18n('emptyFolder'+(mobile? 'LTap':'Drop'))+'" }', i++);
sheet.insertRule('.elfinder-cwd-wrapper-empty .ui-droppable-disabled .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+fm.i18n('emptyFolder')+'" }', i++);
sheet.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+fm.i18n('emptySearch')+'" }', i++);
sheet.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-incsearch-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+fm.i18n('emptyIncSearch')+'" }', i++);
sheet.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-letsearch-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+fm.i18n('emptyLetSearch')+'" }', i++);
}
if(iconSize=(fm.storage('iconsize')||options.iconsView.size||0)){
iconSize=Math.min(iconSize, options.iconsView.sizeMax);
cwd.trigger('iconpref', {size: iconSize});
}
if(! mobile){
fm.one('open', function(){
sheet&&fm.zIndex&&sheet.insertRule('.ui-selectable-helper{z-index:'+fm.zIndex+';}', i++);
});
base=$('<div style="position:absolute"/>');
node=fm.getUI();
node.on('resize', function(e, data){
var offset;
e.preventDefault();
e.stopPropagation();
if(data&&data.fullscreen){
offset=node.offset();
if(data.fullscreen==='on'){
base.css({top:offset.top * -1 , left:offset.left * -1 }).appendTo(node);
selectableOption.appendTo=base;
}else{
base.detach();
selectableOption.appendTo='body';
}
cwd.data('selectable')&&cwd.selectable('option', {appendTo:selectableOption.appendTo});
}});
}
hasUiTree=fm.getUI('tree').length;
})
.bind('enable', function(){
resize();
})
.bind('request.open', function(){
bufferExt.getTmbs=[];
})
.one('open', function(){
if(fm.maxTargets){
tmbNum=Math.min(fm.maxTargets, tmbNum);
}})
.bind('open add remove searchend', function(){
var phash=fm.cwd().hash,
type=this.type;
if(type==='open'||type==='searchend'||fm.searchStatus.state < 2){
cwdHashes=$.map(fm.files(phash), function(f){ return f.hash; });
fm.trigger('cwdhasheschange', cwdHashes);
}
if(type==='open'){
var inTrash=function(){
var isIn=false;
$.each(cwdParents, function(i, h){
if(fm.trashes[h]){
isIn=true;
return false;
}});
return isIn;
},
req=phash?
(! fm.file(phash)||hasUiTree?
(! hasUiTree?
fm.request({
data: {
cmd:'parents',
target:fm.cwd().hash
},
preventFail:true
}):(function(){
var dfd=$.Deferred();
fm.one('treesync', function(e){
e.data.always(function(){
dfd.resolve();
});
});
return dfd;
})()
):null
):null,
cwdObj=fm.cwd();
if(cwdObj.volumeid!==curVolId){
vExpires.empty().hide();
if(curVolId){
wrapper.removeClass('elfinder-cwd-wrapper-' + curVolId);
}
curVolId=cwdObj.volumeid;
showVolumeExpires();
wrapper.addClass('elfinder-cwd-wrapper-' + curVolId);
}
$.when(req).done(function(){
cwdParents=fm.parents(cwdObj.hash);
wrapper[inTrash()? 'addClass':'removeClass']('elfinder-cwd-wrapper-trash');
});
incHashes=void 0;
unselectAll({ notrigger: true });
content();
}})
.bind('search', function(e){
cwdHashes=$.map(e.data.files, function(f){ return f.hash; });
fm.trigger('cwdhasheschange', cwdHashes);
incHashes=void 0;
fm.searchStatus.ininc=false;
content();
fm.autoSync('stop');
})
.bind('searchend', function(e){
if(query||incHashes){
query='';
if(incHashes){
fm.trigger('incsearchend', e.data);
}else{
if(!e.data||!e.data.noupdate){
content();
}}
}
fm.autoSync();
})
.bind('searchstart', function(e){
unselectAll();
query=e.data.query;
})
.bind('incsearchstart', function(e){
selectedFiles={};
fm.lazy(function(){
var regex, q, fst='';
q=query=e.data.query||'';
if(q){
if(q.substr(0,1)==='/'){
q=q.substr(1);
fst='^';
}
regex=new RegExp(fst + q.replace(/([\\*\;\.\?\[\]\{\}\(\)\^\$\-\|])/g, '\\$1'), 'i');
incHashes=$.grep(cwdHashes, function(hash){
var file=fm.file(hash);
return (file&&(file.name.match(regex)||(file.i18&&file.i18.match(regex))))? true:false;
});
fm.trigger('incsearch', { hashes: incHashes, query: q })
.searchStatus.ininc=true;
content();
fm.autoSync('stop');
}else{
fm.trigger('incsearchend');
}});
})
.bind('incsearchend', function(e){
query='';
fm.searchStatus.ininc=false;
incHashes=void 0;
if(!e.data||!e.data.noupdate){
content();
}
fm.autoSync();
})
.bind('sortchange', function(){
var lastScrollLeft=wrapper.scrollLeft(),
allsel=cwd.hasClass('elfinder-cwd-allselected');
content();
fm.one('cwdrender', function(){
wrapper.scrollLeft(lastScrollLeft);
if(allsel){
selectedFiles=fm.arrayFlip(incHashes||cwdHashes, true);
}
(allsel||Object.keys(selectedFiles).length)&&trigger();
});
})
.bind('viewchange', function(){
var l=fm.storage('view')=='list',
allsel=cwd.hasClass('elfinder-cwd-allselected');
if(l!=list){
list=l;
fm.viewType=list? 'list':'icons';
if(iconSize){
fm.one('cwdinit', function(){
cwd.trigger('iconpref', {size: iconSize});
});
}
content();
resize();
if(allsel){
cwd.addClass('elfinder-cwd-allselected');
selectAllCheckbox.find('input').prop('checked', true);
}
Object.keys(selectedFiles).length&&trigger();
}})
.bind('wzresize', function(){
var place=list ? cwd.find('tbody'):cwd,
cwdOffset;
resize(true);
if(bufferExt.hpi){
bottomMarkerShow(place, place.find('[id]').length);
}
cwdOffset=cwd.offset();
wz.data('rectangle', Object.assign({
width: wz.width(),
height: wz.height(),
cwdEdge: (fm.direction==='ltr')? cwdOffset.left:cwdOffset.left + cwd.width()
},
wz.offset())
);
bufferExt.itemH=(list? place.find('tr:first'):place.find('[id]:first')).outerHeight(true);
})
.bind('changeclipboard', function(e){
clipCuts={};
if(e.data&&e.data.clipboard&&e.data.clipboard.length){
$.each(e.data.clipboard, function(i, f){
if(f.cut){
clipCuts[f.hash]=true;
}});
}})
.bind('resMixinMake', function(){
setColwidth();
})
.bind('tmbreload', function(e){
var imgs={},
files=(e.data&&e.data.files)? e.data.files:null;
$.each(files, function(i, f){
if(f.tmb&&f.tmb!='1'){
imgs[f.hash]=f.tmb;
}});
if(Object.keys(imgs).length){
attachThumbnails(imgs, true);
}})
.add(function(e){
var regex=query? new RegExp(query.replace(/([\\*\;\.\?\[\]\{\}\(\)\^\$\-\|])/g, '\\$1'), 'i'):null,
mime=fm.searchStatus.mime,
inSearch=fm.searchStatus.state > 1,
phash=inSearch&&fm.searchStatus.target? fm.searchStatus.target:fm.cwd().hash,
curPath=fm.path(phash),
inTarget=function(f){
var res, parents, path;
res=(f.phash===phash);
if(!res&&inSearch){
path=f.path||fm.path(f.hash);
res=(curPath&&path.indexOf(curPath)===0);
if(! res&&fm.searchStatus.mixed){
res=$.grep(fm.searchStatus.mixed, function(vid){ return f.hash.indexOf(vid)===0? true:false; }).length? true:false;
}}
if(res&&inSearch){
if(mime){
res=(f.mime.indexOf(mime)===0);
}else{
res=(f.name.match(regex)||(f.i18&&f.i18.match(regex)))? true:false;
}}
return res;
},
files=$.grep(e.data.added||[], function(f){ return inTarget(f)? true:false ;});
add(files);
if(fm.searchStatus.state===2){
$.each(files, function(i, f){
if($.inArray(f.hash, cwdHashes)===-1){
cwdHashes.push(f.hash);
}});
fm.trigger('cwdhasheschange', cwdHashes);
}
list&&resize();
wrapper.trigger(scrollEvent);
})
.change(function(e){
var phash=fm.cwd().hash,
sel=fm.selected(),
files, added;
if(query){
$.each(e.data.changed||[], function(i, file){
if(fm.cwdHash2Elm(file.hash).length){
remove([file.hash]);
add([file], 'change');
$.inArray(file.hash, sel)!==-1&&selectFile(file.hash);
added=true;
}});
}else{
$.each($.grep(e.data.changed||[], function(f){ return f.phash==phash ? true:false; }), function(i, file){
if(fm.cwdHash2Elm(file.hash).length){
remove([file.hash]);
add([file], 'change');
$.inArray(file.hash, sel)!==-1&&selectFile(file.hash);
added=true;
}});
}
if(added){
fm.trigger('cwdhasheschange', cwdHashes);
list&&resize();
wrapper.trigger(scrollEvent);
}
trigger();
})
.remove(function(e){
var place=list ? cwd.find('tbody'):cwd;
remove(e.data.removed||[]);
trigger();
if(buffer.length < 1&&place.children(fileSelector + (options.oldSchool? ':not(.elfinder-cwd-parent)':'')).length < 1){
wz.addClass('elfinder-cwd-wrapper-empty');
selectCheckbox&&selectAllCheckbox.find('input').prop('checked', false);
bottomMarker.hide();
wrapper.off(scrollEvent, render);
resize();
}else{
bottomMarkerShow(place);
wrapper.trigger(scrollEvent);
}})
.dragstart(function(e){
var target=$(e.data.target),
oe=e.data.originalEvent;
if(target.hasClass(clFile)){
if(!target.hasClass(clSelected)){
!(oe.ctrlKey||oe.metaKey||oe.shiftKey)&&unselectAll({ notrigger: true });
target.trigger(evtSelect);
trigger();
}}
cwd.removeClass(clDisabled).data('selectable')&&cwd.selectable('disable');
selectLock=true;
})
.dragstop(function(){
cwd.data('selectable')&&cwd.selectable('enable');
selectLock=false;
})
.bind('lockfiles unlockfiles selectfiles unselectfiles', function(e){
var events={
lockfiles:evtDisable ,
unlockfiles:evtEnable ,
selectfiles:evtSelect,
unselectfiles:evtUnselect },
event=events[e.type],
files=e.data.files||[],
l=files.length,
helper=e.data.helper||$(),
parents, ctr, add;
if(l > 0){
parents=fm.parents(files[0]);
}
if(event===evtSelect||event===evtUnselect){
add=(event===evtSelect),
$.each(files, function(i, hash){
var all=cwd.hasClass('elfinder-cwd-allselected');
if(! selectedFiles[hash]){
add&&(selectedFiles[hash]=true);
}else{
if(all){
selectCheckbox&&selectAllCheckbox.children('input').prop('checked', false);
cwd.removeClass('elfinder-cwd-allselected');
all=false;
}
! add&&delete selectedFiles[hash];
}});
}
if(!helper.data('locked')){
while (l--){
try {
fm.cwdHash2Elm(files[l]).trigger(event);
} catch(e){}}
! e.data.inselect&&trigger();
}
if(wrapper.data('dropover')&&parents.indexOf(wrapper.data('dropover'))!==-1){
ctr=e.type!=='lockfiles';
helper.toggleClass('elfinder-drag-helper-plus', ctr);
wrapper.toggleClass(clDropActive, ctr);
}})
.bind('mkdir mkfile duplicate upload rename archive extract paste multiupload', function(e){
if(e.type=='upload'&&e.data._multiupload) return;
var phash=fm.cwd().hash, files;
unselectAll({ notrigger: true });
$.each((e.data.added||[]).concat(e.data.changed||[]), function(i, file){
file&&file.phash==phash&&selectFile(file.hash);
});
trigger();
})
.shortcut({
pattern     :'ctrl+a',
description:'selectall',
callback:selectAll
})
.shortcut({
pattern     :'ctrl+shift+i',
description:'selectinvert',
callback:selectInvert
})
.shortcut({
pattern:'left right up down shift+left shift+right shift+up shift+down',
description:'selectfiles',
type:'keydown' , //fm.UA.Firefox||fm.UA.Opera ? 'keypress':'keydown',
callback:function(e){ select(e.keyCode, e.shiftKey); }})
.shortcut({
pattern:'home',
description:'selectffile',
callback:function(e){
unselectAll({ notrigger: true });
scrollToView(cwd.find('[id]:first').trigger(evtSelect));
trigger();
}})
.shortcut({
pattern:'end',
description:'selectlfile',
callback:function(e){
unselectAll({ notrigger: true });
scrollToView(cwd.find('[id]:last').trigger(evtSelect)) ;
trigger();
}})
.shortcut({
pattern:'page_up',
description:'pageTurning',
callback:function(e){
if(bufferExt.itemH){
wrapper.scrollTop(Math.round(wrapper.scrollTop()
- (Math.floor((wrapper.height() + (list? bufferExt.itemH * -1:16)) / bufferExt.itemH)) * bufferExt.itemH
)
);
}}
}).shortcut({
pattern:'page_down',
description:'pageTurning',
callback:function(e){
if(bufferExt.itemH){
wrapper.scrollTop(Math.round(wrapper.scrollTop()
+ (Math.floor((wrapper.height() + (list? bufferExt.itemH * -1:16)) / bufferExt.itemH)) * bufferExt.itemH
)
);
}}
});
});
return this;
};
$.fn.elfinderdialog=function(opts, fm){
var platformWin=(window.navigator.platform.indexOf('Win')!=-1),
delta={},
syncSize={ enabled: false, width: false, height: false, defaultSize: null },
fitSize=function(dialog){
var opts, node;
if(syncSize.enabled){
node=fm.options.dialogContained? elfNode:$(window);
opts={
maxWidth:syncSize.width?  node.width() - delta.width:null,
maxHeight: syncSize.height? node.height() - delta.height:null
};
Object.assign(restoreStyle, opts);
dialog.css(opts).trigger('resize');
if(dialog.data('hasResizable')&&(dialog.resizable('option', 'maxWidth') < opts.maxWidth||dialog.resizable('option', 'maxHeight') < opts.maxHeight)){
dialog.resizable('option', opts);
}}
},
syncFunc=function(e){
var dialog=e.data;
syncTm&&cancelAnimationFrame(syncTm);
syncTm=requestAnimationFrame(function(){
var opts, offset;
if(syncSize.enabled){
fitSize(dialog);
}});
},
checkEditing=function(){
var cldialog='elfinder-dialog',
dialogs=elfNode.children('.' + cldialog + '.' + fm.res('class', 'editing') + ':visible');
fm[dialogs.length? 'disable':'enable']();
},
propagationEvents={},
syncTm, dialog, elfNode, restoreStyle;
if(fm&&fm.ui){
elfNode=fm.getUI();
}else{
elfNode=this.closest('.elfinder');
if(! fm){
fm=elfNode.elfinder('instance');
}}
if(typeof opts==='string'){
if((dialog=this.closest('.ui-dialog')).length){
if(opts==='open'){
if(dialog.css('display')==='none'){
dialog.trigger('posinit').show().trigger('open').hide();
dialog.fadeIn(120, function(){
fm.trigger('dialogopened', {dialog: dialog});
});
}}else if(opts==='close'||opts==='destroy'){
dialog.stop(true);
if(dialog.is(':visible')||elfNode.is(':hidden')){
dialog.trigger('close');
fm.trigger('dialogclosed', {dialog: dialog});
}
if(opts==='destroy'){
dialog.remove();
fm.trigger('dialogremoved', {dialog: dialog});
}}else if(opts==='toTop'){
dialog.trigger('totop');
fm.trigger('dialogtotoped', {dialog: dialog});
}else if(opts==='posInit'){
dialog.trigger('posinit');
fm.trigger('dialogposinited', {dialog: dialog});
}else if(opts==='tabstopsInit'){
dialog.trigger('tabstopsInit');
fm.trigger('dialogtabstopsinited', {dialog: dialog});
}else if(opts==='checkEditing'){
checkEditing();
}}
return this;
}
opts=Object.assign({}, $.fn.elfinderdialog.defaults, opts);
if(opts.allowMinimize&&opts.allowMinimize==='auto'){
opts.allowMinimize=this.find('textarea,input').length? true:false;
}
opts.openMaximized=opts.allowMinimize&&opts.openMaximized;
if(opts.headerBtnPos&&opts.headerBtnPos==='auto'){
opts.headerBtnPos=platformWin? 'right':'left';
}
if(opts.headerBtnOrder&&opts.headerBtnOrder==='auto'){
opts.headerBtnOrder=platformWin? 'close:maximize:minimize':'close:minimize:maximize';
}
if(opts.modal&&opts.allowMinimize){
opts.allowMinimize=false;
}
if(fm.options.dialogContained){
syncSize.width=syncSize.height=syncSize.enabled=true;
}else{
syncSize.width=(opts.maxWidth==='window');
syncSize.height=(opts.maxHeight==='window');
if(syncSize.width||syncSize.height){
syncSize.enabled=true;
}}
propagationEvents=fm.arrayFlip(opts.propagationEvents, true);
this.filter(':not(.ui-dialog-content)').each(function(){
var self=$(this).addClass('ui-dialog-content ui-widget-content'),
clactive='elfinder-dialog-active',
cldialog='elfinder-dialog',
clnotify='elfinder-dialog-notify',
clhover='ui-state-hover',
cltabstop='elfinder-tabstop',
cl1stfocus='elfinder-focus',
clmodal='elfinder-dialog-modal',
id=parseInt(Math.random()*1000000),
titlebar=$('<div class="ui-dialog-titlebar ui-widget-header ui-corner-top ui-helper-clearfix"><span class="elfinder-dialog-title">'+opts.title+'</span></div>'),
buttonset=$('<div class="ui-dialog-buttonset"/>'),
buttonpane=$('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"/>')
.append(buttonset),
btnWidth=0,
btnCnt=0,
tabstops=$(),
evCover=$('<div style="width:100%;height:100%;position:absolute;top:0px;left:0px;"/>').hide(),
numberToTel=function(){
if(opts.optimizeNumber){
dialog.find('input[type=number]').each(function(){
$(this).attr('inputmode', 'numeric');
$(this).attr('pattern', '[0-9]*');
});
}},
tabstopsInit=function(){
tabstops=dialog.find('.'+cltabstop);
if(tabstops.length){
tabstops.attr('tabindex', '-1');
if(! tabstops.filter('.'+cl1stfocus).length){
buttonset.children('.'+cltabstop+':'+(platformWin? 'first':'last')).addClass(cl1stfocus);
}}
},
tabstopNext=function(cur){
var elms=tabstops.filter(':visible:enabled'),
node=cur? null:elms.filter('.'+cl1stfocus+':first');
if(! node||! node.length){
node=elms.first();
}
if(cur){
$.each(elms, function(i, elm){
if(elm===cur&&elms[i+1]){
node=elms.eq(i+1);
return false;
}});
}
return node;
},
tabstopPrev=function(cur){
var elms=tabstops.filter(':visible:enabled'),
node=elms.last();
$.each(elms, function(i, elm){
if(elm===cur&&elms[i-1]){
node=elms.eq(i-1);
return false;
}});
return node;
},
makeHeaderBtn=function(){
$.each(opts.headerBtnOrder.split(':').reverse(), function(i, v){
headerBtns[v]&&headerBtns[v]();
});
if(platformWin){
titlebar.children('.elfinder-titlebar-button').addClass('elfinder-titlebar-button-right');
}},
headerBtns={
close: function(){
titlebar.prepend($('<span class="ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button"><span class="ui-icon ui-icon-closethick"/></span>')
.on('mousedown', function(e){
e.preventDefault();
e.stopPropagation();
self.elfinderdialog('close');
})
);
},
maximize: function(){
if(opts.allowMaximize){
dialog.on('resize', function(e, data){
var full, elm;
e.preventDefault();
e.stopPropagation();
if(data&&data.maximize){
elm=titlebar.find('.elfinder-titlebar-full');
full=(data.maximize==='on');
elm.children('span.ui-icon')
.toggleClass('ui-icon-plusthick', ! full)
.toggleClass('ui-icon-arrowreturnthick-1-s', full);
if(full){
try {
dialog.hasClass('ui-draggable')&&dialog.draggable('disable');
dialog.hasClass('ui-resizable')&&dialog.resizable('disable');
} catch(e){}
self.css('width', '100%').css('height', dialog.height() - dialog.children('.ui-dialog-titlebar').outerHeight(true) - buttonpane.outerHeight(true));
}else{
self.attr('style', elm.data('style'));
elm.removeData('style');
posCheck();
try {
dialog.hasClass('ui-draggable')&&dialog.draggable('enable');
dialog.hasClass('ui-resizable')&&dialog.resizable('enable');
} catch(e){}}
dialog.trigger('resize', {init: true});
}});
titlebar.prepend($('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-full"><span class="ui-icon ui-icon-plusthick"/></span>')
.on('mousedown', function(e){
var elm=$(this);
e.preventDefault();
e.stopPropagation();
if(!dialog.hasClass('elfinder-maximized')&&typeof elm.data('style')==='undefined'){
self.height(self.height());
elm.data('style', self.attr('style')||'');
}
fm.toggleMaximize(dialog);
typeof(opts.maximize)==='function'&&opts.maximize.call(self[0]);
})
);
}},
minimize: function(){
var btn, mnode, doffset;
if(opts.allowMinimize){
btn=$('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-minimize"><span class="ui-icon ui-icon-minusthick"/></span>')
.on('mousedown', function(e){
var $this=$(this),
tray=fm.getUI('bottomtray'),
dumStyle={ width: 70, height: 24 },
dum=$('<div/>').css(dumStyle).addClass(dialog.get(0).className + ' elfinder-dialog-minimized'),
pos={};
e.preventDefault();
e.stopPropagation();
if(!dialog.data('minimized')){
doffset=dialog.data('minimized', true).position();
mnode=dialog.clone().on('mousedown', function(){
$this.trigger('mousedown');
}).removeClass('ui-draggable ui-resizable elfinder-frontmost');
tray.append(dum);
Object.assign(pos, dum.offset(), dumStyle);
dum.remove();
mnode.height(dialog.height()).children('.ui-dialog-content:first').empty();
fm.toHide(dialog.before(mnode));
mnode.children('.ui-dialog-content:first,.ui-dialog-buttonpane,.ui-resizable-handle').remove();
mnode.find('.elfinder-titlebar-minimize,.elfinder-titlebar-full').remove();
mnode.find('.ui-dialog-titlebar-close').on('mousedown', function(e){
e.stopPropagation();
e.preventDefault();
mnode.remove();
dialog.show();
self.elfinderdialog('close');
});
mnode.animate(pos, function(){
mnode.attr('style', '')
.css({ maxWidth: dialog.width() })
.addClass('elfinder-dialog-minimized')
.appendTo(tray);
checkEditing();
typeof(opts.minimize)==='function'&&opts.minimize.call(self[0]);
});
}else{
dialog.removeData('minimized').before(mnode.css(Object.assign({'position': 'absolute'}, mnode.offset())));
fm.toFront(mnode);
mnode.animate(Object.assign({ width: dialog.width(), height: dialog.height() }, doffset), function(){
dialog.show();
fm.toFront(dialog);
mnode.remove();
posCheck();
checkEditing();
dialog.trigger('resize', {init: true});
typeof(opts.minimize)==='function'&&opts.minimize.call(self[0]);
});
}});
titlebar.on('dblclick', function(e){
$(this).children('.elfinder-titlebar-minimize').trigger('mousedown');
}).prepend(btn);
dialog.on('togleminimize', function(){
btn.trigger('mousedown');
});
}}
},
dialog=$('<div class="ui-front ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog touch-punch '+cldialog+' '+opts.cssClass+'"/>')
.hide()
.append(self)
.appendTo(elfNode)
.draggable({
containment:fm.options.dialogContained? elfNode:null,
handle:'.ui-dialog-titlebar',
start:function(){
evCover.show();
},
drag:function(e, ui){
var top=ui.offset.top,
left=ui.offset.left;
if(top < 0){
ui.position.top=ui.position.top - top;
}
if(left < 0){
ui.position.left=ui.position.left - left;
}
if(fm.options.dialogContained){
ui.position.top < 0&&(ui.position.top=0);
ui.position.left < 0&&(ui.position.left=0);
}},
stop:function(e, ui){
evCover.hide();
dialog.css({height:opts.height});
self.data('draged', true);
}})
.css({
width:opts.width,
height:opts.height,
minWidth:opts.minWidth,
minHeight:opts.minHeight,
maxWidth:opts.maxWidth,
maxHeight:opts.maxHeight
})
.on('touchstart touchmove touchend click dblclick mouseup mouseenter mouseleave mouseout mouseover mousemove', function(e){
!propagationEvents[e.type]&&e.stopPropagation();
})
.on('mousedown', function(e){
!propagationEvents[e.type]&&e.stopPropagation();
requestAnimationFrame(function(){
if(dialog.is(':visible')&&!dialog.hasClass('elfinder-frontmost')){
toFocusNode=$(':focus');
if(!toFocusNode.length){
toFocusNode=void(0);
}
dialog.trigger('totop');
}});
})
.on('open', function(){
dialog.data('margin-y', self.outerHeight(true) - self.height());
if(syncSize.enabled){
if(opts.height&&opts.height!=='auto'){
dialog.trigger('resize', {init: true});
}
if(!syncSize.defaultSize){
syncSize.defaultSize={ width: self.width(), height: self.height() };}
fitSize(dialog);
dialog.trigger('resize').trigger('posinit');
elfNode.on('resize.'+fm.namespace, dialog, syncFunc);
}
if(!dialog.hasClass(clnotify)){
elfNode.children('.'+cldialog+':visible:not(.'+clnotify+')').each(function(){
var d=$(this),
top=parseInt(d.css('top')),
left=parseInt(d.css('left')),
_top=parseInt(dialog.css('top')),
_left=parseInt(dialog.css('left')),
ct=Math.abs(top - _top) < 10,
cl=Math.abs(left - _left) < 10;
if(d[0]!=dialog[0]&&(ct||cl)){
dialog.css({
top:ct ? (top + 10):_top,
left:cl ? (left + 10):_left
});
}});
}
if(dialog.data('modal')){
dialog.addClass(clmodal);
fm.getUI('overlay').elfinderoverlay('show');
}
dialog.trigger('totop');
opts.openMaximized&&fm.toggleMaximize(dialog);
fm.trigger('dialogopen', {dialog: dialog});
typeof(opts.open)=='function'&&$.proxy(opts.open, self[0])();
if(opts.closeOnEscape){
$(document).on('keydown.'+id, function(e){
if(e.keyCode==$.ui.keyCode.ESCAPE&&dialog.hasClass('elfinder-frontmost')){
self.elfinderdialog('close');
}});
}
dialog.hasClass(fm.res('class', 'editing'))&&checkEditing();
})
.on('close', function(e){
var dialogs, dfd;
if(opts.beforeclose&&typeof opts.beforeclose==='function'){
dfd=opts.beforeclose();
if(!dfd||!dfd.promise){
dfd = !dfd? $.Deferred().reject():$.Deferred().resolve();
}}else{
dfd=$.Deferred().resolve();
}
dfd.done(function(){
syncSize.enabled&&elfNode.off('resize.'+fm.namespace, syncFunc);
if(opts.closeOnEscape){
$(document).off('keyup.'+id);
}
if(opts.allowMaximize){
fm.toggleMaximize(dialog, false);
}
fm.toHide(dialog);
dialog.data('modal')&&fm.getUI('overlay').elfinderoverlay('hide');
if(typeof(opts.close)=='function'){
$.proxy(opts.close, self[0])();
}
if(opts.destroyOnClose&&dialog.parent().length){
dialog.hide().remove();
}
dialogs=elfNode.children('.'+cldialog+':visible');
dialog.hasClass(fm.res('class', 'editing'))&&checkEditing();
});
})
.on('totop frontmost', function(){
var s=fm.storage('autoFocusDialog');
dialog.data('focusOnMouseOver', s? (s > 0):fm.options.uiOptions.dialog.focusOnMouseOver);
if(dialog.data('minimized')){
titlebar.children('.elfinder-titlebar-minimize').trigger('mousedown');
}
if(!dialog.data('modal')&&fm.getUI('overlay').is(':visible')){
fm.getUI('overlay').before(dialog);
}else{
fm.toFront(dialog);
}
elfNode.children('.'+cldialog+':not(.'+clmodal+')').removeClass(clactive);
dialog.addClass(clactive);
! fm.UA.Mobile&&(toFocusNode||tabstopNext()).trigger('focus');
toFocusNode=void(0);
})
.on('posinit', function(){
var css=opts.position,
nodeOffset, minTop, minLeft, outerSize, win, winSize, nodeFull;
if(dialog.hasClass('elfinder-maximized')){
return;
}
if(! css&&! dialog.data('resizing')){
nodeFull=elfNode.hasClass('elfinder-fullscreen')||fm.options.enableAlways;
dialog.css(nodeFull? {
maxWidth:'100%',
maxHeight:'100%',
overflow:'auto'
}:restoreStyle);
if(fm.UA.Mobile&&!nodeFull&&dialog.data('rotated')===fm.UA.Rotated){
return;
}
dialog.data('rotated', fm.UA.Rotated);
win=$(window);
nodeOffset=elfNode.offset();
outerSize={
width:dialog.outerWidth(true),
height: dialog.outerHeight(true)
};
outerSize.right=nodeOffset.left + outerSize.width;
outerSize.bottom=nodeOffset.top + outerSize.height;
winSize={
scrLeft: win.scrollLeft(),
scrTop:win.scrollTop(),
width:win.width(),
height:win.height()
};
winSize.right=winSize.scrLeft + winSize.width;
winSize.bottom=winSize.scrTop + winSize.height;
if(fm.options.dialogContained||nodeFull){
minTop=0;
minLeft=0;
}else{
minTop=nodeOffset.top * -1 + winSize.scrTop;
minLeft=nodeOffset.left * -1 + winSize.scrLeft;
}
css={
top:outerSize.height >=winSize.height? minTop:Math.max(minTop, parseInt((elfNode.height() - outerSize.height)/2 - 42)),
left:outerSize.width  >=winSize.width ? minLeft:Math.max(minLeft, parseInt((elfNode.width() - outerSize.width)/2))
};
if(outerSize.right + css.left > winSize.right){
css.left=Math.max(minLeft, winSize.right - outerSize.right);
}
if(outerSize.bottom + css.top > winSize.bottom){
css.top=Math.max(minTop, winSize.bottom - outerSize.bottom);
}}
if(opts.absolute){
css.position='absolute';
}
css&&dialog.css(css);
})
.on('resize', function(e, data){
var oh=0, init=data&&data.init, h, minH;
if((data&&(data.minimize||data.maxmize))||dialog.data('minimized')){
return;
}
e.stopPropagation();
e.preventDefault();
dialog.children('.ui-widget-header,.ui-dialog-buttonpane').each(function(){
oh +=$(this).outerHeight(true);
});
if(!init&&syncSize.enabled&&!e.originalEvent&&!dialog.hasClass('elfinder-maximized')){
h=Math.min(syncSize.defaultSize.height, Math.max(parseInt(dialog.css('max-height')), parseInt(dialog.css('min-height'))) - oh - dialog.data('margin-y'));
}else{
h=dialog.height() - oh - dialog.data('margin-y');
}
self.height(h);
if(init){
return;
}
posCheck();
minH=self.height();
minH=(h < minH)? (minH + oh + dialog.data('margin-y')):opts.minHeight;
dialog.css('min-height', minH);
dialog.data('hasResizable')&&dialog.resizable('option', { minHeight: minH });
if(typeof(opts.resize)==='function'){
$.proxy(opts.resize, self[0])(e, data);
}})
.on('tabstopsInit', tabstopsInit)
.on('focus', '.'+cltabstop, function(){
$(this).addClass(clhover).parent('label').addClass(clhover);
this.id&&$(this).parent().find('label[for='+this.id+']').addClass(clhover);
})
.on('click', 'select.'+cltabstop, function(){
var node=$(this);
node.data('keepFocus')? node.removeData('keepFocus'):node.data('keepFocus', true);
})
.on('blur', '.'+cltabstop, function(){
$(this).removeClass(clhover).removeData('keepFocus').parent('label').removeClass(clhover);
this.id&&$(this).parent().find('label[for='+this.id+']').removeClass(clhover);
})
.on('mouseenter mouseleave', '.'+cltabstop+',label', function(e){
var $this=$(this), labelfor;
if(this.nodeName==='LABEL'){
if(!$this.children('.'+cltabstop).length&&(!(labelfor=$this.attr('for'))||!$('#'+labelfor).hasClass(cltabstop))){
return;
}}
if(opts.btnHoverFocus&&dialog.data('focusOnMouseOver')){
if(e.type==='mouseenter'&&! $(':focus').data('keepFocus')){
$this.trigger('focus');
}}else{
$this.toggleClass(clhover, e.type=='mouseenter');
}})
.on('keydown', '.'+cltabstop, function(e){
var $this=$(this),
esc, move, moveTo;
if($this.is(':focus')){
esc=e.keyCode===$.ui.keyCode.ESCAPE;
if(e.keyCode===$.ui.keyCode.ENTER){
e.preventDefault();
$this.trigger('click');
}else if(((e.keyCode===$.ui.keyCode.TAB)&&e.shiftKey)||e.keyCode===$.ui.keyCode.LEFT||e.keyCode==$.ui.keyCode.UP){
move='prev';
}else if(e.keyCode===$.ui.keyCode.TAB||e.keyCode==$.ui.keyCode.RIGHT||e.keyCode==$.ui.keyCode.DOWN){
move='next';
}
if(move
&&
(
($this.is('textarea')&&!(e.ctrlKey||e.metaKey))
||
($this.is('select,span.ui-slider-handle')&&e.keyCode!==$.ui.keyCode.TAB)
||
($this.is('input:not(:checkbox,:radio)')&&(!(e.ctrlKey||e.metaKey)&&e.keyCode===$.ui.keyCode[move==='prev'? 'LEFT':'RIGHT']))
)
){
e.stopPropagation();
return;
}
if(!esc){
e.stopPropagation();
}else if($this.is('input:not(:checkbox,:radio),textarea')){
if($this.val()!==''){
$this.val('');
e.stopPropagation();
}}
if(move){
e.preventDefault();
(move==='prev'? tabstopPrev:tabstopNext)(this).trigger('focus');
}}
})
.data({modal: opts.modal}),
posCheck=function(){
var node=fm.getUI(),
pos;
if(node.hasClass('elfinder-fullscreen')){
pos=dialog.position();
dialog.css('top', Math.max(Math.min(Math.max(pos.top, 0), node.height() - 100), 0));
dialog.css('left', Math.max(Math.min(Math.max(pos.left, 0), node.width() - 200), 0));
}},
maxSize, toFocusNode;
dialog.prepend(titlebar);
makeHeaderBtn();
$.each(opts.buttons, function(name, cb){
var button=$('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only '
+'elfinder-btncnt-'+(btnCnt++)+' '
+cltabstop
+'"><span class="ui-button-text">'+name+'</span></button>')
.on('click', $.proxy(cb, self[0]));
if(cb._cssClass){
button.addClass(cb._cssClass);
}
if(platformWin){
buttonset.append(button);
}else{
buttonset.prepend(button);
}});
if(buttonset.children().length){
dialog.append(buttonpane);
dialog.show();
buttonpane.find('button').each(function(i, btn){
btnWidth +=$(btn).outerWidth(true);
});
dialog.hide();
btnWidth +=20;
if(dialog.width() < btnWidth){
dialog.width(btnWidth);
}}
dialog.append(evCover);
if(syncSize.enabled){
delta.width=dialog.outerWidth(true) - dialog.width() + ((dialog.outerWidth() - dialog.width()) / 2);
delta.height=dialog.outerHeight(true) - dialog.height() + ((dialog.outerHeight() - dialog.height()) / 2);
}
if(fm.options.dialogContained){
maxSize={
maxWidth: elfNode.width() - delta.width,
maxHeight: elfNode.height() - delta.height
};
opts.maxWidth=opts.maxWidth? Math.min(maxSize.maxWidth, opts.maxWidth):maxSize.maxWidth;
opts.maxHeight=opts.maxHeight? Math.min(maxSize.maxHeight, opts.maxHeight):maxSize.maxHeight;
dialog.css(maxSize);
}
restoreStyle={
maxWidth:dialog.css('max-width'),
maxHeight:dialog.css('max-height'),
overflow:dialog.css('overflow')
};
if(opts.resizable){
dialog.resizable({
minWidth:opts.minWidth,
minHeight:opts.minHeight,
maxWidth:opts.maxWidth,
maxHeight:opts.maxHeight,
start:function(){
evCover.show();
if(dialog.data('resizing')!==true&&dialog.data('resizing')){
clearTimeout(dialog.data('resizing'));
}
dialog.data('resizing', true);
},
stop:function(e, ui){
evCover.hide();
dialog.data('resizing', setTimeout(function(){
dialog.data('resizing', false);
}, 200));
if(syncSize.enabled){
syncSize.defaultSize={ width: self.width(), height: self.height() };}}
}).data('hasResizable', true);
}
numberToTel();
tabstopsInit();
typeof(opts.create)=='function'&&$.proxy(opts.create, this)();
if(opts.autoOpen){
if(opts.open){
requestAnimationFrame(function(){
self.elfinderdialog('open');
});
}else{
self.elfinderdialog('open');
}}
if(opts.resize){
fm.bind('themechange', function(){
setTimeout(function(){
dialog.data('margin-y', self.outerHeight(true) - self.height());
dialog.trigger('resize', {init: true});
}, 300);
});
}});
return this;
};
$.fn.elfinderdialog.defaults={
cssClass:'',
title:'',
modal:false,
resizable:true,
autoOpen:true,
closeOnEscape:true,
destroyOnClose:false,
buttons:{},
btnHoverFocus:true,
position:null,
absolute:false,
width:320,
height:'auto',
minWidth:200,
minHeight:70,
maxWidth:null,
maxHeight:null,
allowMinimize:'auto',
allowMaximize:false,
openMaximized:false,
headerBtnPos:'auto',
headerBtnOrder:'auto',
optimizeNumber:true,
propagationEvents:['mousemove', 'mouseup']
};
$.fn.elfinderfullscreenbutton=function(cmd){
return this.each(function(){
var button=$(this).elfinderbutton(cmd),
icon=button.children('.elfinder-button-icon'),
tm;
cmd.change(function(){
tm&&cancelAnimationFrame(tm);
tm=requestAnimationFrame(function(){
var fullscreen=cmd.value;
icon.addClass('elfinder-button-icon-fullscreen').toggleClass('elfinder-button-icon-unfullscreen', fullscreen);
cmd.className=fullscreen? 'unfullscreen':'';
});
});
});
};
$.fn.elfindernavbar=function(fm, opts){
this.not('.elfinder-navbar').each(function(){
var nav=$(this).hide().addClass('ui-state-default elfinder-navbar'),
parent=nav.css('overflow', 'hidden').parent(),
wz=parent.children('.elfinder-workzone').append(nav),
ltr=fm.direction=='ltr',
delta, deltaW, handle, swipeHandle, autoHide, setWidth, navdock,
setWzRect=function(){
var cwd=fm.getUI('cwd'),
wz=fm.getUI('workzone'),
wzRect=wz.data('rectangle'),
cwdOffset=cwd.offset();
wz.data('rectangle', Object.assign(wzRect, { cwdEdge: (fm.direction==='ltr')? cwdOffset.left:cwdOffset.left + cwd.width() }));
},
setDelta=function(){
nav.css('overflow', 'hidden');
delta=Math.round(nav.outerHeight() - nav.height());
deltaW=Math.round(navdock.outerWidth() - navdock.innerWidth());
nav.css('overflow', 'auto');
};
fm.one('init', function(){
navdock=fm.getUI('navdock');
var set=function(){
setDelta();
fm.bind('wzresize', function(){
var navdockH=0;
navdock.width(nav.outerWidth() - deltaW);
if(navdock.children().length > 1){
navdockH=navdock.outerHeight(true);
}
nav.height(wz.height() - navdockH - delta);
}).trigger('wzresize');
};
if(fm.cssloaded){
set();
}else{
fm.one('cssloaded', set);
}})
.one('opendone',function(){
handle&&handle.trigger('resize');
nav.css('overflow', 'auto');
}).bind('themechange', setDelta);
if(fm.UA.Touch){
autoHide=fm.storage('autoHide')||{};
if(typeof autoHide.navbar==='undefined'){
autoHide.navbar=(opts.autoHideUA&&opts.autoHideUA.length > 0&&$.grep(opts.autoHideUA, function(v){ return fm.UA[v]? true:false; }).length);
fm.storage('autoHide', autoHide);
}
if(autoHide.navbar){
fm.one('init', function(){
if(nav.children().length){
fm.uiAutoHide.push(function(){ nav.stop(true, true).trigger('navhide', { duration: 'slow', init: true });});
}});
}
fm.bind('load', function(){
if(nav.children().length){
swipeHandle=$('<div class="elfinder-navbar-swipe-handle"/>').hide().appendTo(wz);
if(swipeHandle.css('pointer-events')!=='none'){
swipeHandle.remove();
swipeHandle=null;
}}
});
nav.on('navshow navhide', function(e, data){
var mode=(e.type==='navshow')? 'show':'hide',
duration=(data&&data.duration)? data.duration:'fast',
handleW=(data&&data.handleW)? data.handleW:Math.max(50, fm.getUI().width() / 10);
nav.stop(true, true)[mode]({
duration: duration,
step:function(){
fm.trigger('wzresize');
},
complete: function(){
if(swipeHandle){
if(mode==='show'){
swipeHandle.stop(true, true).hide();
}else{
swipeHandle.width(handleW? handleW:'');
fm.resources.blink(swipeHandle, 'slowonce');
}}
fm.trigger('navbar'+ mode);
data.init&&fm.trigger('uiautohide');
setWzRect();
}});
autoHide.navbar=(mode!=='show');
fm.storage('autoHide', Object.assign(fm.storage('autoHide'), {navbar: autoHide.navbar}));
}).on('touchstart', function(e){
if($(this)['scroll' + (fm.direction==='ltr'? 'Right':'Left')]() > 5){
e.originalEvent._preventSwipeX=true;
}});
}
if(! fm.UA.Mobile){
handle=nav.resizable({
handles:ltr ? 'e':'w',
minWidth:opts.minWidth||150,
maxWidth:opts.maxWidth||500,
resize:function(){
fm.trigger('wzresize');
},
stop:function(e, ui){
fm.storage('navbarWidth', ui.size.width);
setWzRect();
}})
.on('resize scroll', function(e){
var $this=$(this),
tm=$this.data('posinit');
e.preventDefault();
e.stopPropagation();
if(! ltr&&e.type==='resize'){
nav.css('left', 0);
}
tm&&cancelAnimationFrame(tm);
$this.data('posinit', requestAnimationFrame(function(){
var offset=(fm.UA.Opera&&nav.scrollLeft())? 20:2;
handle.css('top', 0).css({
top:parseInt(nav.scrollTop())+'px',
left:ltr ? 'auto':parseInt(nav.scrollRight() -  offset) * -1,
right: ltr ? parseInt(nav.scrollLeft() - offset) * -1:'auto'
});
if(e.type==='resize'){
fm.getUI('cwd').trigger('resize');
}}));
})
.children('.ui-resizable-handle').addClass('ui-front');
}
if(setWidth=fm.storage('navbarWidth')){
nav.width(setWidth);
}else{
if(fm.UA.Mobile){
fm.one('cssloaded', function(){
var set=function(){
setWidth=nav.parent().width() / 2;
if(nav.data('defWidth') > setWidth){
nav.width(setWidth);
}else{
nav.width(nav.data('defWidth'));
}
nav.data('width', nav.width());
fm.trigger('wzresize');
};
nav.data('defWidth', nav.width());
$(window).on('resize.' + fm.namespace, set);
set();
});
}}
});
return this;
};
$.fn.elfindernavdock=function(fm, opts){
this.not('.elfinder-navdock').each(function(){
var self=$(this).hide().addClass('ui-state-default elfinder-navdock touch-punch'),
node=self.parent(),
wz=node.children('.elfinder-workzone').append(self),
resize=function(to, h){
var curH=h||self.height(),
diff=to - curH,
len=Object.keys(sizeSyncs).length,
calc=len? diff / len:0,
ovf;
if(diff){
ovf=self.css('overflow');
self.css('overflow', 'hidden');
self.height(to);
$.each(sizeSyncs, function(id, n){
n.height(n.height() + calc).trigger('resize.' + fm.namespace);
});
fm.trigger('wzresize');
self.css('overflow', ovf);
}},
handle=$('<div class="ui-front ui-resizable-handle ui-resizable-n"/>').appendTo(self),
sizeSyncs={},
resizeFn=[],
initMaxHeight=(parseInt(opts.initMaxHeight)||50) / 100,
maxHeight=(parseInt(opts.maxHeight)||90) / 100,
basicHeight, hasNode;
self.data('addNode', function(cNode, opts){
var wzH=fm.getUI('workzone').height(),
imaxH=wzH * initMaxHeight,
curH, tH, mH;
opts=Object.assign({
first: false,
sizeSync: true,
init: false
}, opts);
if(!cNode.attr('id')){
cNode.attr('id', fm.namespace+'-navdock-' + (+new Date()));
}
opts.sizeSync&&(sizeSyncs[cNode.attr('id')]=cNode);
curH=self.height();
tH=curH + cNode.outerHeight(true);
if(opts.first){
handle.after(cNode);
}else{
self.append(cNode);
}
hasNode=true;
self.resizable('enable').height(tH).show();
fm.trigger('wzresize');
if(opts.init){
mH=fm.storage('navdockHeight');
if(mH){
tH=mH;
}else{
tH=tH > imaxH? imaxH:tH;
}
basicHeight=tH;
}
resize(Math.min(tH, wzH * maxHeight));
return self;
}).data('removeNode', function(nodeId, appendTo){
var cNode=$('#'+nodeId);
delete sizeSyncs[nodeId];
self.height(self.height() - $('#'+nodeId).outerHeight(true));
if(appendTo){
if(appendTo==='detach'){
cNode=cNode.detach();
}else{
appendTo.append(cNode);
}}else{
cNode.remove();
}
if(self.children().length <=1){
hasNode=false;
self.resizable('disable').height(0).hide();
}
fm.trigger('wzresize');
return cNode;
});
if(! opts.disabled){
fm.one('init', function(){
var ovf;
if(fm.getUI('navbar').children().not('.ui-resizable-handle').length){
self.data('dockEnabled', true);
self.resizable({
maxHeight: fm.getUI('workzone').height() * maxHeight,
handles: { n: handle },
start: function(e, ui){
ovf=self.css('overflow');
self.css('overflow', 'hidden');
fm.trigger('navdockresizestart', {event: e, ui: ui}, true);
},
resize: function(e, ui){
self.css('top', '');
fm.trigger('wzresize', { inNavdockResize:true });
},
stop: function(e, ui){
fm.trigger('navdockresizestop', {event: e, ui: ui}, true);
self.css('top', '');
basicHeight=ui.size.height;
fm.storage('navdockHeight', basicHeight);
resize(basicHeight, ui.originalSize.height);
self.css('overflow', ovf);
}});
fm.bind('wzresize', function(e){
var minH, maxH, h;
if(self.is(':visible')){
maxH=fm.getUI('workzone').height() * maxHeight;
if(! e.data||! e.data.inNavdockResize){
h=self.height();
if(maxH < basicHeight){
if(Math.abs(h - maxH) > 1){
resize(maxH);
}}else{
if(Math.abs(h - basicHeight) > 1){
resize(basicHeight);
}}
}
self.resizable('option', 'maxHeight', maxH);
}}).bind('themechange', function(){
var oldH=Math.round(self.height());
requestAnimationFrame(function(){
var curH=Math.round(self.height()),
diff=oldH - curH;
if(diff!==0){
resize(self.height(),  curH - diff);
}});
});
}
fm.bind('navbarshow navbarhide', function(e){
self[hasNode&&e.type==='navbarshow'? 'show':'hide']();
});
});
}});
return this;
};
$.fn.elfinderoverlay=function(opts){
var fm=this.parent().elfinder('instance'),
o, cnt, show, hide;
this.filter(':not(.elfinder-overlay)').each(function(){
opts=Object.assign({}, opts);
$(this).addClass('ui-front ui-widget-overlay elfinder-overlay')
.hide()
.on('mousedown', function(e){
e.preventDefault();
e.stopPropagation();
})
.data({
cnt:0,
show:typeof(opts.show)=='function' ? opts.show:function(){ },
hide:typeof(opts.hide)=='function' ? opts.hide:function(){ }});
});
if(opts=='show'){
o=this.eq(0);
cnt=o.data('cnt') + 1;
show=o.data('show');
fm.toFront(o);
o.data('cnt', cnt);
if(o.is(':hidden')){
o.show();
show();
}}
if(opts=='hide'){
o=this.eq(0);
cnt=o.data('cnt') - 1;
hide=o.data('hide');
o.data('cnt', cnt);
if(cnt <=0){
o.hide();
hide();
}}
return this;
};
$.fn.elfinderpanel=function(fm){
return this.each(function(){
var panel=$(this).addClass('elfinder-panel ui-state-default ui-corner-all'),
margin='margin-'+(fm.direction=='ltr' ? 'left':'right');
fm.one('load', function(e){
var navbar=fm.getUI('navbar');
panel.css(margin, parseInt(navbar.outerWidth(true)));
navbar.on('resize', function(e){
e.preventDefault();
e.stopPropagation();
panel.is(':visible')&&panel.css(margin, parseInt(navbar.outerWidth(true)));
});
});
});
};
$.fn.elfinderpath=function(fm, options){
return this.each(function(){
var query='',
target='',
mimes=[],
place='statusbar',
clHover=fm.res('class', 'hover'),
prefix='path' + (elFinder.prototype.uniqueid? elFinder.prototype.uniqueid:'') + '-',
wzbase=$('<div class="ui-widget-header ui-helper-clearfix elfinder-workzone-path"/>'),
path=$(this).addClass('elfinder-path').html('&nbsp;')
.on('mousedown', 'span.elfinder-path-dir', function(e){
var hash=$(this).attr('id').substr(prefix.length);
e.preventDefault();
if(hash!=fm.cwd().hash){
$(this).addClass(clHover);
if(query){
fm.exec('search', query, { target: hash, mime: mimes.join(' ') });
}else{
fm.trigger('select', {selected:[hash]}).exec('open', hash);
}}
})
.prependTo(fm.getUI('statusbar').show()),
roots=$('<div class="elfinder-path-roots"/>').on('click', function(e){
e.stopPropagation();
e.preventDefault();
var roots=$.map(fm.roots, function(h){ return fm.file(h); }),
raw=[];
$.each(roots, function(i, f){
if(! f.phash&&fm.root(fm.cwd().hash, true)!==f.hash){
raw.push({
label:fm.escape(f.i18||f.name),
icon:'home',
callback:function(){ fm.exec('open', f.hash); },
options:{
iconClass:f.csscls||'',
iconImg:f.icon||''
}});
}});
fm.trigger('contextmenu', {
raw: raw,
x: e.pageX,
y: e.pageY
});
}).append('<span class="elfinder-button-icon elfinder-button-icon-menu" />').appendTo(wzbase),
render=function(cwd){
var dirs=[],
names=[];
$.each(fm.parents(cwd), function(i, hash){
var c=(cwd===hash)? 'elfinder-path-dir elfinder-path-cwd':'elfinder-path-dir',
f=fm.file(hash),
name=fm.escape(f.i18||f.name);
names.push(name);
dirs.push('<span id="'+prefix+hash+'" class="'+c+'" title="'+names.join(fm.option('separator'))+'">'+name+'</span>');
});
return dirs.join('<span class="elfinder-path-other">'+fm.option('separator')+'</span>');
},
toWorkzone=function(){
var prev;
path.children('span.elfinder-path-dir').attr('style', '');
prev=fm.direction==='ltr'? $('#'+prefix + fm.cwd().hash).prevAll('span.elfinder-path-dir:first'):$();
path.scrollLeft(prev.length? prev.position().left:0);
},
fit=function(){
if(fm.UA.CSS.flex){
return;
}
var dirs=path.children('span.elfinder-path-dir'),
cnt=dirs.length,
m, bg=0, ids;
if(place==='workzone'||cnt < 2){
dirs.attr('style', '');
return;
}
path.width(path.css('max-width'));
dirs.css({maxWidth: (100/cnt)+'%', display: 'inline-block'});
m=path.width() - 9;
path.children('span.elfinder-path-other').each(function(){
m -=$(this).width();
});
ids=[];
dirs.each(function(i){
var dir=$(this),
w=dir.width();
m -=w;
if(w < this.scrollWidth){
ids.push(i);
}});
path.width('');
if(ids.length){
if(m > 0){
m=m / ids.length;
$.each(ids, function(i, k){
var d=$(dirs[k]);
d.css('max-width', d.width() + m);
});
}
dirs.last().attr('style', '');
}else{
dirs.attr('style', '');
}},
hasUiTree, hasUiStat;
fm.one('init', function(){
hasUiTree=fm.getUI('tree').length;
hasUiStat=fm.getUI('stat').length;
if(! hasUiTree&&options.toWorkzoneWithoutNavbar){
wzbase.append(path).insertBefore(fm.getUI('workzone'));
place='workzone';
fm.bind('open', toWorkzone)
.one('opendone', function(){
fm.getUI().trigger('resize');
});
}})
.bind('open searchend parents', function(){
var dirs=[];
query='';
target='';
mimes=[];
path.html(render(fm.cwd().hash));
if(Object.keys(fm.roots).length > 1){
path.css('margin', '');
roots.show();
}else{
path.css('margin', 0);
roots.hide();
}
!hasUiStat&&fit();
})
.bind('searchstart', function(e){
if(e.data){
query=e.data.query||'';
target=e.data.target||'';
mimes=e.data.mimes||[];
}})
.bind('search', function(e){
var dirs=[],
html='';
if(target){
html=render(target);
}else{
html=fm.i18n('btnAll');
}
path.html('<span class="elfinder-path-other">'+fm.i18n('searcresult') + ': </span>' + html);
fit();
})
.bind('navbarshow navbarhide', function(){
var wz=fm.getUI('workzone');
if(this.type==='navbarshow'){
fm.unbind('open', toWorkzone);
path.prependTo(fm.getUI('statusbar'));
wzbase.detach();
place='statusbar';
}else{
wzbase.append(path).insertBefore(wz);
place='workzone';
toWorkzone();
fm.bind('open', toWorkzone);
}
fm.trigger('uiresize');
})
.bind('resize uistatchange', fit);
});
};
$.fn.elfinderplaces=function(fm, opts){
return this.each(function(){
var dirs={},
c='class',
navdir=fm.res(c, 'navdir'),
collapsed=fm.res(c, 'navcollapse'),
expanded=fm.res(c, 'navexpand'),
hover=fm.res(c, 'hover'),
clroot=fm.res(c, 'treeroot'),
dropover=fm.res(c, 'adroppable'),
tpl=fm.res('tpl', 'placedir'),
ptpl=fm.res('tpl', 'perms'),
spinner=$(fm.res('tpl', 'navspinner')),
suffix=opts.suffix? opts.suffix:'',
key='places' + suffix,
menuTimer=null,
id2hash=function(id){ return id.substr(6);	},
hash2id=function(hash){ return 'place-'+hash; },
hash2elm=function(hash){ return $(document.getElementById(hash2id(hash))); },
save=function(){
var hashes=[], data={};
hashes=$.map(subtree.children().find('[id]'), function(n){
return id2hash(n.id);
});
if(hashes.length){
$.each(hashes.reverse(), function(i, h){
data[h]=dirs[h];
});
}else{
data=null;
}
fm.storage(key, data);
},
init=function(){
var dat, hashes;
key='places'+(opts.suffix? opts.suffix:''),
dirs={};
dat=fm.storage(key);
if(typeof dat==='string'){
dat=$.grep(dat.split(','), function(hash){ return hash? true:false;});
$.each(dat, function(i, d){
var dir=d.split('#');
dirs[dir[0]]=dir[1]? dir[1]:dir[0];
});
}else if($.isPlainObject(dat)){
dirs=dat;
}
/**
* example for preset places
*
* elfinderInstance.bind('placesload', function(e, fm){
*
* 	if(!fm.storage(e.data.storageKey)){
* 		e.data.dirs[targetHash]=fallbackName;
* 	}
* }
**/
fm.trigger('placesload', {dirs: dirs, storageKey: key}, true);
hashes=Object.keys(dirs);
if(hashes.length){
root.prepend(spinner);
fm.request({
data:{cmd:'info', targets:hashes},
preventDefault:true
})
.done(function(data){
var exists={};
data.files&&data.files.length&&fm.cache(data.files);
$.each(data.files, function(i, f){
var hash=f.hash;
exists[hash]=f;
});
$.each(dirs, function(h, f){
add(exists[h]||Object.assign({notfound: true}, f));
});
if(fm.storage('placesState') > 0){
root.trigger('click');
}})
.always(function(){
spinner.remove();
});
}},
create=function(dir, hash){
return $(tpl.replace(/\{id\}/, hash2id(dir? dir.hash:hash))
.replace(/\{name\}/, fm.escape(dir? dir.i18||dir.name:hash))
.replace(/\{cssclass\}/, dir? (fm.perms2class(dir) + (dir.notfound? ' elfinder-na':'') + (dir.csscls? ' '+dir.csscls:'')):'')
.replace(/\{permissions\}/, (dir&&(!dir.read||!dir.write||dir.notfound))? ptpl:'')
.replace(/\{title\}/, dir? (' title="' + fm.escape(fm.path(dir.hash, true)||dir.i18||dir.name) + '"'):'')
.replace(/\{symlink\}/, '')
.replace(/\{style\}/, (dir&&dir.icon)? fm.getIconStyle(dir):''));
},
add=function(dir){
var node, hash;
if(dir.mime!=='directory'){
return false;
}
hash=dir.hash;
if(!fm.files().hasOwnProperty(hash)){
fm.trigger('tree', {tree: [dir]});
}
node=create(dir, hash);
dirs[hash]=dir;
subtree.prepend(node);
root.addClass(collapsed);
sortBtn.toggle(subtree.children().length > 1);
return true;
},
remove=function(hash){
var name=null, tgt, cnt;
if(dirs[hash]){
delete dirs[hash];
tgt=hash2elm(hash);
if(tgt.length){
name=tgt.text();
tgt.parent().remove();
cnt=subtree.children().length;
sortBtn.toggle(cnt > 1);
if(! cnt){
root.removeClass(collapsed);
places.removeClass(expanded);
subtree.slideToggle(false);
}}
}
return name;
},
moveup=function(hash){
var self=hash2elm(hash),
tgt=self.parent(),
prev=tgt.prev('div'),
cls='ui-state-hover',
ctm=fm.getUI('contextmenu');
menuTimer&&clearTimeout(menuTimer);
if(prev.length){
ctm.find(':first').data('placesHash', hash);
self.addClass(cls);
tgt.insertBefore(prev);
prev=tgt.prev('div');
menuTimer=setTimeout(function(){
self.removeClass(cls);
if(ctm.find(':first').data('placesHash')===hash){
ctm.hide().empty();
}}, 1500);
}
if(!prev.length){
self.removeClass(cls);
ctm.hide().empty();
}},
update=function(dir, preHash){
var hash=dir.hash,
tgt=hash2elm(preHash||hash),
node=create(dir, hash);
if(tgt.length > 0){
tgt.parent().replaceWith(node);
dirs[hash]=dir;
return true;
}else{
return false;
}},
clear=function(){
subtree.empty();
root.removeClass(collapsed);
places.removeClass(expanded);
subtree.slideToggle(false);
},
sort=function(){
$.each(dirs, function(h, f){
var dir=fm.file(h)||f,
node=create(dir, h),
ret=null;
if(!dir){
node.hide();
}
if(subtree.children().length){
$.each(subtree.children(), function(){
var current=$(this);
if((dir.i18||dir.name).localeCompare(current.children('.'+navdir).text()) < 0){
ret = !node.insertBefore(current);
return ret;
}});
if(ret!==null){
return true;
}}
!hash2elm(h).length&&subtree.append(node);
});
save();
},
sortBtn=$('<span class="elfinder-button-icon elfinder-button-icon-sort elfinder-places-root-icon" title="'+fm.i18n('cmdsort')+'"/>')
.hide()
.on('click', function(e){
e.stopPropagation();
subtree.empty();
sort();
}
),
wrapper=create({
hash:'root-'+fm.namespace,
name:fm.i18n(opts.name, 'places'),
read:true,
write:true
}),
root=wrapper.children('.'+navdir)
.addClass(clroot)
.on('click', function(e){
e.stopPropagation();
if(root.hasClass(collapsed)){
places.toggleClass(expanded);
subtree.slideToggle();
fm.storage('placesState', places.hasClass(expanded)? 1:0);
}})
.append(sortBtn),
subtree=wrapper.children('.'+fm.res(c, 'navsubtree')),
places=$(this).addClass(fm.res(c, 'tree')+' elfinder-places ui-corner-all')
.hide()
.append(wrapper)
.appendTo(fm.getUI('navbar'))
.on('mouseenter mouseleave', '.'+navdir, function(e){
$(this).toggleClass('ui-state-hover', (e.type=='mouseenter'));
})
.on('click', '.'+navdir, function(e){
var p=$(this);
if(p.data('longtap')){
e.stopPropagation();
return;
}
! p.hasClass('elfinder-na')&&fm.exec('open', p.attr('id').substr(6));
})
.on('contextmenu', '.'+navdir+':not(.'+clroot+')', function(e){
var self=$(this),
hash=self.attr('id').substr(6);
e.preventDefault();
fm.trigger('contextmenu', {
raw:[{
label:fm.i18n('moveUp'),
icon:'up',
remain:true,
callback:function(){ moveup(hash); save(); }},'|',{
label:fm.i18n('rmFromPlaces'),
icon:'rm',
callback:function(){ remove(hash); save(); }}],
'x':e.pageX,
'y':e.pageY
});
self.addClass('ui-state-hover');
fm.getUI('contextmenu').children().on('mouseenter', function(){
self.addClass('ui-state-hover');
});
fm.bind('closecontextmenu', function(){
self.removeClass('ui-state-hover');
});
})
.droppable({
tolerance:'pointer',
accept:'.elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file',
hoverClass:fm.res('class', 'adroppable'),
classes:{
'ui-droppable-hover': fm.res('class', 'adroppable')
},
over:function(e, ui){
var helper=ui.helper,
dir=$.grep(helper.data('files'), function(h){ return (fm.file(h).mime==='directory'&&!dirs[h])? true:false; });
e.stopPropagation();
helper.data('dropover', helper.data('dropover') + 1);
if(fm.insideWorkzone(e.pageX, e.pageY)){
if(dir.length > 0){
helper.addClass('elfinder-drag-helper-plus');
fm.trigger('unlockfiles', {files:helper.data('files'), helper: helper});
}else{
$(this).removeClass(dropover);
}}
},
out:function(e, ui){
var helper=ui.helper;
e.stopPropagation();
helper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus').data('dropover', Math.max(helper.data('dropover') - 1, 0));
$(this).removeData('dropover')
.removeClass(dropover);
},
drop:function(e, ui){
var helper=ui.helper,
resolve=true;
$.each(helper.data('files'), function(i, hash){
var dir=fm.file(hash);
if(dir&&dir.mime=='directory'&&!dirs[dir.hash]){
add(dir);
}else{
resolve=false;
}});
save();
resolve&&helper.hide();
}})
.on('touchstart', '.'+navdir+':not(.'+clroot+')', function(e){
if(e.originalEvent.touches.length > 1){
return;
}
var hash=$(this).attr('id').substr(6),
p=$(this)
.addClass(hover)
.data('longtap', null)
.data('tmlongtap', setTimeout(function(){
p.data('longtap', true);
fm.trigger('contextmenu', {
raw:[{
label:fm.i18n('rmFromPlaces'),
icon:'rm',
callback:function(){ remove(hash); save(); }}],
'x':e.originalEvent.touches[0].pageX,
'y':e.originalEvent.touches[0].pageY
});
}, 500));
})
.on('touchmove touchend', '.'+navdir+':not(.'+clroot+')', function(e){
clearTimeout($(this).data('tmlongtap'));
if(e.type=='touchmove'){
$(this).removeClass(hover);
}});
if($.fn.sortable){
subtree.addClass('touch-punch')
.sortable({
appendTo:fm.getUI(),
revert:false,
helper:function(e){
var dir=$(e.target).parent();
dir.children().removeClass('ui-state-hover');
return $('<div class="ui-widget elfinder-place-drag elfinder-'+fm.direction+'"/>')
.append($('<div class="elfinder-navbar"/>').show().append(dir.clone()));
},
stop:function(e, ui){
var target=$(ui.item[0]),
top=places.offset().top,
left=places.offset().left,
width=places.width(),
height=places.height(),
x=e.pageX,
y=e.pageY;
if(!(x > left&&x < left+width&&y > top&&y < y+height)){
remove(id2hash(target.children(':first').attr('id')));
save();
}},
update:function(e, ui){
save();
}});
}
$(this).on('regist', function(e, files){
var added=false;
$.each(files, function(i, dir){
if(dir&&dir.mime=='directory'&&!dirs[dir.hash]){
if(add(dir)){
added=true;
}}
});
added&&save();
});
fm.one('load', function(){
var dat, hashes;
if(fm.oldAPI){
return;
}
places.show().parent().show();
init();
fm.change(function(e){
var changed=false;
$.each(e.data.changed, function(i, file){
if(dirs[file.hash]){
if(file.mime!=='directory'){
if(remove(file.hash)){
changed=true;
}}else{
if(update(file)){
changed=true;
}}
}});
changed&&save();
})
.bind('rename', function(e){
var changed=false;
if(e.data.removed){
$.each(e.data.removed, function(i, hash){
if(e.data.added[i]){
if(update(e.data.added[i], hash)){
changed=true;
}}
});
}
changed&&save();
})
.bind('rm paste', function(e){
var names=[],
changed=false;
if(e.data.removed){
$.each(e.data.removed, function(i, hash){
var name=remove(hash);
name&&names.push(name);
});
}
if(names.length){
changed=true;
}
if(e.data.added&&names.length){
$.each(e.data.added, function(i, file){
if($.inArray(file.name, names)!==1){
file.mime=='directory'&&add(file);
}});
}
changed&&save();
})
.bind('sync netmount', function(){
var ev=this,
opSuffix=opts.suffix? opts.suffix:'',
hashes;
if(ev.type==='sync'){
if(suffix!==opSuffix){
suffix=opSuffix;
clear();
init();
return;
}}
hashes=Object.keys(dirs);
if(hashes.length){
root.prepend(spinner);
fm.request({
data:{cmd:'info', targets:hashes},
preventDefault:true
})
.done(function(data){
var exists={},
updated=false,
cwd=fm.cwd().hash;
$.each(data.files||[], function(i, file){
var hash=file.hash;
exists[hash]=file;
if(!fm.files().hasOwnProperty(file.hash)){
fm.trigger('tree', {tree: [file]});
}});
$.each(dirs, function(h, f){
if(f.notfound===Boolean(exists[h])){
if((f.phash===cwd&&ev.type!=='netmount')||(exists[h]&&exists[h].mime!=='directory')){
if(remove(h)){
updated=true;
}}else{
if(update(exists[h]||Object.assign({notfound: true}, f))){
updated=true;
}}
}else if(exists[h]&&exists[h].phash!=cwd){
update(exists[h]);
}});
updated&&save();
})
.always(function(){
spinner.remove();
});
}});
});
});
};
$.fn.elfindersearchbutton=function(cmd){
return this.each(function(){
var result=false,
fm=cmd.fm,
disabled=fm.res('class', 'disabled'),
isopts=cmd.options.incsearch||{ enable: false },
sTypes=cmd.options.searchTypes,
id=function(name){return fm.namespace + fm.escape(name);},
toolbar=fm.getUI('toolbar'),
btnCls=fm.res('class', 'searchbtn'),
button=$(this)
.hide()
.addClass('ui-widget-content elfinder-button '+btnCls)
.on('click', function(e){
e.stopPropagation();
}),
getMenuOffset=function(){
var fmNode=fm.getUI(),
baseOffset=fmNode.offset(),
buttonOffset=button.offset();
return {
top:buttonOffset.top - baseOffset.top,
maxHeight:fmNode.height() - 40
};},
search=function(){
input.data('inctm')&&clearTimeout(input.data('inctm'));
var val=$.trim(input.val()),
from = !$('#' + id('SearchFromAll')).prop('checked'),
mime=$('#' + id('SearchMime')).prop('checked'),
type='';
if(from){
if($('#' + id('SearchFromVol')).prop('checked')){
from=fm.root(fm.cwd().hash);
}else{
from=fm.cwd().hash;
}}
if(mime){
mime=val;
val='.';
}
if(typeSet){
type=typeSet.children('input:checked').val();
}
if(val){
input.trigger('focus');
cmd.exec(val, from, mime, type).done(function(){
result=true;
}).fail(function(){
abort();
});
}else{
fm.trigger('searchend');
}},
abort=function(){
input.data('inctm')&&clearTimeout(input.data('inctm'));
input.val('').trigger('blur');
if(result||incVal){
result=false;
incVal='';
fm.lazy(function(){
fm.trigger('searchend');
});
}},
incVal='',
input=$('<input type="text" size="42"/>')
.on('focus', function(){
!button.hasClass('ui-state-active')&&fm.getUI().click();
inFocus=true;
incVal='';
button.addClass('ui-state-active');
fm.trigger('uiresize');
opts&&opts.css(getMenuOffset()).slideDown(function(){
button.addClass('ui-state-active');
fm.toFront(opts);
});
})
.on('blur', function(){
inFocus=false;
if(opts){
if(!opts.data('infocus')){
opts.slideUp(function(){
button.removeClass('ui-state-active');
fm.trigger('uiresize');
fm.toHide(opts);
});
}else{
opts.data('infocus', false);
}}else{
button.removeClass('ui-state-active');
}})
.appendTo(button)
.on('keypress', function(e){
e.stopPropagation();
})
.on('keydown', function(e){
e.stopPropagation();
if(e.keyCode===$.ui.keyCode.ENTER){
search();
}else if(e.keyCode===$.ui.keyCode.ESCAPE){
e.preventDefault();
abort();
}}),
opts, typeSet, cwdReady, inFocus;
if(isopts.enable){
isopts.minlen=isopts.minlen||2;
isopts.wait=isopts.wait||500;
input
.attr('title', fm.i18n('incSearchOnly')).attr("placeholder", fm.i18n('cmdSearchPh'))
.on('compositionstart', function(){
input.data('composing', true);
})
.on('compositionend', function(){
input.removeData('composing');
input.trigger('input');
})
.on('input', function(){
if(! input.data('composing')){
input.data('inctm')&&clearTimeout(input.data('inctm'));
input.data('inctm', setTimeout(function(){
var val=input.val();
if(val.length===0||val.length >=isopts.minlen){
(incVal!==val)&&fm.trigger('incsearchstart', { query: val });
incVal=val;
if(val===''&&fm.searchStatus.state > 1&&fm.searchStatus.query){
input.val(fm.searchStatus.query).trigger('select');
}}
}, isopts.wait));
}});
if(fm.UA.ltIE8){
input.on('keydown', function(e){
if(e.keyCode===229){
input.data('imetm')&&clearTimeout(input.data('imetm'));
input.data('composing', true);
input.data('imetm', setTimeout(function(){
input.removeData('composing');
}, 100));
}})
.on('keyup', function(e){
input.data('imetm')&&clearTimeout(input.data('imetm'));
if(input.data('composing')){
e.keyCode===$.ui.keyCode.ENTER&&input.trigger('compositionend');
}else{
input.trigger('input');
}});
}}
$('<span class="ui-icon ui-icon-search" title="'+cmd.title+'"/>')
.appendTo(button)
.on('mousedown', function(e){
e.stopPropagation();
e.preventDefault();
if(button.hasClass('ui-state-active')){
search();
}else{
input.trigger('focus');
}});
$('<span class="ui-icon ui-icon-close"/>')
.appendTo(button)
.on('mousedown', function(e){
e.stopPropagation();
e.preventDefault();
if(input.val()===''&&!button.hasClass('ui-state-active')){
input.trigger('focus');
}else{
abort();
}});
fm.bind('toolbarload', function(){
var parent=button.parent();
if(parent.length){
toolbar.prepend(button.show());
parent.remove();
if(fm.UA.ltIE7){
var icon=button.children(fm.direction=='ltr' ? '.ui-icon-close':'.ui-icon-search');
icon.css({
right:'',
left:parseInt(button.width())-icon.outerWidth(true)
});
}}
});
fm
.one('init', function(){
fm.getUI('cwd').on('touchstart click', function(){
inFocus&&input.trigger('blur');
});
})
.one('open', function(){
opts=(fm.api < 2.1)? null:$('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-search-menu ui-corner-all"/>')
.append($('<div class="buttonset"/>')
.append($('<input id="'+id('SearchFromCwd')+'" name="serchfrom" type="radio" checked="checked"/><label for="'+id('SearchFromCwd')+'">'+fm.i18n('btnCwd')+'</label>'),
$('<input id="'+id('SearchFromVol')+'" name="serchfrom" type="radio"/><label for="'+id('SearchFromVol')+'">'+fm.i18n('btnVolume')+'</label>'),
$('<input id="'+id('SearchFromAll')+'" name="serchfrom" type="radio"/><label for="'+id('SearchFromAll')+'">'+fm.i18n('btnAll')+'</label>')
),
$('<div class="buttonset elfinder-search-type"/>')
.append($('<input id="'+id('SearchName')+'" name="serchcol" type="radio" checked="checked" value="SearchName"/><label for="'+id('SearchName')+'">'+fm.i18n('btnFileName')+'</label>')
)
)
.hide()
.appendTo(fm.getUI());
if(opts){
if(sTypes){
typeSet=opts.find('.elfinder-search-type');
$.each(cmd.options.searchTypes, function(i, v){
typeSet.append($('<input id="'+id(i)+'" name="serchcol" type="radio" value="'+fm.escape(i)+'"/><label for="'+id(i)+'">'+fm.i18n(v.name)+'</label>'));
});
}
opts.find('div.buttonset').buttonset();
$('#'+id('SearchFromAll')).next('label').attr('title', fm.i18n('searchTarget', fm.i18n('btnAll')));
if(sTypes){
$.each(sTypes, function(i, v){
if(v.title){
$('#'+id(i)).next('label').attr('title', fm.i18n(v.title));
}});
}
opts.on('mousedown', 'div.buttonset', function(e){
e.stopPropagation();
opts.data('infocus', true);
})
.on('click', 'input', function(e){
e.stopPropagation();
$.trim(input.val())? search():input.trigger('focus');
})
.on('close', function(){
input.trigger('blur');
});
}})
.bind('searchend', function(){
input.val('');
})
.bind('open parents', function(){
var dirs=[],
volroot=fm.file(fm.root(fm.cwd().hash));
if(volroot){
$.each(fm.parents(fm.cwd().hash), function(i, hash){
dirs.push(fm.file(hash).name);
});
$('#'+id('SearchFromCwd')).next('label').attr('title', fm.i18n('searchTarget', dirs.join(fm.option('separator'))));
$('#'+id('SearchFromVol')).next('label').attr('title', fm.i18n('searchTarget', volroot.name));
}})
.bind('open', function(){
incVal&&abort();
})
.bind('cwdinit', function(){
cwdReady=false;
})
.bind('cwdrender',function(){
cwdReady=true;
})
.bind('keydownEsc', function(){
if(incVal&&incVal.substr(0, 1)==='/'){
incVal='';
input.val('');
fm.trigger('searchend');
}})
.shortcut({
pattern:'ctrl+f f3',
description:cmd.title,
callback:function(){
input.trigger('select').trigger('focus');
}})
.shortcut({
pattern:'a b c d e f g h i j k l m n o p q r s t u v w x y z dig0 dig1 dig2 dig3 dig4 dig5 dig6 dig7 dig8 dig9 num0 num1 num2 num3 num4 num5 num6 num7 num8 num9',
description:fm.i18n('firstLetterSearch'),
callback:function(e){
if(! cwdReady){ return; }
var code=e.originalEvent.keyCode,
next=function(){
var sel=fm.selected(),
key=$.ui.keyCode[(!sel.length||fm.cwdHash2Elm(sel[0]).next('[id]').length)? 'RIGHT':'HOME'];
$(document).trigger($.Event('keydown', { keyCode: key, ctrlKey:false, shiftKey:false, altKey:false, metaKey:false }));
},
val;
if(code >=96&&code <=105){
code -=48;
}
val='/' + String.fromCharCode(code);
if(incVal!==val){
input.val(val);
incVal=val;
fm
.trigger('incsearchstart', { query: val })
.one('cwdrender', next);
}else{
next();
}}
});
});
};
$.fn.elfindersortbutton=function(cmd){
return this.each(function(){
var fm=cmd.fm,
name=cmd.name,
c='class',
disabled=fm.res(c, 'disabled'),
hover=fm.res(c, 'hover'),
item='elfinder-button-menu-item',
selected=item+'-selected',
asc=selected+'-asc',
desc=selected+'-desc',
text=$('<span class="elfinder-button-text">'+cmd.title+'</span>'),
button=$(this).addClass('ui-state-default elfinder-button elfinder-menubutton elfiner-button-'+name)
.attr('title', cmd.title)
.append('<span class="elfinder-button-icon elfinder-button-icon-'+name+'"/>', text)
.on('mouseenter mouseleave', function(e){ !button.hasClass(disabled)&&button.toggleClass(hover, e.type==='mouseenter'); })
.on('click', function(e){
if(!button.hasClass(disabled)){
e.stopPropagation();
menu.is(':hidden')&&fm.getUI().click();
menu.css(getMenuOffset()).slideToggle({
duration: 100,
done: function(e){
fm[menu.is(':visible')? 'toFront':'toHide'](menu);
}});
}}),
hide=function(){ fm.toHide(menu); },
menu=$('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-sort-menu ui-corner-all"/>')
.hide()
.appendTo(fm.getUI())
.on('mouseenter mouseleave', '.'+item, function(e){ $(this).toggleClass(hover, e.type==='mouseenter'); })
.on('click', function(e){
e.preventDefault();
e.stopPropagation();
})
.on('close', hide),
update=function(){
menu.children('[rel]').removeClass(selected+' '+asc+' '+desc)
.filter('[rel="'+fm.sortType+'"]')
.addClass(selected+' '+(fm.sortOrder=='asc' ? asc:desc));
menu.children('.elfinder-sort-stick').toggleClass(selected, fm.sortStickFolders);
menu.children('.elfinder-sort-tree').toggleClass(selected, fm.sortAlsoTreeview);
},
getMenuOffset=function(){
var baseOffset=fm.getUI().offset(),
buttonOffset=button.offset();
return {
top:buttonOffset.top - baseOffset.top,
left:buttonOffset.left - baseOffset.left
};},
tm;
text.hide();
$.each(fm.sortRules, function(name, value){
menu.append($('<div class="'+item+'" rel="'+name+'"><span class="ui-icon ui-icon-arrowthick-1-n"/><span class="ui-icon ui-icon-arrowthick-1-s"/>'+fm.i18n('sort'+name)+'</div>').data('type', name));
});
menu.children().on('click', function(e){
cmd.exec([], $(this).removeClass(hover).attr('rel'));
});
$('<div class="'+item+' '+item+'-separated elfinder-sort-ext elfinder-sort-stick"><span class="ui-icon ui-icon-check"/>'+fm.i18n('sortFoldersFirst')+'</div>')
.appendTo(menu)
.on('click', function(){
cmd.exec([], 'stick');
});
fm.one('init', function(){
if(fm.ui.tree&&fm.options.sortAlsoTreeview!==null){
$('<div class="'+item+' '+item+'-separated elfinder-sort-ext elfinder-sort-tree"><span class="ui-icon ui-icon-check"/>'+fm.i18n('sortAlsoTreeview')+'</div>')
.appendTo(menu)
.on('click', function(){
cmd.exec([], 'tree');
});
}})
.bind('disable select', hide)
.bind('sortchange', update).getUI().on('click', hide);
if(menu.children().length > 1){
cmd.change(function(){
tm&&cancelAnimationFrame(tm);
tm=requestAnimationFrame(function(){
button.toggleClass(disabled, cmd.disabled());
update();
});
})
.change();
}else{
button.addClass(disabled);
}});
};
$.fn.elfinderstat=function(fm){
return this.each(function(){
var size=$(this).addClass('elfinder-stat-size'),
sel=$('<div class="elfinder-stat-selected"/>')
.on('click', 'a', function(e){
var hash=$(this).data('hash');
e.preventDefault();
fm.exec('opendir', [ hash ]);
}),
titleitems=fm.i18n('items'),
titlesel=fm.i18n('selected'),
titlesize=fm.i18n('size'),
setstat=function(files){
var c=0,
s=0,
cwd=fm.cwd(),
calc=true,
hasSize=true;
if(cwd.sizeInfo||cwd.size){
s=cwd.size;
calc=false;
}
$.each(files, function(i, file){
c++;
if(calc){
s +=parseInt(file.size)||0;
if(hasSize===true&&file.mime==='directory'&&!file.sizeInfo){
hasSize=false;
}}
});
size.html(titleitems+': <span class="elfinder-stat-incsearch"></span>'+c+',&nbsp;<span class="elfinder-stat-size'+(hasSize? ' elfinder-stat-size-recursive':'')+'">'+fm.i18n(hasSize? 'sum':'size')+': '+fm.formatSize(s)+'</span>')
.attr('title', size.text());
fm.trigger('uistatchange');
},
setIncsearchStat=function(data){
size.find('span.elfinder-stat-incsearch').html(data? data.hashes.length + ' / ':'');
size.attr('title', size.text());
fm.trigger('uistatchange');
},
setSelect=function(files){
var s=0,
c=0,
dirs=[],
path, file;
if(files.length===1){
file=files[0];
s=file.size;
if(fm.searchStatus.state===2){
path=fm.escape(file.path? file.path.replace(/\/[^\/]*$/, ''):'..');
dirs.push('<a href="#elf_'+file.phash+'" data-hash="'+file.hash+'" title="'+path+'">'+path+'</a>');
}
dirs.push(fm.escape(file.i18||file.name));
sel.html(dirs.join('/') + (s > 0 ? ', '+fm.formatSize(s):''));
}else if(files.length){
$.each(files, function(i, file){
c++;
s +=parseInt(file.size)||0;
});
sel.html(c ? titlesel+': '+c+', '+titlesize+': '+fm.formatSize(s):'&nbsp;');
}else{
sel.html('');
}
sel.attr('title', sel.text());
fm.trigger('uistatchange');
};
fm.getUI('statusbar').prepend(size).append(sel).show();
if(fm.UA.Mobile&&$.fn.tooltip){
fm.getUI('statusbar').tooltip({
classes: {
'ui-tooltip': 'elfinder-ui-tooltip ui-widget-shadow'
},
tooltipClass: 'elfinder-ui-tooltip ui-widget-shadow',
track: true
});
}
fm
.bind('cwdhasheschange', function(e){
setstat($.map(e.data, function(h){ return fm.file(h); }));
})
.change(function(e){
var files=e.data.changed||[],
cwdHash=fm.cwd().hash;
$.each(files, function(){
if(this.hash===cwdHash){
if(this.size){
size.children('.elfinder-stat-size').addClass('elfinder-stat-size-recursive').html(fm.i18n('sum')+': '+fm.formatSize(this.size));
size.attr('title', size.text());
}
return false;
}});
})
.select(function(){
setSelect(fm.selectedFiles());
})
.bind('open', function(){
setSelect([]);
})
.bind('incsearch', function(e){
setIncsearchStat(e.data);
})
.bind('incsearchend', function(){
setIncsearchStat();
})
;
});
};
$.fn.elfindertoast=function(opts, fm){
var defOpts=Object.assign({
mode: 'success',
msg: '',
showMethod: 'fadeIn',
showDuration: 300,
showEasing: 'swing',
onShown: undefined,
hideMethod: 'fadeOut',
hideDuration: 1500,
hideEasing: 'swing',
onHidden: undefined,
timeOut: 3000,
extNode: undefined,
button: undefined,
width: undefined
}, $.isPlainObject(fm.options.uiOptions.toast.defaults)? fm.options.uiOptions.toast.defaults:{});
return this.each(function(){
opts=Object.assign({}, defOpts, opts||{});
var self=$(this),
show=function(notm){
self.stop();
fm.toFront(self);
self[opts.showMethod]({
duration: opts.showDuration,
easing: opts.showEasing,
complete: function(){
opts.onShown&&opts.onShown();
if(!notm&&opts.timeOut){
rmTm=setTimeout(rm, opts.timeOut);
}}
});
},
rm=function(){
self[opts.hideMethod]({
duration: opts.hideDuration,
easing: opts.hideEasing,
complete: function(){
opts.onHidden&&opts.onHidden();
self.remove();
}});
},
rmTm;
self.on('click', function(e){
e.stopPropagation();
e.preventDefault();
rmTm&&clearTimeout(rmTm);
opts.onHidden&&opts.onHidden();
self.stop().remove();
}).on('mouseenter mouseleave', function(e){
if(opts.timeOut){
rmTm&&clearTimeout(rmTm);
rmTm=null;
if(e.type==='mouseenter'){
show(true);
}else{
rmTm=setTimeout(rm, opts.timeOut);
}}
}).hide().addClass('toast-' + opts.mode).append($('<div class="elfinder-toast-msg"/>').html(opts.msg.replace(/%([a-zA-Z0-9]+)%/g, function(m, m1){
return fm.i18n(m1);
})));
if(opts.extNode){
self.append(opts.extNode);
}
if(opts.button){
self.append($('<button class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"/>')
.append($('<span class="ui-button-text"/>').text(fm.i18n(opts.button.text)))
.on('mouseenter mouseleave', function(e){
$(this).toggleClass('ui-state-hover', e.type=='mouseenter');
})
.on('click', opts.button.click||function(){})
);
}
if(opts.width){
self.css('max-width', opts.width);
}
show();
});
};
$.fn.elfindertoolbar=function(fm, opts){
this.not('.elfinder-toolbar').each(function(){
var commands=fm._commands,
self=$(this).addClass('ui-helper-clearfix ui-widget-header elfinder-toolbar'),
options={
displayTextLabel: false,
labelExcludeUA: ['Mobile'],
autoHideUA: ['Mobile'],
showPreferenceButton: 'none'
},
filter=function(opts){
return $.grep(opts, function(v){
if($.isPlainObject(v)){
options=Object.assign(options, v);
return false;
}
return true;
});
},
render=function(disabled){
var name,cmdPref;
$.each(buttons, function(i, b){ b.detach(); });
self.empty();
l=panels.length;
while (l--){
if(panels[l]){
panel=$('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>');
i=panels[l].length;
while (i--){
name=panels[l][i];
if((!disabled||!disabled[name])&&(cmd=commands[name])){
button='elfinder'+cmd.options.ui;
if(! buttons[name]&&$.fn[button]){
buttons[name]=$('<div/>')[button](cmd);
}
if(buttons[name]){
buttons[name].children('.elfinder-button-text')[textLabel? 'show':'hide']();
panel.prepend(buttons[name]);
}}
}
panel.children().length&&self.prepend(panel);
panel.children(':gt(0)').before('<span class="ui-widget-content elfinder-toolbar-button-separator"/>');
}}
if(cmdPref=commands['preference']){
if(options.showPreferenceButton==='always'||(!self.children().length&&options.showPreferenceButton==='auto')){
panel=$('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>');
name='preference';
button='elfinder'+cmd.options.ui;
buttons[name]=$('<div/>')[button](cmdPref);
buttons[name].children('.elfinder-button-text')[textLabel? 'show':'hide']();
panel.prepend(buttons[name]);
self.append(panel);
}}
(! self.data('swipeClose')&&self.children().length)? self.show():self.hide();
prevHeight=self[0].clientHeight;
fm.trigger('toolbarload').trigger('uiresize');
},
buttons={},
panels=filter(opts||[]),
dispre=null,
uiCmdMapPrev='',
prevHeight=0,
contextRaw=[],
l, i, cmd, panel, button, swipeHandle, autoHide, textLabel, resizeTm;
options.showPreferenceButton=options.showPreferenceButton.toLowerCase();
if(options.displayTextLabel!=='none'){
textLabel=fm.storage('toolbarTextLabel');
if(textLabel===null){
textLabel=(options.displayTextLabel&&(! options.labelExcludeUA||! options.labelExcludeUA.length||! $.grep(options.labelExcludeUA, function(v){ return fm.UA[v]? true:false; }).length));
}else{
textLabel=(textLabel==1);
}
contextRaw.push({
label:fm.i18n('textLabel'),
icon:'text',
callback:function(){
textLabel = ! textLabel;
self.css('height', '').find('.elfinder-button-text')[textLabel? 'show':'hide']();
fm.trigger('uiresize').storage('toolbarTextLabel', textLabel? '1':'0');
},
});
}
if(options.preferenceInContextmenu&&commands['preference']){
contextRaw.push({
label:fm.i18n('toolbarPref'),
icon:'preference',
callback:function(){
fm.exec('preference', void(0), {tab: 'toolbar'});
}});
}
if(contextRaw.length){
self.on('contextmenu', function(e){
e.stopPropagation();
e.preventDefault();
fm.trigger('contextmenu', {
raw: contextRaw,
x: e.pageX,
y: e.pageY
});
}).on('touchstart', function(e){
if(e.originalEvent.touches.length > 1){
return;
}
self.data('tmlongtap')&&clearTimeout(self.data('tmlongtap'));
self.removeData('longtap')
.data('longtap', {x: e.originalEvent.touches[0].pageX, y: e.originalEvent.touches[0].pageY})
.data('tmlongtap', setTimeout(function(){
self.removeData('longtapTm')
.trigger({
type: 'contextmenu',
pageX: self.data('longtap').x,
pageY: self.data('longtap').y
})
.data('longtap', {longtap: true});
}, 500));
}).on('touchmove touchend', function(e){
if(self.data('tmlongtap')){
if(e.type==='touchend' ||
(Math.abs(self.data('longtap').x - e.originalEvent.touches[0].pageX)
+ Math.abs(self.data('longtap').y - e.originalEvent.touches[0].pageY)) > 4)
clearTimeout(self.data('tmlongtap'));
self.removeData('longtapTm');
}}).on('click', function(e){
if(self.data('longtap')&&self.data('longtap').longtap){
e.stopImmediatePropagation();
e.preventDefault();
}}).on('touchend click', '.elfinder-button', function(e){
if(self.data('longtap')&&self.data('longtap').longtap){
e.stopImmediatePropagation();
e.preventDefault();
}}
);
}
self.prev().length&&self.parent().prepend(this);
render();
fm.bind('open sync select toolbarpref', function(){
var disabled=Object.assign({}, fm.option('disabledFlip')),
userHides=fm.storage('toolbarhides'),
doRender, sel, disabledKeys;
if(! userHides&&Array.isArray(options.defaultHides)){
userHides={};
$.each(options.defaultHides, function(){
userHides[this]=true;
});
fm.storage('toolbarhides', userHides);
}
if(this.type==='select'){
if(fm.searchStatus.state < 2){
return;
}
sel=fm.selected();
if(sel.length){
disabled=fm.getDisabledCmds(sel, true);
}}
$.each(userHides, function(n){
if(!disabled[n]){
disabled[n]=true;
}});
if(Object.keys(fm.commandMap).length){
$.each(fm.commandMap, function(from, to){
if(to==='hidden'){
disabled[from]=true;
}});
}
disabledKeys=Object.keys(disabled);
if(!dispre||dispre.toString()!==disabledKeys.sort().toString()){
render(disabledKeys.length? disabled:null);
doRender=true;
}
dispre=disabledKeys.sort();
if(doRender||uiCmdMapPrev!==JSON.stringify(fm.commandMap)){
uiCmdMapPrev=JSON.stringify(fm.commandMap);
if(! doRender){
$.each($('div.elfinder-button'), function(){
var origin=$(this).data('origin');
if(origin){
$(this).after(origin).detach();
}});
}
if(Object.keys(fm.commandMap).length){
$.each(fm.commandMap, function(from, to){
var cmd=fm._commands[to],
button=cmd? 'elfinder'+cmd.options.ui:null,
btn;
if(button&&$.fn[button]){
btn=buttons[from];
if(btn){
if(! buttons[to]&&$.fn[button]){
buttons[to]=$('<div/>')[button](cmd);
if(buttons[to]){
buttons[to].children('.elfinder-button-text')[textLabel? 'show':'hide']();
if(cmd.extendsCmd){
buttons[to].children('span.elfinder-button-icon').addClass('elfinder-button-icon-' + cmd.extendsCmd);
}}
}
if(buttons[to]){
btn.after(buttons[to]);
buttons[to].data('origin', btn.detach());
}}
}});
}}
}).bind('resize', function(e){
resizeTm&&cancelAnimationFrame(resizeTm);
resizeTm=requestAnimationFrame(function(){
var h=self[0].clientHeight;
if(prevHeight!==h){
prevHeight=h;
fm.trigger('uiresize');
}});
});
if(fm.UA.Touch){
autoHide=fm.storage('autoHide')||{};
if(typeof autoHide.toolbar==='undefined'){
autoHide.toolbar=(options.autoHideUA&&options.autoHideUA.length > 0&&$.grep(options.autoHideUA, function(v){ return fm.UA[v]? true:false; }).length);
fm.storage('autoHide', autoHide);
}
if(autoHide.toolbar){
fm.one('init', function(){
fm.uiAutoHide.push(function(){ self.stop(true, true).trigger('toggle', { duration: 500, init: true });});
});
}
fm.bind('load', function(){
swipeHandle=$('<div class="elfinder-toolbar-swipe-handle"/>').hide().appendTo(fm.getUI());
if(swipeHandle.css('pointer-events')!=='none'){
swipeHandle.remove();
swipeHandle=null;
}});
self.on('toggle', function(e, data){
var wz=fm.getUI('workzone'),
toshow=self.is(':hidden'),
wzh=wz.height(),
h=self.height(),
tbh=self.outerHeight(true),
delta=tbh - h,
opt=Object.assign({
step: function(now){
wz.height(wzh + (toshow? (now + delta) * -1:h - now));
fm.trigger('resize');
},
always: function(){
requestAnimationFrame(function(){
self.css('height', '');
fm.trigger('uiresize');
if(swipeHandle){
if(toshow){
swipeHandle.stop(true, true).hide();
}else{
swipeHandle.height(data.handleH? data.handleH:'');
fm.resources.blink(swipeHandle, 'slowonce');
}}
toshow&&self.scrollTop('0px');
data.init&&fm.trigger('uiautohide');
});
}}, data);
self.data('swipeClose', ! toshow).stop(true, true).animate({height:'toggle'}, opt);
autoHide.toolbar = !toshow;
fm.storage('autoHide', Object.assign(fm.storage('autoHide'), {toolbar: autoHide.toolbar}));
}).on('touchstart', function(e){
if(self.scrollBottom() > 5){
e.originalEvent._preventSwipeY=true;
}});
}});
return this;
};
$.fn.elfindertree=function(fm, opts){
var treeclass=fm.res('class', 'tree');
this.not('.'+treeclass).each(function(){
var c='class', mobile=fm.UA.Mobile,
root=fm.res(c, 'treeroot'),
openRoot=opts.openRootOnLoad,
openCwd=opts.openCwdOnOpen,
syncTree=openCwd||opts.syncTree,
subtree=fm.res(c, 'navsubtree'),
navdir=fm.res(c, 'treedir'),
selNavdir='span.' + navdir,
collapsed=fm.res(c, 'navcollapse'),
expanded=fm.res(c, 'navexpand'),
loaded='elfinder-subtree-loaded',
chksubdir='elfinder-subtree-chksubdir',
arrow=fm.res(c, 'navarrow'),
active=fm.res(c, 'active'),
dropover=fm.res(c, 'adroppable'),
hover=fm.res(c, 'hover'),
disabled=fm.res(c, 'disabled'),
draggable=fm.res(c, 'draggable'),
droppable=fm.res(c, 'droppable'),
wrapperRoot='elfinder-navbar-wrapper-root',
pastable='elfinder-navbar-wrapper-pastable',
uploadable='elfinder-navbar-wrapper-uploadable',
insideNavbar=function(x){
var left=navbar.offset().left;
return left <=x&&x <=left + navbar.width();
},
subdirsQue={},
subdirsExecQue=[],
subdirs=function(ids){
var targets=[];
$.each(ids, function(i, id){
subdirsQue[id]&&targets.push(fm.navId2Hash(id));
delete subdirsQue[id];
});
if(targets.length){
return fm.request({
data: {
cmd: 'subdirs',
targets: targets,
preventDefault:true
}}).done(function(res){
if(res&&res.subdirs){
$.each(res.subdirs, function(hash, subdirs){
var elm=fm.navHash2Elm(hash);
elm.removeClass(chksubdir);
elm[subdirs? 'addClass':'removeClass'](collapsed);
});
}});
}},
subdirsJobRes=null,
checkSubdirs=function(){
var ids=Object.keys(subdirsQue);
if(ids.length){
subdirsJobRes&&subdirsJobRes._abort();
execSubdirsTm&&clearTimeout(execSubdirsTm);
subdirsExecQue=[];
subdirsJobRes=fm.asyncJob(function(id){
return fm.isInWindow($('#'+id))? id:null;
}, ids, { numPerOnce: 200 })
.done(function(arr){
if(arr.length){
subdirsExecQue=arr;
execSubdirs();
}});
}},
subdirsPending=0,
execSubdirsTm,
execSubdirs=function(){
var cnt=opts.subdirsMaxConn - subdirsPending,
atOnce=fm.maxTargets? Math.min(fm.maxTargets, opts.subdirsAtOnce):opts.subdirsAtOnce,
i, ids;
execSubdirsTm&&cancelAnimationFrame(execSubdirsTm);
if(subdirsExecQue.length){
if(cnt > 0){
for (i=0; i < cnt; i++){
if(subdirsExecQue.length){
subdirsPending++;
subdirs(subdirsExecQue.splice(0, atOnce)).always(function(){
subdirsPending--;
execSubdirs();
});
}}
}else{
execSubdirsTm=requestAnimationFrame(function(){
subdirsExecQue.length&&execSubdirs();
});
}}
},
drop=fm.droppable.drop,
droppableopts=$.extend(true, {}, fm.droppable, {
over:function(e, ui){
var dst=$(this),
helper=ui.helper,
cl=hover+' '+dropover,
hash, status;
e.stopPropagation();
helper.data('dropover', helper.data('dropover') + 1);
dst.data('dropover', true);
if(ui.helper.data('namespace')!==fm.namespace||! fm.insideWorkzone(e.pageX, e.pageY)){
dst.removeClass(cl);
helper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');
return;
}
if(! insideNavbar(e.clientX)){
dst.removeClass(cl);
return;
}
helper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');
dst.addClass(hover);
if(dst.is('.'+collapsed+':not(.'+expanded+')')){
dst.data('expandTimer', setTimeout(function(){
dst.is('.'+collapsed+'.'+hover)&&dst.children('.'+arrow).trigger('click');
}, 500));
}
if(dst.is('.elfinder-ro,.elfinder-na')){
dst.removeClass(dropover);
return;
}
hash=fm.navId2Hash(dst.attr('id'));
dst.data('dropover', hash);
$.each(ui.helper.data('files'), function(i, h){
if(h===hash||(fm.file(h).phash===hash&&!ui.helper.hasClass('elfinder-drag-helper-plus'))){
dst.removeClass(cl);
return false;
}});
if(helper.data('locked')){
status='elfinder-drag-helper-plus';
}else{
status='elfinder-drag-helper-move';
if(e.shiftKey||e.ctrlKey||e.metaKey){
status +=' elfinder-drag-helper-plus';
}}
dst.hasClass(dropover)&&helper.addClass(status);
requestAnimationFrame(function(){ dst.hasClass(dropover)&&helper.addClass(status); });
},
out:function(e, ui){
var dst=$(this),
helper=ui.helper;
e.stopPropagation();
if(insideNavbar(e.clientX)){
helper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');
}
helper.data('dropover', Math.max(helper.data('dropover') - 1, 0));
dst.data('expandTimer')&&clearTimeout(dst.data('expandTimer'));
dst.removeData('dropover')
.removeClass(hover+' '+dropover);
},
deactivate:function(){
$(this).removeData('dropover')
.removeClass(hover+' '+dropover);
},
drop:function(e, ui){
insideNavbar(e.clientX)&&drop.call(this, e, ui);
}}),
spinner=$(fm.res('tpl', 'navspinner')),
tpl=fm.res('tpl', 'navdir'),
ptpl=fm.res('tpl', 'perms'),
ltpl=fm.res('tpl', 'lock'),
stpl=fm.res('tpl', 'symlink'),
hasMoreDirs={},
replace={
id:function(dir){ return fm.navHash2Id(dir.hash); },
name:function(dir){ return fm.escape(dir.i18||dir.name); },
cssclass:function(dir){
var cname=(dir.phash&&! dir.isroot ? '':root)+' '+navdir+' '+fm.perms2class(dir);
dir.dirs&&!dir.link&&(cname +=' ' + collapsed)&&dir.dirs==-1&&(cname +=' ' + chksubdir);
opts.getClass&&(cname +=' ' + opts.getClass(dir));
dir.csscls&&(cname +=' ' + fm.escape(dir.csscls));
return cname;
},
title:function(dir){ return opts.attrTitle? (' title="' + fm.escape(fm.path(dir.hash, true)||dir.i18||dir.name) + '"'):''; },
root:function(dir){
var cls='';
if(!dir.phash||dir.isroot){
cls +=' '+wrapperRoot;
if(!dir.disabled||dir.disabled.length < 1){
cls +=' '+pastable+' '+uploadable;
}else{
if($.inArray('paste', dir.disabled)===-1){
cls +=' '+pastable;
}
if($.inArray('upload', dir.disabled)===-1){
cls +=' '+uploadable;
}}
return cls;
}else{
return '';
}},
permissions:function(dir){ return !dir.read||!dir.write ? ptpl:''; },
symlink:function(dir){ return dir.alias ? stpl:''; },
style:function(dir){ return dir.icon ? fm.getIconStyle(dir):''; }},
itemhtml=function(dir){
return tpl.replace(/(?:\{([a-z]+)\})/ig, function(m, key){
var res=replace[key] ? replace[key](dir):(dir[key]||'');
if(key==='id'&&dir.dirs==-1){
subdirsQue[res]=res;
}
return res;
});
},
filter=function(files, checkExists){
return $.map(files||[], function(f){
return (f.mime==='directory'&&(!checkExists||fm.navHash2Elm(f.hash).length)) ? f:null;
});
},
findSubtree=function(hash){
return hash ? fm.navHash2Elm(hash).next('.'+subtree):tree;
},
findSibling=function(subtree, dir){
var node=subtree.children(':first'),
info;
while (node.length){
info=fm.file(fm.navId2Hash(node.children('[id]').attr('id')));
if((info=fm.file(fm.navId2Hash(node.children('[id]').attr('id'))))
&& compare(dir, info) < 0){
return node;
}
node=node.next();
}
return subtree.children('button.elfinder-navbar-pager-next');
},
updateTree=function(dirs){
var length=dirs.length,
orphans=[],
i=length,
tgts=$(),
done={},
cwd=fm.cwd(),
append=function(parent, dirs, start, direction){
var hashes={},
curStart=0,
max=fm.newAPI? Math.min(10000, Math.max(10, opts.subTreeMax)):10000,
setHashes=function(){
hashes={};
$.each(dirs, function(i, d){
hashes[d.hash]=i;
});
},
change=function(mode){
if(mode==='prepare'){
$.each(dirs, function(i, d){
d.node&&parent.append(d.node.hide());
});
}else if(mode==='done'){
$.each(dirs, function(i, d){
d.node&&d.node.detach().show();
});
}},
update=function(e, data){
var i, changed;
e.stopPropagation();
if(data.select){
render(getStart(data.select));
return;
}
if(data.change){
change(data.change);
return;
}
if(data.removed&&data.removed.length){
dirs=$.grep(dirs, function(d){
if(data.removed.indexOf(d.hash)===-1){
return true;
}else{
!changed&&(changed=true);
return false;
}});
}
if(data.added&&data.added.length){
dirs=dirs.concat($.grep(data.added, function(d){
if(hashes[d.hash]===void(0)){
!changed&&(changed=true);
return true;
}else{
return false;
}}));
}
if(changed){
dirs.sort(compare);
setHashes();
render(curStart);
}},
getStart=function(target){
if(hashes[target]!==void(0)){
return Math.floor(hashes[target] / max) * max;
}
return void(0);
},
target=fm.navId2Hash(parent.prev('[id]').attr('id')),
render=function(start, direction){
var html=[],
nodes={},
total, page, s, parts, prev, next, prevBtn, nextBtn;
delete hasMoreDirs[target];
curStart=start;
parent.off('update.'+fm.namespace, update);
if(dirs.length > max){
parent.on('update.'+fm.namespace, update);
if(start===void(0)){
s=0;
setHashes();
start=getStart(cwd.hash);
if(start===void(0)){
start=0;
}}
parts=dirs.slice(start, start + max);
hasMoreDirs[target]=parent;
prev=start? Math.max(-1, start - max):-1;
next=(start + max >=dirs.length)? 0:start + max;
total=Math.ceil(dirs.length/max);
page=Math.ceil(start/max);
}
$.each(parts||dirs, function(i, d){
html.push(itemhtml(d));
if(d.node){
nodes[d.hash]=d.node;
}});
if(prev > -1){
prevBtn=$('<button class="elfinder-navbar-pager elfinder-navbar-pager-prev"/>')
.text(fm.i18n('btnPrevious', page, total))
.button({
icons: {
primary: "ui-icon-caret-1-n"
}})
.on('click', function(e){
e.preventDefault();
e.stopPropagation();
render(prev, 'up');
});
}else{
prevBtn=$();
}
if(next){
nextBtn=$('<button class="elfinder-navbar-pager elfinder-navbar-pager-next"/>')
.text(fm.i18n('btnNext', page + 2, total))
.button({
icons: {
primary: "ui-icon-caret-1-s"
}})
.on('click', function(e){
e.preventDefault();
e.stopPropagation();
render(next, 'down');
});
}else{
nextBtn=$();
}
detach();
parent.empty()[parts? 'addClass':'removeClass']('elfinder-navbar-hasmore').append(prevBtn, html.join(''), nextBtn);
$.each(nodes, function(h, n){
fm.navHash2Elm(h).parent().replaceWith(n);
});
if(direction){
autoScroll(fm.navHash2Id(parts[direction==='up'? parts.length - 1:0].hash));
}
! mobile&&fm.lazy(function(){ updateDroppable(null, parent); });
},
detach=function(){
$.each(parent.children('.elfinder-navbar-wrapper'), function(i, elm){
var n=$(elm),
ch=n.children('[id]:first'),
h, c;
if(ch.hasClass(loaded)){
h=fm.navId2Hash(ch.attr('id'));
if(h&&(c=hashes[h])!==void(0)){
dirs[c].node=n.detach();
}}
});
};
render();
},
dir, html, parent, sibling, init, atonce={}, updates=[], base, node,
firstVol=true;
while (i--){
dir=dirs[i];
if(done[dir.hash]||fm.navHash2Elm(dir.hash).length){
continue;
}
done[dir.hash]=true;
if((parent=findSubtree(dir.phash)).length){
if(dir.phash&&((init = !parent.children().length)||parent.hasClass('elfinder-navbar-hasmore')||(sibling=findSibling(parent, dir)).length)){
if(init){
if(!atonce[dir.phash]){
atonce[dir.phash]=[];
}
atonce[dir.phash].push(dir);
}else{
if(sibling){
node=itemhtml(dir);
sibling.before(node);
! mobile&&(tgts=tgts.add(node));
}else{
updates.push(dir);
}}
}else{
node=itemhtml(dir);
parent[firstVol||dir.phash ? 'append':'prepend'](node);
firstVol=false;
if(!dir.phash||dir.isroot){
base=fm.navHash2Elm(dir.hash).parent();
}
! mobile&&updateDroppable(null, base);
}}else{
orphans.push(dir);
}}
if(Object.keys(atonce).length){
$.each(atonce, function(p, dirs){
var parent=findSubtree(p),
html=[];
dirs.sort(compare);
append(parent, dirs);
});
}
if(updates.length){
parent.trigger('update.' + fm.namespace, { added:updates });
}
if(orphans.length&&orphans.length < length){
updateTree(orphans);
return;
}
! mobile&&tgts.length&&fm.lazy(function(){ updateDroppable(tgts); });
},
compare=function(dir1, dir2){
if(! fm.sortAlsoTreeview){
return fm.sortRules.name(dir1, dir2);
}else{
var asc=fm.sortOrder=='asc',
type=fm.sortType,
rules=fm.sortRules,
res;
res=asc? rules[fm.sortType](dir1, dir2):rules[fm.sortType](dir2, dir1);
return type!=='name'&&res===0
? res=asc ? rules.name(dir1, dir2):rules.name(dir2, dir1)
: res;
}},
autoScrTm,
autoScroll=function(target){
var dfrd=$.Deferred(),
current, parent, top, treeH, bottom, tgtTop;
autoScrTm&&clearTimeout(autoScrTm);
autoScrTm=setTimeout(function(){
current=$(document.getElementById((target||fm.navHash2Id(fm.cwd().hash))));
if(current.length){
(openCwd? current:current.parent()).parents('.elfinder-navbar-wrapper').children('.'+loaded).addClass(expanded).next('.'+subtree).show();
parent=tree.parent().stop(false, true);
top=parent.offset().top;
treeH=parent.height();
bottom=top + treeH - current.outerHeight();
tgtTop=current.offset().top;
if(tgtTop < top||tgtTop > bottom){
parent.animate({
scrollTop:parent.scrollTop() + tgtTop - top - treeH / 3
}, {
duration:opts.durations.autoScroll,
complete:function(){	dfrd.resolve(); }});
}else{
dfrd.resolve();
}}else{
dfrd.reject();
}}, 100);
return dfrd;
},
getEnds=function(d){
var cur=d||fm.cwd(),
res=cur.hash? [ cur.hash ]:[],
phash, root, dir;
root=fm.root(cur.hash);
dir=fm.file(root);
while (dir&&(phash=dir.phash)){
res.unshift(phash);
root=fm.root(phash);
dir=fm.file(root);
if(fm.navHash2Elm(dir.hash).hasClass(loaded)){
break;
}}
return res;
},
selectPages=function(current){
var cur=current||fm.cwd(),
curHash=cur.hash,
node=fm.navHash2Elm(curHash);
if(!node.length){
while(cur&&cur.phash){
if(hasMoreDirs[cur.phash]&&!fm.navHash2Elm(cur.hash).length){
hasMoreDirs[cur.phash].trigger('update.'+fm.namespace, { select:cur.hash });
}
cur=fm.file(cur.phash);
}
node=fm.navHash2Elm(curHash);
}
return node;
},
syncing,
sync=function(cwdDirs, aScr){
var cwd=fm.cwd(),
cwdhash=cwd.hash,
autoScr=aScr===void(0)? syncTree:aScr,
loadParents=function(dir){
var dfd=$.Deferred(),
reqs=[],
ends=getEnds(dir),
makeReq=function(cmd, h, until){
var data={
cmd:cmd,
target:h
};
if(until){
data.until=until;
}
return fm.request({
data:data,
preventFail:true
});
},
baseHash, baseId;
reqs=$.map(ends, function(h){
var d=fm.file(h),
isRoot=d? fm.isRoot(d):false,
node=fm.navHash2Elm(h),
getPhash=function(h, dep){
var d, ph,
depth=dep||1;
ph=(d=fm.file(h))? d.phash:false;
if(ph&&depth > 1){
return getPhash(ph, --depth);
}
return ph;
},
until,
closest=(function(){
var phash=getPhash(h);
until=phash;
while (phash){
if(fm.navHash2Elm(phash).hasClass(loaded)){
break;
}
until=phash;
phash=getPhash(phash);
}
if(!phash){
until=void(0);
phash=fm.root(h);
}
return phash;
})(),
cmd;
if(!node.hasClass(loaded)&&(isRoot||!d||!fm.navHash2Elm(d.phash).hasClass(loaded))){
if(isRoot||closest===getPhash(h)||closest===getPhash(h, 2)){
until=void(0);
cmd='tree';
if(!isRoot){
h=getPhash(h);
}}else{
cmd='parents';
}
if(!baseHash){
baseHash=(cmd==='tree')? h:closest;
}
return makeReq(cmd, h, until);
}
return null;
});
if(reqs.length){
selectPages(fm.file(baseHash));
baseId=fm.navHash2Id(baseHash);
autoScr&&autoScroll(baseId);
baseNode=$('#'+baseId);
spinner=$(fm.res('tpl', 'navspinner')).insertBefore(baseNode.children('.'+arrow));
baseNode.removeClass(collapsed);
$.when.apply($, reqs)
.done(function(){
var res={},data, treeDirs, dirs, argLen, i;
argLen=arguments.length;
if(argLen > 0){
for (i=0; i < argLen; i++){
data=arguments[i].tree||[];
res[ends[i]]=Object.assign([], filter(data));
}}
dfd.resolve(res);
})
.fail(function(){
dfd.reject();
});
return dfd;
}else{
return dfd.resolve();
}},
done=function(res, dfrd){
var open=function(){
if(openRoot&&baseNode){
findSubtree(baseNode.hash).show().prev(selNavdir).addClass(expanded);
openRoot=false;
}
if(autoScr){
autoScroll().done(checkSubdirs);
}else{
checkSubdirs();
}},
current;
if(res){
$.each(res, function(endHash, dirs){
dirs&&updateTree(dirs);
selectPages(fm.file(endHash));
dirs&&updateArrows(dirs, loaded);
});
}
if(cwdDirs){
(fm.api < 2.1)&&cwdDirs.push(cwd);
updateTree(cwdDirs);
}
current=selectPages();
if(!current.hasClass(active)){
tree.find(selNavdir+'.'+active).removeClass(active);
current.addClass(active);
}
current.parents('.elfinder-navbar-wrapper').children('.'+navdir).addClass(loaded);
if(res){
fm.lazy(open).done(function(){
dfrd.resolve();
});
}else{
open();
dfrd.resolve();
}},
rmSpinner=function(fail){
if(baseNode){
spinner.remove();
baseNode.addClass(collapsed + (fail? '':(' ' + loaded)));
}},
dfrd=$.Deferred(),
baseNode, spinner;
if(!fm.navHash2Elm(cwdhash).length){
syncing=true;
loadParents()
.done(function(res){
done(res, dfrd);
rmSpinner();
})
.fail(function(){
rmSpinner(true);
dfrd.reject();
})
.always(function(){
syncing=false;
});
}else{
done(void(0), dfrd);
}
fm.trigger('treesync', dfrd);
return dfrd;
},
updateDroppable=function(target, node){
var limit=100,
next;
if(!target){
if(!node||node.closest('div.'+wrapperRoot).hasClass(uploadable)){
(node||tree.find('div.'+uploadable)).find(selNavdir+':not(.elfinder-ro,.elfinder-na)').addClass('native-droppable');
}
if(!node||node.closest('div.'+wrapperRoot).hasClass(pastable)){
target=(node||tree.find('div.'+pastable)).find(selNavdir+':not(.'+droppable+')');
}else{
target=$();
}
if(node){
node.children('div.'+wrapperRoot).each(function(){
updateDroppable(null, $(this));
});
}}
if(target.length){
fm.asyncJob(function(elm){
$(elm).droppable(droppableopts);
}, $.makeArray(target), {
interval:20,
numPerOnce:100
});
}},
updateArrows=function(dirs, cls){
var sel=cls==loaded
? '.'+collapsed+':not(.'+loaded+')'
: ':not(.'+collapsed+')';
$.each(dirs, function(i, dir){
fm.navHash2Elm(dir.phash).filter(sel)
.filter(function(){ return $.grep($(this).next('.'+subtree).children(), function(n){
return ($(n).children().hasClass(root))? false:true;
}).length > 0; })
.addClass(cls);
});
},
tree=$(this).addClass(treeclass)
.on('mouseenter mouseleave', selNavdir, function(e){
var enter=(e.type==='mouseenter');
if(enter&&scrolling){ return; }
var link=$(this),
hash, dir;
if(!link.hasClass(dropover+' '+disabled)){
if(!mobile&&enter&&!link.data('dragRegisted')&&!link.hasClass(root+' '+draggable+' elfinder-na elfinder-wo')){
link.data('dragRegisted', true);
if(fm.isCommandEnabled('copy', (hash=fm.navId2Hash(link.attr('id'))))){
link.draggable(fm.draggable);
}}
link.toggleClass(hover, enter);
}
if(enter&&opts.attrTitle){
dir=fm.file(hash||fm.navId2Hash(link.attr('id')));
if(!dir.isroot&&link.attr('title')===(dir.i18||dir.name)){
link.attr('title', fm.path(hash, true));
}}
})
.on('dragenter', selNavdir, function(e){
if(e.originalEvent.dataTransfer){
var dst=$(this);
dst.addClass(hover);
if(dst.is('.'+collapsed+':not(.'+expanded+')')){
dst.data('expandTimer', setTimeout(function(){
dst.is('.'+collapsed+'.'+hover)&&dst.children('.'+arrow).trigger('click');
}, 500));
}}
})
.on('dragleave', selNavdir, function(e){
if(e.originalEvent.dataTransfer){
var dst=$(this);
dst.data('expandTimer')&&clearTimeout(dst.data('expandTimer'));
dst.removeClass(hover);
}})
.on('click', selNavdir, function(e){
var link=$(this),
hash=fm.navId2Hash(link.attr('id')),
file=fm.file(hash);
if(link.data('longtap')){
link.removeData('longtap');
e.stopPropagation();
return;
}
if(!link.hasClass(active)){
tree.find(selNavdir+'.'+active).removeClass(active);
link.addClass(active);
}
if(hash!=fm.cwd().hash&&!link.hasClass(disabled)){
fm.exec('open', hash).done(function(){
fm.one('opendone', function(){
fm.select({selected: [hash], origin: 'navbar'});
});
});
}else{
if(link.hasClass(collapsed)){
link.children('.'+arrow).trigger('click');
}
fm.select({selected: [hash], origin: 'navbar'});
}})
.on('touchstart', selNavdir, function(e){
if(e.originalEvent.touches.length > 1){
return;
}
var evt=e.originalEvent,
p;
if(e.target.nodeName==='INPUT'){
e.stopPropagation();
return;
}
p=$(this).addClass(hover)
.removeData('longtap')
.data('tmlongtap', setTimeout(function(e){
p.data('longtap', true);
fm.trigger('contextmenu', {
'type':'navbar',
'targets':[fm.navId2Hash(p.attr('id'))],
'x':evt.touches[0].pageX,
'y':evt.touches[0].pageY
});
}, 500));
})
.on('touchmove touchend', selNavdir, function(e){
if(e.target.nodeName==='INPUT'){
e.stopPropagation();
return;
}
clearTimeout($(this).data('tmlongtap'));
$(this).removeData('tmlongtap');
if(e.type=='touchmove'){
$(this).removeClass(hover);
}})
.on('click', selNavdir+'.'+collapsed+' .'+arrow, function(e){
var arrow=$(this),
link=arrow.parent(selNavdir),
stree=link.next('.'+subtree),
dfrd=$.Deferred(),
slideTH=30, cnt;
e.stopPropagation();
if(link.hasClass(loaded)){
link.toggleClass(expanded);
fm.lazy(function(){
cnt=link.hasClass(expanded)? stree.children().length + stree.find('div.elfinder-navbar-subtree[style*=block]').children().length:stree.find('div:visible').length;
if(cnt > slideTH){
stree.toggle();
fm.draggingUiHelper&&fm.draggingUiHelper.data('refreshPositions', 1);
checkSubdirs();
}else{
stree.stop(true, true)[link.hasClass(expanded)? 'slideDown':'slideUp'](opts.durations.slideUpDown, function(){
fm.draggingUiHelper&&fm.draggingUiHelper.data('refreshPositions', 1);
checkSubdirs();
});
}}).always(function(){
dfrd.resolve();
});
}else{
spinner.insertBefore(arrow);
link.removeClass(collapsed);
fm.request({cmd:'tree', target:fm.navId2Hash(link.attr('id'))})
.done(function(data){
updateTree(Object.assign([], filter(data.tree)));
if(stree.children().length){
link.addClass(collapsed+' '+expanded);
if(stree.children().length > slideTH){
stree.show();
fm.draggingUiHelper&&fm.draggingUiHelper.data('refreshPositions', 1);
checkSubdirs();
}else{
stree.stop(true, true).slideDown(opts.durations.slideUpDown, function(){
fm.draggingUiHelper&&fm.draggingUiHelper.data('refreshPositions', 1);
checkSubdirs();
});
}}
})
.always(function(data){
spinner.remove();
link.addClass(loaded);
fm.one('treedone', function(){
dfrd.resolve();
});
});
}
arrow.data('dfrd', dfrd);
})
.on('contextmenu', selNavdir, function(e){
var self=$(this);
if(self.find('input:text').length){
e.stopPropagation();
return;
}
e.preventDefault();
if(!self.data('tmlongtap')){
fm.trigger('contextmenu', {
'type':'navbar',
'targets':[fm.navId2Hash($(this).attr('id'))],
'x':e.pageX,
'y':e.pageY
});
}
self.addClass('ui-state-hover');
fm.getUI('contextmenu').children().on('mouseenter', function(){
self.addClass('ui-state-hover');
});
fm.bind('closecontextmenu', function(){
self.removeClass('ui-state-hover');
});
})
.on('scrolltoview', selNavdir, function(e, data){
var self=$(this);
autoScroll(self.attr('id')).done(function(){
if(!data||data.blink==='undefined'||data.blink){
fm.resources.blink(self, 'lookme');
}});
})
.on('create.'+fm.namespace, function(e, item){
var pdir=findSubtree(item.phash),
lock=item.move||false,
dir=$(itemhtml(item)).addClass('elfinder-navbar-wrapper-tmp'),
selected=fm.selected();
lock&&selected.length&&fm.trigger('lockfiles', {files: selected});
pdir.prepend(dir);
}),
scrolling=false,
navbarScrTm,
navbar=fm.getUI('navbar').append(tree).show().on('scroll', function(){
scrolling=true;
navbarScrTm&&cancelAnimationFrame(navbarScrTm);
navbarScrTm=requestAnimationFrame(function(){
scrolling=false;
checkSubdirs();
});
}),
prevSortTreeview=fm.sortAlsoTreeview;
fm.open(function(e){
var data=e.data,
dirs=filter(data.files),
contextmenu=fm.getUI('contextmenu');
data.init&&tree.empty();
if(fm.UA.iOS){
navbar.removeClass('overflow-scrolling-touch').addClass('overflow-scrolling-touch');
}
if(dirs.length){
fm.lazy(function(){
if(!contextmenu.data('cmdMaps')){
contextmenu.data('cmdMaps', {});
}
updateTree(dirs);
updateArrows(dirs, loaded);
sync(dirs);
});
}else{
sync();
}})
.add(function(e){
var dirs=filter(e.data.added);
if(dirs.length){
updateTree(dirs);
updateArrows(dirs, collapsed);
}})
.change(function(e){
if(syncing){
return;
}
var dirs=filter(e.data.changed, true),
length=dirs.length,
l=length,
tgts=$(),
changed={},
dir, phash, node, tmp, realParent, reqParent, realSibling, reqSibling, isExpanded, isLoaded, parent, subdirs;
$.each(hasMoreDirs, function(h, node){
node.trigger('update.'+fm.namespace, { change: 'prepare' });
});
while (l--){
dir=dirs[l];
phash=dir.phash;
if((node=fm.navHash2Elm(dir.hash)).length){
parent=node.parent();
if(phash){
realParent=node.closest('.'+subtree);
reqParent=findSubtree(phash);
realSibling=node.parent().next();
reqSibling=findSibling(reqParent, dir);
if(!reqParent.length){
continue;
}
if(reqParent[0]!==realParent[0]||realSibling.get(0)!==reqSibling.get(0)){
reqSibling.length ? reqSibling.before(parent):reqParent.append(parent);
}}
isExpanded=node.hasClass(expanded);
isLoaded=node.hasClass(loaded);
tmp=$(itemhtml(dir));
node.replaceWith(tmp.children(selNavdir));
! mobile&&updateDroppable(null, parent);
if(dir.dirs
&& (isExpanded||isLoaded)
&& (node=fm.navHash2Elm(dir.hash))
&& node.next('.'+subtree).children().length){
isExpanded&&node.addClass(expanded);
isLoaded&&node.addClass(loaded);
}
subdirs |=dir.dirs==-1;
}}
if(subdirs){
checkSubdirs();
}
$.each(hasMoreDirs, function(h, node){
node.trigger('update.'+fm.namespace, { change: 'done' });
});
length&&sync(void(0), false);
})
.remove(function(e){
var dirs=e.data.removed,
l=dirs.length,
node, stree, removed;
$.each(hasMoreDirs, function(h, node){
node.trigger('update.'+fm.namespace, { removed:dirs });
node.trigger('update.'+fm.namespace, { change: 'prepare' });
});
while (l--){
if((node=fm.navHash2Elm(dirs[l])).length){
removed=true;
stree=node.closest('.'+subtree);
node.parent().detach();
if(!stree.children().length){
stree.hide().prev(selNavdir).removeClass(collapsed+' '+expanded+' '+loaded);
}}
}
removed&&fm.getUI('navbar').children('.ui-resizable-handle').trigger('resize');
$.each(hasMoreDirs, function(h, node){
node.trigger('update.'+fm.namespace, { change: 'done' });
});
})
.bind('lockfiles unlockfiles', function(e){
var lock=e.type=='lockfiles',
helperLocked=e.data.helper? e.data.helper.data('locked'):false,
act=(lock&&!helperLocked) ? 'disable':'enable',
dirs=$.grep(e.data.files||[], function(h){
var dir=fm.file(h);
return dir&&dir.mime=='directory' ? true:false;
});
$.each(dirs, function(i, hash){
var dir=fm.navHash2Elm(hash);
if(dir.length&&!helperLocked){
dir.hasClass(draggable)&&dir.draggable(act);
dir.hasClass(droppable)&&dir.droppable(act);
dir[lock ? 'addClass':'removeClass'](disabled);
}});
})
.bind('sortchange', function(){
if(fm.sortAlsoTreeview||prevSortTreeview!==fm.sortAlsoTreeview){
var dirs,
ends=[],
endsMap={},
endsVid={},
topVid='',
single=false,
current;
fm.lazy(function(){
dirs=filter(fm.files());
prevSortTreeview=fm.sortAlsoTreeview;
tree.empty();
updateTree($.map(fm.roots, function(h){
var dir=fm.file(h);
return dir&&!dir.phash? dir:null;
}));
if(!Object.keys(hasMoreDirs).length){
updateTree(dirs);
current=selectPages();
updateArrows(dirs, loaded);
}else{
ends=getEnds();
if(ends.length > 1){
$.each(ends, function(i, end){
var vid=fm.file(fm.root(end)).volumeid;
if(i===0){
topVid=vid;
}
endsVid[vid]=end;
endsMap[end]=[];
});
$.each(dirs, function(i, d){
if(!d.volumeid){
single=true;
return false;
}
endsMap[endsVid[d.volumeid]||endsVid[topVid]].push(d);
});
}else{
single=true;
}
if(single){
$.each(ends, function(i, endHash){
updateTree(dirs);
current=selectPages(fm.file(endHash));
updateArrows(dirs, loaded);
});
}else{
$.each(endsMap, function(endHash, dirs){
updateTree(dirs);
current=selectPages(fm.file(endHash));
updateArrows(dirs, loaded);
});
}}
sync();
}, 100);
}});
});
return this;
};
$.fn.elfinderuploadbutton=function(cmd){
return this.each(function(){
var fm=cmd.fm,
button=$(this).elfinderbutton(cmd)
.off('click'),
form=$('<form/>').appendTo(button),
input=$('<input type="file" multiple="true" title="'+cmd.fm.i18n('selectForUpload')+'"/>')
.on('change', function(){
var _input=$(this);
if(_input.val()){
fm.exec('upload', {input:_input.remove()[0]}, void(0), fm.cwd().hash);
input.clone(true).appendTo(form);
}})
.on('dragover', function(e){
e.originalEvent.dataTransfer.dropEffect='copy';
}),
tm;
form.append(input.clone(true));
cmd.change(function(){
tm&&cancelAnimationFrame(tm);
tm=requestAnimationFrame(function(){
var toShow=cmd.disabled();
if(form.is('visible')){
!toShow&&form.hide();
}else{
toShow&&form.show();
}});
})
.change();
});
};
$.fn.elfinderviewbutton=function(cmd){
return this.each(function(){
var button=$(this).elfinderbutton(cmd),
icon=button.children('.elfinder-button-icon'),
text=button.children('.elfinder-button-text'),
tm;
cmd.change(function(){
tm&&cancelAnimationFrame(tm);
tm=requestAnimationFrame(function(){
var icons=cmd.value=='icons';
icon.toggleClass('elfinder-button-icon-view-list', icons);
cmd.className=icons? 'view-list':'';
cmd.title=cmd.fm.i18n(icons ? 'viewlist':'viewicons');
button.attr('title', cmd.title);
text.html(cmd.title);
});
});
});
};
$.fn.elfinderworkzone=function(fm){
var cl='elfinder-workzone';
this.not('.'+cl).each(function(){
var wz=$(this).addClass(cl),
prevH=Math.round(wz.height()),
parent=wz.parent(),
setDelta=function(){
wdelta=wz.outerHeight(true) - wz.height();
},
fitsize=function(e){
var height=parent.height() - wdelta,
style=parent.attr('style'),
curH=Math.round(wz.height());
if(e){
e.preventDefault();
e.stopPropagation();
}
parent.css('overflow', 'hidden')
.children(':visible:not(.'+cl+')').each(function(){
var ch=$(this);
if(ch.css('position')!='absolute'&&ch.css('position')!='fixed'){
height -=ch.outerHeight(true);
}});
parent.attr('style', style||'');
height=Math.max(0, Math.round(height));
if(prevH!==height||curH!==height){
prevH=Math.round(wz.height());
wz.height(height);
fm.trigger('wzresize');
}},
cssloaded=function(){
wdelta=wz.outerHeight(true) - wz.height();
fitsize();
},
wdelta;
setDelta();
parent.on('resize.' + fm.namespace, fitsize);
fm.one('cssloaded', cssloaded)
.bind('uiresize', fitsize)
.bind('themechange', setDelta);
});
return this;
};
elFinder.prototype.commands.archive=function(){
var self=this,
fm=self.fm,
mimes=[],
dfrd;
this.variants=[];
this.disableOnSearch=false;
this.nextAction={};
fm.bind('open reload', function(){
self.variants=[];
$.each((mimes=fm.option('archivers')['create']||[]), function(i, mime){
self.variants.push([mime, fm.mime2kind(mime)]);
});
self.change();
});
this.getstate=function(select){
var sel=this.files(select),
cnt=sel.length,
chk=(cnt&&! fm.isRoot(sel[0])&&(fm.file(sel[0].phash)||{}).write&&! $.grep(sel, function(f){ return f.read ? false:true; }).length),
cwdId;
if(chk&&fm.searchStatus.state > 1){
cwdId=fm.cwd().volumeid;
chk=(cnt===$.grep(sel, function(f){ return f.read&&f.hash.indexOf(cwdId)===0 ? true:false; }).length);
}
return chk&&!this._disabled&&mimes.length&&(cnt||(dfrd&&dfrd.state()=='pending')) ? 0:-1;
};
this.exec=function(hashes, type){
var files=this.files(hashes),
cnt=files.length,
mime=type||mimes[0],
cwd=fm.file(files[0].phash)||null,
error=['errArchive', 'errPerm', 'errCreatingTempDir', 'errFtpDownloadFile', 'errFtpUploadFile', 'errFtpMkdir', 'errArchiveExec', 'errExtractExec', 'errRm'],
i, open;
dfrd=$.Deferred().fail(function(error){
error&&fm.error(error);
});
if(! (cnt&&mimes.length&&$.inArray(mime, mimes)!==-1)){
return dfrd.reject();
}
if(!cwd.write){
return dfrd.reject(error);
}
for (i=0; i < cnt; i++){
if(!files[i].read){
return dfrd.reject(error);
}}
self.mime=mime;
self.prefix=((cnt > 1)? 'Archive':files[0].name) + (fm.option('archivers')['createext']? '.' + fm.option('archivers')['createext'][mime]:'');
self.data={targets:self.hashes(hashes), type:mime};
if(fm.cwd().hash!==cwd.hash){
open=fm.exec('open', cwd.hash).done(function(){
fm.one('cwdrender', function(){
fm.selectfiles({files:hashes});
dfrd=$.proxy(fm.res('mixin', 'make'), self)();
});
});
}else{
fm.selectfiles({files:hashes});
dfrd=$.proxy(fm.res('mixin', 'make'), self)();
}
return dfrd;
};};
(elFinder.prototype.commands.back=function(){
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.shortcuts=[{
pattern:'ctrl+left backspace'
}];
this.getstate=function(){
return this.fm.history.canBack() ? 0:-1;
};
this.exec=function(){
return this.fm.history.back();
};}).prototype={ forceLoad:true };
elFinder.prototype.commands.chmod=function(){
this.updateOnSelect=false;
var fm=this.fm,
level={
0:'owner',
1:'group',
2:'other'
},
msg={
read:fm.i18n('read'),
write:fm.i18n('write'),
execute:fm.i18n('execute'),
perm:fm.i18n('perm'),
kind:fm.i18n('kind'),
files:fm.i18n('files')
},
isPerm=function(perm){
return (!isNaN(parseInt(perm, 8)&&parseInt(perm, 8) <=511)||perm.match(/^([r-][w-][x-]){3}$/i));
};
this.tpl={
main:'<div class="ui-helper-clearfix elfinder-info-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}</div>'
+'{dataTable}',
itemTitle:'<strong>{name}</strong><span id="elfinder-info-kind">{kind}</span>',
groupTitle:'<strong>{items}: {num}</strong>',
dataTable:'<table id="{id}-table-perm"><tr><td>{0}</td><td>{1}</td><td>{2}</td></tr></table>'
+'<div class="">'+msg.perm+': <input class="elfinder-tabstop elfinder-focus" id="{id}-perm" type="text" size="4" maxlength="3" value="{value}"></div>',
fieldset:'<fieldset id="{id}-fieldset-{level}"><legend>{f_title}{name}</legend>'
+'<input type="checkbox" value="4" class="elfinder-tabstop" id="{id}-read-{level}-perm"{checked-r}> <label for="{id}-read-{level}-perm">'+msg.read+'</label><br>'
+'<input type="checkbox" value="6" class="elfinder-tabstop" id="{id}-write-{level}-perm"{checked-w}> <label for="{id}-write-{level}-perm">'+msg.write+'</label><br>'
+'<input type="checkbox" value="5" class="elfinder-tabstop" id="{id}-execute-{level}-perm"{checked-x}> <label for="{id}-execute-{level}-perm">'+msg.execute+'</label><br>'
};
this.shortcuts=[{
}];
this.getstate=function(sel){
var fm=this.fm;
sel=sel||fm.selected();
if(sel.length==0){
sel=[ fm.cwd().hash ];
}
return this.checkstate(this.files(sel)) ? 0:-1;
};
this.checkstate=function(sel){
var cnt=sel.length;
if(!cnt) return false;
var chk=$.grep(sel, function(f){
return (f.isowner&&f.perm&&isPerm(f.perm)&&(cnt==1||f.mime!='directory')) ? true:false;
}).length;
return (cnt==chk)? true:false;
};
this.exec=function(select){
var hashes=this.hashes(select),
files=this.files(hashes);
if(! files.length){
hashes=[ this.fm.cwd().hash ];
files=this.files(hashes);
}
var fm=this.fm,
dfrd=$.Deferred().always(function(){
fm.enable();
}),
tpl=this.tpl,
cnt=files.length,
file=files[0],
id=fm.namespace + '-perm-' + file.hash,
view=tpl.main,
checked=' checked="checked"',
buttons=function(){
var buttons={};
buttons[fm.i18n('btnApply')]=save;
buttons[fm.i18n('btnCancel')]=function(){ dialog.elfinderdialog('close'); };
return buttons;
},
save=function(){
var perm=$.trim($('#'+id+'-perm').val()),
reqData;
if(!isPerm(perm)) return false;
dialog.elfinderdialog('close');
reqData={
cmd:'chmod',
targets:hashes,
mode:perm
};
fm.request({
data:reqData,
notify:{type:'chmod', cnt:cnt}})
.fail(function(error){
dfrd.reject(error);
})
.done(function(data){
if(data.changed&&data.changed.length){
data.undo={
cmd:'chmod',
callback:function(){
var reqs=[];
$.each(prevVals, function(perm, hashes){
reqs.push(fm.request({
data:{cmd:'chmod', targets:hashes, mode:perm},
notify:{type:'undo', cnt:hashes.length}}));
});
return $.when.apply(null, reqs);
}};
data.redo={
cmd:'chmod',
callback:function(){
return fm.request({
data:reqData,
notify:{type:'redo', cnt:hashes.length}});
}};}
dfrd.resolve(data);
});
},
setperm=function(){
var perm='';
var _perm;
for (var i=0; i < 3; i++){
_perm=0;
if($("#"+id+"-read-"+level[i]+'-perm').is(':checked')){
_perm=(_perm | 4);
}
if($("#"+id+"-write-"+level[i]+'-perm').is(':checked')){
_perm=(_perm | 2);
}
if($("#"+id+"-execute-"+level[i]+'-perm').is(':checked')){
_perm=(_perm | 1);
}
perm +=_perm.toString(8);
}
$('#'+id+'-perm').val(perm);
},
setcheck=function(perm){
var _perm;
for (var i=0; i < 3; i++){
_perm=parseInt(perm.slice(i, i+1), 8);
$("#"+id+"-read-"+level[i]+'-perm').prop("checked", false);
$("#"+id+"-write-"+level[i]+'-perm').prop("checked", false);
$("#"+id+"-execute-"+level[i]+'-perm').prop("checked", false);
if((_perm & 4)==4){
$("#"+id+"-read-"+level[i]+'-perm').prop("checked", true);
}
if((_perm & 2)==2){
$("#"+id+"-write-"+level[i]+'-perm').prop("checked", true);
}
if((_perm & 1)==1){
$("#"+id+"-execute-"+level[i]+'-perm').prop("checked", true);
}}
setperm();
},
makeperm=function(files){
var perm='777', ret='', chk, _chk, _perm;
var len=files.length;
for (var i2=0; i2 < len; i2++){
chk=getPerm(files[i2].perm);
if(! prevVals[chk]){
prevVals[chk]=[];
}
prevVals[chk].push(files[i2].hash);
ret='';
for (var i=0; i < 3; i++){
_chk=parseInt(chk.slice(i, i+1), 8);
_perm=parseInt(perm.slice(i, i+1), 8);
if((_chk & 4)!=4&&(_perm & 4)==4){
_perm -=4;
}
if((_chk & 2)!=2&&(_perm & 2)==2){
_perm -=2;
}
if((_chk & 1)!=1&&(_perm & 1)==1){
_perm -=1;
}
ret +=_perm.toString(8);
}
perm=ret;
}
return perm;
},
makeName=function(name){
return name? ':'+name:'';
},
makeDataTable=function(perm, f){
var _perm, fieldset;
var value='';
var dataTable=tpl.dataTable;
for (var i=0; i < 3; i++){
_perm=parseInt(perm.slice(i, i+1), 8);
value +=_perm.toString(8);
fieldset=tpl.fieldset.replace('{f_title}', fm.i18n(level[i])).replace('{name}', makeName(f[level[i]])).replace(/\{level\}/g, level[i]);
dataTable=dataTable.replace('{'+i+'}', fieldset)
.replace('{checked-r}', ((_perm & 4)==4)? checked:'')
.replace('{checked-w}', ((_perm & 2)==2)? checked:'')
.replace('{checked-x}', ((_perm & 1)==1)? checked:'');
}
dataTable=dataTable.replace('{value}', value).replace('{valueCaption}', msg['perm']);
return dataTable;
},
getPerm=function(perm){
if(isNaN(parseInt(perm, 8))){
var mode_array=perm.split('');
var a=[];
for (var i=0, l=mode_array.length; i < l; i++){
if(i===0||i===3||i===6){
if(mode_array[i].match(/[r]/i)){
a.push(1);
}else if(mode_array[i].match(/[-]/)){
a.push(0);
}}else if(i===1||i===4||i===7){
if(mode_array[i].match(/[w]/i)){
a.push(1);
}else if(mode_array[i].match(/[-]/)){
a.push(0);
}}else{
if(mode_array[i].match(/[x]/i)){
a.push(1);
}else if(mode_array[i].match(/[-]/)){
a.push(0);
}}
}
a.splice(3, 0, ",");
a.splice(7, 0, ",");
var b=a.join("");
var b_array=b.split(",");
var c=[];
for (var j=0, m=b_array.length; j < m; j++){
var p=parseInt(b_array[j], 2).toString(8);
c.push(p);
}
perm=c.join('');
}else{
perm=parseInt(perm, 8).toString(8);
}
return perm;
},
opts={
title:this.title,
width:'auto',
buttons:buttons(),
close:function(){ $(this).elfinderdialog('destroy'); }},
dialog=fm.getUI().find('#'+id),
prevVals={},
tmb='', title, dataTable;
if(dialog.length){
dialog.elfinderdialog('toTop');
return $.Deferred().resolve();
}
view=view.replace('{class}', cnt > 1 ? 'elfinder-cwd-icon-group':fm.mime2class(file.mime));
if(cnt > 1){
title=tpl.groupTitle.replace('{items}', fm.i18n('items')).replace('{num}', cnt);
}else{
title=tpl.itemTitle.replace('{name}', file.name).replace('{kind}', fm.mime2kind(file));
tmb=fm.tmb(file);
}
dataTable=makeDataTable(makeperm(files), files.length==1? files[0]:{});
view=view.replace('{title}', title).replace('{dataTable}', dataTable).replace(/{id}/g, id);
dialog=this.fmDialog(view, opts);
dialog.attr('id', id);
if(tmb){
$('<img/>')
.on('load', function(){ dialog.find('.elfinder-cwd-icon').addClass(tmb.className).css('background-image', "url('"+tmb.url+"')"); })
.attr('src', tmb.url);
}
$('#' + id + '-table-perm :checkbox').on('click', function(){setperm('perm');});
$('#' + id + '-perm').on('keydown', function(e){
var c=e.keyCode;
if(c==$.ui.keyCode.ENTER){
e.stopPropagation();
save();
return;
}}).on('focus', function(e){
$(this).trigger('select');
}).on('keyup', function(e){
if($(this).val().length==3){
$(this).trigger('select');
setcheck($(this).val());
}});
return dfrd;
};};
elFinder.prototype.commands.colwidth=function(){
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.getstate=function(){
return this.fm.getUI('cwd').find('table').css('table-layout')==='fixed' ? 0:-1;
};
this.exec=function(){
this.fm.getUI('cwd').trigger('colwidth');
return $.Deferred().resolve();
};};
elFinder.prototype.commands.copy=function(){
this.shortcuts=[{
pattern:'ctrl+c ctrl+insert'
}];
this.getstate=function(select){
var sel=this.files(select),
cnt=sel.length;
return cnt&&$.grep(sel, function(f){ return f.read ? true:false; }).length==cnt ? 0:-1;
};
this.exec=function(hashes){
var fm=this.fm,
dfrd=$.Deferred()
.fail(function(error){
fm.error(error);
});
$.each(this.files(hashes), function(i, file){
if(! file.read){
return !dfrd.reject(['errCopy', file.name, 'errPerm']);
}});
return dfrd.state()=='rejected' ? dfrd:dfrd.resolve(fm.clipboard(this.hashes(hashes)));
};};
elFinder.prototype.commands.cut=function(){
var fm=this.fm;
this.shortcuts=[{
pattern:'ctrl+x shift+insert'
}];
this.getstate=function(select){
var sel=this.files(select),
cnt=sel.length;
return cnt&&$.grep(sel, function(f){ return f.read&&! f.locked&&! fm.isRoot(f) ? true:false; }).length==cnt ? 0:-1;
};
this.exec=function(hashes){
var dfrd=$.Deferred()
.fail(function(error){
fm.error(error);
});
$.each(this.files(hashes), function(i, file){
if(!(file.read&&! file.locked&&! fm.isRoot(file))){
return !dfrd.reject(['errCopy', file.name, 'errPerm']);
}
if(file.locked){
return !dfrd.reject(['errLocked', file.name]);
}});
return dfrd.state()=='rejected' ? dfrd:dfrd.resolve(fm.clipboard(this.hashes(hashes), true));
};};
elFinder.prototype.commands.zipdl=function(){};
elFinder.prototype.commands.download=function(){
var self=this,
fm=this.fm,
czipdl=null,
zipOn=false,
mixed=false,
dlntf=false,
cpath=window.location.pathname||'/',
filter=function(hashes, inExec){
var volumeid, mixedCmd;
if(czipdl!==null){
if(fm.searchStatus.state > 1){
mixed=fm.searchStatus.mixed;
}else if(fm.leafRoots[fm.cwd().hash]){
volumeid=fm.cwd().volumeid;
$.each(hashes, function(i, h){
if(h.indexOf(volumeid)!==0){
mixed=true;
return false;
}});
}
zipOn=(fm.isCommandEnabled('zipdl', hashes[0]));
}
if(mixed){
mixedCmd=czipdl? 'zipdl':'download';
hashes=$.grep(hashes, function(h){
var f=fm.file(h),
res=(! f||(! czipdl&&f.mime==='directory')||! fm.isCommandEnabled(mixedCmd, h))? false:true;
if(f&&inExec&&! res){
fm.cwdHash2Elm(f.hash).trigger('unselect');
}
return res;
});
if(! hashes.length){
return [];
}}else{
if(!fm.isCommandEnabled('download', hashes[0])){
return [];
}}
return $.grep(self.files(hashes), function(f){
var res=(! f.read||(! zipOn&&f.mime=='directory')) ? false:true;
if(inExec&&! res){
fm.cwdHash2Elm(f.hash).trigger('unselect');
}
return res;
});
};
this.linkedCmds=['zipdl'];
this.shortcuts=[{
pattern:'shift+enter'
}];
this.getstate=function(select){
var sel=this.hashes(select),
cnt=sel.length,
maxReq=this.options.maxRequests||10,
mixed=false,
croot='';
if(cnt < 1){
return -1;
}
cnt=filter(sel).length;
return  (cnt&&(zipOn||(cnt <=maxReq&&((!fm.UA.IE&&!fm.UA.Mobile)||cnt==1))) ? 0:-1);
};
fm.bind('contextmenu', function(e){
var fm=self.fm,
helper=null,
targets, file, link,
getExtra=function(file){
var link=file.url||fm.url(file.hash);
return {
icon: 'link',
node: $('<a/>')
.attr({href: link, target: '_blank', title: fm.i18n('link')})
.text(file.name)
.on('mousedown click touchstart touchmove touchend contextmenu', function(e){
e.stopPropagation();
})
.on('dragstart', function(e){
var dt=e.dataTransfer||e.originalEvent.dataTransfer||null;
helper=null;
if(dt){
var icon=function(f){
var mime=f.mime, i, tmb=fm.tmb(f);
i='<div class="elfinder-cwd-icon '+fm.mime2class(mime)+' ui-corner-all"/>';
if(tmb){
i=$(i).addClass(tmb.className).css('background-image', "url('"+tmb.url+"')").get(0).outerHTML;
}
return i;
};
dt.effectAllowed='copyLink';
if(dt.setDragImage){
helper=$('<div class="elfinder-drag-helper html5-native">').append(icon(file)).appendTo($(document.body));
dt.setDragImage(helper.get(0), 50, 47);
}
if(!fm.UA.IE){
dt.setData('elfinderfrom', window.location.href + file.phash);
dt.setData('elfinderfrom:' + dt.getData('elfinderfrom'), '');
}}
})
.on('dragend', function(e){
helper&&helper.remove();
})
};};
self.extra=null;
if(e.data){
targets=e.data.targets||[];
if(targets.length===1&&(file=fm.file(targets[0]))&&file.mime!=='directory'){
if(file.url!='1'){
self.extra=getExtra(file);
}else{
var node;
self.extra={
icon: 'link',
node: $('<a/>')
.attr({href: '#', title: fm.i18n('getLink'), draggable: 'false'})
.text(file.name)
.on('click touchstart', function(e){
if(e.type==='touchstart'&&e.originalEvent.touches.length > 1){
return;
}
var parent=node.parent();
e.stopPropagation();
e.preventDefault();
parent.removeClass('ui-state-disabled').addClass('elfinder-button-icon-spinner');
fm.request({
data:{cmd:'url', target:file.hash},
preventDefault:true
})
.always(function(data){
parent.removeClass('elfinder-button-icon-spinner');
if(data.url){
var rfile=fm.file(file.hash);
rfile.url=data.url;
node.replaceWith(getExtra(file).node);
}else{
parent.addClass('ui-state-disabled');
}});
})
};
node=self.extra.node;
node.ready(function(){
requestAnimationFrame(function(){
node.parent().addClass('ui-state-disabled').css('pointer-events', 'auto');
});
});
}}
}}).one('open', function(){
if(fm.api >=2.1012){
czipdl=fm.getCommand ('zipdl');
}
dlntf=fm.api > 2.1038&&!fm.isCORS;
});
this.exec=function(select){
var hashes=this.hashes(select),
fm=this.fm,
base=fm.options.url,
files=filter(hashes, true),
dfrd=$.Deferred(),
iframes='',
cdata='',
targets={},
i, url,
linkdl=false,
getTask=function(hashes){
return function(){
var dfd=$.Deferred(),
root=fm.file(fm.root(hashes[0])),
single=(hashes.length===1),
volName=root? (root.i18||root.name):null,
dir, dlName, phash;
if(single){
if(dir=fm.file(hashes[0])){
dlName=(dir.i18||dir.name);
}}else{
$.each(hashes, function(){
var d=fm.file(this);
if(d&&(!phash||phash===d.phash)){
phash=d.phash;
}else{
phash=null;
return false;
}});
if(phash&&(dir=fm.file(phash))){
dlName=(dir.i18||dir.name) + '-' + hashes.length;
}}
if(dlName){
volName=dlName;
}
volName&&(volName=' (' + volName + ')');
fm.request({
data:{cmd:'zipdl', targets:hashes},
notify:{type:'zipdl', cnt:1, hideCnt:true, msg:fm.i18n('ntfzipdl') + volName},
cancel:true,
eachCancel:true,
preventDefault:true
}).done(function(e){
var zipdl, dialog, btn={}, dllink, form, iframe, m,
uniq='dlw' + (+new Date());
if(e.error){
fm.error(e.error);
dfd.resolve();
}else if(e.zipdl){
zipdl=e.zipdl;
if(dlName){
m=fm.splitFileExtention(zipdl.name||'');
dlName +=m[1]? ('.' + m[1]):'.zip';
}else{
dlName=zipdl.name;
}
if((html5dl&&(!fm.UA.Safari||fm.isSameOrigin(fm.options.url)))||linkdl){
url=fm.options.url + (fm.options.url.indexOf('?')===-1 ? '?':'&')
+ 'cmd=zipdl&download=1';
$.each([hashes[0], zipdl.file, dlName, zipdl.mime], function(key, val){
url +='&targets%5B%5D='+encodeURIComponent(val);
});
$.each(fm.customData, function(key, val){
url +='&'+encodeURIComponent(key)+'='+encodeURIComponent(val);
});
url +='&'+encodeURIComponent(dlName);
dllink=$('<a/>')
.attr('href', url)
.attr('download', fm.escape(dlName))
.on('click', function(){
dfd.resolve();
dialog&&dialog.elfinderdialog('destroy');
});
if(linkdl){
dllink.attr('target', '_blank')
.append('<span class="elfinder-button-icon elfinder-button-icon-download"></span>'+fm.escape(dlName));
btn[fm.i18n('btnCancel')]=function(){
dialog.elfinderdialog('destroy');
};
dialog=self.fmDialog(dllink, {
title: fm.i18n('link'),
buttons: btn,
width: '200px',
destroyOnClose: true,
close: function(){
(dfd.state()!=='resolved')&&dfd.resolve();
}});
}else{
click(dllink.hide().appendTo('body').get(0));
dllink.remove();
}}else{
form=$('<form action="'+fm.options.url+'" method="post" target="'+uniq+'" style="display:none"/>')
.append('<input type="hidden" name="cmd" value="zipdl"/>')
.append('<input type="hidden" name="download" value="1"/>');
$.each([hashes[0], zipdl.file, dlName, zipdl.mime], function(key, val){
form.append('<input type="hidden" name="targets[]" value="'+fm.escape(val)+'"/>');
});
$.each(fm.customData, function(key, val){
form.append('<input type="hidden" name="'+key+'" value="'+fm.escape(val)+'"/>');
});
form.attr('target', uniq).appendTo('body');
iframe=$('<iframe style="display:none" name="'+uniq+'">')
.appendTo('body')
.ready(function(){
form.submit().remove();
dfd.resolve();
setTimeout(function(){
iframe.remove();
}, 20000);
});
}}
}).fail(function(error){
error&&fm.error(error);
dfd.resolve();
});
return dfd.promise();
};},
click=function(a){
var clickEv;
if(typeof MouseEvent==='function'){
clickEv=new MouseEvent('click');
}else{
clickEv=document.createEvent('MouseEvents');
clickEv.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
}
fm.pauseUnloadCheck(true);
a.dispatchEvent(clickEv);
},
checkCookie=function(id){
var name='elfdl' + id,
parts;
parts=document.cookie.split(name + "=");
if(parts.length===2){
ntftm&&clearTimeout(ntftm);
document.cookie=name + '=; path=' + cpath + '; max-age=0';
closeNotify();
}else{
setTimeout(function(){ checkCookie(id); }, 200);
}},
closeNotify=function(){
if(fm.ui.notify.children('.elfinder-notify-download').length){
fm.notify({
type:'download',
cnt:-1
});
}},
reqids=[],
link, html5dl, fileCnt, clickEv, cid, ntftm, reqid;
if(!files.length){
return dfrd.reject();
}
fileCnt=$.grep(files, function(f){ return f.mime==='directory'? false:true; }).length;
link=$('<a>').hide().appendTo('body');
html5dl=(typeof link.get(0).download==='string');
if(zipOn&&(fileCnt!==files.length||fileCnt >=(this.options.minFilesZipdl||1))){
link.remove();
linkdl=(!html5dl&&fm.UA.Mobile);
if(mixed){
targets={};
$.each(files, function(i, f){
var p=f.hash.split('_', 2);
if(! targets[p[0]]){
targets[p[0]]=[ f.hash ];
}else{
targets[p[0]].push(f.hash);
}});
if(!linkdl&&fm.UA.Mobile&&Object.keys(targets).length > 1){
linkdl=true;
}}else{
targets=[ $.map(files, function(f){ return f.hash; }) ];
}
dfrd=fm.sequence($.map(targets, function(t){ return getTask(t); })).always(function(){
fm.trigger('download', {files:files});
}
);
return dfrd;
}else{
reqids=[];
for (i=0; i < files.length; i++){
url=fm.openUrl(files[i].hash, true);
if(dlntf&&url.substr(0, fm.options.url.length)===fm.options.url){
reqid=fm.getRequestId();
reqids.push(reqid);
url +='&cpath=' + cpath + '&reqid=' + reqid;
ntftm=setTimeout(function(){
fm.notify({
type:'download',
cnt:1,
cancel:(fm.UA.IE||fm.UA.Edge)? void(0):function(){
if(reqids.length){
$.each(reqids, function(){
fm.request({
data: {
cmd: 'abort',
id: this
},
preventDefault: true
});
});
}
reqids=[];
}});
}, fm.notifyDelay);
checkCookie(reqid);
}
if(html5dl&&(!fm.UA.Safari||fm.isSameOrigin(url))){
click(link.attr('href', url)
.attr('download', fm.escape(files[i].name))
.get(0)
);
}else{
if(fm.UA.Mobile){
setTimeout(function(){
if(! window.open(url)){
fm.error('errPopup');
ntftm&&cleaerTimeout(ntftm);
closeNotify();
}}, 100);
}else{
iframes +='<iframe class="downloader" id="downloader-' + files[i].hash+'" style="display:none" src="'+url+'"/>';
}}
}
link.remove();
$(iframes)
.appendTo('body')
.ready(function(){
setTimeout(function(){
$(iframes).each(function(){
$('#' + $(this).attr('id')).remove();
});
}, 20000 + (10000 * i));
});
fm.trigger('download', {files:files});
return dfrd.resolve();
}};};
elFinder.prototype.commands.duplicate=function(){
var fm=this.fm;
this.getstate=function(select){
var sel=this.files(select),
cnt=sel.length;
return cnt&&fm.cwd().write&&$.grep(sel, function(f){ return f.read&&f.phash===fm.cwd().hash&&! fm.isRoot(f)? true:false; }).length==cnt ? 0:-1;
};
this.exec=function(hashes){
var fm=this.fm,
files=this.files(hashes),
cnt=files.length,
dfrd=$.Deferred()
.fail(function(error){
error&&fm.error(error);
}),
args=[];
if(! cnt){
return dfrd.reject();
}
$.each(files, function(i, file){
if(!file.read||!fm.file(file.phash).write){
return !dfrd.reject(['errCopy', file.name, 'errPerm']);
}});
if(dfrd.state()=='rejected'){
return dfrd;
}
return fm.request({
data:{cmd:'duplicate', targets:this.hashes(hashes)},
notify:{type:'copy', cnt:cnt},
navigate:{
toast:{
inbuffer:{msg: fm.i18n(['complete', fm.i18n('cmdduplicate')])}}
}});
};};
elFinder.prototype.commands.edit=function(){
var self=this,
fm=this.fm,
clsEditing=fm.res('class', 'editing'),
mimesSingle=[],
mimes=[],
allowAll=false,
rtrim=function(str){
return str.replace(/\s+$/, '');
},
getEncSelect=function(heads){
var sel=$('<select class="ui-corner-all"/>'),
hval;
if(heads){
$.each(heads, function(i, head){
hval=fm.escape(head.value);
sel.append('<option value="'+hval+'">'+(head.caption? fm.escape(head.caption):hval)+'</option>');
});
}
$.each(self.options.encodings, function(i, v){
sel.append('<option value="'+v+'">'+v+'</option>');
});
return sel;
},
getDlgWidth=function(){
var m, width;
if(typeof self.options.dialogWidth==='string'&&(m=self.options.dialogWidth.match(/(\d+)%/))){
width=parseInt(fm.getUI().width() * (m[1] / 100));
}else{
width=parseInt(self.options.dialogWidth||650);
}
return Math.min(width, $(window).width());
},
filter=function(files){
var cnt=files.length,
mime, ext, skip;
if(cnt > 1){
mime=files[0].mime;
ext=files[0].name.replace(/^.*(\.[^.]+)$/, '$1');
}
return $.grep(files, function(file){
var res;
if(skip||file.mime==='directory'){
return false;
}
res=file.read
&& (allowAll||fm.mimeIsText(file.mime)||$.inArray(file.mime, cnt===1? mimesSingle:mimes)!==-1)
&& (!self.onlyMimes.length||$.inArray(file.mime, self.onlyMimes)!==-1)
&& (cnt===1||(file.mime===mime&&file.name.substr(ext.length * -1)===ext))
&& (fm.uploadMimeCheck(file.mime, file.phash)? true:false)
&& setEditors(file, cnt)
&& Object.keys(editors).length;
if(!res){
skip=true;
}
return res;
});
},
fileSync=function(hash){
var old=fm.file(hash),
f;
fm.request({
cmd: 'info',
targets: [hash],
preventDefault: true
}).done(function(data){
var changed;
if(data&&data.files&&data.files.length){
f=data.files[0];
if(old.ts!=f.ts||old.size!=f.size){
changed={ changed: [ f ] };
fm.updateCache(changed);
fm.change(changed);
}}
});
},
dialog=function(id, file, content, encoding, editor){
var dfrd=$.Deferred(),
_loaded=false,
loaded=function(){
if(!_loaded){
fm.toast({
mode: 'warning',
msg: fm.i18n('nowLoading')
});
return false;
}
return true;
},
save=function(){
var encord=selEncoding? selEncoding.val():void(0),
saveDfd=$.Deferred().fail(function(err){
dialogNode.show().find('button.elfinder-btncnt-0,button.elfinder-btncnt-1').hide();
}),
conf, res;
if(!loaded()){
return saveDfd.resolve();
}
if(ta.editor){
ta.editor.save(ta[0], ta.editor.instance);
conf=ta.editor.confObj;
if(conf.info&&(conf.info.schemeContent||conf.info.arrayBufferContent)){
encord='scheme';
}}
res=getContent();
setOld(res);
if(res.promise){
res.done(function(data){
dfrd.notifyWith(ta, [encord, ta.data('hash'), old, saveDfd]);
}).fail(function(err){
saveDfd.reject(err);
});
}else{
dfrd.notifyWith(ta, [encord, ta.data('hash'), old, saveDfd]);
}
return saveDfd;
},
saveon=function(){
if(!loaded()){ return; }
save().fail(function(err){
err&&fm.error(err);
});
},
cancel=function(){
ta.elfinderdialog('close');
},
savecl=function(){
if(!loaded()){ return; }
save().done(function(){
_loaded=false;
dialogNode.show();
cancel();
}).fail(function(err){
dialogNode.show();
err&&fm.error(err);
});
dialogNode.hide();
},
saveAs=function(){
if(!loaded()){ return; }
var prevOld=old,
phash=fm.file(file.phash)? file.phash:fm.cwd().hash,
fail=function(err){
dialogs.addClass(clsEditing).fadeIn(function(){
err&&fm.error(err);
});
old=prevOld;
fm.disable();
},
make=function(){
self.mime=saveAsFile.mime||file.mime;
self.prefix=(saveAsFile.name||file.name).replace(/ \d+(\.[^.]+)?$/, '$1');
self.requestCmd='mkfile';
self.nextAction={};
self.data={target:phash};
$.proxy(fm.res('mixin', 'make'), self)()
.done(function(data){
if(data.added&&data.added.length){
ta.data('hash', data.added[0].hash);
save().done(function(){
_loaded=false;
dialogNode.show();
cancel();
dialogs.fadeIn();
}).fail(fail);
}else{
fail();
}})
.progress(function(err){
if(err&&err==='errUploadMime'){
ta.trigger('saveAsFail');
}})
.fail(fail)
.always(function(){
delete self.mime;
delete self.prefix;
delete self.nextAction;
delete self.data;
});
fm.trigger('unselectfiles', { files: [ file.hash ] });
},
reqOpen=null,
dialogs=fm.getUI().children('.' + self.dialogClass + ':visible');
if(dialogNode.is(':hidden')){
dialogs=dialogs.add(dialogNode);
}
dialogs.removeClass(clsEditing).fadeOut();
fm.enable();
if(fm.searchStatus.state < 2&&phash!==fm.cwd().hash){
reqOpen=fm.exec('open', [phash], {thash: phash});
}
$.when([reqOpen]).done(function(){
reqOpen? fm.one('cwdrender', make):make();
}).fail(fail);
},
changed=function(){
var dfd=$.Deferred(),
res, tm;
if(!_loaded){
return dfd.resolve(false);
}
ta.editor&&ta.editor.save(ta[0], ta.editor.instance);
res=getContent();
if(res&&res.promise){
tm=setTimeout(function(){
fm.notify({
type:'chkcontent',
cnt:1,
hideCnt: true
});
}, 100);
res.always(function(){
tm&&clearTimeout(tm);
fm.notify({ type:'chkcontent', cnt: -1 });
}).done(function(d){
dfd.resolve(old!==d);
}).fail(function(err){
dfd.resolve(err||true);
});
}else{
dfd.resolve(old!==res);
}
return dfd;
},
opts={
title:fm.escape(file.name),
width:getDlgWidth(),
buttons:{},
cssClass:clsEditing,
maxWidth:'window',
maxHeight:'window',
allowMinimize:true,
allowMaximize:true,
openMaximized:editorMaximized()||(editor&&editor.info&&editor.info.openMaximized),
btnHoverFocus:false,
closeOnEscape:false,
propagationEvents:['mousemove', 'mouseup', 'click'],
minimize:function(){
var conf;
if(ta.editor&&dialogNode.closest('.ui-dialog').is(':hidden')){
conf=ta.editor.confObj;
if(conf.info&&conf.info.syncInterval){
fileSync(file.hash);
}}
},
close:function(){
var close=function(){
var conf;
dfrd.resolve();
if(ta.editor){
ta.editor.close(ta[0], ta.editor.instance);
conf=ta.editor.confObj;
if(conf.info&&conf.info.syncInterval){
fileSync(file.hash);
}}
ta.elfinderdialog('destroy');
},
onlySaveAs=(typeof saveAsFile.name!=='undefined'),
accept=onlySaveAs? {
label:'btnSaveAs',
callback:function(){
requestAnimationFrame(saveAs);
}}:{
label:'btnSaveClose',
callback:function(){
save().done(function(){
close();
});
}};
changed().done(function(change){
var msgs=['confirmNotSave'];
if(change){
if(typeof change==='string'){
msgs.unshift(change);
}
fm.confirm({
title:self.title,
text:msgs,
accept:accept,
cancel:{
label:'btnClose',
callback:close
},
buttons:onlySaveAs? null:[{
label:'btnSaveAs',
callback:function(){
requestAnimationFrame(saveAs);
}}]
});
}else{
close();
}});
},
open:function(){
var loadRes, conf, interval;
ta.initEditArea.call(ta, id, file, content, fm);
if(ta.editor){
loadRes=ta.editor.load(ta[0])||null;
if(loadRes&&loadRes.done){
loadRes.always(function(){
_loaded=true;
}).done(function(instance){
ta.editor.instance=instance;
ta.editor.focus(ta[0], ta.editor.instance);
setOld(getContent());
requestAnimationFrame(function(){
dialogNode.trigger('resize');
});
}).fail(function(error){
error&&fm.error(error);
ta.elfinderdialog('destroy');
return;
});
}else{
_loaded=true;
if(loadRes&&(typeof loadRes==='string'||Array.isArray(loadRes))){
fm.error(loadRes);
ta.elfinderdialog('destroy');
return;
}
ta.editor.instance=loadRes;
ta.editor.focus(ta[0], ta.editor.instance);
setOld(getContent());
requestAnimationFrame(function(){
dialogNode.trigger('resize');
});
}
conf=ta.editor.confObj;
if(conf.info&&conf.info.syncInterval){
if(interval=parseInt(conf.info.syncInterval)){
setTimeout(function(){
autoSync(interval);
}, interval);
}}
}else{
_loaded=true;
setOld(getContent());
}},
resize:function(e, data){
ta.editor&&ta.editor.resize(ta[0], ta.editor.instance, e, data||{});
}},
getContent=function(){
return ta.getContent.call(ta, ta[0]);
},
setOld=function(res){
if(res&&res.promise){
res.done(function(d){
old=d;
});
}else{
old=res;
}},
autoSync=function(interval){
if(dialogNode.is(':visible')){
fileSync(file.hash);
setTimeout(function(){
autoSync(interval);
}, interval);
}},
saveAsFile={},
ta, old, dialogNode, selEncoding, extEditor, maxW, syncInterval;
if(editor){
if(editor.html){
ta=$(editor.html);
}
extEditor={
init:editor.init||null,
load:editor.load,
getContent:editor.getContent||null,
save:editor.save,
beforeclose:typeof editor.beforeclose=='function' ? editor.beforeclose:void 0,
close:typeof editor.close=='function' ? editor.close:function(){},
focus:typeof editor.focus=='function' ? editor.focus:function(){},
resize:typeof editor.resize=='function' ? editor.resize:function(){},
instance:null,
doSave:saveon,
doCancel:cancel,
doClose:savecl,
file:file,
fm:fm,
confObj:editor,
trigger:function(evName, data){
fm.trigger('editEditor' + evName, Object.assign({}, editor.info||{}, data));
}};}
if(!ta){
if(!fm.mimeIsText(file.mime)){
return dfrd.reject('errEditorNotFound');
}
(function(){
var stateChange=function(){
if(selEncoding){
changed().done(function(change){
if(change){
selEncoding.attr('title', fm.i18n('saveAsEncoding')).addClass('elfinder-edit-changed');
}else{
selEncoding.attr('title', fm.i18n('openAsEncoding')).removeClass('elfinder-edit-changed');
}});
}};
ta=$('<textarea class="elfinder-file-edit" rows="20" id="'+id+'-ta"></textarea>')
.on('input propertychange', stateChange);
if(!ta.editor||!ta.editor.info||ta.editor.info.useTextAreaEvent){
ta.on('keydown', function(e){
var code=e.keyCode,
value, start;
e.stopPropagation();
if(code==$.ui.keyCode.TAB){
e.preventDefault();
if(this.setSelectionRange){
value=this.value;
start=this.selectionStart;
this.value=value.substr(0, start) + "\t" + value.substr(this.selectionEnd);
start +=1;
this.setSelectionRange(start, start);
}}
if(e.ctrlKey||e.metaKey){
if(code=='Q'.charCodeAt(0)||code=='W'.charCodeAt(0)){
e.preventDefault();
cancel();
}
if(code=='S'.charCodeAt(0)){
e.preventDefault();
saveon();
}}
})
.on('mouseenter', function(){this.focus();});
}
ta.initEditArea=function(id, file, content){
var heads=(encoding&&encoding!=='unknown')? [{value: encoding}]:[],
wfake=$('<select/>').hide(),
setSelW=function(init){
init&&wfake.appendTo(selEncoding.parent());
wfake.empty().append($('<option/>').text(selEncoding.val()));
selEncoding.width(wfake.width());
};
ta.hide().val(content);
if(content===''||! encoding||encoding!=='UTF-8'){
heads.push({value: 'UTF-8'});
}
selEncoding=getEncSelect(heads).on('touchstart', function(e){
e.stopPropagation();
}).on('change', function(){
changed().done(function(change){
if(! change&&getContent()!==''){
cancel();
edit(file, selEncoding.val(), editor).fail(function(err){ err&&fm.error(err); });
}});
setSelW();
}).on('mouseover', stateChange);
ta.parent().next().prepend($('<div class="ui-dialog-buttonset elfinder-edit-extras"/>').append(selEncoding));
setSelW(true);
};})();
}
ta.data('hash', file.hash);
if(extEditor){
ta.editor=extEditor;
if(typeof extEditor.beforeclose==='function'){
opts.beforeclose=function(){
return extEditor.beforeclose(ta[0], extEditor.instance);
};}
if(typeof extEditor.init==='function'){
ta.initEditArea=extEditor.init;
}
if(typeof extEditor.getContent==='function'){
ta.getContent=extEditor.getContent;
}}
if(! ta.initEditArea){
ta.initEditArea=function(){};}
if(! ta.getContent){
ta.getContent=function(){
return rtrim(ta.val());
};}
if(!editor||!editor.info||!editor.info.preventGet){
opts.buttons[fm.i18n('btnSave')]=saveon;
opts.buttons[fm.i18n('btnSaveClose')]=savecl;
opts.buttons[fm.i18n('btnSaveAs')]=saveAs;
opts.buttons[fm.i18n('btnCancel')]=cancel;
}
if(editor&&typeof editor.prepare==='function'){
editor.prepare(ta, opts, file);
}
dialogNode=self.fmDialog(ta, opts)
.attr('id', id)
.on('keydown keyup keypress', function(e){
e.stopPropagation();
})
.css({ overflow: 'hidden', minHeight: '7em' })
.addClass('elfinder-edit-editor')
.closest('.ui-dialog')
.on('changeType', function(e, data){
if(data.extention&&data.mime){
var ext=data.extention,
mime=data.mime,
btnSet=$(this).children('.ui-dialog-buttonpane').children('.ui-dialog-buttonset');
btnSet.children('.elfinder-btncnt-0,.elfinder-btncnt-1').hide();
saveAsFile.name=fm.splitFileExtention(file.name)[0] + '.' + data.extention;
saveAsFile.mime=data.mime;
if(!data.keepEditor){
btnSet.children('.elfinder-btncnt-2').trigger('click');
}}
});
maxW=(fm.options.dialogContained? elfNode:$(window)).width();
(dialogNode.width() > maxW)&&dialogNode.width(maxW);
return dfrd.promise();
},
edit=function(file, convert, editor){
var hash=file.hash,
opts=fm.options,
dfrd=$.Deferred(),
id='edit-'+fm.namespace+'-'+file.hash,
d=fm.getUI().find('#'+id),
conv   = !convert? 0:convert,
noContent=false,
req, error, res;
if(d.length){
d.elfinderdialog('toTop');
return dfrd.resolve();
}
if(!file.read||(!file.write&&(!editor.info||!editor.info.converter))){
error=['errOpen', file.name, 'errPerm'];
return dfrd.reject(error);
}
if(editor&&editor.info){
if(typeof editor.info.edit==='function'){
res=editor.info.edit.call(fm, file, editor);
if(res.promise){
res.done(function(){
dfrd.resolve();
}).fail(function(error){
dfrd.reject(error);
});
}else{
res? dfrd.resolve():dfrd.reject();
}
return dfrd;
}
noContent=editor.info.preventGet||editor.info.noContent;
if(editor.info.urlAsContent||noContent){
req=$.Deferred();
if(editor.info.urlAsContent){
fm.url(hash, { async: true, onetime: true, temporary: true }).done(function(url){
req.resolve({content: url});
});
}else{
req.resolve({});
}}else{
req=fm.request({
data:{cmd:'get', target:hash, conv:conv, _t:file.ts},
options:{type: 'get', cache:true},
notify:{type:'file', cnt:1},
preventDefault:true
});
}
req.done(function(data){
var selEncoding, reg, m, res;
if(data.doconv){
fm.confirm({
title:self.title,
text:data.doconv==='unknown'? 'confirmNonUTF8':'confirmConvUTF8',
accept:{
label:'btnConv',
callback:function(){
dfrd=edit(file, selEncoding.val(), editor);
}},
cancel:{
label:'btnCancel',
callback:function(){ dfrd.reject(); }},
optionsCallback:function(options){
options.create=function(){
var base=$('<div class="elfinder-dialog-confirm-encoding"/>'),
head={value: data.doconv},
detected;
if(data.doconv==='unknown'){
head.caption='-';
}
selEncoding=getEncSelect([head]);
$(this).next().find('.ui-dialog-buttonset')
.prepend(base.append($('<label>'+fm.i18n('encoding')+' </label>').append(selEncoding)));
};}});
}else{
if(!noContent&&fm.mimeIsText(file.mime)){
reg=new RegExp('^(data:'+file.mime.replace(/([.+])/g, '\\$1')+';base64,)', 'i');
if(!editor.info.dataScheme){
if(window.atob&&(m=data.content.match(reg))){
data.content=atob(data.content.substr(m[1].length));
}}else{
if(window.btoa&&!data.content.match(reg)){
data.content='data:'+file.mime+';base64,'+btoa(data.content);
}}
}
dialog(id, file, data.content, data.encoding, editor)
.done(function(data){
dfrd.resolve(data);
})
.progress(function(encoding, newHash, data, saveDfd){
var ta=this;
if(newHash){
hash=newHash;
}
fm.request({
options:{type:'post'},
data:{
cmd:'put',
target:hash,
encoding:encoding||data.encoding,
content:data
},
notify:{type:'save', cnt:1},
syncOnFail:true,
preventFail:true,
navigate:{
target:'changed',
toast:{
inbuffer:{msg: fm.i18n(['complete', fm.i18n('btnSave')])}}
}})
.fail(function(error){
dfrd.reject(error);
saveDfd.reject();
})
.done(function(data){
requestAnimationFrame(function(){
ta.trigger('focus');
ta.editor&&ta.editor.focus(ta[0], ta.editor.instance);
});
saveDfd.resolve();
});
})
.fail(function(error){
dfrd.reject(error);
});
}})
.fail(function(error){
var err=fm.parseError(error);
err=Array.isArray(err)? err[0]:err;
(err!=='errConvUTF8')&&fm.sync();
dfrd.reject(error);
});
}
return dfrd.promise();
},
editors={},
fallbackEditor={
info:{
id:'textarea',
name:'TextArea',
useTextAreaEvent:true
},
load:function(textarea){
this.trigger('Prepare', {
node: textarea,
editorObj: void(0),
instance: void(0),
opts: {}});
textarea.setSelectionRange&&textarea.setSelectionRange(0, 0);
$(textarea).trigger('focus').show();
},
save:function(){}},
setEditors=function(file, cnt){
var mimeMatch=function(fileMime, editorMimes){
if(!editorMimes){
return fm.mimeIsText(fileMime);
}else{
if(editorMimes[0]==='*'||$.inArray(fileMime, editorMimes)!==-1){
return true;
}
var i, l;
l=editorMimes.length;
for (i=0; i < l; i++){
if(fileMime.indexOf(editorMimes[i])===0){
return true;
}}
return false;
}},
extMatch=function(fileName, editorExts){
if(!editorExts||!editorExts.length){
return true;
}
var ext=fileName.replace(/^.+\.([^.]+)|(.+)$/, '$1$2').toLowerCase(),
i, l;
l=editorExts.length;
for (i=0; i < l; i++){
if(ext===editorExts[i].toLowerCase()){
return true;
}}
return false;
},
optEditors=self.options.editors||[],
cwdWrite=fm.cwd().write;
stored=fm.storage('storedEditors')||{};
editors={};
if(!optEditors.length){
optEditors=[fallbackEditor];
}
$.each(optEditors, function(i, editor){
var name;
if((cnt===1||!editor.info.single)
&& ((!editor.info||!editor.info.converter)? file.write:cwdWrite)
&& (file.size > 0||(!editor.info.converter&&(editor.info.canMakeEmpty||(editor.info.canMakeEmpty!==false&&fm.mimeIsText(file.mime)))))
&& (!editor.info.maxSize||file.size <=editor.info.maxSize)
&& mimeMatch(file.mime, editor.mimes||null)
&& extMatch(file.name, editor.exts||null)
&& typeof editor.load=='function'
&& typeof editor.save=='function'){
name=editor.info.name? editor.info.name:('Editor ' + i);
editor.id=editor.info.id? editor.info.id:('editor' + i),
editor.name=name;
editor.i18n=fm.i18n(name);
editors[editor.id]=editor;
}});
return Object.keys(editors).length? true:false;
},
store=function(mime, editor){
if(mime&&editor){
if(!$.isPlainObject(stored)){
stored={};}
stored[mime]=editor.id;
fm.storage('storedEditors', stored);
fm.trigger('selectfiles', {files:fm.selected()});
}},
useStoredEditor=function(){
var d=fm.storage('useStoredEditor');
return d? (d > 0):self.options.useStoredEditor;
},
editorMaximized=function(){
var d=fm.storage('editorMaximized');
return d? (d > 0):self.options.editorMaximized;
},
getSubMenuRaw=function(files, callback){
var subMenuRaw=[];
$.each(editors, function(id, ed){
subMenuRaw.push({
label:fm.escape(ed.i18n),
icon:ed.info&&ed.info.icon? ed.info.icon:'edit',
options:{ iconImg: ed.info&&ed.info.iconImg? fm.baseUrl + ed.info.iconImg:void(0) },
callback:function(){
store(files[0].mime, ed);
callback&&callback.call(ed);
}}
);
});
return subMenuRaw;
},
getStoreId=function(name){
return name.toLowerCase().replace(/ +/g, '');
},
getStoredEditor=function(mime){
var name=stored[mime];
return name&&Object.keys(editors).length? editors[getStoreId(name)]:void(0);
},
infoRequest=function(){
},
stored;
this.shortcuts=[{
pattern:'ctrl+e'
}];
this.init=function(){
var self=this,
fm=this.fm,
opts=this.options,
cmdChecks=[],
ccData, dfd;
this.onlyMimes=this.options.mimes||[];
fm.one('open', function(){
if(opts.editors&&Array.isArray(opts.editors)){
fm.trigger('canMakeEmptyFile', {mimes: Object.keys(fm.storage('mkfileTextMimes')||{}).concat(opts.makeTextMimes||['text/plain'])});
$.each(opts.editors, function(i, editor){
if(editor.info&&editor.info.cmdCheck){
cmdChecks.push(editor.info.cmdCheck);
}});
if(cmdChecks.length){
if(fm.api >=2.1030){
dfd=fm.request({
data:{
cmd: 'editor',
name: cmdChecks,
method: 'enabled'
},
preventDefault:true
}).done(function(d){
ccData=d;
}).fail(function(){
ccData={};});
}else{
ccData={};
dfd=$.Deferred().resolve();
}}else{
dfd=$.Deferred().resolve();
}
dfd.always(function(){
if(ccData){
opts.editors=$.grep(opts.editors, function(e){
if(e.info&&e.info.cmdCheck){
return ccData[e.info.cmdCheck]? true:false;
}else{
return true;
}});
}
$.each(opts.editors, function(i, editor){
if(editor.setup&&typeof editor.setup==='function'){
editor.setup.call(editor, opts, fm);
}
if(!editor.disabled){
if(editor.mimes&&Array.isArray(editor.mimes)){
mimesSingle=mimesSingle.concat(editor.mimes);
if(!editor.info||!editor.info.single){
mimes=mimes.concat(editor.mimes);
}}
if(!allowAll&&editor.mimes&&editor.mimes[0]==='*'){
allowAll=true;
}
if(!editor.info){
editor.info={};}
if(editor.info.integrate){
fm.trigger('helpIntegration', Object.assign({cmd: 'edit'}, editor.info.integrate));
}
if(editor.info.canMakeEmpty){
fm.trigger('canMakeEmptyFile', {mimes: editor.mimes});
}}
});
mimesSingle=($.uniqueSort||$.unique)(mimesSingle);
mimes=($.uniqueSort||$.unique)(mimes);
opts.editors=$.grep(opts.editors, function(e){
return e.disabled? false:true;
});
});
}})
.bind('select', function(){
editors=null;
})
.bind('contextmenucreate', function(e){
var file, editor,
single=function(editor){
var title=self.title;
fm.one('contextmenucreatedone', function(){
self.title=title;
});
self.title=fm.escape(editor.i18n);
if(editor.info&&editor.info.iconImg){
self.contextmenuOpts={
iconImg: fm.baseUrl + editor.info.iconImg
};}
delete self.variants;
};
self.contextmenuOpts=void(0);
if(e.data.type==='files'&&self.enabled()){
file=fm.file(e.data.targets[0]);
if(setEditors(file, e.data.targets.length)){
if(Object.keys(editors).length > 1){
if(!useStoredEditor()||!(editor=getStoredEditor(file.mime))){
delete self.extra;
self.variants=[];
$.each(editors, function(id, editor){
self.variants.push([{ editor: editor }, editor.i18n, editor.info&&editor.info.iconImg? fm.baseUrl + editor.info.iconImg:'edit']);
});
}else{
single(editor);
self.extra={
icon: 'menu',
node: $('<span/>')
.attr({title: fm.i18n('select')})
.on('click touchstart', function(e){
if(e.type==='touchstart'&&e.originalEvent.touches.length > 1){
return;
}
var node=$(this);
e.stopPropagation();
e.preventDefault();
fm.trigger('contextmenu', {
raw: getSubMenuRaw(fm.selectedFiles(), function(){
var hashes=fm.selected();
fm.exec('edit', hashes, {editor: this});
fm.trigger('selectfiles', {files:hashes});
}),
x: node.offset().left,
y: node.offset().top
});
})
};}}else{
single(editors[Object.keys(editors)[0]]);
delete self.extra;
}}
}})
.bind('canMakeEmptyFile', function(e){
if(e.data&&e.data.resetTexts){
var defs=fm.arrayFlip(self.options.makeTextMimes||['text/plain']),
hides=fm.storage('mkfileHides')||{};
$.each((fm.storage('mkfileTextMimes')||{}), function(mime, type){
if(!defs[mime]){
delete fm.mimesCanMakeEmpty[mime];
delete hides[mime];
}});
fm.storage('mkfileTextMimes', null);
if(Object.keys(hides).length){
fm.storage('mkfileHides', hides);
}else{
fm.storage('mkfileHides', null);
}}
});
};
this.getstate=function(select){
var sel=this.files(select),
cnt=sel.length;
return cnt&&filter(sel).length==cnt ? 0:-1;
};
this.exec=function(select, opts){
var fm=this.fm,
files=filter(this.files(select)),
hashes=$.map(files, function(f){ return f.hash; }),
list=[],
editor=opts&&opts.editor? opts.editor:null,
node=$(opts&&opts._currentNode? opts._currentNode:fm.cwdHash2Elm(hashes[0])),
getEditor=function(){
var dfd=$.Deferred(),
storedId;
if(!editor&&Object.keys(editors).length > 1){
if(useStoredEditor()&&(editor=getStoredEditor(files[0].mime))){
return dfd.resolve(editor);
}
fm.trigger('contextmenu', {
raw: getSubMenuRaw(files, function(){
dfd.resolve(this);
}),
x: node.offset().left,
y: node.offset().top + 22,
opened: function(){
fm.one('closecontextmenu',function(){
requestAnimationFrame(function(){
if(dfd.state()==='pending'){
dfd.reject();
}});
});
}});
fm.trigger('selectfiles', {files:hashes});
return dfd;
}else{
Object.keys(editors).length > 1&&editor&&store(files[0].mime, editor);
return dfd.resolve(editor? editor:(Object.keys(editors).length? editors[Object.keys(editors)[0]]:null));
}},
dfrd=$.Deferred(),
file;
if(editors===null){
setEditors(files[0], hashes.length);
}
if(!node.length){
node=fm.getUI('cwd');
}
getEditor().done(function(editor){
while ((file=files.shift())){
list.push(edit(file, void(0), editor).fail(function(error){
error&&fm.error(error);
}));
}
if(list.length){
$.when.apply(null, list).done(function(){
dfrd.resolve();
}).fail(function(){
dfrd.reject();
});
}else{
dfrd.reject();
}}).fail(function(){
dfrd.reject();
});
return dfrd;
};};
elFinder.prototype.commands.empty=function(){
var self, fm,
selFiles=function(select){
var sel=self.files(select);
if(!sel.length){
sel=[ fm.cwd() ];
}
return sel;
};
this.linkedCmds=['rm'];
this.init=function(){
self=this;
fm=this.fm;
};
this.getstate=function(select){
var sel=selFiles(select),
cnt;
cnt=sel.length;
return $.grep(sel, function(f){ return f.read&&f.write&&f.mime==='directory' ? true:false; }).length==cnt ? 0:-1;
};
this.exec=function(hashes){
var dirs=selFiles(hashes),
cnt=dirs.length,
dfrd=$.Deferred()
.done(function(){
var data={changed: {}};
fm.toast({msg: fm.i18n(['"'+success.join('", ')+'"', 'complete', fm.i18n('cmdempty')])});
$.each(dirs, function(i, dir){
data.changed[dir.hash]=dir;
});
fm.change(data);
})
.always(function(){
var cwd=fm.cwd().hash;
fm.trigger('selectfiles', {files: $.map(dirs, function(d){ return cwd===d.phash? d.hash:null; })});
}),
success=[],
done=function(res){
if(typeof res==='number'){
success.push(dirs[res].name);
delete dirs[res].dirs;
}else{
res&&fm.error(res);
}
(--cnt < 1)&&dfrd[success.length? 'resolve':'reject']();
};
$.each(dirs, function(i, dir){
var tm;
if(!(dir.write&&dir.mime==='directory')){
done(['errEmpty', dir.name, 'errPerm']);
return null;
}
if(!fm.isCommandEnabled('rm', dir.hash)){
done(['errCmdNoSupport', '"rm"']);
return null;
}
tm=setTimeout(function(){
fm.notify({type:'search', cnt:1, hideCnt:cnt > 1? false:true});
}, fm.notifyDelay);
fm.request({
data:{cmd:'open', target:dir.hash},
preventDefault:true,
asNotOpen:true
}).done(function(data){
var targets=[];
tm&&clearTimeout(tm);
if(fm.ui.notify.children('.elfinder-notify-search').length){
fm.notify({type:'search', cnt:-1, hideCnt:cnt > 1? false:true});
}
if(data&&data.files&&data.files.length){
if(data.files.length > fm.maxTargets){
done(['errEmpty', dir.name, 'errMaxTargets', fm.maxTargets]);
}else{
fm.updateCache(data);
$.each(data.files, function(i, f){
if(!f.write||f.locked){
done(['errEmpty', dir.name, 'errRm', f.name, 'errPerm']);
targets=[];
return false;
}
targets.push(f.hash);
});
if(targets.length){
fm.exec('rm', targets, { _userAction:true, addTexts:[ fm.i18n('folderToEmpty', dir.name) ] })
.fail(function(error){
fm.trigger('unselectfiles', {files: fm.selected()});
done(fm.parseError(error)||'');
})
.done(function(){ done(i); });
}}
}else{
fm.toast({ mode: 'warning', msg: fm.i18n('filderIsEmpty', dir.name)});
done('');
}}).fail(function(error){
done(fm.parseError(error)||'');
});
});
return dfrd;
};};
elFinder.prototype.commands.extract=function(){
var self=this,
fm=self.fm,
mimes=[],
filter=function(files){
return $.grep(files, function(file){
return file.read&&$.inArray(file.mime, mimes)!==-1 ? true:false;
});
};
this.variants=[];
this.disableOnSearch=true;
fm.bind('open reload', function(){
mimes=fm.option('archivers')['extract']||[];
if(fm.api > 2){
self.variants=[[{makedir: true}, fm.i18n('cmdmkdir')], [{}, fm.i18n('btnCwd')]];
}else{
self.variants=[[{}, fm.i18n('btnCwd')]];
}
self.change();
});
this.getstate=function(select){
var sel=this.files(select),
cnt=sel.length;
return cnt&&this.fm.cwd().write&&filter(sel).length==cnt ? 0:-1;
};
this.exec=function(hashes, opts){
var files=this.files(hashes),
dfrd=$.Deferred(),
cnt=files.length,
makedir=opts&&opts.makedir ? 1:0,
i, error,
decision;
var overwriteAll=false;
var omitAll=false;
var mkdirAll=0;
var names=$.map(fm.files(hashes), function(file){ return file.name; });
var map={};
$.grep(fm.files(hashes), function(file){
map[file.name]=file;
return false;
});
var decide=function(decision){
switch (decision){
case 'overwrite_all' :
overwriteAll=true;
break;
case 'omit_all':
omitAll=true;
break;
}};
var unpack=function(file){
if(!(file.read&&fm.file(file.phash).write)){
error=['errExtract', file.name, 'errPerm'];
fm.error(error);
dfrd.reject(error);
}else if($.inArray(file.mime, mimes)===-1){
error=['errExtract', file.name, 'errNoArchive'];
fm.error(error);
dfrd.reject(error);
}else{
fm.request({
data:{cmd:'extract', target:file.hash, makedir:makedir},
notify:{type:'extract', cnt:1},
syncOnFail:true,
navigate:{
toast:makedir? {
incwd:{msg: fm.i18n(['complete', fm.i18n('cmdextract')]), action: {cmd: 'open', msg: 'cmdopen'}},
inbuffer:{msg: fm.i18n(['complete', fm.i18n('cmdextract')]), action: {cmd: 'open', msg: 'cmdopen'}}}:{
inbuffer:{msg: fm.i18n(['complete', fm.i18n('cmdextract')])}}
}})
.fail(function (error){
if(dfrd.state()!='rejected'){
dfrd.reject(error);
}})
.done(function (){
});
}};
var confirm=function(files, index){
var file=files[index],
name=fm.splitFileExtention(file.name)[0],
existed=($.inArray(name, names) >=0),
next=function(){
if((index+1) < cnt){
confirm(files, index+1);
}else{
dfrd.resolve();
}};
if(!makedir&&existed&&map[name].mime!='directory'){
fm.confirm({
title:fm.i18n('ntfextract'),
text:['errExists', name, 'confirmRepl'],
accept:{
label:'btnYes',
callback:function (all){
decision=all ? 'overwrite_all':'overwrite';
decide(decision);
if(!overwriteAll&&!omitAll){
if('overwrite'==decision){
unpack(file);
}
if((index+1) < cnt){
confirm(files, index+1);
}else{
dfrd.resolve();
}}else if(overwriteAll){
for (i=index; i < cnt; i++){
unpack(files[i]);
}
dfrd.resolve();
}}
},
reject:{
label:'btnNo',
callback:function (all){
decision=all ? 'omit_all':'omit';
decide(decision);
if(!overwriteAll&&!omitAll&&(index+1) < cnt){
confirm(files, index+1);
}else if(omitAll){
dfrd.resolve();
}}
},
cancel:{
label:'btnCancel',
callback:function (){
dfrd.resolve();
}},
all:((index+1) < cnt)
}
);
}else if(!makedir){
if(mkdirAll==0){
fm.confirm({
title:fm.i18n('cmdextract'),
text:[fm.i18n('cmdextract')+' "'+file.name+'"', 'confirmRepl'],
accept:{
label:'btnYes',
callback:function (all){
all&&(mkdirAll=1);
unpack(file);
next();
}},
reject:{
label:'btnNo',
callback:function (all){
all&&(mkdirAll=-1);
next();
}},
cancel:{
label:'btnCancel',
callback:function (){
dfrd.resolve();
}},
all:((index+1) < cnt)
});
}else{
(mkdirAll > 0)&&unpack(file);
next();
}}else{
unpack(file);
next();
}};
if(!(this.enabled()&&cnt&&mimes.length)){
return dfrd.reject();
}
if(cnt > 0){
confirm(files, 0);
}
return dfrd;
};};
(elFinder.prototype.commands.forward=function(){
this.alwaysEnabled=true;
this.updateOnSelect=true;
this.shortcuts=[{
pattern:'ctrl+right'
}];
this.getstate=function(){
return this.fm.history.canForward() ? 0:-1;
};
this.exec=function(){
return this.fm.history.forward();
};}).prototype={ forceLoad:true };
elFinder.prototype.commands.fullscreen=function(){
var self=this,
fm=this.fm,
update=function(e, data){
e.preventDefault();
e.stopPropagation();
if(data&&data.fullscreen){
self.update(void(0), (data.fullscreen==='on'));
}};
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.syncTitleOnChange=true;
this.value=false;
this.options={
ui:'fullscreenbutton'
};
this.getstate=function(){
return 0;
};
this.exec=function(){
var node=fm.getUI().get(0),
full=(node===fm.toggleFullscreen(node));
self.title=fm.i18n(full ? 'reinstate':'cmdfullscreen');
self.update(void(0), full);
return $.Deferred().resolve();
};
fm.bind('init', function(){
fm.getUI().off('resize.' + fm.namespace, update).on('resize.' + fm.namespace, update);
});
};
(elFinder.prototype.commands.getfile=function(){
var self=this,
fm=this.fm,
filter=function(files){
var o=self.options;
files=$.grep(files, function(file){
return (file.mime!='directory'||o.folders)&&file.read ? true:false;
});
return o.multiple||files.length==1 ? files:[];
};
this.alwaysEnabled=true;
this.callback=fm.options.getFileCallback;
this._disabled=typeof(this.callback)=='function';
this.getstate=function(select){
var sel=this.files(select),
cnt=sel.length;
return this.callback&&cnt&&filter(sel).length==cnt ? 0:-1;
};
this.exec=function(hashes){
var fm=this.fm,
opts=this.options,
files=this.files(hashes),
cnt=files.length,
url=fm.option('url'),
tmb=fm.option('tmbUrl'),
dfrd=$.Deferred()
.done(function(data){
var res,
done=function(){
if(opts.oncomplete=='close'){
fm.hide();
}else if(opts.oncomplete=='destroy'){
fm.destroy();
}},
fail=function(error){
if(opts.onerror=='close'){
fm.hide();
}else if(opts.onerror=='destroy'){
fm.destroy();
}else{
error&&fm.error(error);
}};
fm.trigger('getfile', {files:data});
try {
res=self.callback(data, fm);
} catch(e){
fail(['Error in `getFileCallback`.', e.message]);
return;
}
if(typeof res==='object'&&typeof res.done==='function'){
res.done(done).fail(fail);
}else{
done();
}}),
result=function(file){
return opts.onlyURL
? opts.multiple ? $.map(files, function(f){ return f.url; }):files[0].url
: opts.multiple ? files:files[0];
},
req=[],
i, file, dim;
for (i=0; i < cnt; i++){
file=files[i];
if(file.mime=='directory'&&!opts.folders){
return dfrd.reject();
}
file.baseUrl=url;
if(file.url=='1'){
req.push(fm.request({
data:{cmd:'url', target:file.hash},
notify:{type:'url', cnt:1, hideCnt:true},
preventDefault:true
})
.done(function(data){
if(data.url){
var rfile=fm.file(this.hash);
rfile.url=this.url=data.url;
}}.bind(file)));
}else{
file.url=fm.url(file.hash);
}
if(! opts.onlyURL){
if(opts.getPath){
file.path=fm.path(file.hash);
if(file.path===''&&file.phash){
(function(){
var dfd=$.Deferred();
req.push(dfd);
fm.path(file.hash, false, {})
.done(function(path){
file.path=path;
})
.fail(function(){
file.path='';
})
.always(function(){
dfd.resolve();
});
})();
}}
if(file.tmb&&file.tmb!=1){
file.tmb=tmb + file.tmb;
}
if(!file.width&&!file.height){
if(file.dim){
dim=file.dim.split('x');
file.width=dim[0];
file.height=dim[1];
}else if(opts.getImgSize&&file.mime.indexOf('image')!==-1){
req.push(fm.request({
data:{cmd:'dim', target:file.hash},
notify:{type:'dim', cnt:1, hideCnt:true},
preventDefault:true
})
.done(function(data){
if(data.dim){
var dim=data.dim.split('x');
var rfile=fm.file(this.hash);
rfile.width=this.width=dim[0];
rfile.height=this.height=dim[1];
}}.bind(file)));
}}
}}
if(req.length){
$.when.apply(null, req).always(function(){
dfrd.resolve(result(files));
});
return dfrd;
}
return dfrd.resolve(result(files));
};}).prototype={ forceLoad:true };
(elFinder.prototype.commands.help=function(){
var fm=this.fm,
self=this,
linktpl='<div class="elfinder-help-link"> <a href="{url}">{link}</a></div>',
linktpltgt='<div class="elfinder-help-link"> <a href="{url}" target="_blank">{link}</a></div>',
atpl='<div class="elfinder-help-team"><div>{author}</div>{work}</div>',
url=/\{url\}/,
link=/\{link\}/,
author=/\{author\}/,
work=/\{work\}/,
r='replace',
prim='ui-priority-primary',
sec='ui-priority-secondary',
lic='elfinder-help-license',
tab='<li class="' + fm.res('class', 'tabstab') + ' elfinder-help-tab-{id}"><a href="#'+fm.namespace+'-help-{id}" class="ui-tabs-anchor">{title}</a></li>',
html=['<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-help">',
'<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-top">'],
stpl='<div class="elfinder-help-shortcut"><div class="elfinder-help-shortcut-pattern">{pattern}</div> {descrip}</div>',
sep='<div class="elfinder-help-separator"/>',
selfUrl=$('base').length? document.location.href.replace(/#.*$/, ''):'',
clTabActive=fm.res('class', 'tabsactive'),
getTheme=function(){
var src;
if(fm.theme&&fm.theme.author){
src=atpl[r]('elfinder-help-team', 'elfinder-help-team elfinder-help-term-theme')[r](author, fm.i18n(fm.theme.author) + (fm.theme.email? ' &lt;'+fm.theme.email+'&gt;':''))[r](work, fm.i18n('theme') + ' ('+fm.i18n(fm.theme.name)+')');
}else{
src='<div class="elfinder-help-team elfinder-help-term-theme" style="display:none"></div>';
}
return src;
},
about=function(){
html.push('<div id="'+fm.namespace+'-help-about" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><div class="elfinder-help-logo"/>');
html.push('<h3>elFinder</h3>');
html.push('<div class="'+prim+'">'+fm.i18n('webfm')+'</div>');
html.push('<div class="'+sec+'">'+fm.i18n('ver')+': '+fm.version+'</div>');
html.push('<div class="'+sec+'">'+fm.i18n('protocolver')+': <span class="apiver"></span></div>');
html.push('<div class="'+sec+'">jQuery/jQuery UI: '+$().jquery+'/'+$.ui.version+'</div>');
html.push(sep);
html.push(linktpltgt[r](url, 'https://studio-42.github.io/elFinder/')[r](link, fm.i18n('homepage')));
html.push(linktpltgt[r](url, 'https://github.com/Studio-42/elFinder/wiki')[r](link, fm.i18n('docs')));
html.push(linktpltgt[r](url, 'https://github.com/Studio-42/elFinder')[r](link, fm.i18n('github')));
html.push(sep);
html.push('<div class="'+prim+'">'+fm.i18n('team')+'</div>');
html.push(atpl[r](author, 'Dmitry "dio" Levashov &lt;dio@std42.ru&gt;')[r](work, fm.i18n('chiefdev')));
html.push(atpl[r](author, 'Naoki Sawada &lt;hypweb+elfinder@gmail.com&gt;')[r](work, fm.i18n('developer')));
html.push(atpl[r](author, 'Troex Nevelin &lt;troex@fury.scancode.ru&gt;')[r](work, fm.i18n('maintainer')));
html.push(atpl[r](author, 'Alexey Sukhotin &lt;strogg@yandex.ru&gt;')[r](work, fm.i18n('contributor')));
if(fm.i18[fm.lang].translator){
$.each(fm.i18[fm.lang].translator.split(', '), function(){
html.push(atpl[r](author, $.trim(this))[r](work, fm.i18n('translator')+' ('+fm.i18[fm.lang].language+')'));
});
}
html.push(getTheme());
html.push(sep);
html.push('<div class="'+lic+'">'+fm.i18n('icons')+': Pixelmixer, <a href="http://p.yusukekamiyamane.com" target="_blank">Fugue</a>, <a href="https://icons8.com" target="_blank">Icons8</a></div>');
html.push(sep);
html.push('<div class="'+lic+'">Licence: 3-clauses BSD Licence</div>');
html.push('<div class="'+lic+'">Copyright © 2009-2019, Studio 42</div>');
html.push('<div class="'+lic+'">„ …'+fm.i18n('dontforget')+' ”</div>');
html.push('</div>');
},
shortcuts=function(){
var sh=fm.shortcuts();
html.push('<div id="'+fm.namespace+'-help-shortcuts" class="ui-tabs-panel ui-widget-content ui-corner-bottom">');
if(sh.length){
html.push('<div class="ui-widget-content elfinder-help-shortcuts">');
$.each(sh, function(i, s){
html.push(stpl.replace(/\{pattern\}/, s[0]).replace(/\{descrip\}/, s[1]));
});
html.push('</div>');
}else{
html.push('<div class="elfinder-help-disabled">'+fm.i18n('shortcutsof')+'</div>');
}
html.push('</div>');
},
help=function(){
html.push('<div id="'+fm.namespace+'-help-help" class="ui-tabs-panel ui-widget-content ui-corner-bottom">');
html.push('<a href="https://github.com/Studio-42/elFinder/wiki" target="_blank" class="elfinder-dont-panic"><span>DON\'T PANIC</span></a>');
html.push('</div>');
},
useInteg=false,
integrations=function(){
useInteg=true;
html.push('<div id="'+fm.namespace+'-help-integrations" class="ui-tabs-panel ui-widget-content ui-corner-bottom"/>');
},
useDebug=false,
debug=function(){
useDebug=true;
html.push('<div id="'+fm.namespace+'-help-debug" class="ui-tabs-panel ui-widget-content ui-corner-bottom">');
html.push('<div class="ui-widget-content elfinder-help-debug"><ul></ul></div>');
html.push('</div>');
},
debugRender=function(){
var render=function(elm, obj){
$.each(obj, function(k, v){
elm.append($('<dt/>').text(k));
if(typeof v==='undefined'){
elm.append($('<dd/>').append($('<span/>').text('undfined')));
}else if(typeof v==='object'&&!v){
elm.append($('<dd/>').append($('<span/>').text('null')));
}else if(typeof v==='object'&&($.isPlainObject(v)||v.length)){
elm.append($('<dd/>').append(render($('<dl/>'), v)));
}else{
elm.append($('<dd/>').append($('<span/>').text((v&&typeof v==='object')? '[]':(v? v:'""'))));
}});
return elm;
},
cnt=debugUL.children('li').length,
targetL, target, tabId,
info, lastUL, lastDIV;
if(self.debug.options||self.debug.debug){
if(cnt >=5){
lastUL=debugUL.children('li:last');
lastDIV=debugDIV.children('div:last');
if(lastDIV.is(':hidden')){
lastUL.remove();
lastDIV.remove();
}else{
lastUL.prev().remove();
lastDIV.prev().remove();
}}
tabId=fm.namespace + '-help-debug-' + (+new Date());
targetL=$('<li/>').html('<a href="'+selfUrl+'#'+tabId+'">'+self.debug.debug.cmd+'</a>').prependTo(debugUL);
target=$('<div id="'+tabId+'"/>').data('debug', self.debug);
targetL.on('click.debugrender', function(){
var debug=target.data('debug');
target.removeData('debug');
if(debug){
target.hide();
if(debug.debug){
info=$('<fieldset>').append($('<legend/>').text('debug'), render($('<dl/>'), debug.debug));
target.append(info);
}
if(debug.options){
info=$('<fieldset>').append($('<legend/>').text('options'), render($('<dl/>'), debug.options));
target.append(info);
}
target.show();
}
targetL.off('click.debugrender');
});
debugUL.after(target);
opened&&debugDIV.tabs('refresh');
}},
content='',
opened, tabInteg, integDIV, tabDebug, debugDIV, debugUL;
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.state=-1;
this.shortcuts=[{
pattern:'f1',
description:this.title
}];
fm.bind('load', function(){
var parts=self.options.view||['about', 'shortcuts', 'help', 'integrations', 'debug'],
i, helpSource, tabBase, tabNav, tabs, delta;
if((i=$.inArray('preference', parts))!==-1){
parts.splice(i, 1);
}
if(! $.fn.tabs){
if((i=$.inArray(parts, 'debug'))!==-1){
parts.splice(i, 1);
}}
$.each(parts, function(i, title){
html.push(tab[r](/\{id\}/g, title)[r](/\{title\}/, fm.i18n(title)));
});
html.push('</ul>');
$.inArray('about', parts)!==-1&&about();
$.inArray('shortcuts', parts)!==-1&&shortcuts();
if($.inArray('help', parts)!==-1){
helpSource=fm.i18nBaseUrl + 'help/%s.html.js';
help();
}
$.inArray('integrations', parts)!==-1&&integrations();
$.inArray('debug', parts)!==-1&&debug();
html.push('</div>');
content=$(html.join(''));
content.find('.ui-tabs-nav li')
.on('mouseenter mouseleave', function(e){
$(this).toggleClass('ui-state-hover', e.type==='mouseenter');
})
.on('focus blur', 'a', function(e){
$(e.delegateTarget).toggleClass('ui-state-focus', e.type==='focusin');
})
.children()
.on('click', function(e){
var link=$(this);
e.preventDefault();
e.stopPropagation();
link.parent().addClass(clTabActive).siblings().removeClass(clTabActive);
content.children('.ui-tabs-panel').hide().filter(link.attr('href')).show();
})
.filter(':first').trigger('click');
if(useInteg){
tabInteg=content.find('.elfinder-help-tab-integrations').hide();
integDIV=content.find('#'+fm.namespace+'-help-integrations').hide().append($('<div class="elfinder-help-integrations-desc"/>').html(fm.i18n('integrationWith')));
fm.bind('helpIntegration', function(e){
var ul=integDIV.children('ul:first'),
data, elm, cmdUL, cmdCls;
if(e.data){
if($.isPlainObject(e.data)){
data=Object.assign({
link: '',
title: '',
banner: ''
}, e.data);
if(data.title||data.link){
if(!data.title){
data.title=data.link;
}
if(data.link){
elm=$('<a/>').attr('href', data.link).attr('target', '_blank').text(data.title);
}else{
elm=$('<span/>').text(data.title);
}
if(data.banner){
elm=$('<span/>').append($('<img/>').attr(data.banner), elm);
}}
}else{
elm=$(e.data);
elm.filter('a').each(function(){
var tgt=$(this);
if(!tgt.attr('target')){
tgt.attr('target', '_blank');;
}});
}
if(elm){
tabInteg.show();
if(!ul.length){
ul=$('<ul class="elfinder-help-integrations"/>').appendTo(integDIV);
}
if(data&&data.cmd){
cmdCls='elfinder-help-integration-' + data.cmd;
cmdUL=ul.find('ul.' + cmdCls);
if(!cmdUL.length){
cmdUL=$('<ul class="'+cmdCls+'"/>');
ul.append($('<li/>').append($('<span/>').html(fm.i18n('cmd'+data.cmd))).append(cmdUL));
}
elm=cmdUL.append($('<li/>').append(elm));
}else{
ul.append($('<li/>').append(elm));
}}
}}).bind('themechange', function(){
content.find('div.elfinder-help-term-theme').replaceWith(getTheme());
});
}
if(useDebug){
tabDebug=content.find('.elfinder-help-tab-debug').hide();
debugDIV=content.find('#'+fm.namespace+'-help-debug').children('div:first');
debugUL=debugDIV.children('ul:first').on('click', function(e){
e.preventDefault();
e.stopPropagation();
});
self.debug={};
fm.bind('backenddebug', function(e){
if(useDebug&&e.data&&e.data.debug){
self.debug={ options:e.data.options, debug:Object.assign({ cmd:fm.currentReqCmd }, e.data.debug) };
if(self.dialog){
debugRender();
}}
});
}
content.find('#'+fm.namespace+'-help-about').find('.apiver').text(fm.api);
self.dialog=self.fmDialog(content, {
title:self.title,
width:530,
maxWidth: 'window',
maxHeight: 'window',
autoOpen:false,
destroyOnClose:false,
close:function(){
if(useDebug){
tabDebug.hide();
debugDIV.tabs('destroy');
}
opened=false;
}})
.on('click', function(e){
e.stopPropagation();
})
.css({
overflow: 'hidden'
});
tabBase=self.dialog.children('.ui-tabs');
tabNav=tabBase.children('.ui-tabs-nav:first');
tabs=tabBase.children('.ui-tabs-panel');
delta=self.dialog.outerHeight(true) - self.dialog.height();
self.dialog.closest('.ui-dialog').on('resize', function(){
tabs.height(self.dialog.height() - delta - tabNav.outerHeight(true) - 20);
});
if(helpSource){
self.dialog.one('initContents', function(){
$.ajax({
url: self.options.helpSource? self.options.helpSource:helpSource.replace('%s', fm.lang),
dataType: 'html'
}).done(function(source){
$('#'+fm.namespace+'-help-help').html(source);
}).fail(function(){
$.ajax({
url: helpSource.replace('%s', 'en'),
dataType: 'html'
}).done(function(source){
$('#'+fm.namespace+'-help-help').html(source);
});
});
});
}
self.state=0;
fm.trigger('helpBuilded', self.dialog);
}).one('open', function(){
var debug=false;
fm.one('backenddebug', function(){
debug=true;
}).one('opendone', function(){
requestAnimationFrame(function(){
if(! debug&&useDebug){
useDebug=false;
tabDebug.hide();
debugDIV.hide();
debugUL.hide();
}});
});
});
this.getstate=function(){
return 0;
};
this.exec=function(sel, opts){
var tab=opts? opts.tab:void(0),
debugShow=function(){
if(useDebug){
debugDIV.tabs();
debugUL.find('a:first').trigger('click');
tabDebug.show();
opened=true;
}};
debugShow();
this.dialog.trigger('initContents').elfinderdialog('open').find((tab? '.elfinder-help-tab-'+tab:'.ui-tabs-nav li') + ' a:first').trigger('click');
return $.Deferred().resolve();
};}).prototype={ forceLoad:true };
elFinder.prototype.commands.hidden=function(){
this.hidden=true;
this.updateOnSelect=false;
this.getstate=function(){
return -1;
};};
elFinder.prototype.commands.hide=function(){
var self=this,
nameCache={},
hideData, hideCnt, cMenuType, sOrigin;
this.syncTitleOnChange=true;
this.shortcuts=[{
pattern:'ctrl+shift+dot',
description:this.fm.i18n('toggleHidden')
}];
this.init=function(){
var fm=this.fm;
hideData=fm.storage('hide')||{items: {}};
hideCnt=Object.keys(hideData.items).length;
this.title=fm.i18n(hideData.show? 'hideHidden':'showHidden');
self.update(void(0), self.title);
};
this.fm.bind('select contextmenucreate closecontextmenu', function(e, fm){
var sel=(e.data? (e.data.selected||e.data.targets):null)||fm.selected();
if(e.type==='select'&&e.data){
sOrigin=e.data.origin;
}else if(e.type==='contextmenucreate'){
cMenuType=e.data.type;
}
if(!sel.length||(((e.type!=='contextmenucreate'&&sOrigin!=='navbar')||cMenuType==='cwd')&&sel[0]===fm.cwd().hash)){
self.title=fm.i18n(hideData.show? 'hideHidden':'showHidden');
}else{
self.title=fm.i18n('cmdhide');
}
if(e.type!=='closecontextmenu'){
self.update(cMenuType==='cwd'? (hideCnt? 0:-1):void(0), self.title);
}else{
cMenuType='';
requestAnimationFrame(function(){
self.update(void(0), self.title);
});
}});
this.getstate=function(sel){
return (cMenuType!=='cwd'&&(sel||this.fm.selected()).length)||hideCnt? 0:-1;
};
this.exec=function(hashes, opts){
var fm=this.fm,
dfrd=$.Deferred()
.done(function(){
fm.trigger('hide', {items: items, opts: opts});
})
.fail(function(error){
fm.error(error);
}),
o=opts||{},
items=o.targets? o.targets:(hashes||fm.selected()),
added=[],
removed=[],
notifyto, files, res;
hideData=fm.storage('hide')||{};
if(!$.isPlainObject(hideData)){
hideData={};}
if(!$.isPlainObject(hideData.items)){
hideData.items={};}
if(opts._currentType==='shortcut'||!items.length||(opts._currentType!=='navbar'&&sOrigin!=='navbar'&&items[0]===fm.cwd().hash)){
if(hideData.show){
o.hide=true;
}else if(Object.keys(hideData.items).length){
o.show=true;
}}
if(o.reset){
o.show=true;
hideCnt=0;
}
if(o.show||o.hide){
if(o.show){
hideData.show=true;
}else{
delete hideData.show;
}
if(o.show){
fm.storage('hide', o.reset? null:hideData);
self.title=fm.i18n('hideHidden');
self.update(o.reset? -1:void(0), self.title);
$.each(hideData.items, function(h){
var f=fm.file(h, true);
if(f&&(fm.searchStatus.state||!f.phash||fm.file(f.phash))){
added.push(f);
}});
if(added.length){
fm.updateCache({added: added});
fm.add({added: added});
}
if(o.reset){
hideData={items: {}};}
return dfrd.resolve();
}
items=Object.keys(hideData.items);
}
if(items.length){
$.each(items, function(i, h){
var f;
if(!hideData.items[h]){
f=fm.file(h);
if(f){
nameCache[h]=f.i18||f.name;
}
hideData.items[h]=nameCache[h]? nameCache[h]:h;
}});
hideCnt=Object.keys(hideData.items).length;
files=this.files(items);
fm.storage('hide', hideData);
fm.remove({removed: items});
if(hideData.show){
this.exec(void(0), {hide: true});
}
if(!o.hide){
res={};
res.undo={
cmd:'hide',
callback:function(){
var nData=fm.storage('hide');
if(nData){
$.each(items, function(i, h){
delete nData.items[h];
});
hideCnt=Object.keys(nData.items).length;
fm.storage('hide', nData);
fm.trigger('hide', {items: items, opts: {}});
self.update(hideCnt? 0:-1);
}
fm.updateCache({added: files});
fm.add({added: files});
}};
res.redo={
cmd:'hide',
callback:function(){
return fm.exec('hide', void(0), {targets: items});
}};}}
return dfrd.state()=='rejected' ? dfrd:dfrd.resolve(res);
};};
(elFinder.prototype.commands.home=function(){
this.title='Home';
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.shortcuts=[{
pattern:'ctrl+home ctrl+shift+up',
description:'Home'
}];
this.getstate=function(){
var root=this.fm.root(),
cwd=this.fm.cwd().hash;
return root&&cwd&&root!=cwd ? 0: -1;
};
this.exec=function(){
return this.fm.exec('open', this.fm.root());
};}).prototype={ forceLoad:true };
(elFinder.prototype.commands.info=function(){
var m='msg',
fm=this.fm,
spclass='elfinder-spinner',
btnclass='elfinder-info-button',
msg={
calc:fm.i18n('calc'),
size:fm.i18n('size'),
unknown:fm.i18n('unknown'),
path:fm.i18n('path'),
aliasfor:fm.i18n('aliasfor'),
modify:fm.i18n('modify'),
perms:fm.i18n('perms'),
locked:fm.i18n('locked'),
dim:fm.i18n('dim'),
kind:fm.i18n('kind'),
files:fm.i18n('files'),
folders:fm.i18n('folders'),
roots:fm.i18n('volumeRoots'),
items:fm.i18n('items'),
yes:fm.i18n('yes'),
no:fm.i18n('no'),
link:fm.i18n('link'),
owner:fm.i18n('owner'),
group:fm.i18n('group'),
perm:fm.i18n('perm'),
getlink:fm.i18n('getLink')
},
applyZWSP=function(str, remove){
if(remove){
return str.replace(/\u200B/g, '');
}else{
return str.replace(/(\/|\\)/g, "$1\u200B");
}};
this.items=['size', 'aliasfor', 'path', 'link', 'dim', 'modify', 'perms', 'locked', 'owner', 'group', 'perm'];
if(this.options.custom&&Object.keys(this.options.custom).length){
$.each(this.options.custom, function(name, details){
details.label&&this.items.push(details.label);
});
}
this.tpl={
main:'<div class="ui-helper-clearfix elfinder-info-title {dirclass}"><span class="elfinder-cwd-icon {class} ui-corner-all"{style}/>{title}</div><table class="elfinder-info-tb">{content}</table>',
itemTitle:'<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>',
groupTitle:'<strong>{items}: {num}</strong>',
row:'<tr><td class="elfinder-info-label">{label}:</td><td class="{class}">{value}</td></tr>',
spinner:'<span>{text}</span> <span class="'+spclass+' '+spclass+'-{name}"/>'
};
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.shortcuts=[{
pattern:'ctrl+i'
}];
this.init=function(){
$.each(msg, function(k, v){
msg[k]=fm.i18n(v);
});
};
this.getstate=function(){
return 0;
};
this.exec=function(hashes){
var files=this.files(hashes);
if(! files.length){
files=this.files([ this.fm.cwd().hash ]);
}
var self=this,
fm=this.fm,
o=this.options,
tpl=this.tpl,
row=tpl.row,
cnt=files.length,
content=[],
view=tpl.main,
l='{label}',
v='{value}',
reqs=[],
reqDfrd=null,
opts={
title:fm.i18n('selectionInfo'),
width:'auto',
close:function(){
$(this).elfinderdialog('destroy');
if(reqDfrd&&reqDfrd.state()==='pending'){
reqDfrd.reject();
}
$.grep(reqs, function(r){
r&&r.state()==='pending'&&r.reject();
});
}},
count=[],
replSpinner=function(msg, name, className){
dialog.find('.'+spclass+'-'+name).parent().html(msg).addClass(className||'');
},
id=fm.namespace+'-info-'+$.map(files, function(f){ return f.hash; }).join('-'),
dialog=fm.getUI().find('#'+id),
customActions=[],
style='',
hashClass='elfinder-font-mono elfinder-info-hash',
size, tmb, file, title, dcnt, rdcnt, path, getHashAlgorisms, hideItems;
if(!cnt){
return $.Deferred().reject();
}
if(dialog.length){
dialog.elfinderdialog('toTop');
return $.Deferred().resolve();
}
hideItems=fm.storage('infohides')||fm.arrayFlip(o.hideItems, true);
if(cnt===1){
file=files[0];
if(file.icon){
style=' '+fm.getIconStyle(file);
}
view=view.replace('{dirclass}', file.csscls? fm.escape(file.csscls):'').replace('{class}', fm.mime2class(file.mime)).replace('{style}', style);
title=tpl.itemTitle.replace('{name}', fm.escape(file.i18||file.name)).replace('{kind}', '<span title="'+fm.escape(file.mime)+'">'+fm.mime2kind(file)+'</span>');
tmb=fm.tmb(file);
if(!file.read){
size=msg.unknown;
}else if(file.mime!='directory'||file.alias){
size=fm.formatSize(file.size);
}else{
size=tpl.spinner.replace('{text}', msg.calc).replace('{name}', 'size');
count.push(file.hash);
}
!hideItems.size&&content.push(row.replace(l, msg.size).replace(v, size));
!hideItems.aleasfor&&file.alias&&content.push(row.replace(l, msg.aliasfor).replace(v, file.alias));
if(!hideItems.path){
if(path=fm.path(file.hash, true)){
content.push(row.replace(l, msg.path).replace(v, applyZWSP(fm.escape(path))).replace('{class}', 'elfinder-info-path'));
}else{
content.push(row.replace(l, msg.path).replace(v, tpl.spinner.replace('{text}', msg.calc).replace('{name}', 'path')).replace('{class}', 'elfinder-info-path'));
reqs.push(fm.path(file.hash, true, {notify: null})
.fail(function(){
replSpinner(msg.unknown, 'path');
})
.done(function(path){
replSpinner(applyZWSP(path), 'path');
}));
}}
if(!hideItems.link&&file.read){
var href,
name_esc=fm.escape(file.name);
if(file.url=='1'){
content.push(row.replace(l, msg.link).replace(v, '<button class="'+btnclass+' '+spclass+'-url">'+msg.getlink+'</button>'));
}else{
if(file.url){
href=file.url;
}else if(file.mime==='directory'){
if(o.nullUrlDirLinkSelf&&file.url===null){
var loc=window.location;
href=loc.pathname + loc.search + '#elf_' + file.hash;
}else if(file.url!==''&&fm.option('url', (!fm.isRoot(file)&&file.phash)||file.hash)){
href=fm.url(file.hash);
}}else{
href=fm.url(file.hash);
}
href&&content.push(row.replace(l, msg.link).replace(v,  '<a href="'+href+'" target="_blank">'+name_esc+'</a>'));
}}
if(!hideItems.dim){
if(file.dim){
content.push(row.replace(l, msg.dim).replace(v, file.dim));
}else if(file.mime.indexOf('image')!==-1){
if(file.width&&file.height){
content.push(row.replace(l, msg.dim).replace(v, file.width+'x'+file.height));
}else{
content.push(row.replace(l, msg.dim).replace(v, tpl.spinner.replace('{text}', msg.calc).replace('{name}', 'dim')));
reqs.push(fm.request({
data:{cmd:'dim', target:file.hash},
preventDefault:true
})
.fail(function(){
replSpinner(msg.unknown, 'dim');
})
.done(function(data){
replSpinner(data.dim||msg.unknown, 'dim');
if(data.dim){
var dim=data.dim.split('x');
var rfile=fm.file(file.hash);
rfile.width=dim[0];
rfile.height=dim[1];
}}));
}}
}
!hideItems.modify&&content.push(row.replace(l, msg.modify).replace(v, fm.formatDate(file)));
!hideItems.perms&&content.push(row.replace(l, msg.perms).replace(v, fm.formatPermissions(file)));
!hideItems.locked&&content.push(row.replace(l, msg.locked).replace(v, file.locked ? msg.yes:msg.no));
!hideItems.owner&&file.owner&&content.push(row.replace(l, msg.owner).replace(v, file.owner));
!hideItems.group&&file.group&&content.push(row.replace(l, msg.group).replace(v, file.group));
!hideItems.perm&&file.perm&&content.push(row.replace(l, msg.perm).replace(v, fm.formatFileMode(file.perm)));
if(window.ArrayBuffer&&(fm.options.cdns.sparkmd5||fm.options.cdns.jssha)&&file.mime!=='directory'&&file.size > 0&&(!o.showHashMaxsize||file.size <=o.showHashMaxsize)){
getHashAlgorisms=[];
$.each(fm.storage('hashchekcer')||o.showHashAlgorisms, function(i, n){
if(!file[n]){
content.push(row.replace(l, fm.i18n(n)).replace(v, tpl.spinner.replace('{text}', msg.calc).replace('{name}', n)));
getHashAlgorisms.push(n);
}else{
content.push(row.replace(l, fm.i18n(n)).replace(v, file[n]).replace('{class}', hashClass));
}});
reqs.push(fm.getContentsHashes(file.hash, getHashAlgorisms).progress(function(hashes){
$.each(getHashAlgorisms, function(i, n){
if(hashes[n]){
replSpinner(hashes[n], n, hashClass);
}});
}).always(function(){
$.each(getHashAlgorisms, function(i, n){
replSpinner(msg.unknown, n);
});
})
);
}
if(o.custom){
$.each(o.custom, function(name, details){
if(!hideItems[details.label]
&&
(!details.mimes||$.grep(details.mimes, function(m){return (file.mime===m||file.mime.indexOf(m+'/')===0)? true:false;}).length)
&&
(!details.hashRegex||file.hash.match(details.hashRegex))
){
content.push(row.replace(l, fm.i18n(details.label)).replace(v , details.tpl.replace('{id}', id)));
if(details.action&&(typeof details.action=='function')){
customActions.push(details.action);
}}
});
}}else{
view=view.replace('{class}', 'elfinder-cwd-icon-group');
title=tpl.groupTitle.replace('{items}', msg.items).replace('{num}', cnt);
dcnt=$.grep(files, function(f){ return f.mime=='directory' ? true:false ; }).length;
if(!dcnt){
size=0;
$.each(files, function(h, f){
var s=parseInt(f.size);
if(s >=0&&size >=0){
size +=s;
}else{
size='unknown';
}});
content.push(row.replace(l, msg.kind).replace(v, msg.files));
!hideItems.size&&content.push(row.replace(l, msg.size).replace(v, fm.formatSize(size)));
}else{
rdcnt=$.grep(files, function(f){ return f.mime==='directory'&&(! f.phash||f.isroot)? true:false ; }).length;
dcnt -=rdcnt;
content.push(row.replace(l, msg.kind).replace(v, (rdcnt===cnt||dcnt===cnt)? msg[rdcnt? 'roots':'folders']:$.map({roots: rdcnt, folders: dcnt, files: cnt - rdcnt - dcnt}, function(c, t){ return c? msg[t]+' '+c:null; }).join(', ')));
!hideItems.size&&content.push(row.replace(l, msg.size).replace(v, tpl.spinner.replace('{text}', msg.calc).replace('{name}', 'size')));
count=$.map(files, function(f){ return f.hash; });
}}
view=view.replace('{title}', title).replace('{content}', content.join('').replace(/{class}/g, ''));
dialog=self.fmDialog(view, opts);
dialog.attr('id', id).one('mousedown', '.elfinder-info-path', function(){
$(this).html(applyZWSP($(this).html(), true));
});
if(fm.UA.Mobile&&$.fn.tooltip){
dialog.children('.ui-dialog-content .elfinder-info-title').tooltip({
classes: {
'ui-tooltip': 'elfinder-ui-tooltip ui-widget-shadow'
},
tooltipClass: 'elfinder-ui-tooltip ui-widget-shadow',
track: true
});
}
if(file&&file.url=='1'){
dialog.on('click', '.'+spclass+'-url', function(){
$(this).parent().html(tpl.spinner.replace('{text}', fm.i18n('ntfurl')).replace('{name}', 'url'));
fm.request({
data:{cmd:'url', target:file.hash},
preventDefault:true
})
.fail(function(){
replSpinner(name_esc, 'url');
})
.done(function(data){
if(data.url){
replSpinner('<a href="'+data.url+'" target="_blank">'+name_esc+'</a>'||name_esc, 'url');
var rfile=fm.file(file.hash);
rfile.url=data.url;
}else{
replSpinner(name_esc, 'url');
}});
});
}
if(tmb){
$('<img/>')
.on('load', function(){ dialog.find('.elfinder-cwd-icon').addClass(tmb.className).css('background-image', "url('"+tmb.url+"')"); })
.attr('src', tmb.url);
}
if(count.length){
reqDfrd=fm.getSize(count).done(function(data){
replSpinner(data.formated, 'size');
}).fail(function(){
replSpinner(msg.unknown, 'size');
});
}
if(customActions.length){
$.each(customActions, function(i, action){
try {
action(file, fm, dialog);
} catch(e){
fm.debug('error', e);
}});
}
return $.Deferred().resolve();
};}).prototype={ forceLoad:true };
elFinder.prototype.commands.mkdir=function(){
var fm=this.fm,
self=this,
curOrg;
this.value='';
this.disableOnSearch=true;
this.updateOnSelect=false;
this.syncTitleOnChange=true;
this.mime='directory';
this.prefix='untitled folder';
this.exec=function(select, cOpts){
var onCwd;
if(select&&select.length&&cOpts&&cOpts._currentType&&cOpts._currentType==='navbar'){
this.origin=cOpts._currentType;
this.data={
target: select[0]
};}else{
onCwd=fm.cwd().hash===select[0];
this.origin=curOrg&&!onCwd? curOrg:'cwd';
delete this.data;
}
if(! select&&! this.options.intoNewFolderToolbtn){
fm.getUI('cwd').trigger('unselectall');
}
this.move=this.value===fm.i18n('cmdmkdirin');
return $.proxy(fm.res('mixin', 'make'), self)();
};
this.shortcuts=[{
pattern:'ctrl+shift+n'
}];
this.init=function(){
if(this.options.intoNewFolderToolbtn){
this.syncTitleOnChange=true;
}};
fm.bind('select contextmenucreate closecontextmenu', function(e){
var sel=(e.data? (e.data.selected||e.data.targets):null)||fm.selected();
self.className='mkdir';
curOrg=e.data&&sel.length? (e.data.origin||e.data.type||''):'';
if(!self.options.intoNewFolderToolbtn&&curOrg===''){
curOrg='cwd';
}
if(sel.length&&curOrg!=='navbar'&&curOrg!=='cwd'&&fm.cwd().hash!==sel[0]){
self.title=fm.i18n('cmdmkdirin');
self.className +=' elfinder-button-icon-mkdirin';
}else{
self.title=fm.i18n('cmdmkdir');
}
if(e.type!=='closecontextmenu'){
self.update(void(0), self.title);
}else{
requestAnimationFrame(function(){
self.update(void(0), self.title);
});
}});
this.getstate=function(select){
var cwd=fm.cwd(),
sel=(curOrg==='navbar'||(select&&select[0]!==cwd.hash))? this.files(select||fm.selected()):[],
cnt=sel.length;
if(curOrg==='navbar'){
return cnt&&sel[0].write&&sel[0].read? 0:-1;
}else{
return cwd.write&&(!cnt||$.grep(sel, function(f){ return f.read&&! f.locked? true:false; }).length==cnt)? 0:-1;
}};};
elFinder.prototype.commands.mkfile=function(){
var self=this;
this.disableOnSearch=true;
this.updateOnSelect=false;
this.mime='text/plain';
this.prefix='untitled file.txt';
this.variants=[];
this.getTypeName=function(mime, type){
var fm=self.fm,
name;
if(name=fm.messages['kind' + fm.kinds[mime]]){
name=fm.i18n(['extentiontype', type.toUpperCase(), name]);
}else{
name=fm.i18n(['extentionfile', type.toUpperCase()]);
}
return name;
};
this.fm.bind('open reload canMakeEmptyFile', function(){
var fm=self.fm,
hides=fm.storage('mkfileHides')||{};
self.variants=[];
if(fm.mimesCanMakeEmpty){
$.each(fm.mimesCanMakeEmpty, function(mime, type){
type&&!hides[mime]&&fm.uploadMimeCheck(mime)&&self.variants.push([mime, self.getTypeName(mime, type)]);
});
}
self.change();
});
this.getstate=function(){
return this.fm.cwd().write ? 0:-1;
};
this.exec=function(_dum, mime){
var fm=self.fm,
type, err;
if(type=fm.mimesCanMakeEmpty[mime]){
if(fm.uploadMimeCheck(mime)){
this.mime=mime;
this.prefix=fm.i18n(['untitled file', type]);
return $.proxy(fm.res('mixin', 'make'), self)();
}
err=['errMkfile', self.getTypeName(mime, type)];
}
return $.Deferred().reject(err);
};};
elFinder.prototype.commands.netmount=function(){
var self=this,
hasMenus=false,
content;
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.drivers=[];
this.handlers={
load:function(){
var fm=self.fm;
self.drivers=fm.netDrivers;
if(self.drivers.length){
requestAnimationFrame(function(){
$.each(self.drivers, function(){
var d=self.options[this];
if(d){
hasMenus=true;
if(d.integrateInfo){
fm.trigger('helpIntegration', Object.assign({cmd: 'netmount'}, d.integrateInfo));
}}
});
});
}}
};
this.getstate=function(){
return hasMenus ? 0:-1;
};
this.exec=function(){
var fm=self.fm,
dfrd=$.Deferred(),
o=self.options,
create=function(){
var winFocus=function(){
inputs.protocol.trigger('change', 'winfocus');
},
inputs={
protocol:$('<select/>')
.on('change', function(e, data){
var protocol=this.value;
content.find('.elfinder-netmount-tr').hide();
content.find('.elfinder-netmount-tr-'+protocol).show();
dialogNode&&dialogNode.children('.ui-dialog-buttonpane:first').find('button').show();
if(typeof o[protocol].select=='function'){
o[protocol].select(fm, e, data);
}
requestAnimationFrame(function(){
content.find('input:text.elfinder-tabstop:visible:first').trigger('focus');
});
})
.addClass('ui-corner-all')
},
opts={
title:fm.i18n('netMountDialogTitle'),
resizable:false,
modal:true,
destroyOnClose:false,
open:function(){
$(window).on('focus.'+fm.namespace, winFocus);
inputs.protocol.trigger('change');
},
close:function(){
dfrd.state()=='pending'&&dfrd.reject();
$(window).off('focus.'+fm.namespace, winFocus);
},
buttons:{}},
doMount=function(){
var protocol=inputs.protocol.val(),
data={cmd:'netmount', protocol: protocol},
cur=o[protocol];
$.each(content.find('input.elfinder-netmount-inputs-'+protocol), function(name, input){
var val, elm;
elm=$(input);
if(elm.is(':radio,:checkbox')){
if(elm.is(':checked')){
val=$.trim(elm.val());
}}else{
val=$.trim(elm.val());
}
if(val){
data[input.name]=val;
}});
if(!data.host){
return fm.trigger('error', {error:'errNetMountHostReq', opts:{modal: true}});
}
fm.request({data:data, notify:{type:'netmount', cnt:1, hideCnt:true}})
.done(function(data){
var pdir;
if(data.added&&data.added.length){
if(data.added[0].phash){
if(pdir=fm.file(data.added[0].phash)){
if(! pdir.dirs){
pdir.dirs=1;
fm.change({ changed: [ pdir ] });
}}
}
fm.one('netmountdone', function(){
fm.exec('open', data.added[0].hash);
});
}
dfrd.resolve();
})
.fail(function(error){
if(cur.fail&&typeof cur.fail=='function'){
cur.fail(fm, fm.parseError(error));
}
dfrd.reject(error);
});
self.dialog.elfinderdialog('close');
},
form=$('<form autocomplete="off"/>').on('keydown', 'input', function(e){
var comp=true,
next;
if(e.keyCode===$.ui.keyCode.ENTER){
$.each(form.find('input:visible:not(.elfinder-input-optional)'), function(){
if($(this).val()===''){
comp=false;
next=$(this);
return false;
}});
if(comp){
doMount();
}else{
next.trigger('focus');
}}
}),
hidden=$('<div/>'),
dialog;
content=$('<table class="elfinder-info-tb elfinder-netmount-tb"/>')
.append($('<tr/>').append($('<td>'+fm.i18n('protocol')+'</td>')).append($('<td/>').append(inputs.protocol)));
$.each(self.drivers, function(i, protocol){
if(o[protocol]){
inputs.protocol.append('<option value="'+protocol+'">'+fm.i18n(o[protocol].name||protocol)+'</option>');
$.each(o[protocol].inputs, function(name, input){
input.attr('name', name);
if(input.attr('type')!='hidden'){
input.addClass('ui-corner-all elfinder-netmount-inputs-'+protocol);
content.append($('<tr/>').addClass('elfinder-netmount-tr elfinder-netmount-tr-'+protocol).append($('<td>'+fm.i18n(name)+'</td>')).append($('<td/>').append(input)));
}else{
input.addClass('elfinder-netmount-inputs-'+protocol);
hidden.append(input);
}});
o[protocol].protocol=inputs.protocol;
}});
content.append(hidden);
content.find('.elfinder-netmount-tr').hide();
opts.buttons[fm.i18n('btnMount')]=doMount;
opts.buttons[fm.i18n('btnCancel')]=function(){
self.dialog.elfinderdialog('close');
};
content.find('select,input').addClass('elfinder-tabstop');
dialog=self.fmDialog(form.append(content), opts);
dialogNode=dialog.closest('.ui-dialog');
dialog.ready(function(){
inputs.protocol.trigger('change');
dialog.elfinderdialog('posInit');
});
return dialog;
},
dialogNode;
if(!self.dialog){
self.dialog=create();
}else{
self.dialog.elfinderdialog('open');
}
return dfrd.promise();
};
self.fm.bind('netmount', function(e){
var d=e.data||null,
o=self.options;
if(d&&d.protocol){
if(o[d.protocol]&&typeof o[d.protocol].done=='function'){
o[d.protocol].done(self.fm, d);
content.find('select,input').addClass('elfinder-tabstop');
self.dialog.elfinderdialog('tabstopsInit');
}}
});
};
elFinder.prototype.commands.netunmount=function(){
var self=this;
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.drivers=[];
this.handlers={
load:function(){
this.drivers=this.fm.netDrivers;
}};
this.getstate=function(sel){
var fm=this.fm,
file;
return !!sel&&this.drivers.length&&!this._disabled&&(file=fm.file(sel[0]))&&file.netkey ? 0:-1;
};
this.exec=function(hashes){
var self=this,
fm=this.fm,
dfrd=$.Deferred()
.fail(function(error){
error&&fm.error(error);
}),
drive=fm.file(hashes[0]),
childrenRoots=function(hash){
var roots=[],
work;
if(fm.leafRoots){
work=[];
$.each(fm.leafRoots, function(phash, hashes){
var parents=fm.parents(phash),
idx, deep;
if((idx=$.inArray(hash, parents))!==-1){
idx=parents.length - idx;
$.each(hashes, function(i, h){
work.push({i: idx, hash: h});
});
}});
if(work.length){
work.sort(function(a, b){ return a.i < b.i; });
$.each(work, function(i, o){
roots.push(o.hash);
});
}}
return roots;
};
if(this._disabled){
return dfrd.reject();
}
if(dfrd.state()=='pending'){
fm.confirm({
title:self.title,
text:fm.i18n('confirmUnmount', drive.name),
accept:{
label:'btnUnmount',
callback:function(){
var target=drive.hash,
roots=childrenRoots(target),
requests=[],
removed=[],
doUmount=function(){
$.when(requests).done(function(){
fm.request({
data:{cmd:'netmount', protocol:'netunmount', host: drive.netkey, user:target, pass:'dum'},
notify:{type:'netunmount', cnt:1, hideCnt:true},
preventFail:true
})
.fail(function(error){
dfrd.reject(error);
})
.done(function(data){
drive.volumeid&&delete fm.volumeExpires[drive.volumeid];
dfrd.resolve();
});
}).fail(function(error){
if(removed.length){
fm.remove({ removed: removed });
}
dfrd.reject(error);
});
};
if(roots.length){
fm.confirm({
title:self.title,
text:(function(){
var msgs=['unmountChildren'];
$.each(roots, function(i, hash){
msgs.push([fm.file(hash).name]);
});
return msgs;
})(),
accept:{
label:'btnUnmount',
callback:function(){
$.each(roots, function(i, hash){
var d=fm.file(hash);
if(d.netkey){
requests.push(fm.request({
data:{cmd:'netmount', protocol:'netunmount', host: d.netkey, user:d.hash, pass:'dum'},
notify:{type:'netunmount', cnt:1, hideCnt:true},
preventDefault:true
}).done(function(data){
if(data.removed){
d.volumeid&&delete fm.volumeExpires[d.volumeid];
removed=removed.concat(data.removed);
}}));
}});
doUmount();
}},
cancel:{
label:'btnCancel',
callback:function(){
dfrd.reject();
}}
});
}else{
requests=null;
doUmount();
}}
},
cancel:{
label:'btnCancel',
callback:function(){ dfrd.reject(); }}
});
}
return dfrd;
};};
(elFinder.prototype.commands.open=function(){
var fm=this.fm;
this.alwaysEnabled=true;
this.noChangeDirOnRemovedCwd=true;
this._handlers={
dblclick:function(e){ e.preventDefault(); fm.exec('open', e.data&&e.data.file? [ e.data.file ]: void(0)); },
'select enable disable reload':function(e){ this.update(e.type=='disable' ? -1:void(0));  }};
this.shortcuts=[{
pattern:'ctrl+down numpad_enter'+(fm.OS!='mac'&&' enter')
}];
this.getstate=function(select){
var sel=this.files(select),
cnt=sel.length;
return cnt==1 
? (sel[0].read? 0:-1)
: (cnt&&!fm.UA.Mobile) ? ($.grep(sel, function(file){ return file.mime=='directory'||! file.read ? false:true;}).length==cnt ? 0:-1):-1;
};
this.exec=function(hashes, cOpts){
var dfrd=$.Deferred().fail(function(error){ error&&fm.error(error); }),
files=this.files(hashes),
cnt=files.length,
thash=(typeof cOpts=='object')? cOpts.thash:false,
opts=this.options,
into=opts.into||'window',
file, url, s, w, imgW, imgH, winW, winH, reg, link, html5dl, inline,
selAct, cmd;
if(!cnt&&!thash){
{
return dfrd.reject();
}}
if(thash||(cnt==1&&(file=files[0])&&file.mime=='directory')){
if(!thash&&file&&!file.read){
return dfrd.reject(['errOpen', file.name, 'errPerm']);
}else{
if(fm.keyState.ctrlKey&&(fm.keyState.shiftKey||typeof fm.options.getFileCallback!=='function')){
if(fm.getCommand ('opennew')){
return fm.exec('opennew', [thash? thash:file.hash]);
}}
return fm.request({
data:{cmd:'open', target:thash||file.hash},
notify:{type:'open', cnt:1, hideCnt:true},
syncOnFail:true,
lazy:false
});
}}
files=$.grep(files, function(file){ return file.mime!='directory' ? true:false; });
if(cnt!=files.length){
return dfrd.reject();
}
var doOpen=function(){
var wnd, target, getOnly;
try {
reg=new RegExp(fm.option('dispInlineRegex'), 'i');
} catch(e){
reg=false;
}
link=$('<a>').hide().appendTo($('body')),
html5dl=(typeof link.get(0).download==='string');
cnt=files.length;
while (cnt--){
target='elf_open_window';
file=files[cnt];
if(!file.read){
return dfrd.reject(['errOpen', file.name, 'errPerm']);
}
inline=(reg&&file.mime.match(reg));
url=fm.openUrl(file.hash, !inline);
if(fm.UA.Mobile||!inline){
if(html5dl){
if(!inline){
link.attr('download', file.name);
}else{
link.attr('target', '_blank');
}
link.attr('href', url).get(0).click();
}else{
wnd=window.open(url);
if(!wnd){
return dfrd.reject('errPopup');
}}
}else{
getOnly=(typeof opts.method==='string'&&opts.method.toLowerCase()==='get');
if(!getOnly
&& url.indexOf(fm.options.url)===0
&& fm.customData
&& Object.keys(fm.customData).length
&& !file.mime.match(/^(?:video|audio)/)
){
url='';
}
if(into==='window'){
imgW=winW=Math.round(2 * screen.availWidth / 3);
imgH=winH=Math.round(2 * screen.availHeight / 3);
if(parseInt(file.width)&&parseInt(file.height)){
imgW=parseInt(file.width);
imgH=parseInt(file.height);
}else if(file.dim){
s=file.dim.split('x');
imgW=parseInt(s[0]);
imgH=parseInt(s[1]);
}
if(winW >=imgW&&winH >=imgH){
winW=imgW;
winH=imgH;
}else{
if((imgW - winW) > (imgH - winH)){
winH=Math.round(imgH * (winW / imgW));
}else{
winW=Math.round(imgW * (winH / imgH));
}}
w='width='+winW+',height='+winH;
wnd=window.open(url, target, w + ',top=50,left=50,scrollbars=yes,resizable=yes,titlebar=no');
}else{
if(into==='tabs'){
target=file.hash;
}
wnd=window.open('about:blank', target);
}
if(!wnd){
return dfrd.reject('errPopup');
}
if(url===''){
var form=document.createElement("form");
form.action=fm.options.url;
form.method='POST';
form.target=target;
form.style.display='none';
var params=Object.assign({}, fm.customData, {
cmd: 'file',
target: file.hash,
_t: file.ts||parseInt(+new Date()/1000)
});
$.each(params, function(key, val){
var input=document.createElement("input");
input.name=key;
input.value=val;
form.appendChild(input);
});
document.body.appendChild(form);
form.submit();
}else if(into!=='window'){
wnd.location=url;
}
$(wnd).trigger('focus');
}}
link.remove();
return dfrd.resolve(hashes);
};
if(cnt > 1){
fm.confirm({
title: 'openMulti',
text:['openMultiConfirm', cnt + ''],
accept:{
label:'cmdopen',
callback:function(){ doOpen(); }},
cancel:{
label:'btnCancel',
callback:function(){
dfrd.reject();
}},
buttons:(fm.getCommand ('zipdl')&&fm.isCommandEnabled('zipdl', fm.cwd().hash))? [
{
label:'cmddownload',
callback:function(){
fm.exec('download', hashes);
dfrd.reject();
}}
]:[]
});
}else{
selAct=fm.storage('selectAction')||opts.selectAction;
if(selAct){
$.each(selAct.split('/'), function(){
var cmdName=this.valueOf();
if(cmdName!=='open'&&(cmd=fm.getCommand (cmdName))&&cmd.enabled()){
return false;
}
cmd=null;
});
if(cmd){
return fm.exec(cmd.name);
}}
doOpen();
}
return dfrd;
};}).prototype={ forceLoad:true };
elFinder.prototype.commands.opendir=function(){
this.alwaysEnabled=true;
this.getstate=function(){
var sel=this.fm.selected(),
cnt=sel.length,
wz;
if(cnt!==1){
return -1;
}
wz=this.fm.getUI('workzone');
return wz.hasClass('elfinder-search-result')? 0:-1;
};
this.exec=function(hashes){
var fm=this.fm,
dfrd=$.Deferred(),
files=this.files(hashes),
cnt=files.length,
hash, pcheck=null;
if(!cnt||!files[0].phash){
return dfrd.reject();
}
hash=files[0].phash;
fm.trigger('searchend', { noupdate: true });
fm.request({
data:{cmd:'open', target:hash},
notify:{type:'open', cnt:1, hideCnt:true},
syncOnFail:false
});
return dfrd;
};};
elFinder.prototype.commands.opennew=function(){
var fm=this.fm;
this.shortcuts=[{
pattern:(typeof(fm.options.getFileCallback)==='function'? 'shift+':'') + 'ctrl+enter'
}];
this.getstate=function(select){
var sel=this.files(select),
cnt=sel.length;
return cnt===1 
? (sel[0].mime==='directory'&&sel[0].read? 0:-1)
: -1;
};
this.exec=function(hashes){
var dfrd=$.Deferred(),
files=this.files(hashes),
cnt=files.length,
opts=this.options,
file, loc, url, win;
if(cnt===1&&(file=files[0])&&file.mime==='directory'){
loc=window.location;
if(opts.url){
url=opts.url;
}else{
url=loc.pathname;
}
if(opts.useOriginQuery){
if(!url.match(/\?/)){
url +=loc.search;
}else if(loc.search){
url +='&' + loc.search.substr(1);
}}
url +='#elf_' + file.hash;
win=window.open(url, '_blank');
setTimeout(function(){
win.focus();
}, 1000);
return dfrd.resolve();
}else{
return dfrd.reject();
}};};
elFinder.prototype.commands.paste=function(){
this.updateOnSelect=false;
this.handlers={
changeclipboard:function(){ this.update(); }};
this.shortcuts=[{
pattern:'ctrl+v shift+insert'
}];
this.getstate=function(dst){
if(this._disabled){
return -1;
}
if(dst){
if(Array.isArray(dst)){
if(dst.length!=1){
return -1;
}
dst=this.fm.file(dst[0]);
}}else{
dst=this.fm.cwd();
}
return this.fm.clipboard().length&&dst.mime=='directory'&&dst.write ? 0:-1;
};
this.exec=function(select, cOpts){
var self=this,
fm=self.fm,
opts=cOpts||{},
dst=select ? this.files(select)[0]:fm.cwd(),
files=fm.clipboard(),
cnt=files.length,
cut=cnt ? files[0].cut:false,
cmd=opts._cmd? opts._cmd:(cut? 'move':'copy'),
error='err' + cmd.charAt(0).toUpperCase() + cmd.substr(1),
fpaste=[],
fcopy=[],
dfrd=$.Deferred()
.fail(function(error){
error&&fm.error(error);
})
.always(function(){
fm.unlockfiles({files:$.map(files, function(f){ return f.hash; })});
}),
copy=function(files){
return files.length&&fm._commands.duplicate
? fm.exec('duplicate', files)
: $.Deferred().resolve();
},
paste=function(files){
var dfrd=$.Deferred(),
existed=[],
hashes={},
intersect=function(files, names){
var ret=[],
i=files.length;
while (i--){
$.inArray(files[i].name, names)!==-1&&ret.unshift(i);
}
return ret;
},
confirm=function(ndx){
var i=existed[ndx],
file=files[i],
last=ndx==existed.length-1;
if(!file){
return;
}
fm.confirm({
title:fm.i18n(cmd + 'Files'),
text:['errExists', file.name, cmd==='restore'? 'confirmRest':'confirmRepl'],
all:!last,
accept:{
label:'btnYes',
callback:function(all){
!last&&!all
? confirm(++ndx)
: paste(files);
}},
reject:{
label:'btnNo',
callback:function(all){
var i;
if(all){
i=existed.length;
while (ndx < i--){
files[existed[i]].remove=true;
}}else{
files[existed[ndx]].remove=true;
}
!last&&!all
? confirm(++ndx)
: paste(files);
}},
cancel:{
label:'btnCancel',
callback:function(){
dfrd.resolve();
}},
buttons:[
{
label:'btnBackup',
callback:function(all){
var i;
if(all){
i=existed.length;
while (ndx < i--){
files[existed[i]].rename=true;
}}else{
files[existed[ndx]].rename=true;
}
!last&&!all
? confirm(++ndx)
: paste(files);
}}
]
});
},
valid=function(names){
var exists={}, existedArr;
if(names){
if(Array.isArray(names)){
if(names.length){
if(typeof names[0]=='string'){
existed=intersect(files, names);
}else{
$.each(names, function(i, v){
exists[v.name]=v.hash;
});
existed=intersect(files, $.map(exists, function(h, n){ return n; }));
$.each(files, function(i, file){
if(exists[file.name]){
hashes[exists[file.name]]=file.name;
}});
}}
}else{
existedArr=[];
existed=$.map(names, function(n){
if(typeof n==='string'){
return n;
}else{
existedArr=existedArr.concat(n);
return false;
}});
if(existedArr.length){
existed=existed.concat(existedArr);
}
existed=intersect(files, existed);
hashes=names;
}}
existed.length ? confirm(0):paste(files);
},
paste=function(selFiles){
var renames=[],
files=$.grep(selFiles, function(file){
if(file.rename){
renames.push(file.name);
}
return !file.remove ? true:false;
}),
cnt=files.length,
groups={},
args=[],
targets, reqData;
if(!cnt){
return dfrd.resolve();
}
targets=$.map(files, function(f){ return f.hash; });
reqData={cmd:'paste', dst:dst.hash, targets:targets, cut:cut ? 1:0, renames:renames, hashes:hashes, suffix:fm.options.backupSuffix};
if(fm.api < 2.1){
reqData.src=files[0].phash;
}
fm.request({
data:reqData,
notify:{type:cmd, cnt:cnt},
navigate:{
toast:opts.noToast? {}:{
inbuffer:{msg: fm.i18n(['complete', fm.i18n('cmd' + cmd)]), action: {
cmd: 'open',
msg: 'cmdopendir',
data: [dst.hash],
done: 'select',
cwdNot: dst.hash
}}}
}})
.done(function(data){
var dsts={},
added=data.added&&data.added.length? data.added:null;
if(cut&&added){
$.each(files, function(i, f){
var phash=f.phash,
srcHash=function(name){
var hash;
$.each(added, function(i, f){
if(f.name===name){
hash=f.hash;
return false;
}});
return hash;
},
shash=srcHash(f.name);
if(shash){
if(dsts[phash]){
dsts[phash].push(shash);
}else{
dsts[phash]=[ shash ];
}}
});
if(Object.keys(dsts).length){
data.undo={
cmd:'move',
callback:function(){
var reqs=[];
$.each(dsts, function(dst, targets){
reqs.push(fm.request({
data:{cmd:'paste', dst:dst, targets:targets, cut:1},
notify:{type:'undo', cnt:targets.length}}));
});
return $.when.apply(null, reqs);
}};
data.redo={
cmd:'move',
callback:function(){
return fm.request({
data:reqData,
notify:{type:'redo', cnt:cnt}});
}};}}
dfrd.resolve(data);
})
.fail(function(){
dfrd.reject();
})
.always(function(){
fm.unlockfiles({files:files});
});
},
internames;
if(!fm.isCommandEnabled(self.name, dst.hash)||!files.length){
return dfrd.resolve();
}
if(fm.oldAPI){
paste(files);
}else{
if(!fm.option('copyOverwrite', dst.hash)){
paste(files);
}else{
internames=$.map(files, function(f){ return f.name; });
dst.hash==fm.cwd().hash
? valid($.map(fm.files(), function(file){ return file.phash==dst.hash ? {hash: file.hash, name: file.name}:null; }))
: fm.request({
data:{cmd:'ls', target:dst.hash, intersect:internames},
notify:{type:'prepare', cnt:1, hideCnt:true},
preventFail:true
})
.always(function(data){
valid(data.list);
});
}}
return dfrd;
},
parents, fparents;
if(!cnt||!dst||dst.mime!='directory'){
return dfrd.reject();
}
if(!dst.write){
return dfrd.reject([error, files[0].name, 'errPerm']);
}
parents=fm.parents(dst.hash);
$.each(files, function(i, file){
if(!file.read){
return !dfrd.reject([error, file.name, 'errPerm']);
}
if(cut&&file.locked){
return !dfrd.reject(['errLocked', file.name]);
}
if($.inArray(file.hash, parents)!==-1){
return !dfrd.reject(['errCopyInItself', file.name]);
}
if(file.mime&&file.mime!=='directory'&&! fm.uploadMimeCheck(file.mime, dst.hash)){
return !dfrd.reject([error, file.name, 'errUploadMime']);
}
fparents=fm.parents(file.hash);
fparents.pop();
if($.inArray(dst.hash, fparents)!==-1){
if($.grep(fparents, function(h){ var d=fm.file(h); return d.phash==dst.hash&&d.name==file.name ? true:false; }).length){
return !dfrd.reject(['errReplByChild', file.name]);
}}
if(file.phash==dst.hash){
fcopy.push(file.hash);
}else{
fpaste.push({
hash:file.hash,
phash:file.phash,
name:file.name
});
}});
if(dfrd.state()=='rejected'){
return dfrd;
}
$.when(copy(fcopy),
paste(fpaste)
)
.done(function(cr, pr){
dfrd.resolve(pr&&pr.undo? pr:void(0));
})
.fail(function(){
dfrd.reject();
})
.always(function(){
cut&&fm.clipboard([]);
});
return dfrd;
};};
elFinder.prototype.commands.places=function(){
var self=this,
fm=this.fm,
filter=function(hashes){
return $.grep(self.files(hashes), function(f){ return f.mime=='directory' ? true:false; });
},
places=null;
this.getstate=function(select){
var sel=this.hashes(select),
cnt=sel.length;
return  places&&cnt&&cnt==filter(sel).length ? 0:-1;
};
this.exec=function(hashes){
var files=this.files(hashes);
places.trigger('regist', [ files ]);
return $.Deferred().resolve();
};
fm.one('load', function(){
places=fm.ui.places;
});
};
elFinder.prototype.commands.preference=function(){
var self=this,
fm=this.fm,
r='replace',
tab='<li class="' + fm.res('class', 'tabstab') + ' elfinder-preference-tab-{id}"><a href="#'+fm.namespace+'-preference-{id}" id="'+fm.namespace+'-preference-tab-{id}" class="ui-tabs-anchor {class}">{title}</a></li>',
base=$('<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-preference">'),
ul=$('<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-top">'),
tabs=$('<div class="elfinder-preference-tabs ui-tabs-panel ui-widget-content ui-corner-bottom"/>'),
sep='<div class="elfinder-preference-separator"/>',
selfUrl=$('base').length? document.location.href.replace(/#.*$/, ''):'',
selectTab=function(tab){
$('#'+fm.namespace+'-preference-tab-'+tab).trigger('mouseover').trigger('click');
openTab=tab;
},
clTabActive=fm.res('class', 'tabsactive'),
build=function(){
var cats=self.options.categories||{
'language':['language'],
'theme':['theme'],
'toolbar':['toolbarPref'],
'workspace':['iconSize','columnPref', 'selectAction', 'makefileTypes', 'useStoredEditor', 'editorMaximized', 'useFullscreen', 'showHidden'],
'dialog':['autoFocusDialog'],
'selectionInfo':['infoItems', 'hashChecker'],
'reset':['clearBrowserData'],
'all':true
},
forms=self.options.prefs||['language', 'theme', 'toolbarPref', 'iconSize', 'columnPref', 'selectAction', 'makefileTypes', 'useStoredEditor', 'editorMaximized', 'useFullscreen', 'showHidden', 'infoItems', 'hashChecker', 'autoFocusDialog', 'clearBrowserData'];
forms=fm.arrayFlip(forms, true);
if(fm.options.getFileCallback){
delete forms.selectAction;
}
if(!fm.UA.Fullscreen){
delete forms.useFullscreen;
}
forms.language&&(forms.language=(function(){
var langSel=$('<select/>').on('change', function(){
var lang=$(this).val();
fm.storage('lang', lang);
$('#'+fm.id).elfinder('reload');
}),
optTags=[],
langs=self.options.langs||{
ar: 'العربية',
bg: 'Български',
ca: 'Català',
cs: 'Čeština',
da: 'Dansk',
de: 'Deutsch',
el: 'Ελληνικά',
en: 'English',
es: 'Español',
fa: 'فارسی',
fo: 'Føroyskt',
fr: 'Français',
he: 'עברית',
hr: 'Hrvatski',
hu: 'Magyar',
id: 'Bahasa Indonesia',
it: 'Italiano',
ja: '日本語',
ko: '한국어',
nl: 'Nederlands',
no: 'Norsk',
pl: 'Polski',
pt_BR: 'Português',
ro: 'Română',
ru: 'Pусский',
si: 'සිංහල',
sk: 'Slovenčina',
sl: 'Slovenščina',
sr: 'Srpski',
sv: 'Svenska',
tr: 'Türkçe',
ug_CN: 'ئۇيغۇرچە',
uk: 'Український',
vi: 'Tiếng Việt',
zh_CN: '简体中文',
zh_TW: '正體中文'
};
$.each(langs, function(lang, name){
optTags.push('<option value="'+lang+'">'+name+'</option>');
});
return langSel.append(optTags.join('')).val(fm.lang);
})());
forms.theme&&(forms.theme=(function(){
var cnt=fm.options.themes? Object.keys(fm.options.themes).length:0;
if(cnt===0||(cnt===1&&fm.options.themes.default)){
return null;
}
var themeSel=$('<select/>').on('change', function(){
var theme=$(this).val();
fm.changeTheme(theme).storage('theme', theme);
}),
optTags=[],
tpl={
image: '<img class="elfinder-preference-theme elfinder-preference-theme-image" src="$2" />',
link: '<a href="$1" target="_blank" title="$3">$2</a>',
data: '<dt>$1</dt><dd><span class="elfinder-preference-theme elfinder-preference-theme-$0">$2</span></dd>'
},
items=['image', 'description', 'author', 'email', 'license'],
render=function(key, data){
},
defBtn=$('<button class="ui-button ui-corner-all ui-widget elfinder-preference-theme-default"/>').text(fm.i18n('default')).on('click', function(e){
themeSel.val('default').trigger('change');
}),
list=$('<div class="elfinder-reference-hide-taball"/>').on('click', 'button', function(){
var val=$(this).data('themeid');
themeSel.val(val).trigger('change');
});
if(!fm.options.themes.default){
themeSel.append('<option value="default">'+fm.i18n('default')+'</option>');
}
$.each(fm.options.themes, function(id, val){
var opt=$('<option class="elfinder-theme-option-'+id+'" value="'+id+'">'+fm.i18n(id)+'</option>'),
dsc=$('<fieldset class="ui-widget ui-widget-content ui-corner-all elfinder-theme-list-'+id+'"><legend>'+fm.i18n(id)+'</legend><div><span class="elfinder-spinner"/></div></fieldset>'),
tm;
themeSel.append(opt);
list.append(dsc);
tm=setTimeout(function(){
dsc.find('span.elfinder-spinner').replaceWith(fm.i18n(['errRead', id]));
}, 10000);
fm.getTheme(id).always(function(){
tm&&clearTimeout(tm);
}).done(function(data){
var link, val=$(), dl=$('<dl/>');
link=data.link? tpl.link.replace(/\$1/g, data.link).replace(/\$3/g, fm.i18n('website')):'$2';
if(data.name){
opt.html(fm.i18n(data.name));
}
dsc.children('legend').html(link.replace(/\$2/g, fm.i18n(data.name)||id));
$.each(items, function(i, key){
var t=tpl[key]||tpl.data,
elm;
if(data[key]){
elm=t.replace(/\$0/g, fm.escape(key)).replace(/\$1/g, fm.i18n(key)).replace(/\$2/g, fm.i18n(data[key]));
if(key==='image'&&data.link){
elm=$(elm).on('click', function(){
themeSel.val(id).trigger('change');
}).attr('title', fm.i18n('select'));
}
dl.append(elm);
}});
val=val.add(dl);
val=val.add($('<div class="elfinder-preference-theme-btn"/>').append($('<button class="ui-button ui-corner-all ui-widget"/>').data('themeid', id).html(fm.i18n('select'))));
dsc.find('span.elfinder-spinner').replaceWith(val);
}).fail(function(){
dsc.find('span.elfinder-spinner').replaceWith(fm.i18n(['errRead', id]));
});
});
return $('<div/>').append(themeSel.val(fm.theme&&fm.theme.id? fm.theme.id:'default'), defBtn, list);
})());
forms.toolbarPref&&(forms.toolbarPref=(function(){
var pnls=$.map(fm.options.uiOptions.toolbar, function(v){
return $.isArray(v)? v:null;
}),
tags=[],
hides=fm.storage('toolbarhides')||{};
$.each(pnls, function(){
var cmd=this,
name=fm.i18n('cmd'+cmd);
if(name==='cmd'+cmd){
name=fm.i18n(cmd);
}
tags.push('<span class="elfinder-preference-toolbar-item"><label><input type="checkbox" value="'+cmd+'" '+(hides[cmd]? '':'checked')+'/>'+name+'</label></span>');
});
return $(tags.join(' ')).on('change', 'input', function(){
var v=$(this).val(),
o=$(this).is(':checked');
if(!o&&!hides[v]){
hides[v]=true;
}else if(o&&hides[v]){
delete hides[v];
}
fm.storage('toolbarhides', hides);
fm.trigger('toolbarpref');
});
})());
forms.iconSize&&(forms.iconSize=(function(){
var max=fm.options.uiOptions.cwd.iconsView.sizeMax||3,
size=fm.storage('iconsize')||0,
sld=$('<div class="touch-punch"/>').slider({
classes: {
'ui-slider-handle': 'elfinder-tabstop',
},
value: size,
max: max,
slide: function(e, ui){
fm.getUI('cwd').trigger('iconpref', {size: ui.value});
},
change: function(e, ui){
fm.storage('iconsize', ui.value);
}});
fm.getUI('cwd').on('iconpref', function(e, data){
sld.slider('option', 'value', data.size);
});
return sld;
})());
forms.columnPref&&(forms.columnPref=(function(){
var cols=fm.options.uiOptions.cwd.listView.columns,
tags=[],
hides=fm.storage('columnhides')||{};
$.each(cols, function(){
var key=this,
name=fm.getColumnName(key);
tags.push('<span class="elfinder-preference-column-item"><label><input type="checkbox" value="'+key+'" '+(hides[key]? '':'checked')+'/>'+name+'</label></span>');
});
return $(tags.join(' ')).on('change', 'input', function(){
var v=$(this).val(),
o=$(this).is(':checked');
if(!o&&!hides[v]){
hides[v]=true;
}else if(o&&hides[v]){
delete hides[v];
}
fm.storage('columnhides', hides);
fm.trigger('columnpref', { repaint: true });
});
})());
forms.selectAction&&(forms.selectAction=(function(){
var actSel=$('<select/>').on('change', function(){
var act=$(this).val();
fm.storage('selectAction', act==='default'? null:act);
}),
optTags=[],
acts=self.options.selectActions,
defAct=fm.getCommand ('open').options.selectAction||'open';
if($.inArray(defAct, acts)===-1){
acts.unshift(defAct);
}
$.each(acts, function(i, act){
var names=$.map(act.split('/'), function(cmd){
var name=fm.i18n('cmd'+cmd);
if(name==='cmd'+cmd){
name=fm.i18n(cmd);
}
return name;
});
optTags.push('<option value="'+act+'">'+names.join('/')+'</option>');
});
return actSel.append(optTags.join('')).val(fm.storage('selectAction')||defAct);
})());
forms.makefileTypes&&(forms.makefileTypes=(function(){
var hides=fm.storage('mkfileHides')||{},
getTag=function(){
var tags=[];
hides=fm.storage('mkfileHides')||{};
$.each(fm.mimesCanMakeEmpty, function(mime, type){
var name=fm.getCommand ('mkfile').getTypeName(mime, type);
tags.push('<span class="elfinder-preference-column-item" title="'+fm.escape(name)+'"><label><input type="checkbox" value="'+mime+'" '+(hides[mime]? '':'checked')+'/>'+type+'</label></span>');
});
return tags.join(' ');
},
elm=$('<div/>').on('change', 'input', function(){
var v=$(this).val(),
o=$(this).is(':checked');
if(!o&&!hides[v]){
hides[v]=true;
}else if(o&&hides[v]){
delete hides[v];
}
fm.storage('mkfileHides', hides);
fm.trigger('canMakeEmptyFile');
}).append(getTag()),
add=$('<div/>').append($('<input type="text" placeholder="'+fm.i18n('typeOfTextfile')+'"/>').on('keydown', function(e){
(e.keyCode===$.ui.keyCode.ENTER)&&$(this).next().trigger('click');
}),
$('<button class="ui-button"/>').html(fm.i18n('add')).on('click', function(){
var input=$(this).prev(),
val=input.val(),
uiToast=fm.getUI('toast'),
err=function(){
uiToast.appendTo(input.closest('.ui-dialog'));
fm.toast({
msg: fm.i18n('errUsupportType'),
mode: 'warning',
onHidden: function(){
uiToast.children().length===1&&uiToast.appendTo(fm.getUI());
}});
input.trigger('focus');
return false;
},
tmpMimes;
if(!val.match(/\//)){
val=fm.arrayFlip(fm.mimeTypes)[val];
if(!val){
return err();
}
input.val(val);
}
if(!fm.mimeIsText(val)||!fm.mimeTypes[val]){
return err();
}
fm.trigger('canMakeEmptyFile', {mimes: [val], unshift: true});
tmpMimes={};
tmpMimes[val]=fm.mimeTypes[val];
fm.storage('mkfileTextMimes', Object.assign(tmpMimes, fm.storage('mkfileTextMimes')||{}));
input.val('');
uiToast.appendTo(input.closest('.ui-dialog'));
fm.toast({
msg: fm.i18n(['complete', val + ' (' + tmpMimes[val] + ')']),
onHidden: function(){
uiToast.children().length===1&&uiToast.appendTo(fm.getUI());
}});
}),
$('<button class="ui-button"/>').html(fm.i18n('reset')).on('click', function(){
fm.one('canMakeEmptyFile', {done: function(){
elm.empty().append(getTag());
}});
fm.trigger('canMakeEmptyFile', {resetTexts: true});
})
),
tm;
fm.bind('canMakeEmptyFile', {done: function(e){
if(e.data&&e.data.mimes&&e.data.mimes.length){
elm.empty().append(getTag());
}}});
return $('<div/>').append(elm, add);
})());
forms.useStoredEditor&&(forms.useStoredEditor=$('<input type="checkbox"/>').prop('checked', (function(){
var s=fm.storage('useStoredEditor');
return s? (s > 0):fm.options.commandsOptions.edit.useStoredEditor;
})()).on('change', function(e){
fm.storage('useStoredEditor', $(this).is(':checked')? 1:-1);
}));
forms.editorMaximized&&(forms.editorMaximized=$('<input type="checkbox"/>').prop('checked', (function(){
var s=fm.storage('editorMaximized');
return s? (s > 0):fm.options.commandsOptions.edit.editorMaximized;
})()).on('change', function(e){
fm.storage('editorMaximized', $(this).is(':checked')? 1:-1);
}));
forms.useFullscreen&&(forms.useFullscreen=$('<input type="checkbox"/>').prop('checked', (function(){
var s=fm.storage('useFullscreen');
return s? (s > 0):fm.options.commandsOptions.fullscreen.mode==='screen';
})()).on('change', function(e){
fm.storage('useFullscreen', $(this).is(':checked')? 1:-1);
}));
if(forms.showHidden){
(function(){
var setTitle=function(){
var s=fm.storage('hide'),
t=[],
v;
if(s&&s.items){
$.each(s.items, function(h, n){
t.push(fm.escape(n));
});
}
elms.prop('disabled', !t.length)[t.length? 'removeClass':'addClass']('ui-state-disabled');
v=t.length? t.join('\n'):'';
forms.showHidden.attr('title',v);
useTooltip&&forms.showHidden.tooltip('option', 'content', v.replace(/\n/g, '<br>')).tooltip('close');
},
chk=$('<input type="checkbox"/>').prop('checked', (function(){
var s=fm.storage('hide');
return s&&s.show;
})()).on('change', function(e){
var o={};
o[$(this).is(':checked')? 'show':'hide']=true;
fm.exec('hide', void(0), o);
}),
btn=$('<button class="ui-button ui-corner-all ui-widget"/>').append(fm.i18n('reset')).on('click', function(){
fm.exec('hide', void(0), {reset: true});
$(this).parent().find('input:first').prop('checked', false);
setTitle();
}),
elms=$().add(chk).add(btn),
useTooltip;
forms.showHidden=$('<div/>').append(chk, btn);
fm.bind('hide', function(e){
var d=e.data;
if(!d.opts||(!d.opts.show&&!d.opts.hide)){
setTitle();
}});
if(fm.UA.Mobile&&$.fn.tooltip){
useTooltip=true;
forms.showHidden.tooltip({
classes: {
'ui-tooltip': 'elfinder-ui-tooltip ui-widget-shadow'
},
tooltipClass: 'elfinder-ui-tooltip ui-widget-shadow',
track: true
}).css('user-select', 'none');
btn.css('user-select', 'none');
}
setTitle();
})();
}
forms.infoItems&&(forms.infoItems=(function(){
var items=fm.getCommand ('info').items,
tags=[],
hides=fm.storage('infohides')||fm.arrayFlip(fm.options.commandsOptions.info.hideItems, true);
$.each(items, function(){
var key=this,
name=fm.i18n(key);
tags.push('<span class="elfinder-preference-info-item"><label><input type="checkbox" value="'+key+'" '+(hides[key]? '':'checked')+'/>'+name+'</label></span>');
});
return $(tags.join(' ')).on('change', 'input', function(){
var v=$(this).val(),
o=$(this).is(':checked');
if(!o&&!hides[v]){
hides[v]=true;
}else if(o&&hides[v]){
delete hides[v];
}
fm.storage('infohides', hides);
fm.trigger('infopref', { repaint: true });
});
})());
forms.hashChecker&&fm.hashCheckers.length&&(forms.hashChecker=(function(){
var tags=[],
enabled=fm.arrayFlip(fm.storage('hashchekcer')||fm.options.commandsOptions.info.showHashAlgorisms, true);
$.each(fm.hashCheckers, function(){
var cmd=this,
name=fm.i18n(cmd);
tags.push('<span class="elfinder-preference-hashchecker-item"><label><input type="checkbox" value="'+cmd+'" '+(enabled[cmd]? 'checked':'')+'/>'+name+'</label></span>');
});
return $(tags.join(' ')).on('change', 'input', function(){
var v=$(this).val(),
o=$(this).is(':checked');
if(o){
enabled[v]=true;
}else if(enabled[v]){
delete enabled[v];
}
fm.storage('hashchekcer', $.grep(fm.hashCheckers, function(v){
return enabled[v];
}));
});
})());
forms.autoFocusDialog&&(forms.autoFocusDialog=$('<input type="checkbox"/>').prop('checked', (function(){
var s=fm.storage('autoFocusDialog');
return s? (s > 0):fm.options.uiOptions.dialog.focusOnMouseOver;
})()).on('change', function(e){
fm.storage('autoFocusDialog', $(this).is(':checked')? 1:-1);
}));
forms.clearBrowserData&&(forms.clearBrowserData=$('<button/>').text(fm.i18n('reset')).button().on('click', function(e){
e.preventDefault();
fm.storage();
$('#'+fm.id).elfinder('reload');
}));
$.each(cats, function(id, prefs){
var dls, found;
if(prefs===true){
found=1;
}else if(prefs){
dls=$();
$.each(prefs, function(i, n){
var f, title, chks='', cbox;
if(f=forms[n]){
found=2;
title=fm.i18n(n);
cbox=$(f).filter('input[type="checkbox"]');
if(!cbox.length){
cbox=$(f).find('input[type="checkbox"]');
}
if(cbox.length===1){
if(!cbox.attr('id')){
cbox.attr('id', 'elfinder-preference-'+n+'-checkbox');
}
title='<label for="'+cbox.attr('id')+'">'+title+'</label>';
}else if(cbox.length > 1){
chks=' elfinder-preference-checkboxes';
}
dls=dls.add($('<dt class="elfinder-preference-'+n+chks+'">'+title+'</dt>')).add($('<dd class="elfinder-preference-'+n+chks+'"/>').append(f));
}});
}
if(found){
ul.append(tab[r](/\{id\}/g, id)[r](/\{title\}/, fm.i18n(id))[r](/\{class\}/, openTab===id? 'elfinder-focus':''));
if(found===2){
tabs.append($('<div id="'+fm.namespace+'-preference-'+id+'" class="elfinder-preference-content"/>')
.hide()
.append($('<dl/>').append(dls))
);
}}
});
ul.on('click', 'a', function(e){
var t=$(e.target),
h=t.attr('href');
e.preventDefault();
e.stopPropagation();
ul.children().removeClass(clTabActive);
t.removeClass('ui-state-hover').parent().addClass(clTabActive);
if(h.match(/all$/)){
tabs.addClass('elfinder-preference-taball').children().show();
}else{
tabs.removeClass('elfinder-preference-taball').children().hide();
$(h).show();
}}).on('focus blur', 'a', function(e){
$(this).parent().toggleClass('ui-state-focus', e.type==='focusin');
}).on('mouseenter mouseleave', 'li', function(e){
$(this).toggleClass('ui-state-hover', e.type==='mouseenter');
});
tabs.find('a,input,select,button').addClass('elfinder-tabstop');
base.append(ul, tabs);
dialog=self.fmDialog(base, {
title:self.title,
width:self.options.width||600,
height: self.options.height||400,
maxWidth: 'window',
maxHeight: 'window',
autoOpen:false,
destroyOnClose:false,
allowMinimize:false,
open:function(){
openTab&&selectTab(openTab);
openTab=null;
},
resize:function(){
tabs.height(dialog.height() - ul.outerHeight(true) - (tabs.outerHeight(true) - tabs.height()) - 5);
}})
.on('click', function(e){
e.stopPropagation();
})
.css({
overflow: 'hidden'
});
dialog.closest('.ui-dialog')
.css({
overflow: 'hidden'
})
.addClass('elfinder-bg-translucent');
openTab='all';
},
dialog, openTab;
this.shortcuts=[{
pattern:'ctrl+comma',
description:this.title
}];
this.alwaysEnabled=true;
this.getstate=function(){
return 0;
};
this.exec=function(sel, cOpts){
!dialog&&build();
if(cOpts){
if(cOpts.tab){
selectTab(cOpts.tab);
}else if(cOpts._currentType==='cwd'){
selectTab('workspace');
}}
dialog.elfinderdialog('open');
return $.Deferred().resolve();
};};
(elFinder.prototype.commands.quicklook=function(){
var self=this,
fm=self.fm,
closed=0,
animated=1,
opened=2,
docked=3,
dockedhidden=4,
state=closed,
evUpdate=Element.update? 'quicklookupdate':'update',
navicon='elfinder-quicklook-navbar-icon',
fullscreen='elfinder-quicklook-fullscreen',
infocls='elfinder-quicklook-info-wrapper',
navtrigger=function(code){
$(document).trigger($.Event('keydown', { keyCode: code, ctrlKey:false, shiftKey:false, altKey:false, metaKey:false }));
},
closedCss=function(node){
var elf=fm.getUI().offset(),
base=(function(){
var target=node.find('.elfinder-cwd-file-wrapper');
return target.length? target:node;
})(),
baseOffset=base.offset()||{ top: 0, left: 0 };
return {
opacity:0,
width:base.width(),
height:base.height() - 30,
top:baseOffset.top - elf.top,
left:baseOffset.left  - elf.left
};},
openedCss=function(){
var contain=self.options.contain,
win=contain? fm.getUI():$(window),
elf=fm.getUI().offset(),
w=Math.min(width, win.width()-10),
h=Math.min(height, win.height()-80);
return {
opacity:1,
width:w,
height:h,
top:parseInt((win.height() - h - 60) / 2 + (contain? 0:win.scrollTop() - elf.top)),
left:parseInt((win.width() - w) / 2 + (contain? 0:win.scrollLeft() - elf.left))
};},
mediaNode={},
support=function(codec, name){
var node=name||codec.substr(0, codec.indexOf('/')),
media=mediaNode[node]? mediaNode[node]:(mediaNode[node]=document.createElement(node)),
value=false;
try {
value=media.canPlayType&&media.canPlayType(codec);
} catch(e){}
return (value&&value!==''&&value!='no')? true:false;
},
platformWin=(window.navigator.platform.indexOf('Win')!=-1),
width,
height,
prevStyle,
parent,
cwd,
cwdHash,
dockEnabled=false,
navdrag=false,
navmove=false,
navtm=null,
leftKey=$.ui.keyCode.LEFT,
rightKey=$.ui.keyCode.RIGHT,
coverEv='mousemove touchstart ' + ('onwheel' in document? 'wheel':'onmousewheel' in document? 'mousewheel':'DOMMouseScroll'),
title=$('<span class="elfinder-dialog-title elfinder-quicklook-title"/>'),
icon=$('<div/>'),
info=$('<div class="elfinder-quicklook-info"/>'),
cover=$('<div class="ui-front elfinder-quicklook-cover"/>'),
fsicon=$('<div class="'+navicon+' '+navicon+'-fullscreen"/>')
.on('click touchstart', function(e){
if(navmove){
return;
}
var win=self.window,
full=win.hasClass(fullscreen),
$window=$(window),
resize=function(){ self.preview.trigger('changesize'); };
e.stopPropagation();
e.preventDefault();
if(full){
navStyle='';
navShow();
win.toggleClass(fullscreen)
.css(win.data('position'));
$window.trigger(self.resize).off(self.resize, resize);
navbar.off('mouseenter mouseleave');
cover.off(coverEv);
}else{
win.toggleClass(fullscreen)
.data('position', {
left:win.css('left'),
top:win.css('top'),
width:win.width(),
height:win.height(),
display: 'block'
})
.removeAttr('style');
$(window).on(self.resize, resize)
.trigger(self.resize);
cover.on(coverEv, function(e){
if(! navdrag){
if(e.type==='mousemove'||e.type==='touchstart'){
navShow();
navtm=setTimeout(function(){
if(fm.UA.Mobile||navbar.parent().find('.elfinder-quicklook-navbar:hover').length < 1){
navbar.fadeOut('slow', function(){
cover.show();
});
}}, 3000);
}
if(cover.is(':visible')){
coverHide();
cover.data('tm', setTimeout(function(){
cover.show();
}, 3000));
}}
}).show().trigger('mousemove');
navbar.on('mouseenter mouseleave', function(e){
if(! navdrag){
if(e.type==='mouseenter'){
navShow();
}else{
cover.trigger('mousemove');
}}
});
}
if(fm.zIndex){
win.css('z-index', fm.zIndex + 1);
}
if(fm.UA.Mobile){
navbar.attr('style', navStyle);
}else{
navbar.attr('style', navStyle).draggable(full ? 'destroy':{
start: function(){
navdrag=true;
navmove=true;
cover.show();
navShow();
},
stop: function(){
navdrag=false;
navStyle=self.navbar.attr('style');
requestAnimationFrame(function(){
navmove=false;
});
}});
}
$(this).toggleClass(navicon+'-fullscreen-off');
var collection=win;
if(parent.is('.ui-resizable')){
collection=collection.add(parent);
}
collection.resizable(full ? 'enable':'disable').removeClass('ui-state-disabled');
win.trigger('viewchange');
}
),
updateOnSel=function(){
self.update(void(0), (function(){
var fm=self.fm,
files=fm.selectedFiles(),
cnt=files.length,
inDock=self.docked(),
getInfo=function(){
var ts=0;
$.each(files, function(i, f){
var t=parseInt(f.ts);
if(ts >=0){
if(t > ts){
ts=t;
}}else{
ts='unknown';
}});
return {
hash:files[0].hash  + '/' + (+new Date()),
name:fm.i18n('items') + ': ' + cnt,
mime:'group',
size:spinner,
ts:ts,
files:$.map(files, function(f){ return f.hash; }),
getSize:true
};};
if(! cnt){
cnt=1;
files=[fm.cwd()];
}
return (cnt===1)? files[0]:getInfo();
})());
},
navShow=function(){
if(self.window.hasClass(fullscreen)){
navtm&&clearTimeout(navtm);
navtm=null;
navbar.stop(true, true).css('display', 'block');
coverHide();
}},
coverHide=function(){
cover.data('tm')&&clearTimeout(cover.data('tm'));
cover.removeData('tm');
cover.hide();
},
prev=$('<div class="'+navicon+' '+navicon+'-prev"/>').on('click touchstart', function(e){ ! navmove&&navtrigger(leftKey); return false; }),
next=$('<div class="'+navicon+' '+navicon+'-next"/>').on('click touchstart', function(e){ ! navmove&&navtrigger(rightKey); return false; }),
navbar=$('<div class="elfinder-quicklook-navbar"/>')
.append(prev)
.append(fsicon)
.append(next)
.append('<div class="elfinder-quicklook-navbar-separator"/>')
.append($('<div class="'+navicon+' '+navicon+'-close"/>').on('click touchstart', function(e){ ! navmove&&self.window.trigger('close'); return false; }))
,
titleClose=$('<span class="ui-front ui-icon elfinder-icon-close ui-icon-closethick"/>').on('mousedown', function(e){
e.stopPropagation();
self.window.trigger('close');
}),
titleDock=$('<span class="ui-front ui-icon elfinder-icon-minimize ui-icon-minusthick"/>').on('mousedown', function(e){
e.stopPropagation();
if(! self.docked()){
self.window.trigger('navdockin');
}else{
self.window.trigger('navdockout');
}}),
spinner='<span class="elfinder-spinner-text">' + fm.i18n('calc') + '</span>' + '<span class="elfinder-spinner"/>',
navStyle='',
init=true,
dockHeight,	getSize, tm4cwd, dockedNode, selectTm;
this.cover=cover;
this.evUpdate=evUpdate;
(this.navbar=navbar)._show=navShow;
this.resize='resize.'+fm.namespace;
this.info=$('<div/>').addClass(infocls)
.append(icon)
.append(info);
this.autoPlay=function(){
if(self.opened()){
return !! self.options[self.docked()? 'dockAutoplay':'autoplay'];
}
return false;
};
this.preview=$('<div class="elfinder-quicklook-preview ui-helper-clearfix"/>')
.on('change', function(){
navShow();
navbar.attr('style', navStyle);
self.docked()&&navbar.hide();
self.preview.attr('style', '').removeClass('elfinder-overflow-auto');
self.info.attr('style', '').hide();
self.cover.removeClass('elfinder-quicklook-coverbg');
icon.removeAttr('class').attr('style', '');
info.html('');
})
.on(evUpdate, function(e){
var preview=self.preview,
file=e.file,
tpl='<div class="elfinder-quicklook-info-data">{value}</div>',
update=function(){
var win=self.window.css('overflow', 'hidden');
name=fm.escape(file.i18||file.name);
!file.read&&e.stopImmediatePropagation();
self.window.data('hash', file.hash);
self.preview.off('changesize').trigger('change').children().remove();
title.html(name);
prev.css('visibility', '');
next.css('visibility', '');
if(file.hash===fm.cwdId2Hash(cwd.find('[id]:not(.elfinder-cwd-parent):first').attr('id'))){
prev.css('visibility', 'hidden');
}
if(file.hash===fm.cwdId2Hash(cwd.find('[id]:last').attr('id'))){
next.css('visibility', 'hidden');
}
if(file.mime==='directory'){
getSizeHashes=[ file.hash ];
}else if(file.mime==='group'&&file.getSize){
getSizeHashes=file.files;
}
info.html(tpl.replace(/\{value\}/, name)
+ tpl.replace(/\{value\}/, fm.mime2kind(file))
+ tpl.replace(/\{value\}/, getSizeHashes.length ? spinner:fm.formatSize(file.size))
+ tpl.replace(/\{value\}/, fm.i18n('modify')+': '+ fm.formatDate(file))
);
if(getSizeHashes.length){
getSize=fm.getSize(getSizeHashes).done(function(data){
info.find('span.elfinder-spinner').parent().html(data.formated);
}).fail(function(){
info.find('span.elfinder-spinner').parent().html(fm.i18n('unknown'));
}).always(function(){
getSize=null;
});
getSize._hash=file.hash;
}
icon.addClass('elfinder-cwd-icon ui-corner-all '+fm.mime2class(file.mime));
if(file.icon){
icon.css(fm.getIconStyle(file, true));
}
self.info.attr('class', infocls);
if(file.csscls){
self.info.addClass(file.csscls);
}
if(file.read&&(tmb=fm.tmb(file))){
$('<img/>')
.hide()
.appendTo(self.preview)
.on('load', function(){
icon.addClass(tmb.className).css('background-image', "url('"+tmb.url+"')");
$(this).remove();
})
.attr('src', tmb.url);
}
self.info.delay(100).fadeIn(10);
if(self.window.hasClass(fullscreen)){
cover.trigger('mousemove');
}
win.css('overflow', '');
},
tmb, name, getSizeHashes=[];
if(file&&! Object.keys(file).length){
file=fm.cwd();
}
if(file&&getSize&&getSize.state()==='pending'&&getSize._hash!==file.hash){
getSize.reject();
}
if(file&&(e.forceUpdate||self.window.data('hash')!==file.hash)){
update();
}else{
e.stopImmediatePropagation();
}});
this.window=$('<div class="ui-front ui-helper-reset ui-widget elfinder-quicklook touch-punch" style="position:absolute"/>')
.hide()
.addClass(fm.UA.Touch? 'elfinder-touch':'')
.on('click', function(e){
var win=this;
e.stopPropagation();
if(state===opened){
requestAnimationFrame(function(){
state===opened&&fm.toFront(win);
});
}})
.append($('<div class="ui-dialog-titlebar ui-widget-header ui-corner-top ui-helper-clearfix elfinder-quicklook-titlebar"/>')
.append($('<span class="ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button elfinder-quicklook-titlebar-icon'+(platformWin? ' elfinder-titlebar-button-right':'')+'"/>').append(titleClose, titleDock
),
title
),
this.preview,
self.info.hide(),
cover.hide(),
navbar
)
.draggable({handle:'div.elfinder-quicklook-titlebar'})
.on('open', function(e, clcss){
var win=self.window,
file=self.value,
node=fm.getUI('cwd'),
open=function(status){
state=status;
self.update(1, self.value);
self.change();
win.trigger('resize.' + fm.namespace);
};
if(!init&&state===closed){
if(file&&file.hash!==cwdHash){
node=fm.cwdHash2Elm(file.hash.split('/', 2)[0]);
}
navStyle='';
navbar.attr('style', '');
state=animated;
node.trigger('scrolltoview');
coverHide();
win.css(clcss||closedCss(node))
.show()
.animate(openedCss(), 550, function(){
open(opened);
navShow();
});
fm.toFront(win);
}else if(state===dockedhidden){
fm.getUI('navdock').data('addNode')(dockedNode);
open(docked);
self.preview.trigger('changesize');
fm.storage('previewDocked', '1');
if(fm.getUI('navdock').width()===0){
win.trigger('navdockout');
}}
})
.on('close', function(e, dfd){
var win=self.window,
preview=self.preview.trigger('change'),
file=self.value,
hash=(win.data('hash')||'').split('/', 2)[0],
close=function(status, winhide){
state=status;
winhide&&fm.toHide(win);
preview.children().remove();
self.update(0, self.value);
win.data('hash', '');
dfd&&dfd.resolve();
},
node;
if(self.opened()){
getSize&&getSize.state()==='pending'&&getSize.reject();
if(! self.docked()){
state=animated;
win.hasClass(fullscreen)&&fsicon.click();
(hash&&(node=cwd.find('#'+hash)).length)
? win.animate(closedCss(node), 500, function(){ close(closed, true); })
: close(closed, true);
}else{
dockedNode=fm.getUI('navdock').data('removeNode')(self.window.attr('id'), 'detach');
close(dockedhidden);
fm.storage('previewDocked', '2');
}}
})
.on('navdockin', function(e, data){
var w=self.window,
box=fm.getUI('navdock'),
height=dockHeight||box.width(),
opts=data||{};
if(init){
opts.init=true;
}
state=docked;
prevStyle=w.attr('style');
w.toggleClass('ui-front').removeClass('ui-widget').draggable('disable').resizable('disable').removeAttr('style').css({
width: '100%',
height: height,
boxSizing: 'border-box',
paddingBottom: 0,
zIndex: 'unset'
});
navbar.hide();
titleDock.toggleClass('ui-icon-plusthick ui-icon-minusthick elfinder-icon-full elfinder-icon-minimize');
fm.toHide(w, true);
box.data('addNode')(w, opts);
self.preview.trigger('changesize');
fm.storage('previewDocked', '1');
})
.on('navdockout', function(e){
var w=self.window,
box=fm.getUI('navdock'),
dfd=$.Deferred(),
clcss=closedCss(self.preview);
dockHeight=w.outerHeight();
box.data('removeNode')(w.attr('id'), fm.getUI());
w.toggleClass('ui-front').addClass('ui-widget').draggable('enable').resizable('enable').attr('style', prevStyle);
titleDock.toggleClass('ui-icon-plusthick ui-icon-minusthick elfinder-icon-full elfinder-icon-minimize');
state=closed;
w.trigger('open', clcss);
fm.storage('previewDocked', '0');
})
.on('resize.' + fm.namespace, function(){
self.preview.trigger('changesize');
});
this.alwaysEnabled=true;
this.value=null;
this.handlers={
select:function(e, d){
selectTm&&cancelAnimationFrame(selectTm);
if(! e.data||! e.data.selected||! e.data.selected.length){
selectTm=requestAnimationFrame(function(){
self.opened()&&updateOnSel();
});
}else{
self.opened()&&updateOnSel();
}},
error:function(){ self.window.is(':visible')&&self.window.trigger('close'); },
'searchshow searchhide':function(){ this.opened()&&this.window.trigger('close'); },
navbarshow:function(){
requestAnimationFrame(function(){
self.docked()&&self.preview.trigger('changesize');
});
},
destroy:function(){ self.window.remove(); }};
this.shortcuts=[{
pattern:'space'
}];
this.support={
audio:{
ogg:support('audio/ogg;'),
webm: support('audio/webm;'),
mp3:support('audio/mpeg;'),
wav:support('audio/wav;'),
m4a:support('audio/mp4;')||support('audio/x-m4a;')||support('audio/aac;'),
flac: support('audio/flac;'),
amr:support('audio/amr;')
},
video:{
ogg:support('video/ogg;'),
webm:support('video/webm;'),
mp4:support('video/mp4;'),
mkv:support('video/x-matroska;')||support('video/webm;'),
'3gp': support('video/3gpp;')||support('video/mp4;'),
m3u8:support('application/x-mpegURL', 'video')||support('application/vnd.apple.mpegURL', 'video'),
mpd:support('application/dash+xml', 'video')
}};
mediaNode={};
this.closed=function(){
return (state==closed||state==dockedhidden);
};
this.opened=function(){
return state==opened||state==docked;
};
this.docked=function(){
return state==docked;
};
this.addIntegration=function(opts){
requestAnimationFrame(function(){
fm.trigger('helpIntegration', Object.assign({cmd: 'quicklook'}, opts));
});
};
this.init=function(){
var o=this.options,
win=this.window,
preview=this.preview,
i, p, cwdDispInlineRegex;
width=o.width  > 0 ? parseInt(o.width):450;
height=o.height > 0 ? parseInt(o.height):300;
if(o.dockHeight!=='auto'){
dockHeight=parseInt(o.dockHeight);
if(! dockHeight){
dockHeight=void(0);
}}
fm.one('load', function(){
dockEnabled=fm.getUI('navdock').data('dockEnabled');
! dockEnabled&&titleDock.hide();
parent=fm.getUI();
cwd=fm.getUI('cwd');
if(fm.zIndex){
win.css('z-index', fm.zIndex + 1);
}
win.appendTo(parent);
$(document).on('keydown.'+fm.namespace, function(e){
e.keyCode==$.ui.keyCode.ESCAPE&&self.opened()&&! self.docked()&&win.hasClass('elfinder-frontmost')&&win.trigger('close');
});
win.resizable({
handles:'se',
minWidth:350,
minHeight:120,
resize:function(){
preview.trigger('changesize');
}});
self.change(function(){
if(self.opened()){
if(self.value){
if(self.value.tmb&&self.value.tmb==1){
self.value=Object.assign({}, fm.file(self.value.hash));
}
preview.trigger($.Event(evUpdate, {file:self.value}));
}}
});
preview.on(evUpdate, function(e){
var file, hash, serach;
if(file=e.file){
hash=file.hash;
serach=(fm.searchStatus.mixed&&fm.searchStatus.state > 1);
if(file.mime!=='directory'){
if(parseInt(file.size)||file.mime.match(o.mimeRegexNotEmptyCheck)){
self.dispInlineRegex=cwdDispInlineRegex;
if(serach||fm.optionsByHashes[hash]){
try {
self.dispInlineRegex=new RegExp(fm.option('dispInlineRegex', hash), 'i');
} catch(e){
try {
self.dispInlineRegex=new RegExp(!fm.isRoot(file)? fm.option('dispInlineRegex', file.phash):fm.options.dispInlineRegex, 'i');
} catch(e){
self.dispInlineRegex=/^$/;
}}
}}else{
e.stopImmediatePropagation();
}}else{
self.dispInlineRegex=/^$/;
}
self.info.show();
}else{
e.stopImmediatePropagation();
}});
$.each(fm.commands.quicklook.plugins||[], function(i, plugin){
if(typeof(plugin)=='function'){
new plugin(self);
}});
}).one('open', function(){
var dock=Number(fm.storage('previewDocked')||o.docked),
win;
if(dockEnabled&&dock >=1){
win=self.window;
self.exec();
win.trigger('navdockin', { init:true });
if(dock===2){
win.trigger('close');
}else{
self.update(void(0), fm.cwd());
self.change();
}}
init=false;
}).bind('open', function(){
cwdHash=fm.cwd().hash;
self.value=fm.cwd();
try {
cwdDispInlineRegex=new RegExp(fm.option('dispInlineRegex'), 'i');
} catch(e){
cwdDispInlineRegex=/^$/;
}}).bind('change', function(e){
if(e.data&&e.data.changed&&self.opened()){
$.each(e.data.changed, function(){
if(self.window.data('hash')===this.hash){
self.window.data('hash', null);
self.preview.trigger(evUpdate);
return false;
}});
}}).bind('navdockresizestart navdockresizestop', function(e){
cover[e.type==='navdockresizestart'? 'show':'hide']();
});
};
this.getstate=function(){
return self.opened()? 1:0;
};
this.exec=function(){
self.closed()&&updateOnSel();
self.enabled()&&self.window.trigger(self.opened() ? 'close':'open');
return $.Deferred().resolve();
};
this.hideinfo=function(){
this.info.stop(true, true).hide();
};}).prototype={ forceLoad:true };
elFinder.prototype.commands.quicklook.plugins=[
function(ql){
var mimes=['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml', 'image/x-ms-bmp'],
preview=ql.preview,
WebP, flipMime;
WebP=new Image();
WebP.onload=WebP.onerror=function(){
if(WebP.height==2){
mimes.push('image/webp');
}};
WebP.src='data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA
$.each(navigator.mimeTypes, function(i, o){
var mime=o.type;
if(mime.indexOf('image/')===0&&$.inArray(mime, mimes)){
mimes.push(mime);
}});
preview.on(ql.evUpdate, function(e){
var fm=ql.fm,
file=e.file,
showed=false,
dimreq=null,
setdim=function(dim){
var rfile=fm.file(file.hash);
rfile.width=dim[0];
rfile.height=dim[1];
},
show=function(){
var elm, varelm, memSize, width, height, prop;
dimreq&&dimreq.state&&dimreq.state()==='pending'&&dimreq.reject();
if(showed){
return;
}
showed=true;
elm=img.get(0);
memSize=file.width&&file.height? {w: file.width, h: file.height}:(elm.naturalWidth? null:{w: img.width(), h: img.height()});
memSize&&img.removeAttr('width').removeAttr('height');
width=file.width||elm.naturalWidth||elm.width||img.width();
height=file.height||elm.naturalHeight||elm.height||img.height();
if(!file.width||!file.height){
setdim([width, height]);
}
memSize&&img.width(memSize.w).height(memSize.h);
prop=(width/height).toFixed(2);
preview.on('changesize', function(){
var pw=parseInt(preview.width()),
ph=parseInt(preview.height()),
w, h;
if(prop < (pw/ph).toFixed(2)){
h=ph;
w=Math.floor(h * prop);
}else{
w=pw;
h=Math.floor(w/prop);
}
img.width(w).height(h).css('margin-top', h < ph ? Math.floor((ph - h)/2):0);
})
.trigger('changesize');
img.fadeIn(100);
},
hideInfo=function(){
loading.remove();
ql.hideinfo();
},
url, img, loading, m;
if(!flipMime){
flipMime=fm.arrayFlip(mimes);
}
if(flipMime[file.mime]&&ql.dispInlineRegex.test(file.mime)){
e.stopImmediatePropagation();
loading=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+fm.i18n('nowLoading')+'</span><span class="elfinder-spinner"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));
url=fm.openUrl(file.hash);
img=$('<img/>')
.hide()
.appendTo(preview)
.on('load', function(){
hideInfo();
show();
})
.on('error', function(){
loading.remove();
})
.attr('src', url);
if(file.width&&file.height){
show();
}else if(file.size > (ql.options.getDimThreshold||0)){
dimreq=fm.request({
data:{cmd:'dim', target:file.hash},
preventDefault:true
})
.done(function(data){
if(data.dim){
var dim=data.dim.split('x');
file.width=dim[0];
file.height=dim[1];
setdim(dim);
show();
}});
}}
});
},
function(ql){
var fm=ql.fm,
mimes=fm.arrayFlip(['image/vnd.adobe.photoshop', 'image/x-photoshop']),
preview=ql.preview,
load=function(url, img, loading){
try {
fm.replaceXhrSend();
PSD.fromURL(url).then(function(psd){
var prop;
img.attr('src', psd.image.toBase64());
requestAnimationFrame(function(){
prop=(img.width()/img.height()).toFixed(2);
preview.on('changesize', function(){
var pw=parseInt(preview.width()),
ph=parseInt(preview.height()),
w, h;
if(prop < (pw/ph).toFixed(2)){
h=ph;
w=Math.floor(h * prop);
}else{
w=pw;
h=Math.floor(w/prop);
}
img.width(w).height(h).css('margin-top', h < ph ? Math.floor((ph - h)/2):0);
}).trigger('changesize');
loading.remove();
ql.hideinfo();
img.fadeIn(100);
});
}, function(){
loading.remove();
img.remove();
});
fm.restoreXhrSend();
} catch(e){
fm.restoreXhrSend();
loading.remove();
img.remove();
}},
PSD;
preview.on(ql.evUpdate, function(e){
var file=e.file,
url, img, loading, m,
_define, _require;
if(mimes[file.mime]&&fm.options.cdns.psd&&! fm.UA.ltIE10&&ql.dispInlineRegex.test(file.mime)){
e.stopImmediatePropagation();
loading=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+fm.i18n('nowLoading')+'</span><span class="elfinder-spinner"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));
url=fm.openUrl(file.hash);
if(!fm.isSameOrigin(url)){
url=fm.openUrl(file.hash, true);
}
img=$('<img/>').hide().appendTo(preview);
if(PSD){
load(url, img, loading);
}else{
_define=window.define;
_require=window.require;
window.require=null;
window.define=null;
fm.loadScript([ fm.options.cdns.psd ],
function(){
PSD=require('psd');
_define? (window.define=_define):(delete window.define);
_require? (window.require=_require):(delete window.require);
load(url, img, loading);
}
);
}}
});
},
function(ql){
var fm=ql.fm,
mimes=fm.arrayFlip(['text/html', 'application/xhtml+xml']),
preview=ql.preview;
preview.on(ql.evUpdate, function(e){
var file=e.file, jqxhr, loading;
if(mimes[file.mime]&&ql.dispInlineRegex.test(file.mime)&&(!ql.options.getSizeMax||file.size <=ql.options.getSizeMax)){
e.stopImmediatePropagation();
loading=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+fm.i18n('nowLoading')+'</span><span class="elfinder-spinner"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));
preview.one('change', function(){
jqxhr.state()=='pending'&&jqxhr.reject();
}).addClass('elfinder-overflow-auto');
jqxhr=fm.request({
data:{cmd:'get', target:file.hash, conv:1, _t:file.ts},
options:{type: 'get', cache:true},
preventDefault:true
})
.done(function(data){
ql.hideinfo();
var doc=$('<iframe class="elfinder-quicklook-preview-html"/>').appendTo(preview)[0].contentWindow.document;
doc.open();
doc.write(data.content);
doc.close();
})
.always(function(){
loading.remove();
});
}});
},
function(ql){
var fm=ql.fm,
mimes=fm.arrayFlip(['text/x-markdown']),
preview=ql.preview,
marked=null,
show=function(data, loading){
ql.hideinfo();
var doc=$('<iframe class="elfinder-quicklook-preview-html"/>').appendTo(preview)[0].contentWindow.document;
doc.open();
doc.write(marked(data.content));
doc.close();
loading.remove();
},
error=function(loading){
marked=false;
loading.remove();
};
preview.on(ql.evUpdate, function(e){
var file=e.file, jqxhr, loading;
if(mimes[file.mime]&&fm.options.cdns.marked&&marked!==false&&ql.dispInlineRegex.test(file.mime)&&(!ql.options.getSizeMax||file.size <=ql.options.getSizeMax)){
e.stopImmediatePropagation();
loading=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+fm.i18n('nowLoading')+'</span><span class="elfinder-spinner"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));
preview.one('change', function(){
jqxhr.state()=='pending'&&jqxhr.reject();
}).addClass('elfinder-overflow-auto');
jqxhr=fm.request({
data:{cmd:'get', target:file.hash, conv:1, _t:file.ts},
options:{type: 'get', cache:true},
preventDefault:true
})
.done(function(data){
if(marked||window.marked){
if(!marked){
marked=window.marked;
}
show(data, loading);
}else{
fm.loadScript([fm.options.cdns.marked],
function(res){
marked=res||window.marked||false;
delete window.marked;
if(marked){
show(data, loading);
}else{
error(loading);
}},
{
tryRequire: true,
error: function(){
error(loading);
}}
);
}})
.fail(function(){
error(loading);
});
}});
},
function(ql){
if(ql.options.viewerjs){
var fm=ql.fm,
preview=ql.preview,
opts=ql.options.viewerjs,
mimes=opts.url? fm.arrayFlip(opts.mimes||[]):[];
if(opts.url){
preview.on('update', function(e){
var win=ql.window,
file=e.file, node, loading;
if(mimes[file.mime]){
var url=fm.openUrl(file.hash);
if(url&&fm.isSameOrigin(url)){
e.stopImmediatePropagation();
loading=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+fm.i18n('nowLoading')+'</span><span class="elfinder-spinner"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));
node=$('<iframe class="elfinder-quicklook-preview-iframe"/>')
.css('background-color', 'transparent')
.on('load', function(){
ql.hideinfo();
loading.remove();
node.css('background-color', '#fff');
})
.on('error', function(){
loading.remove();
node.remove();
})
.appendTo(preview)
.attr('src', opts.url + '#' + url);
preview.one('change', function(){
loading.remove();
node.off('load').remove();
});
}}
});
}}
},
function(ql){
var fm=ql.fm,
mime='application/pdf',
preview=ql.preview,
active=false,
urlhash='',
firefox, toolbar;
if((fm.UA.Safari&&fm.OS==='mac'&&!fm.UA.iOS)||fm.UA.IE||fm.UA.Firefox){
active=true;
}else{
$.each(navigator.plugins, function(i, plugins){
$.each(plugins, function(i, plugin){
if(plugin.type===mime){
return !(active=true);
}});
});
}
if(active){
if(typeof ql.options.pdfToolbar!=='undefined'&&!ql.options.pdfToolbar){
urlhash='#toolbar=0';
}
preview.on(ql.evUpdate, function(e){
var file=e.file;
if(active&&file.mime===mime&&ql.dispInlineRegex.test(file.mime)){
e.stopImmediatePropagation();
ql.hideinfo();
ql.cover.addClass('elfinder-quicklook-coverbg');
$('<object class="elfinder-quicklook-preview-pdf" data="'+fm.openUrl(file.hash)+urlhash+'" type="application/pdf" />')
.on('error', function(e){
active=false;
ql.update(void(0), fm.cwd());
ql.update(void(0), file);
})
.appendTo(preview);
}});
}},
function(ql){
var fm=ql.fm,
mime='application/x-shockwave-flash',
preview=ql.preview,
active=false;
$.each(navigator.plugins, function(i, plugins){
$.each(plugins, function(i, plugin){
if(plugin.type===mime){
return !(active=true);
}});
});
active&&preview.on(ql.evUpdate, function(e){
var file=e.file,
node;
if(file.mime===mime&&ql.dispInlineRegex.test(file.mime)){
e.stopImmediatePropagation();
ql.hideinfo();
node=$('<embed class="elfinder-quicklook-preview-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+fm.openUrl(file.hash)+'" quality="high" type="application/x-shockwave-flash" wmode="transparent" />')
.appendTo(preview);
}});
},
function(ql){
var fm=ql.fm,
preview=ql.preview,
mimes={
'audio/mpeg':'mp3',
'audio/mpeg3':'mp3',
'audio/mp3':'mp3',
'audio/x-mpeg3':'mp3',
'audio/x-mp3':'mp3',
'audio/x-wav':'wav',
'audio/wav':'wav',
'audio/x-m4a':'m4a',
'audio/aac':'m4a',
'audio/mp4':'m4a',
'audio/x-mp4':'m4a',
'audio/ogg':'ogg',
'audio/webm':'webm',
'audio/flac':'flac',
'audio/x-flac':'flac',
'audio/amr':'amr'
},
node, curHash,
win=ql.window,
navi=ql.navbar,
AMR, autoplay,
controlsList=typeof ql.options.mediaControlsList==='string'&&ql.options.mediaControlsList? ' controlsList="' + fm.escape(ql.options.mediaControlsList) + '"':'',
setNavi=function(){
navi.css('bottom', win.hasClass('elfinder-quicklook-fullscreen')? '50px':'');
},
getNode=function(src, hash){
return $('<audio class="elfinder-quicklook-preview-audio ui-front" controls' + controlsList + ' preload="auto" autobuffer><source src="'+src+'" /></audio>')
.on('change', function(e){
e.stopPropagation();
})
.on('error', function(e){
node&&node.data('hash')===hash&&reset();
})
.data('hash', hash)
.appendTo(preview);
},
amrToWavUrl=function(hash){
var dfd=$.Deferred(),
loader=$.Deferred().done(function(){
fm.getContents(hash).done(function(data){
try {
var buffer=AMR.toWAV(new Uint8Array(data));
if(buffer){
dfd.resolve(URL.createObjectURL(new Blob([buffer], { type: 'audio/x-wav' })));
}else{
dfd.reject();
}} catch(e){
dfd.reject();
}}).fail(function(){
dfd.reject();
});
}).fail(function(){
AMR=false;
dfd.reject();
}),
_AMR;
if(window.TextEncoder&&window.URL&&URL.createObjectURL&&typeof AMR==='undefined'){
_AMR=window.AMR;
delete window.AMR;
fm.loadScript([ fm.options.cdns.amr ],
function(){
AMR=window.AMR? window.AMR:false;
window.AMR=_AMR;
loader[AMR? 'resolve':'reject']();
},
{
error: function(){
loader.reject();
}}
);
}else{
loader[AMR? 'resolve':'reject']();
}
return dfd;
},
play=function(player){
var hash=node.data('hash'),
playPromise;
autoplay&&(playPromise=player.play());
if(playPromise&&playPromise['catch']){
playPromise['catch'](function(e){
if(!player.paused){
node&&node.data('hash')===hash&&reset();
}});
}},
reset=function(){
if(node&&node.parent().length){
var elm=node[0],
url=node.children('source').attr('src');
win.off('viewchange.audio');
try {
elm.pause();
node.empty();
if(url.match(/^blob:/)){
URL.revokeObjectURL(url);
}
elm.src='';
elm.load();
} catch(e){}
node.remove();
node=null;
}};
preview.on(ql.evUpdate, function(e){
var file=e.file,
type=mimes[file.mime],
html5, srcUrl;
if(mimes[file.mime]&&ql.dispInlineRegex.test(file.mime)&&((html5=ql.support.audio[type])||(type==='amr'))){
autoplay=ql.autoPlay();
curHash=file.hash;
srcUrl=html5? fm.openUrl(curHash):'';
if(!html5){
if(fm.options.cdns.amr&&type==='amr'&&AMR!==false){
e.stopImmediatePropagation();
node=getNode(srcUrl, curHash);
amrToWavUrl(file.hash).done(function(url){
if(curHash===file.hash){
var elm=node[0];
try {
node.children('source').attr('src', url);
elm.pause();
elm.load();
play(elm);
win.on('viewchange.audio', setNavi);
setNavi();
} catch(e){
URL.revokeObjectURL(url);
node.remove();
}}else{
URL.revokeObjectURL(url);
}}).fail(function(){
node.remove();
});
}}else{
e.stopImmediatePropagation();
node=getNode(srcUrl, curHash);
play(node[0]);
win.on('viewchange.audio', setNavi);
setNavi();
}}
}).on('change', reset);
},
function(ql){
var fm=ql.fm,
preview=ql.preview,
mimes={
'video/mp4':'mp4',
'video/x-m4v':'mp4',
'video/quicktime':'mp4',
'video/mpeg':'mpeg',
'video/ogg':'ogg',
'application/ogg':'ogg',
'video/webm':'webm',
'video/x-matroska': 'mkv',
'video/3gpp':'3gp',
'application/vnd.apple.mpegurl':'m3u8',
'application/x-mpegurl':'m3u8',
'application/dash+xml':'mpd',
'video/x-flv':'flv',
'video/x-msvideo':'avi'
},
node,
win=ql.window,
navi=ql.navbar,
cHls, cDash, pDash, cFlv, cVideojs, autoplay, tm,
controlsList=typeof ql.options.mediaControlsList==='string'&&ql.options.mediaControlsList? ' controlsList="' + fm.escape(ql.options.mediaControlsList) + '"':'',
setNavi=function(){
if(fm.UA.iOS){
if(win.hasClass('elfinder-quicklook-fullscreen')){
preview.css('height', '-webkit-calc(100% - 50px)');
navi._show();
}else{
preview.css('height', '');
}}else{
navi.css('bottom', win.hasClass('elfinder-quicklook-fullscreen')? '50px':'');
}},
render=function(file, opts){
var errTm=function(e){
if(err > 1){
tm&&clearTimeout(tm);
tm=setTimeout(function(){
!canPlay&&reset(true);
}, 800);
}},
err=0,
canPlay;
pDash=null;
opts=opts||{};
ql.hideinfo();
node=$('<video class="elfinder-quicklook-preview-video" controls' + controlsList + ' preload="auto" autobuffer playsinline>'
+'</video>')
.on('change', function(e){
e.stopPropagation();
})
.on('timeupdate progress', errTm)
.on('canplay', function(){
canPlay=true;
})
.data('hash', file.hash);
node[0].addEventListener('error', function(e){
if(opts.src&&fm.convAbsUrl(opts.src)===fm.convAbsUrl(e.target.src)){
++err;
errTm();
}}, true);
if(opts.src){
node.append('<source src="'+opts.src+'" type="'+file.mime+'"/><source src="'+opts.src+'"/>');
}
node.appendTo(preview);
win.on('viewchange.video', setNavi);
setNavi();
},
loadHls=function(file){
var hls;
render(file);
hls=new cHls();
hls.loadSource(fm.openUrl(file.hash));
hls.attachMedia(node[0]);
if(autoplay){
hls.on(cHls.Events.MANIFEST_PARSED, function(){
play(node[0]);
});
}},
loadDash=function(file){
render(file);
pDash=window.dashjs.MediaPlayer().create();
pDash.getDebug().setLogToBrowserConsole(false);
pDash.initialize(node[0], fm.openUrl(file.hash), autoplay);
pDash.on('error', function(e){
reset(true);
});
},
loadFlv=function(file){
if(!cFlv.isSupported()){
cFlv=false;
return;
}
var player=cFlv.createPlayer({
type: 'flv',
url: fm.openUrl(file.hash)
});
render(file);
player.on(cFlv.Events.ERROR, function(){
player.destroy();
reset(true);
});
player.attachMediaElement(node[0]);
player.load();
play(player);
},
loadVideojs=function(file){
render(file);
node[0].src=fm.openUrl(file.hash);
cVideojs(node[0], {
src: fm.openUrl(file.hash)
});
},
play=function(player){
var hash=node.data('hash'),
playPromise;
autoplay&&(playPromise=player.play());
if(playPromise&&playPromise['catch']){
playPromise['catch'](function(e){
if(!player.paused){
node&&node.data('hash')===hash&&reset(true);
}});
}},
reset=function(showInfo){
tm&&clearTimeout(tm);
if(node&&node.parent().length){
var elm=node[0];
win.off('viewchange.video');
pDash&&pDash.reset();
try {
elm.pause();
node.empty();
elm.src='';
elm.load();
} catch(e){}
node.remove();
node=null;
}
showInfo&&ql.info.show();
};
preview.on(ql.evUpdate, function(e){
var file=e.file,
mime=file.mime.toLowerCase(),
type=mimes[mime],
stock, playPromise;
if(mimes[mime]&&ql.dispInlineRegex.test(file.mime) ){
autoplay=ql.autoPlay();
if(ql.support.video[type]&&(type!=='m3u8'||fm.UA.Safari)){
e.stopImmediatePropagation();
render(file, { src: fm.openUrl(file.hash) });
play(node[0]);
}else{
if(cHls!==false&&fm.options.cdns.hls&&type==='m3u8'){
e.stopImmediatePropagation();
if(cHls){
loadHls(file);
}else{
stock=window.Hls;
delete window.Hls;
fm.loadScript([ fm.options.cdns.hls ],
function(res){
cHls=res||window.Hls||false;
window.Hls=stock;
cHls&&loadHls(file);
},
{
tryRequire: true,
error:function(){
cHls=false;
}}
);
}}else if(cDash!==false&&fm.options.cdns.dash&&type==='mpd'){
e.stopImmediatePropagation();
if(cDash){
loadDash(file);
}else{
fm.loadScript([ fm.options.cdns.dash ],
function(){
cDash=window.dashjs? true:false;
cDash&&loadDash(file);
},
{
tryRequire: true,
error:function(){
cDash=false;
}}
);
}}else if(cFlv!==false&&fm.options.cdns.flv&&type==='flv'){
e.stopImmediatePropagation();
if(cFlv){
loadFlv(file);
}else{
stock=window.flvjs;
delete window.flvjs;
fm.loadScript([ fm.options.cdns.flv ],
function(res){
cFlv=res||window.flvjs||false;
window.flvjs=stock;
cFlv&&loadFlv(file);
},
{
tryRequire: true,
error:function(){
cFlv=false;
}}
);
}}else{
if(cVideojs){
loadVideojs(file);
}else{
fm.loadScript([ 'https://cdnjs.cloudflare.com/ajax/libs/video.js/7.5.0/video.min.js' ],
function(res){
cVideojs=res||window.videojs||false;
cVideojs&&loadVideojs(file);
},
{
tryRequire: true,
error:function(){
cVideojs=false;
}}
).loadCss(['https://cdnjs.cloudflare.com/ajax/libs/video.js/7.5.0/video-js.min.css']);
}}
}}
}).on('change', reset);
},
function(ql){
var preview=ql.preview,
mimes=[],
node,
win=ql.window,
navi=ql.navbar;
$.each(navigator.plugins, function(i, plugins){
$.each(plugins, function(i, plugin){
(plugin.type.indexOf('audio/')===0||plugin.type.indexOf('video/')===0)&&mimes.push(plugin.type);
});
});
mimes=ql.fm.arrayFlip(mimes);
preview.on(ql.evUpdate, function(e){
var file=e.file,
mime=file.mime,
video,
setNavi=function(){
navi.css('bottom', win.hasClass('elfinder-quicklook-fullscreen')? '50px':'');
};
if(mimes[file.mime]&&ql.dispInlineRegex.test(file.mime)){
e.stopImmediatePropagation();
(video=mime.indexOf('video/')===0)&&ql.hideinfo();
node=$('<embed src="'+ql.fm.openUrl(file.hash)+'" type="'+mime+'" class="elfinder-quicklook-preview-'+(video ? 'video':'audio')+'"/>')
.appendTo(preview);
win.on('viewchange.embed', setNavi);
setNavi();
}}).on('change', function(){
if(node&&node.parent().length){
win.off('viewchange.embed');
node.remove();
node=null;
}});
},
function(ql){
var fm=ql.fm,
mimes=fm.arrayFlip(['application/zip', 'application/x-gzip', 'application/x-tar']),
preview=ql.preview,
unzipFiles=function(){
var filenameList=[];
var i;
var il;
var fileHeaderList;
this.Y();
fileHeaderList=this.i;
for (i=0, il=fileHeaderList.length; i < il; ++i){
filenameList[i]=fileHeaderList[i].filename + (fileHeaderList[i].J? ' (' + fm.formatSize(fileHeaderList[i].J) + ')':'');
}
return filenameList;
},
tarFiles=function(tar){
var filenames=[],
tarlen=tar.length,
offset=0,
toStr=function(arr){
return String.fromCharCode.apply(null, arr).replace(/\0+$/, '');
},
h, name, prefix, size, dbs;
while (offset < tarlen&&tar[offset]!==0){
h=tar.subarray(offset, offset + 512);
name=toStr(h.subarray(0, 100));
if(prefix=toStr(h.subarray(345, 500))){
name=prefix + name;
}
size=parseInt(toStr(h.subarray(124, 136)), 8);
dbs=Math.ceil(size / 512) * 512;
if(name==='././@LongLink'){
name=toStr(tar.subarray(offset + 512, offset + 512 + dbs));
}
(name!=='pax_global_header')&&filenames.push(name + (size? ' (' + fm.formatSize(size) + ')': ''));
offset=offset + 512 + dbs;
}
return filenames;
},
Zlib;
if(window.Uint8Array&&window.DataView&&fm.options.cdns.zlibUnzip&&fm.options.cdns.zlibGunzip){
preview.on(ql.evUpdate, function(e){
var file=e.file,
isTar=(file.mime==='application/x-tar');
if(mimes[file.mime]&&(
isTar
|| ((typeof Zlib==='undefined'||Zlib)&&(file.mime==='application/zip'||file.mime==='application/x-gzip'))
)){
var jqxhr, loading, url,
req=function(){
url=fm.openUrl(file.hash);
if(!fm.isSameOrigin(url)){
url=fm.openUrl(file.hash, true);
}
jqxhr=fm.request({
data:{cmd:'get'},
options:{
url: url,
type: 'get',
cache:true,
dataType:'binary',
responseType :'arraybuffer',
processData: false
}})
.fail(function(){
loading.remove();
})
.done(function(data){
var unzip, filenames;
try {
if(file.mime==='application/zip'){
unzip=new Zlib.Unzip(new Uint8Array(data));
filenames=unzipFiles.call(unzip);
}else if(file.mime==='application/x-gzip'){
unzip=new Zlib.Gunzip(new Uint8Array(data));
filenames=tarFiles(unzip.decompress());
}else if(file.mime==='application/x-tar'){
filenames=tarFiles(new Uint8Array(data));
}
makeList(filenames);
} catch (e){
loading.remove();
fm.debug('error', e);
}});
},
makeList=function(filenames){
var header, doc;
if(filenames&&filenames.length){
filenames=$.map(filenames, function(str){
return fm.decodeRawString(str);
});
filenames.sort();
loading.remove();
header='<strong>'+fm.escape(file.mime)+'</strong> ('+fm.formatSize(file.size)+')'+'<hr/>';
doc=$('<div class="elfinder-quicklook-preview-archive-wrapper">'+header+'<pre class="elfinder-quicklook-preview-text">'+fm.escape(filenames.join("\n"))+'</pre></div>')
.on('touchstart', function(e){
if($(this)['scroll' + (fm.direction==='ltr'? 'Right':'Left')]() > 5){
e.originalEvent._preventSwipeX=true;
}})
.appendTo(preview);
ql.hideinfo();
}},
_Zlib;
e.stopImmediatePropagation();
loading=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+fm.i18n('nowLoading')+'</span><span class="elfinder-spinner"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));
preview.one('change', function(){
jqxhr.state()==='pending'&&jqxhr.reject();
loading.remove();
});
if(Zlib){
req();
}else{
if(window.Zlib){
_Zlib=window.Zlib;
delete window.Zlib;
}
fm.loadScript([ fm.options.cdns.zlibUnzip, fm.options.cdns.zlibGunzip ],
function(){
if(window.Zlib&&(Zlib=window.Zlib)){
if(_Zlib){
window.Zlib=_Zlib;
}else{
delete window.Zlib;
}
req();
}else{
error();
}}
);
}}
});
}},
function(ql){
var fm=ql.fm,
mimes=fm.arrayFlip(['application/x-rar']),
preview=ql.preview,
RAR;
if(window.DataView){
preview.on(ql.evUpdate, function(e){
var file=e.file;
if(mimes[file.mime]&&fm.options.cdns.rar&&RAR!==false){
var loading, url, archive, abort,
getList=function(url){
if(abort){
loading.remove();
return;
}
try {
archive=RAR({
file: url,
type: 2,
xhrHeaders: fm.customHeaders,
xhrFields: fm.xhrFields
}, function(err){
loading.remove();
var filenames=[],
header, doc;
if(abort||err){
err&&fm.debug('error', err);
return;
}
$.each(archive.entries, function(){
filenames.push(this.path + (this.size? ' (' + fm.formatSize(this.size) + ')':''));
});
if(filenames.length){
filenames=$.map(filenames, function(str){
return fm.decodeRawString(str);
});
filenames.sort();
header='<strong>'+fm.escape(file.mime)+'</strong> ('+fm.formatSize(file.size)+')'+'<hr/>';
doc=$('<div class="elfinder-quicklook-preview-archive-wrapper">'+header+'<pre class="elfinder-quicklook-preview-text">'+fm.escape(filenames.join("\n"))+'</pre></div>')
.on('touchstart', function(e){
if($(this)['scroll' + (fm.direction==='ltr'? 'Right':'Left')]() > 5){
e.originalEvent._preventSwipeX=true;
}})
.appendTo(preview);
ql.hideinfo();
}});
} catch(e){
loading.remove();
}},
error=function(){
RAR=false;
loading.remove();
},
_RAR;
e.stopImmediatePropagation();
loading=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+fm.i18n('nowLoading')+'</span><span class="elfinder-spinner"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));
preview.one('change', function(){
archive&&(archive.abort=true);
loading.remove();
abort=true;
});
url=fm.openUrl(file.hash);
if(!fm.isSameOrigin(url)){
url=fm.openUrl(file.hash, true);
}
if(RAR){
getList(url);
}else{
if(window.RarArchive){
_RAR=window.RarArchive;
delete window.RarArchive;
}
fm.loadScript([ fm.options.cdns.rar ],
function(){
if(fm.hasRequire){
require(['rar'], function(RarArchive){
RAR=RarArchive;
getList(url);
}, error);
}else{
if(RAR=window.RarArchive){
if(_RAR){
window.RarArchive=_RAR;
}else{
delete window.RarArchive;
}
getList(url);
}else{
error();
}}
},
{
tryRequire: true,
error:error
}
);
}}
});
}},
function(ql){
var fm=ql.fm,
mimes=fm.arrayFlip(ql.options.sharecadMimes||[]),
preview=ql.preview,
win=ql.window,
node;
if(ql.options.sharecadMimes.length){
ql.addIntegration({
title: 'ShareCAD.org CAD and 3D-Models viewer',
link: 'https://sharecad.org/DWGOnlinePlugin'
});
}
preview.on(ql.evUpdate, function(e){
var file=e.file;
if(mimes[file.mime.toLowerCase()]&&!fm.option('onetimeUrl', file.hash)){
var win=ql.window,
loading, url;
e.stopImmediatePropagation();
if(file.url=='1'){
preview.hide();
$('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">'+fm.i18n('getLink')+'</button></div>').appendTo(ql.info.find('.elfinder-quicklook-info'))
.on('click', function(){
var self=$(this);
self.html('<span class="elfinder-spinner">');
fm.request({
data:{cmd:'url', target:file.hash},
preventDefault:true
})
.always(function(){
self.html('');
})
.done(function(data){
var rfile=fm.file(file.hash);
file.url=rfile.url=data.url||'';
if(file.url){
preview.trigger({
type: ql.evUpdate,
file: file,
forceUpdate: true
});
}});
});
}
if(file.url!==''&&file.url!='1'){
preview.one('change', function(){
loading.remove();
node.off('load').remove();
node=null;
}).addClass('elfinder-overflow-auto');
loading=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+fm.i18n('nowLoading')+'</span><span class="elfinder-spinner"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));
url=fm.convAbsUrl(fm.url(file.hash));
node=$('<iframe class="elfinder-quicklook-preview-iframe" scrolling="no"/>')
.css('background-color', 'transparent')
.appendTo(preview)
.on('load', function(){
ql.hideinfo();
loading.remove();
ql.preview.after(ql.info);
$(this).css('background-color', '#fff').show();
})
.on('error', function(){
loading.remove();
ql.preview.after(ql.info);
})
.attr('src', '//sharecad.org/cadframe/load?url=' + encodeURIComponent(url));
ql.info.after(ql.preview);
}}
});
},
function(ql){
var fm=ql.fm,
mimes={
'application/vnd.google-earth.kml+xml':true,
'application/vnd.google-earth.kmz':true
},
preview=ql.preview,
gMaps, loadMap, wGmfail, fail, mapScr;
if(ql.options.googleMapsApiKey){
ql.addIntegration({
title: 'Google Maps',
link: 'https://www.google.com/intl/' + fm.lang.replace('_', '-') + '/help/terms_maps.html'
});
gMaps=(window.google&&google.maps);
loadMap=function(file, node){
var mapsOpts=ql.options.googleMapsOpts.maps;
fm.forExternalUrl(file.hash).done(function(url){
if(url){
try {
new gMaps.KmlLayer(url, Object.assign({
map: new gMaps.Map(node.get(0), mapsOpts)
}, ql.options.googleMapsOpts.kml));
ql.hideinfo();
} catch(e){
fail();
}}else{
fail();
}});
};
wGmfail=window.gm_authFailure;
fail=function(){
mapScr=null;
};
mapScr='https://maps.googleapis.com/maps/api/js?key=' + ql.options.googleMapsApiKey;
window.gm_authFailure=function(){
fail();
wGmfail&&wGmfail();
};
preview.on(ql.evUpdate, function(e){
var file=e.file;
if(mapScr&&mimes[file.mime.toLowerCase()]){
var win=ql.window,
getLink=(file.url=='1'&&!fm.option('onetimeUrl', file.hash)),
loading, url, node;
e.stopImmediatePropagation();
if(getLink){
preview.hide();
$('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">'+fm.i18n('getLink')+'</button></div>').appendTo(ql.info.find('.elfinder-quicklook-info'))
.on('click', function(){
var self=$(this);
self.html('<span class="elfinder-spinner">');
fm.request({
data:{cmd:'url', target:file.hash},
preventDefault:true
})
.always(function(){
self.html('');
})
.done(function(data){
var rfile=fm.file(file.hash);
file.url=rfile.url=data.url||'';
if(file.url){
preview.trigger({
type: ql.evUpdate,
file: file,
forceUpdate: true
});
}});
});
}
if(file.url!==''&&!getLink){
node=$('<div style="width:100%;height:100%;"/>').appendTo(preview);
preview.one('change', function(){
node.remove();
node=null;
});
if(!gMaps){
fm.loadScript([mapScr], function(){
gMaps=window.google&&google.maps;
gMaps&&loadMap(file, node);
});
}else{
loadMap(file, node);
}}
}});
}},
function(ql){
var fm=ql.fm,
mimes=Object.assign(fm.arrayFlip(ql.options.googleDocsMimes||[], 'g'), fm.arrayFlip(ql.options.officeOnlineMimes||[], 'm')),
preview=ql.preview,
win=ql.window,
navi=ql.navbar,
urls={
g: 'docs.google.com/gview?embedded=true&url=',
m: 'view.officeapps.live.com/op/embed.aspx?wdStartOn=0&src='
},
navBottom={
g: '56px',
m: '24px'
},
mLimits={
xls:5242880,
xlsb:5242880,
xlsx:5242880,
xlsm:5242880,
other: 10485760 
},
node, enable;
if(ql.options.googleDocsMimes.length){
enable=true;
ql.addIntegration({
title: 'Google Docs Viewer',
link: 'https://docs.google.com/'
});
}
if(ql.options.officeOnlineMimes.length){
enable=true;
ql.addIntegration({
title: 'MS Online Doc Viewer',
link: 'https://products.office.com/office-online/view-office-documents-online'
});
}
if(enable){
preview.on(ql.evUpdate, function(e){
var file=e.file,
type;
if(file.size <=26214400&&(type=mimes[file.mime])){
var win=ql.window,
setNavi=function(){
navi.css('bottom', win.hasClass('elfinder-quicklook-fullscreen')? navBottom[type]:'');
},
ext=fm.mimeTypes[file.mime],
getLink=(file.url=='1'&&!fm.option('onetimeUrl', file.hash)),
loading, url;
if(type==='m'){
if((mLimits[ext]&&file.size > mLimits[ext])||file.size > mLimits.other){
type='g';
}}
if(getLink){
preview.hide();
$('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">'+fm.i18n('getLink')+'</button></div>').appendTo(ql.info.find('.elfinder-quicklook-info'))
.on('click', function(){
var self=$(this);
self.html('<span class="elfinder-spinner">');
fm.request({
data:{cmd:'url', target:file.hash},
preventDefault:true
})
.always(function(){
self.html('');
})
.done(function(data){
var rfile=fm.file(file.hash);
file.url=rfile.url=data.url||'';
if(file.url){
preview.trigger({
type: ql.evUpdate,
file: file,
forceUpdate: true
});
}});
});
}
if(file.url!==''&&!getLink){
e.stopImmediatePropagation();
preview.one('change', function(){
win.off('viewchange.googledocs');
loading.remove();
node.off('load').remove();
node=null;
}).addClass('elfinder-overflow-auto');
loading=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+fm.i18n('nowLoading')+'</span><span class="elfinder-spinner"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));
node=$('<iframe class="elfinder-quicklook-preview-iframe"/>')
.css('background-color', 'transparent')
.appendTo(preview);
fm.forExternalUrl(file.hash).done(function(url){
if(url){
if(file.ts){
url +=(url.match(/\?/)? '&':'?') + '_t=' + file.ts;
}
node.on('load', function(){
ql.hideinfo();
loading.remove();
ql.preview.after(ql.info);
$(this).css('background-color', '#fff').show();
})
.on('error', function(){
loading.remove();
ql.preview.after(ql.info);
}).attr('src', 'https://' + urls[type] + encodeURIComponent(url));
}else{
loading.remove();
node.remove();
}});
win.on('viewchange.googledocs', setNavi);
setNavi();
ql.info.after(ql.preview);
}}
});
}},
function(ql){
var fm=ql.fm,
preview=ql.preview,
textMaxlen=parseInt(ql.options.textMaxlen)||2000,
prettify=function(){
if(fm.options.cdns.prettify){
fm.loadScript([fm.options.cdns.prettify + (fm.options.cdns.prettify.match(/\?/)? '&':'?') + 'autorun=false']);
prettify=function(){ return true; };}else{
prettify=function(){ return false; };}},
PRcheck=function(node, cnt){
if(prettify()){
if(typeof window.PR==='undefined'&&cnt--){
setTimeout(function(){ PRcheck(node, cnt); }, 100);
}else{
if(typeof window.PR==='object'){
node.css('cursor', 'wait');
requestAnimationFrame(function(){
PR.prettyPrint&&PR.prettyPrint(null, node.get(0));
node.css('cursor', '');
});
}else{
prettify=function(){ return false; };}}
}};
preview.on(ql.evUpdate, function(e){
var file=e.file,
mime=file.mime,
jqxhr, loading;
if(fm.mimeIsText(file.mime)&&(!ql.options.getSizeMax||file.size <=ql.options.getSizeMax)){
e.stopImmediatePropagation();
(typeof window.PR==='undefined')&&prettify();
loading=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+fm.i18n('nowLoading')+'</span><span class="elfinder-spinner"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));
preview.one('change', function(){
jqxhr.state()=='pending'&&jqxhr.reject();
});
jqxhr=fm.request({
data:{cmd:'get', target:file.hash, conv:1, _t:file.ts},
options:{type: 'get', cache:true},
preventDefault:true
})
.done(function(data){
var reg=new RegExp('^(data:'+file.mime.replace(/([.+])/g, '\\$1')+';base64,)', 'i'),
text=data.content,
part, more, node, m;
ql.hideinfo();
if(window.atob&&(m=text.match(reg))){
text=atob(text.substr(m[1].length));
}
more=text.length - textMaxlen;
if(more > 100){
part=text.substr(0, textMaxlen) + '...';
}else{
more=0;
}
node=$('<div class="elfinder-quicklook-preview-text-wrapper"><pre class="elfinder-quicklook-preview-text prettyprint"></pre></div>');
if(more){
node.append($('<div class="elfinder-quicklook-preview-charsleft"><hr/><span>' + fm.i18n('charsLeft', fm.toLocaleString(more)) + '</span></div>')
.on('click', function(){
var top=node.scrollTop();
$(this).remove();
node.children('pre').removeClass('prettyprinted').text(text).scrollTop(top);
PRcheck(node, 100);
})
);
}
node.children('pre').text(part||text);
node.on('touchstart', function(e){
if($(this)['scroll' + (fm.direction==='ltr'? 'Right':'Left')]() > 5){
e.originalEvent._preventSwipeX=true;
}}).appendTo(preview);
PRcheck(node, 100);
})
.always(function(){
loading.remove();
});
}});
}
];
(elFinder.prototype.commands.reload=function(){
"use strict";
var self=this,
search=false;
this.alwaysEnabled=true;
this.updateOnSelect=true;
this.shortcuts=[{
pattern:'ctrl+shift+r f5'
}];
this.getstate=function(){
return 0;
};
this.init=function(){
this.fm.bind('search searchend', function(){
search=this.type=='search';
});
};
this.fm.bind('contextmenu', function(){
var fm=self.fm;
if(fm.options.sync >=1000){
self.extra={
icon: 'accept',
node: $('<span/>')
.attr({title: fm.i18n('autoSync')})
.on('click touchstart', function(e){
if(e.type==='touchstart'&&e.originalEvent.touches.length > 1){
return;
}
e.stopPropagation();
e.preventDefault();
$(this).parent()
.toggleClass('ui-state-disabled', fm.options.syncStart)
.parent().removeClass('ui-state-hover');
fm.options.syncStart = !fm.options.syncStart;
fm.autoSync(fm.options.syncStart? null:'stop');
}).on('ready', function(){
$(this).parent().toggleClass('ui-state-disabled', !fm.options.syncStart).css('pointer-events', 'auto');
})
};}});
this.exec=function(){
var fm=this.fm;
if(!search){
var dfrd=fm.sync(),
timeout=setTimeout(function(){
fm.notify({type:'reload', cnt:1, hideCnt:true});
dfrd.always(function(){ fm.notify({type:'reload', cnt:-1});});
}, fm.notifyDelay);
return dfrd.always(function(){
clearTimeout(timeout);
fm.trigger('reload');
});
}else{
$('div.elfinder-toolbar > div.'+fm.res('class', 'searchbtn') + ' > span.ui-icon-search').click();
}};}).prototype={ forceLoad:true };
elFinder.prototype.commands.rename=function(){
"use strict";
this.alwaysEnabled=true;
this.syncTitleOnChange=true;
var self=this,
fm=self.fm,
request=function(dfrd, targtes, file, name){
var sel=targtes? [file.hash].concat(targtes):[file.hash],
cnt=sel.length,
data={}, rootNames;
fm.lockfiles({files:sel});
if(fm.isRoot(file)){
if(!(rootNames=fm.storage('rootNames'))){
rootNames={};}
if(name===''){
if(rootNames[file.hash]){
file.name=file._name;
file.i18=file._i18;
delete rootNames[file.hash];
delete file._name;
delete file._i18;
}else{
dfrd&&dfrd.reject();
fm.unlockfiles({files:sel}).trigger('selectfiles', {files:sel});
return;
}}else{
if(typeof file._name==='undefined'){
file._name=file.name;
file._i18=file.i18;
}
file.name=rootNames[file.hash]=name;
delete file.i18;
}
fm.storage('rootNames', rootNames);
data={ changed: [file] };
fm.updateCache(data);
fm.change(data);
dfrd&&dfrd.resolve(data);
fm.unlockfiles({files:sel}).trigger('selectfiles', {files:sel});
return;
}
data={
cmd:'rename',
name:name,
target:file.hash
};
if(cnt > 1){
data['targets']=targtes;
if(name.match(/\*/)){
data['q']=name;
}}
fm.request({
data:data,
notify:{type:'rename', cnt:cnt},
navigate:{}})
.fail(function(error){
var err=fm.parseError(error);
dfrd&&dfrd.reject();
if(! err||! Array.isArray(err)||err[0]!=='errRename'){
fm.sync();
}})
.done(function(data){
var cwdHash;
if(data.added&&data.added.length&&cnt===1){
data.undo={
cmd:'rename',
callback:function(){
return fm.request({
data:{cmd:'rename', target:data.added[0].hash, name:file.name},
notify:{type:'undo', cnt:1}});
}};
data.redo={
cmd:'rename',
callback:function(){
return fm.request({
data:{cmd:'rename', target:file.hash, name:name},
notify:{type:'rename', cnt:1}});
}};}
dfrd&&dfrd.resolve(data);
if(!(cwdHash=fm.cwd().hash)||cwdHash===file.hash){
fm.exec('open', $.map(data.added, function(f){
return (f.mime==='directory')? f.hash:null;
})[0]);
}})
.always(function(){
fm.unlockfiles({files:sel}).trigger('selectfiles', {files:sel});
}
);
},
getHint=function(name, target){
var sel=target||fm.selected(),
splits=fm.splitFileExtention(name),
f1=fm.file(sel[0]),
f2=fm.file(sel[1]),
ext, hint, add;
ext=splits[1]? ('.' + splits[1]):'';
if(splits[1]&&splits[0]==='*'){
hint='"' + fm.splitFileExtention(f1.name)[0] + ext + '", ';
hint +='"' + fm.splitFileExtention(f2.name)[0] + ext + '"';
}else if(splits[0].length > 1){
if(splits[0].substr(-1)==='*'){
add=splits[0].substr(0, splits[0].length - 1);
hint='"' + add + f1.name+'", ';
hint +='"' + add + f2.name+'"';
}else if(splits[0].substr(0, 1)==='*'){
add=splits[0].substr(1);
hint='"'+fm.splitFileExtention(f1.name)[0] + add + ext + '", ';
hint +='"'+fm.splitFileExtention(f2.name)[0] + add + ext + '"';
}}
if(!hint){
hint='"'+splits[0] + '1' + ext + '", "' + splits[0] + '2' + ext + '"';
}
if(sel.length > 2){
hint +=' ...';
}
return hint;
},
batchRename=function(){
var sel=fm.selected(),
tplr='<input name="type" type="radio" class="elfinder-tabstop">',
mkChk=function(node, label){
return $('<label class="elfinder-rename-batch-checks">' + fm.i18n(label) + '</label>').prepend(node);
},
name=$('<input type="text" class="ui-corner-all elfinder-tabstop">'),
num=$(tplr),
prefix=$(tplr),
suffix=$(tplr),
extention=$(tplr),
checks=$('<div/>').append(mkChk(num, 'plusNumber'),
mkChk(prefix, 'asPrefix'),
mkChk(suffix, 'asSuffix'),
mkChk(extention, 'changeExtention')
),
preview=$('<div class="elfinder-rename-batch-preview"/>'),
node=$('<div class="elfinder-rename-batch"/>').append($('<div class="elfinder-rename-batch-name"/>').append(name),
$('<div class="elfinder-rename-batch-type"/>').append(checks),
preview
),
opts={
title:fm.i18n('batchRename'),
modal:true,
destroyOnClose:true,
width: Math.min(380, fm.getUI().width() - 20),
buttons:{},
open:function(){
name.on('input', mkPrev).trigger('focus');
}},
getName=function(){
var vName=name.val(),
ext=fm.splitFileExtention(fm.file(sel[0]).name)[1];
if(vName!==''||num.is(':checked')){
if(prefix.is(':checked')){
vName +='*';
}else if(suffix.is(':checked')){
vName='*' + vName + '.' + ext;
}else if(extention.is(':checked')){
vName='*.' + vName;
}else if(ext){
vName +='.' + ext;
}}
return vName;
},
mkPrev=function(){
var vName=getName();
if(vName!==''){
preview.html(fm.i18n(['renameMultiple', sel.length, getHint(vName)]));
}else{
preview.empty();
}},
radios=checks.find('input:radio').on('change', mkPrev),
dialog;
opts.buttons[fm.i18n('btnApply')]=function(){
var vName=getName(),
file, targets;
if(vName!==''){
dialog.elfinderdialog('close');
targets=sel;
file=fm.file(targets.shift());
request(void(0), targets, file, vName);
}};
opts.buttons[fm.i18n('btnCancel')]=function(){
dialog.elfinderdialog('close');
};
if($.fn.checkboxradio){
radios.checkboxradio({
create: function(e, ui){
if(this===num.get(0)){
num.prop('checked', true).change();
}}
});
}else{
checks.buttonset({
create: function(e, ui){
num.prop('checked', true).change();
}});
}
dialog=self.fmDialog(node, opts);
};
this.noChangeDirOnRemovedCwd=true;
this.shortcuts=[{
pattern:'f2' + (fm.OS=='mac' ? ' enter':'')
}, {
pattern:'shift+f2',
description:'batchRename',
callback:function(){
fm.selected().length > 1&&batchRename();
}}];
this.getstate=function(select){
var sel=this.files(select),
cnt=sel.length,
phash, ext, mime, brk, state, isRoot;
if(!cnt){
return -1;
}
if(cnt > 1&&sel[0].phash){
phash=sel[0].phash;
ext=fm.splitFileExtention(sel[0].name)[1].toLowerCase();
mime=sel[0].mime;
}
if(cnt===1){
isRoot=fm.isRoot(sel[0]);
}
state=(cnt===1&&(isRoot||!sel[0].locked)||(fm.api > 2.1030&&cnt===$.grep(sel, function(f){
if(!brk&&!f.locked&&f.phash===phash&&!fm.isRoot(f)&&(mime===f.mime||ext===fm.splitFileExtention(f.name)[1].toLowerCase())){
return true;
}else{
brk&&(brk=true);
return false;
}}).length)) ? 0:-1;
if(!isRoot&&state===0&&fm.option('disabledFlip', sel[0].hash)['rename']){
state=-1;
}
if(state!==-1&&cnt > 1){
self.extra={
icon: 'preference',
node: $('<span/>')
.attr({title: fm.i18n('batchRename')})
.on('click touchstart', function(e){
if(e.type==='touchstart'&&e.originalEvent.touches.length > 1){
return;
}
e.stopPropagation();
e.preventDefault();
fm.getUI().trigger('click');
batchRename();
})
};}else{
delete self.extra;
}
return state;
};
this.exec=function(hashes, cOpts){
var cwd=fm.getUI('cwd'),
sel=hashes||(fm.selected().length? fm.selected():false)||[fm.cwd().hash],
cnt=sel.length,
file=fm.file(sel.shift()),
filename='.elfinder-cwd-filename',
opts=cOpts||{},
incwd=(fm.cwd().hash==file.hash),
type=(opts._currentType==='navbar'||opts._currentType==='files')? opts._currentType:(incwd? 'navbar':'files'),
navbar=(type!=='files'),
target=fm[navbar? 'navHash2Elm':'cwdHash2Elm'](file.hash),
tarea=(!navbar&&fm.storage('view')!='list'),
split=function(name){
var ext=fm.splitFileExtention(name)[1];
return [name.substr(0, name.length - ext.length - 1), ext];
},
unselect=function(){
requestAnimationFrame(function(){
input&&input.trigger('blur');
});
},
rest=function(){
if(!overlay.is(':hidden')){
overlay.elfinderoverlay('hide').off('click close', cancel);
}
pnode.removeClass('ui-front')
.css('position', '')
.off('unselect.'+fm.namespace, unselect);
if(tarea){
node&&node.css('max-height', '');
}else if(!navbar){
pnode.css('width', '')
.parent('td').css('overflow', '');
}}, colwidth,
dfrd=$.Deferred()
.fail(function(error){
var parent=input.parent(),
name=fm.escape(file.i18||file.name);
input.off();
if(tarea){
name=name.replace(/([_.])/g, '&#8203;$1');
}
requestAnimationFrame(function(){
if(navbar){
input.replaceWith(name);
}else{
if(parent.length){
input.remove();
parent.html(name);
}else{
target.find(filename).html(name);
}}
});
error&&fm.error(error);
})
.always(function(){
rest();
fm.unbind('resize', resize);
fm.enable();
}),
blur=function(e){
var name=$.trim(input.val()),
splits=fm.splitFileExtention(name),
valid=true,
req=function(){
input.off();
rest();
if(navbar){
input.replaceWith(fm.escape(name));
}else{
node.html(fm.escape(name));
}
request(dfrd, sel, file, name);
};
if(!overlay.is(':hidden')){
pnode.css('z-index', '');
}
if(name===''){
if(!fm.isRoot(file)){
return cancel();
}
if(navbar){
input.replaceWith(fm.escape(file.name));
}else{
node.html(fm.escape(file.name));
}}
if(!inError&&pnode.length){
input.off('blur');
if(cnt===1&&name===file.name){
return dfrd.reject();
}
if(fm.options.validName&&fm.options.validName.test){
try {
valid=fm.options.validName.test(name);
} catch(e){
valid=false;
}}
if(name==='.'||name==='..'||!valid){
inError=true;
fm.error(file.mime==='directory'? 'errInvDirname':'errInvName', {modal: true, close: function(){setTimeout(select, 120);}});
return false;
}
if(cnt===1&&fm.fileByName(name, file.phash)){
inError=true;
fm.error(['errExists', name], {modal: true, close: function(){setTimeout(select, 120);}});
return false;
}
if(cnt===1){
req();
}else{
fm.confirm({
title:'cmdrename',
text:['renameMultiple', cnt, getHint(name, [file.hash].concat(sel))],
accept:{
label:'btnYes',
callback:req
},
cancel:{
label:'btnCancel',
callback:function(){
setTimeout(function(){
inError=true;
select();
}, 120);
}}
});
setTimeout(function(){
fm.trigger('unselectfiles', {files: fm.selected()})
.trigger('selectfiles', {files:[file.hash].concat(sel)});
}, 120);
}}
},
input=$(tarea? '<textarea/>':'<input type="text"/>')
.on('keyup text', function(){
if(tarea){
this.style.height='1px';
this.style.height=this.scrollHeight + 'px';
}else if(colwidth){
this.style.width=colwidth + 'px';
if(this.scrollWidth > colwidth){
this.style.width=this.scrollWidth + 10 + 'px';
}}
})
.on('keydown', function(e){
e.stopImmediatePropagation();
if(e.keyCode==$.ui.keyCode.ESCAPE){
dfrd.reject();
}else if(e.keyCode==$.ui.keyCode.ENTER){
e.preventDefault();
input.trigger('blur');
}})
.on('mousedown click dblclick', function(e){
e.stopPropagation();
if(e.type==='dblclick'){
e.preventDefault();
}})
.on('blur', blur)
.on('dragenter dragleave dragover drop', function(e){
e.stopPropagation();
}),
select=function(){
var name=fm.splitFileExtention(input.val())[0];
if(!inError&&fm.UA.Mobile&&!fm.UA.iOS){
overlay.on('click close', cancel).elfinderoverlay('show');
pnode.css('z-index', overlay.css('z-index') + 1);
}
! fm.enabled()&&fm.enable();
if(inError){
inError=false;
input.on('blur', blur);
}
input.trigger('focus').trigger('select');
input[0].setSelectionRange&&input[0].setSelectionRange(0, name.length);
},
node=navbar? target.contents().filter(function(){ return this.nodeType==3&&$(this).parent().attr('id')===fm.navHash2Id(file.hash); })
: target.find(filename),
pnode=node.parent(),
overlay=fm.getUI('overlay'),
cancel=function(e){
if(!overlay.is(':hidden')){
pnode.css('z-index', '');
}
if(! inError){
dfrd.reject();
if(e){
e.stopPropagation();
e.preventDefault();
}}
},
resize=function(){
target.trigger('scrolltoview', {blink:false});
},
inError=false;
pnode.addClass('ui-front')
.css('position', 'relative')
.on('unselect.'+fm.namespace, unselect);
fm.bind('resize', resize);
if(navbar){
node.replaceWith(input.val(file.name));
}else{
if(tarea){
node.css('max-height', 'none');
}else if(!navbar){
colwidth=pnode.width();
pnode.width(colwidth - 15)
.parent('td').css('overflow', 'visible');
}
node.empty().append(input.val(file.name));
}
if(cnt > 1&&fm.api <=2.1030){
return dfrd.reject();
}
if(!file||!node.length){
return dfrd.reject('errCmdParams', this.title);
}
if(file.locked&&!fm.isRoot(file)){
return dfrd.reject(['errLocked', file.name]);
}
fm.one('select', function(){
input.parent().length&&file&&$.inArray(file.hash, fm.selected())===-1&&input.trigger('blur');
});
input.trigger('keyup');
select();
return dfrd;
};
fm.bind('select contextmenucreate closecontextmenu', function(e){
var sel=(e.data? (e.data.selected||e.data.targets):null)||fm.selected(),
file;
if(sel&&sel.length===1&&(file=fm.file(sel[0]))&&fm.isRoot(file)){
self.title=fm.i18n('kindAlias') + ' (' + fm.i18n('preference') + ')';
}else{
self.title=fm.i18n('cmdrename');
}
if(e.type!=='closecontextmenu'){
self.update(void(0), self.title);
}else{
requestAnimationFrame(function(){
self.update(void(0), self.title);
});
}}).remove(function(e){
var rootNames;
if(e.data&&e.data.removed&&(rootNames=fm.storage('rootNames'))){
$.each(e.data.removed, function(i, h){
if(rootNames[h]){
delete rootNames[h];
}});
fm.storage('rootNames', rootNames);
}});
};
elFinder.prototype.commands.resize=function(){
"use strict";
var losslessRotate=0,
getBounceBox=function(w, h, theta){
var srcPts=[
{x: w/2, y: h/2},
{x: -w/2, y: h/2},
{x: -w/2, y: -h/2},
{x: w/2, y: -h/2}
],
dstPts=[],
min={x: Number.MAX_VALUE, y: Number.MAX_VALUE},
max={x: Number.MIN_VALUE, y: Number.MIN_VALUE};
$.each(srcPts, function(i, srcPt){
dstPts.push({
x: srcPt.x * Math.cos(theta) - srcPt.y * Math.sin(theta),
y: srcPt.x * Math.sin(theta) + srcPt.y * Math.cos(theta)
});
});
$.each(dstPts, function(i, pt){
min.x=Math.min(min.x, pt.x);
min.y=Math.min(min.y, pt.y);
max.x=Math.max(max.x, pt.x);
max.y=Math.max(max.y, pt.y);
});
return {
width: max.x - min.x, height: max.y - min.y
};};
this.updateOnSelect=false;
this.getstate=function(){
var sel=this.fm.selectedFiles();
return sel.length==1&&sel[0].read&&sel[0].write&&sel[0].mime.indexOf('image/')!==-1 ? 0:-1;
};
this.resizeRequest=function(data, f, dfrd){
var fm=this.fm,
file=f||fm.file(data.target),
tmb=file? file.tmb:null,
enabled=fm.isCommandEnabled('resize', data.target);
if(enabled&&(! file||(file&&file.read&&file.write&&file.mime.indexOf('image/')!==-1))){
return fm.request({
data:Object.assign(data, {
cmd:'resize'
}),
notify:{type:'resize', cnt:1}})
.fail(function(error){
if(dfrd){
dfrd.reject(error);
}})
.done(function(){
if(data.quality){
fm.storage('jpgQuality', data.quality===fm.option('jpgQuality')? null:data.quality);
}
dfrd&&dfrd.resolve();
});
}else{
var error;
if(file){
if(file.mime.indexOf('image/')===-1){
error=['errResize', file.name, 'errUsupportType'];
}else{
error=['errResize', file.name, 'errPerm'];
}}else{
error=['errResize', data.target, 'errPerm'];
}
if(dfrd){
dfrd.reject(error);
}else{
fm.error(error);
}
return $.Deferred().reject(error);
}};
this.exec=function(hashes){
var self=this,
fm=this.fm,
files=this.files(hashes),
dfrd=$.Deferred(),
api2=(fm.api > 1),
options=this.options,
dialogWidth=650,
fmnode=fm.getUI(),
ctrgrup=$().controlgroup? 'controlgroup':'buttonset',
grid8Def=typeof options.grid8px==='undefined'||options.grid8px!=='disable'? true:false,
presetSize=Array.isArray(options.presetSize)? options.presetSize:[],
clactive='elfinder-dialog-active',
clsediting=fm.res('class', 'editing'),
open=function(file, id){
var isJpeg=(file.mime==='image/jpeg'),
dialog=$('<div class="elfinder-resize-container"/>'),
input='<input type="number" class="ui-corner-all"/>',
row='<div class="elfinder-resize-row"/>',
label='<div class="elfinder-resize-label"/>',
changeTm=null,
operate=false,
opStart=function(){ operate=true; },
opStop=function(){
if(operate){
operate=false;
control.trigger('change');
}},
control=$('<div class="elfinder-resize-control"/>')
.on('focus', 'input[type=text],input[type=number]', function(){
$(this).trigger('select');
})
.on('change', function(){
changeTm&&cancelAnimationFrame(changeTm);
changeTm=requestAnimationFrame(function(){
var panel, quty, canvas, ctx, img, sx, sy, sw, sh, deg, theta, bb;
if(sizeImg&&! operate&&(canvas=sizeImg.data('canvas'))){
panel=control.children('div.elfinder-resize-control-panel:visible');
quty=panel.find('input.elfinder-resize-quality');
if(quty.is(':visible')){
ctx=sizeImg.data('ctx');
img=sizeImg.get(0);
if(panel.hasClass('elfinder-resize-uiresize')){
sw=canvas.width=width.val();
sh=canvas.height=height.val();
ctx.drawImage(img, 0, 0, sw, sh);
}else if(panel.hasClass('elfinder-resize-uicrop')){
sx=pointX.val();
sy=pointY.val();
sw=offsetX.val();
sh=offsetY.val();
canvas.width=sw;
canvas.height=sh;
ctx.drawImage(img, sx, sy, sw, sh, 0, 0, sw, sh);
}else{
deg=degree.val();
theta=(degree.val() * Math.PI) / 180;
bb=getBounceBox(owidth, oheight, theta);
sw=canvas.width=bb.width;
sh=canvas.height=bb.height;
ctx.save();
if(deg % 90!==0){
ctx.fillStyle=bg.val()||'#FFF';
ctx.fillRect(0, 0, sw, sh);
}
ctx.translate(sw / 2, sh / 2);
ctx.rotate(theta);
ctx.drawImage(img, -img.width/2, -img.height/2, owidth, oheight);
ctx.restore();
}
canvas.toBlob(function(blob){
blob&&quty.next('span').text(' (' + fm.formatSize(blob.size) + ')');
}, 'image/jpeg', Math.max(Math.min(quty.val(), 100), 1) / 100);
}}
});
})
.on('mouseup', 'input', function(e){
$(e.target).trigger('change');
}),
preview=$('<div class="elfinder-resize-preview"/>')
.on('touchmove', function(e){
if($(e.target).hasClass('touch-punch')){
e.stopPropagation();
e.preventDefault();
}}),
spinner=$('<div class="elfinder-resize-loading">'+fm.i18n('ntfloadimg')+'</div>'),
rhandle=$('<div class="elfinder-resize-handle touch-punch"/>'),
rhandlec=$('<div class="elfinder-resize-handle touch-punch"/>'),
uiresize=$('<div class="elfinder-resize-uiresize elfinder-resize-control-panel"/>'),
uicrop=$('<div class="elfinder-resize-uicrop elfinder-resize-control-panel"/>'),
uirotate=$('<div class="elfinder-resize-rotate elfinder-resize-control-panel"/>'),
uideg270=$('<button/>').attr('title',fm.i18n('rotate-cw')).append($('<span class="elfinder-button-icon elfinder-button-icon-rotate-l"/>')),
uideg90=$('<button/>').attr('title',fm.i18n('rotate-ccw')).append($('<span class="elfinder-button-icon elfinder-button-icon-rotate-r"/>')),
uiprop=$('<span />'),
reset=$('<button class="elfinder-resize-reset">').text(fm.i18n('reset'))
.on('click', function(){
resetView();
})
.button({
icons: {
primary: 'ui-icon-arrowrefresh-1-n'
},
text: false
}),
uitype=$('<div class="elfinder-resize-type"/>')
.append('<input type="radio" name="type" id="'+id+'-resize" value="resize" checked="checked" /><label for="'+id+'-resize">'+fm.i18n('resize')+'</label>',
'<input class="api2" type="radio" name="type" id="'+id+'-crop" value="crop" /><label class="api2" for="'+id+'-crop">'+fm.i18n('crop')+'</label>',
'<input class="api2" type="radio" name="type" id="'+id+'-rotate" value="rotate" /><label class="api2" for="'+id+'-rotate">'+fm.i18n('rotate')+'</label>'),
mode='resize',
type=uitype[ctrgrup]()[ctrgrup]('disable').find('input')
.on('change', function(){
mode=$(this).val();
resetView();
resizable(true);
croppable(true);
rotateable(true);
if(mode=='resize'){
uiresize.show();
uirotate.hide();
uicrop.hide();
resizable();
isJpeg&&grid8px.insertAfter(uiresize.find('.elfinder-resize-grid8'));
}
else if(mode=='crop'){
uirotate.hide();
uiresize.hide();
uicrop.show();
croppable();
isJpeg&&grid8px.insertAfter(uicrop.find('.elfinder-resize-grid8'));
}else if(mode=='rotate'){
uiresize.hide();
uicrop.hide();
uirotate.show();
rotateable();
}}),
width=$(input)
.on('change', function(){
var w=round(parseInt(width.val())),
h=round(cratio ? w/ratio:parseInt(height.val()));
if(w > 0&&h > 0){
resize.updateView(w, h);
width.val(w);
height.val(h);
}}).addClass('elfinder-focus'),
height=$(input)
.on('change', function(){
var h=round(parseInt(height.val())),
w=round(cratio ? h*ratio:parseInt(width.val()));
if(w > 0&&h > 0){
resize.updateView(w, h);
width.val(w);
height.val(h);
}}),
pointX=$(input).on('change', function(){crop.updateView();}),
pointY=$(input).on('change', function(){crop.updateView();}),
offsetX=$(input).on('change', function(){crop.updateView('w');}),
offsetY=$(input).on('change', function(){crop.updateView('h');}),
quality=isJpeg&&api2?
$(input).val(fm.storage('jpgQuality') > 0? fm.storage('jpgQuality'):fm.option('jpgQuality'))
.addClass('elfinder-resize-quality')
.attr('min', '1').attr('max', '100').attr('title', '1 - 100')
.on('blur', function(){
var q=Math.min(100, Math.max(1, parseInt(this.value)));
control.find('input.elfinder-resize-quality').val(q);
})
: null,
degree=$('<input type="number" class="ui-corner-all" maxlength="3" value="0" />')
.on('change', function(){
rotate.update();
}),
uidegslider=$('<div class="elfinder-resize-rotate-slider touch-punch"/>')
.slider({
min: 0,
max: 360,
value: degree.val(),
animate: true,
start: opStart,
stop: opStop,
change: function(event, ui){
if(ui.value!=uidegslider.slider('value')){
rotate.update(ui.value);
}},
slide: function(event, ui){
rotate.update(ui.value, false);
}}).find('.ui-slider-handle')
.addClass('elfinder-tabstop')
.off('keydown')
.on('keydown', function(e){
if(e.keyCode==$.ui.keyCode.LEFT||e.keyCode==$.ui.keyCode.RIGHT){
e.stopPropagation();
e.preventDefault();
rotate.update(Number(degree.val()) + (e.keyCode==$.ui.keyCode.RIGHT? 1:-1), false);
}})
.end(),
pickimg,
pickcanv,
pickctx,
pickc={},
pick=function(e){
var color, r, g, b, h, s, l;
try {
color=pickc[Math.round(e.offsetX)][Math.round(e.offsetY)];
} catch(e){}
if(!color) return;
r=color[0]; g=color[1]; b=color[2];
h=color[3]; s=color[4]; l=color[5];
setbg(r, g, b, (e.type==='click'));
},
palpick=function(e){
setbg($(this).css('backgroundColor'), '', '', (e.type==='click'));
},
setbg=function(r, g, b, off){
var s, m, cc;
if(typeof r==='string'){
g='';
if(r&&(s=$('<span>').css('backgroundColor', r).css('backgroundColor'))&&(m=s.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i))){
r=Number(m[1]);
g=Number(m[2]);
b=Number(m[3]);
}}
cc=(g==='')? r:'#' + getColorCode(r, g, b);
bg.val(cc).css({ backgroundColor: cc, backgroundImage: 'none', color: (r+g+b < 384? '#fff':'#000') });
preview.css('backgroundColor', cc);
if(off){
imgr.off('.picker').removeClass('elfinder-resize-picking');
pallet.off('.picker').removeClass('elfinder-resize-picking');
}},
getColorCode=function(r, g, b){
return $.map([r,g,b], function(c){return ('0'+parseInt(c).toString(16)).slice(-2);}).join('');
},
picker=$('<button>').text(fm.i18n('colorPicker'))
.on('click', function(){
imgr.on('mousemove.picker click.picker', pick).addClass('elfinder-resize-picking');
pallet.on('mousemove.picker click.picker', 'span', palpick).addClass('elfinder-resize-picking');
})
.button({
icons: {
primary: 'ui-icon-pin-s'
},
text: false
}),
reseter=$('<button>').text(fm.i18n('reset'))
.on('click', function(){
setbg('', '', '', true);
})
.button({
icons: {
primary: 'ui-icon-arrowrefresh-1-n'
},
text: false
}),
bg=$('<input class="ui-corner-all elfinder-resize-bg" type="text">')
.on('focus', function(){
$(this).attr('style', '');
})
.on('blur', function(){
setbg($(this).val());
}),
pallet=$('<div class="elfinder-resize-pallet">').on('click', 'span', function(){
setbg($(this).css('backgroundColor'));
}),
ratio=1,
prop=1,
owidth=0,
oheight=0,
cratio=true,
cratioc=false,
pwidth=0,
pheight=0,
rwidth=0,
rheight=0,
rdegree=0,
grid8=isJpeg? grid8Def:false,
constr=$('<button>').html(fm.i18n('aspectRatio'))
.on('click', function(){
cratio = ! cratio;
constr.button('option', {
icons:{ primary: cratio? 'ui-icon-locked':'ui-icon-unlocked'}});
resize.fixHeight();
rhandle.resizable('option', 'aspectRatio', cratio).data('uiResizable')._aspectRatio=cratio;
})
.button({
icons:{
primary: cratio? 'ui-icon-locked':'ui-icon-unlocked'
},
text: false
}),
constrc=$('<button>').html(fm.i18n('aspectRatio'))
.on('click', function(){
cratioc = ! cratioc;
constrc.button('option', {
icons:{ primary: cratioc? 'ui-icon-locked':'ui-icon-unlocked'}});
rhandlec.resizable('option', 'aspectRatio', cratioc).data('uiResizable')._aspectRatio=cratioc;
})
.button({
icons:{
primary: cratioc? 'ui-icon-locked':'ui-icon-unlocked'
},
text: false
}),
grid8px=$('<button>').html(fm.i18n(grid8? 'enabled':'disabled')).toggleClass('ui-state-active', grid8)
.on('click', function(){
grid8 = ! grid8;
grid8px.html(fm.i18n(grid8? 'enabled':'disabled')).toggleClass('ui-state-active', grid8);
setStep8();
})
.button(),
setStep8=function(){
var step=grid8? 8:1;
$.each([width, height, offsetX, offsetY, pointX, pointY], function(){
this.attr('step', step);
});
if(grid8){
width.val(round(width.val()));
height.val(round(height.val()));
offsetX.val(round(offsetX.val()));
offsetY.val(round(offsetY.val()));
pointX.val(round(pointX.val()));
pointY.val(round(pointY.val()));
if(uiresize.is(':visible')){
resize.updateView(width.val(), height.val());
}else if(uicrop.is(':visible')){
crop.updateView();
}}
},
setuprimg=function(){
var r_scale,
fail=function(){
bg.parent().hide();
pallet.hide();
};
r_scale=Math.min(pwidth, pheight) / Math.sqrt(Math.pow(owidth, 2) + Math.pow(oheight, 2));
rwidth=Math.ceil(owidth * r_scale);
rheight=Math.ceil(oheight * r_scale);
imgr.width(rwidth)
.height(rheight)
.css('margin-top', (pheight-rheight)/2 + 'px')
.css('margin-left', (pwidth-rwidth)/2 + 'px');
if(imgr.is(':visible')&&bg.is(':visible')){
if(file.mime!=='image/png'){
preview.css('backgroundColor', bg.val());
pickimg=$('<img>');
if(fm.isCORS){
pickimg.attr('crossorigin', 'use-credentials');
}
pickimg.on('load', function(){
if(pickcanv&&pickcanv.width!==rwidth){
setColorData();
}})
.on('error', fail)
.attr('src', canvSrc);
}else{
fail();
}}
},
setupimg=function(){
resize.updateView(owidth, oheight);
setuprimg();
basec
.width(img.width())
.height(img.height());
imgc
.width(img.width())
.height(img.height());
crop.updateView();
jpgCalc();
},
setColorData=function(){
if(pickctx){
var n, w, h, r, g, b, a, s, l, hsl, hue,
data, scale, tx1, tx2, ty1, ty2, rgb,
domi={},
domic=[],
domiv, palc,
rgbToHsl=function (r, g, b){
var h, s, l,
max=Math.max(Math.max(r, g), b),
min=Math.min(Math.min(r, g), b);
if(max===min){
h=0;
}else if(r===max){
h=((g - b) / (max - min) * 60 + 360) % 360;
}else if(g===max){
h=(b - r) / (max - min) * 60 + 120;
}else if(b===max){
h=(r - g) / (max - min) * 60 + 240;
}
s=(max - min) / max;
l=(r *  0.3 + g * 0.59 + b * 0.11) / 255;
return [h, s, l, 'hsl'];
},
rgbRound=function(c){
return Math.round(c / 8) * 8;
};
calc:
try {
w=pickcanv.width=imgr.width();
h=pickcanv.height=imgr.height();
scale=w / owidth;
pickctx.scale(scale, scale);
pickctx.drawImage(pickimg.get(0), 0, 0);
data=pickctx.getImageData(0, 0, w, h).data;
tx1=w * 0.1;
tx2=w * 0.9;
ty1=h * 0.1;
ty2=h * 0.9;
for (var y=0; y < h - 1; y++){
for (var x=0; x < w - 1; x++){
n=x * 4 + y * w * 4;
r=data[n]; g=data[n + 1]; b=data[n + 2]; a=data[n + 3];
if(a!==255){
bg.parent().hide();
pallet.hide();
break calc;
}
hsl=rgbToHsl(r, g, b);
hue=Math.round(hsl[0]); s=Math.round(hsl[1] * 100); l=Math.round(hsl[2] * 100);
if(! pickc[x]){
pickc[x]={};}
pickc[x][y]=[r, g, b, hue, s, l];
if((x < tx1||x > tx2)&&(y < ty1||y > ty2)){
rgb=rgbRound(r) + ',' + rgbRound(g) + ',' + rgbRound(b);
if(! domi[rgb]){
domi[rgb]=1;
}else{
++domi[rgb];
}}
}}
if(! pallet.children(':first').length){
palc=1;
$.each(domi, function(c, v){
domic.push({c: c, v: v});
});
$.each(domic.sort(function(a, b){
return (a.v > b.v)? -1:1;
}), function(){
if(this.v < 2||palc > 10){
return false;
}
pallet.append($('<span style="width:20px;height:20px;display:inline-block;background-color:rgb('+this.c+');">'));
++palc;
});
}} catch(e){
picker.hide();
pallet.hide();
}}
},
setupPicker=function(){
try {
pickcanv=document.createElement('canvas');
pickctx=pickcanv.getContext('2d');
} catch(e){
picker.hide();
pallet.hide();
}},
setupPreset=function(){
preset.on('click', 'span.elfinder-resize-preset', function(){
var btn=$(this),
w=btn.data('s')[0],
h=btn.data('s')[1],
r=owidth / oheight;
btn.data('s', [h, w]).text(h + 'x' + w);
if(owidth > w||oheight > h){
if(owidth <=w){
w=round(h * r);
}else if(oheight <=h){
h=round(w / r);
}else{
if(owidth - w > oheight - h){
h=round(w / r);
}else{
w=round(h * r);
}}
}else{
w=owidth;
h=oheight;
}
width.val(w);
height.val(h);
resize.updateView(w, h);
jpgCalc();
});
presetc.on('click', 'span.elfinder-resize-preset', function(){
var btn=$(this),
w=btn.data('s')[0],
h=btn.data('s')[1],
x=pointX.val(),
y=pointY.val();
btn.data('s', [h, w]).text(h + 'x' + w);
if(owidth >=w&&oheight >=h){
if(owidth - w - x < 0){
x=owidth - w;
}
if(oheight - h - y < 0){
y=oheight - h;
}
pointX.val(x);
pointY.val(y);
offsetX.val(w);
offsetY.val(h);
crop.updateView();
jpgCalc();
}});
presetc.children('span.elfinder-resize-preset').each(function(){
var btn=$(this),
w=btn.data('s')[0],
h=btn.data('s')[1];
btn[(owidth >=w&&oheight >=h)? 'show':'hide']();
});
},
dimreq=null,
inited=false,
setdim=function(dim){
var rfile=fm.file(file.hash);
rfile.width=dim[0];
rfile.height=dim[1];
},
init=function(){
var elm, memSize, r_scale, imgRatio;
if(inited){
return;
}
inited=true;
dimreq&&dimreq.state&&dimreq.state()==='pending'&&dimreq.reject();
if(fm.api >=2.1030){
if(losslessRotate===0){
fm.request({
data: {
cmd:'resize',
target:file.hash,
degree:0,
mode:'rotate'
},
preventDefault:true
}).done(function(data){
losslessRotate=data.losslessRotate? 1:-1;
if(losslessRotate===1&&(degree.val() % 90===0)){
uirotate.children('div.elfinder-resize-quality').hide();
}}).fail(function(){
losslessRotate=-1;
});
}}else{
losslessRotate=-1;
}
elm=img.get(0);
memSize=file.width&&file.height? {w: file.width, h: file.height}:(elm.naturalWidth? null:{w: img.width(), h: img.height()});
memSize&&img.removeAttr('width').removeAttr('height');
owidth=file.width||elm.naturalWidth||elm.width||img.width();
oheight=file.height||elm.naturalHeight||elm.height||img.height();
if(!file.width||!file.height){
setdim([owidth, oheight]);
}
memSize&&img.width(memSize.w).height(memSize.h);
dMinBtn.show();
imgRatio=oheight / owidth;
if(imgRatio < 1&&preview.height() > preview.width() * imgRatio){
preview.height(preview.width() * imgRatio);
}
if(preview.height() > img.height() + 20){
preview.height(img.height() + 20);
}
pheight=preview.height() - (rhandle.outerHeight() - rhandle.height());
spinner.remove();
ratio=owidth/oheight;
rhandle.append(img.show()).show();
width.val(owidth);
height.val(oheight);
setupPicker();
setupPreset();
setupimg();
uitype[ctrgrup]('enable');
control.find('input,select').prop('disabled', false)
.filter(':text').on('keydown', function(e){
var cOpts;
if(e.keyCode==$.ui.keyCode.ENTER){
e.stopPropagation();
e.preventDefault();
cOpts={
title:$('input:checked', uitype).val(),
text:'confirmReq',
accept:{
label:'btnApply',
callback:function(){
save();
}},
cancel:{
label:'btnCancel',
callback:function(){
$(this).trigger('focus');
}}
};
if(useSaveAs){
cOpts['buttons']=[{
label:'btnSaveAs',
callback:function(){
requestAnimationFrame(saveAs);
}}];
}
fm.confirm(cOpts);
return;
}})
.on('keyup', function(){
var $this=$(this);
if(! $this.hasClass('elfinder-resize-bg')){
requestAnimationFrame(function(){
$this.val($this.val().replace(/[^0-9]/g, ''));
});
}})
.filter(':first');
setStep8();
!fm.UA.Mobile&&width.trigger('focus');
resizable();
},
img=$('<img/>')
.on('load', init)
.on('error', function(){
spinner.text('Unable to load image').css('background', 'transparent');
}),
basec=$('<div/>'),
imgc=$('<img/>'),
coverc=$('<div/>'),
imgr=$('<img class="elfinder-resize-imgrotate" />'),
round=function(v, max){
v=grid8? Math.round(v/8)*8:Math.round(v);
v=Math.max(0, v);
if(max&&v > max){
v=grid8? Math.floor(max/8)*8:max;
}
return v;
},
resetView=function(){
width.val(owidth);
height.val(oheight);
resize.updateView(owidth, oheight);
pointX.val(0);
pointY.val(0);
offsetX.val(owidth);
offsetY.val(oheight);
crop.updateView();
jpgCalc();
},
resize={
update:function(){
width.val(round(img.width()/prop));
height.val(round(img.height()/prop));
jpgCalc();
},
updateView:function(w, h){
if(w > pwidth||h > pheight){
if(w / pwidth > h / pheight){
prop=pwidth / w;
img.width(pwidth).height(round(h*prop));
}else{
prop=pheight / h;
img.height(pheight).width(round(w*prop));
}}else{
img.width(round(w)).height(round(h));
}
prop=img.width()/w;
uiprop.text('1:'+(1/prop).toFixed(2));
resize.updateHandle();
},
updateHandle:function(){
rhandle.width(img.width()).height(img.height());
},
fixHeight:function(){
var w, h;
if(cratio){
w=width.val();
h=round(w/ratio);
resize.updateView(w, h);
height.val(h);
}}
},
crop={
update:function(change){
pointX.val(round(((rhandlec.data('x')||rhandlec.position().left))/prop, owidth));
pointY.val(round(((rhandlec.data('y')||rhandlec.position().top))/prop, oheight));
if(change!=='xy'){
offsetX.val(round((rhandlec.data('w')||rhandlec.width())/prop, owidth - pointX.val()));
offsetY.val(round((rhandlec.data('h')||rhandlec.height())/prop, oheight - pointY.val()));
}
jpgCalc();
},
updateView:function(change){
var r, x, y, w, h;
pointX.val(round(pointX.val(), owidth - (grid8? 8:1)));
pointY.val(round(pointY.val(), oheight - (grid8? 8:1)));
offsetX.val(round(offsetX.val(), owidth - pointX.val()));
offsetY.val(round(offsetY.val(), oheight - pointY.val()));
if(cratioc){
r=coverc.width() / coverc.height();
if(change==='w'){
offsetY.val(round(parseInt(offsetX.val()) / r));
}else if(change==='h'){
offsetX.val(round(parseInt(offsetY.val()) * r));
}}
x=Math.round(parseInt(pointX.val()) * prop);
y=Math.round(parseInt(pointY.val()) * prop);
if(change!=='xy'){
w=Math.round(parseInt(offsetX.val()) * prop);
h=Math.round(parseInt(offsetY.val()) * prop);
}else{
w=rhandlec.data('w');
h=rhandlec.data('h');
}
rhandlec.data({x: x, y: y, w: w, h: h})
.width(w)
.height(h)
.css({left: x, top: y});
coverc.width(w)
.height(h);
},
resize_update:function(e, ui){
rhandlec.data({x: ui.position.left, y: ui.position.top, w: ui.size.width, h: ui.size.height});
crop.update();
crop.updateView();
},
drag_update:function(e, ui){
rhandlec.data({x: ui.position.left, y: ui.position.top});
crop.update('xy');
}},
rotate={
mouseStartAngle:0,
imageStartAngle:0,
imageBeingRotated:false,
setQuality:function(){
uirotate.children('div.elfinder-resize-quality')[(losslessRotate > 0&&(degree.val() % 90)===0)? 'hide':'show']();
},
update:function(value, animate){
if(typeof value=='undefined'){
rdegree=value=parseInt(degree.val());
}
if(typeof animate=='undefined'){
animate=true;
}
if(! animate||fm.UA.Opera||fm.UA.ltIE8){
imgr.rotate(value);
}else{
imgr.animate({rotate: value + 'deg'});
}
value=value % 360;
if(value < 0){
value +=360;
}
degree.val(parseInt(value));
uidegslider.slider('value', degree.val());
rotate.setQuality();
},
execute:function(e){
if(!rotate.imageBeingRotated) return;
var imageCentre=rotate.getCenter(imgr);
var ev=e.originalEvent.touches? e.originalEvent.touches[0]:e;
var mouseXFromCentre=ev.pageX - imageCentre[0];
var mouseYFromCentre=ev.pageY - imageCentre[1];
var mouseAngle=Math.atan2(mouseYFromCentre, mouseXFromCentre);
var rotateAngle=mouseAngle - rotate.mouseStartAngle + rotate.imageStartAngle;
rotateAngle=Math.round(parseFloat(rotateAngle) * 180 / Math.PI);
if(e.shiftKey){
rotateAngle=Math.round((rotateAngle + 6)/15) * 15;
}
imgr.rotate(rotateAngle);
rotateAngle=rotateAngle % 360;
if(rotateAngle < 0){
rotateAngle +=360;
}
degree.val(rotateAngle);
uidegslider.slider('value', degree.val());
rotate.setQuality();
return false;
},
start:function(e){
if(imgr.hasClass('elfinder-resize-picking')){
return;
}
opStart();
rotate.imageBeingRotated=true;
var imageCentre=rotate.getCenter(imgr);
var ev=e.originalEvent.touches? e.originalEvent.touches[0]:e;
var mouseStartXFromCentre=ev.pageX - imageCentre[0];
var mouseStartYFromCentre=ev.pageY - imageCentre[1];
rotate.mouseStartAngle=Math.atan2(mouseStartYFromCentre, mouseStartXFromCentre);
rotate.imageStartAngle=parseFloat(imgr.rotate()) * Math.PI / 180.0;
$(document).on('mousemove', rotate.execute);
imgr.on('touchmove', rotate.execute);
return false;
},
stop:function(e){
if(!rotate.imageBeingRotated) return;
$(document).off('mousemove', rotate.execute);
imgr.off('touchmove', rotate.execute);
requestAnimationFrame(function(){ rotate.imageBeingRotated=false; });
opStop();
return false;
},
getCenter:function(image){
var currentRotation=imgr.rotate();
imgr.rotate(0);
var imageOffset=imgr.offset();
var imageCentreX=imageOffset.left + imgr.width() / 2;
var imageCentreY=imageOffset.top + imgr.height() / 2;
imgr.rotate(currentRotation);
return Array(imageCentreX, imageCentreY);
}},
resizable=function(destroy){
if(destroy){
rhandle.filter(':ui-resizable').resizable('destroy');
rhandle.hide();
}else{
rhandle.show();
rhandle.resizable({
alsoResize:img,
aspectRatio:cratio,
resize:resize.update,
start:opStart,
stop:function(e){
resize.fixHeight;
resize.updateView(width.val(), height.val());
opStop();
}});
dinit();
}},
croppable=function(destroy){
if(destroy){
rhandlec.filter(':ui-resizable').resizable('destroy')
.filter(':ui-draggable').draggable('destroy');
basec.hide();
}else{
basec.show();
rhandlec
.resizable({
containment:basec,
aspectRatio:cratioc,
resize:crop.resize_update,
start:opStart,
stop:opStop,
handles:'all'
})
.draggable({
handle:coverc,
containment:imgc,
drag:crop.drag_update,
start:opStart,
stop:function(){
crop.updateView('xy');
opStop();
}});
dinit();
crop.update();
}},
rotateable=function(destroy){
if(destroy){
imgr.hide();
}else{
imgr.show();
dinit();
}},
checkVals=function(){
var w, h, x, y, d, q, b='';
if(mode=='resize'){
w=parseInt(width.val())||0;
h=parseInt(height.val())||0;
}else if(mode=='crop'){
w=parseInt(offsetX.val())||0;
h=parseInt(offsetY.val())||0;
x=parseInt(pointX.val())||0;
y=parseInt(pointY.val())||0;
}else if(mode=='rotate'){
w=owidth;
h=oheight;
d=parseInt(degree.val())||0;
if(d < 0||d > 360){
fm.error('Invalid rotate degree');
return false;
}
if(d==0||d==360){
fm.error('errResizeNoChange');
return false;
}
b=bg.val();
}
q=quality? parseInt(quality.val()):0;
if(mode!='rotate'){
if(w <=0||h <=0){
fm.error('Invalid image size');
return false;
}
if(w==owidth&&h==oheight){
fm.error('errResizeNoChange');
return false;
}}
return {w: w, h: h, x: x, y: y, d: d, q: q, b: b};},
save=function(){
var vals;
if(vals=checkVals()){
dialog.elfinderdialog('close');
self.resizeRequest({
target:file.hash,
width:vals.w,
height:vals.h,
x:vals.x,
y:vals.y,
degree:vals.d,
quality: vals.q,
bg:vals.b,
mode:mode
}, file, dfrd);
}},
saveAs=function(){
var fail=function(){
dialogs.addClass(clsediting).fadeIn(function(){
base.addClass(clactive);
});
fm.disable();
},
make=function(){
self.mime=file.mime;
self.prefix=file.name.replace(/ \d+(\.[^.]+)?$/, '$1');
self.requestCmd='mkfile';
self.nextAction={};
self.data={target:file.phash};
$.proxy(fm.res('mixin', 'make'), self)()
.done(function(data){
var hash, dfd;
if(data.added&&data.added.length){
hash=data.added[0].hash;
dfd=fm.api < 2.1032? fm.url(file.hash, { async: true, temporary: true }):null;
$.when(dfd).done(function(url){
fm.request({
options:{type:'post'},
data:{
cmd:'put',
target:hash,
encoding: dfd? 'scheme':'hash',
content:dfd? fm.convAbsUrl(url):file.hash
},
notify:{type:'copy', cnt:1},
syncOnFail:true
})
.fail(fail)
.done(function(data){
data=fm.normalize(data);
fm.updateCache(data);
file=fm.file(hash);
data.changed&&data.changed.length&&fm.change(data);
base.show().find('.elfinder-dialog-title').html(fm.escape(file.name));
save();
dialogs.fadeIn();
});
}).fail(fail);
}else{
fail();
}})
.fail(fail)
.always(function(){
delete self.mime;
delete self.prefix;
delete self.nextAction;
delete self.data;
});
fm.trigger('unselectfiles', { files: [ file.hash ] });
},
reqOpen=null,
dialogs;
if(checkVals()){
dialogs=fmnode.children('.' + self.dialogClass + ':visible').removeClass(clsediting).fadeOut();
base.removeClass(clactive);
fm.enable();
if(fm.searchStatus.state < 2&&file.phash!==fm.cwd().hash){
reqOpen=fm.exec('open', [file.phash], {thash: file.phash});
}
$.when([reqOpen]).done(function(){
reqOpen? fm.one('cwdrender', make):make();
}).fail(fail);
}},
buttons={},
hline='elfinder-resize-handle-hline',
vline='elfinder-resize-handle-vline',
rpoint='elfinder-resize-handle-point',
src=fm.openUrl(file.hash),
canvSrc=fm.openUrl(file.hash, !fm.isSameOrigin(src)),
sizeImg=quality? $('<img>').attr('crossorigin', fm.isCORS? 'use-credentials':'').attr('src', canvSrc).on('load', function(){
try {
var canv=document.createElement('canvas');
sizeImg.data('canvas', canv).data('ctx', canv.getContext('2d'));
jpgCalc();
} catch(e){
sizeImg.removeData('canvas').removeData('ctx');
}}):null,
jpgCalc=function(){
control.find('input.elfinder-resize-quality:visible').trigger('change');
},
dinit=function(e){
if(base.hasClass('elfinder-dialog-minimized')||base.is(':hidden')){
return;
}
preset.hide();
presetc.hide();
var win=fm.options.dialogContained? fmnode:$(window),
winH=win.height(),
winW=win.width(),
presW='auto',
presIn=true,
dw, ctrW, prvW;
base.width(Math.min(dialogWidth, winW - 30));
preview.attr('style', '');
if(owidth&&oheight){
pwidth=preview.width()  - (rhandle.outerWidth()  - rhandle.width());
pheight=preview.height() - (rhandle.outerHeight() - rhandle.height());
resize.updateView(owidth, oheight);
}
ctrW=dialog.find('div.elfinder-resize-control').width();
prvW=preview.width();
dw=dialog.width() - 20;
if(prvW > dw){
preview.width(dw);
presIn=false;
}else if((dw - prvW) < ctrW){
if(winW > winH){
preview.width(dw - ctrW - 20);
}else{
preview.css({ float: 'none', marginLeft: 'auto', marginRight: 'auto'});
presIn=false;
}}
if(presIn){
presW=ctrW;
}
pwidth=preview.width()  - (rhandle.outerWidth()  - rhandle.width());
if(fmnode.hasClass('elfinder-fullscreen')){
if(base.height() > winH){
winH -=2;
preview.height(winH - base.height() + preview.height());
base.css('top', 0 - fmnode.offset().top);
}}else{
winH -=30;
(preview.height() > winH)&&preview.height(winH);
}
pheight=preview.height() - (rhandle.outerHeight() - rhandle.height());
if(owidth&&oheight){
setupimg();
}
if(img.height()&&preview.height() > img.height() + 20){
preview.height(img.height() + 20);
pheight=preview.height() - (rhandle.outerHeight() - rhandle.height());
setuprimg();
}
preset.css('width', presW).show();
presetc.css('width', presW).show();
if(!presetc.children('span.elfinder-resize-preset:visible').length){
presetc.hide();
}},
preset=(function(){
var sets=$('<fieldset class="elfinder-resize-preset-container">').append($('<legend>').html(fm.i18n('presets'))).hide(),
hasC;
$.each(presetSize, function(i, s){
if(s.length===2){
hasC=true;
sets.append($('<span class="elfinder-resize-preset"/>')
.data('s', s)
.text(s[0]+'x'+s[1])
.button()
);
}});
if(!hasC){
return $();
}else{
return sets;
}})(),
presetc=preset.clone(true),
useSaveAs=fm.uploadMimeCheck(file.mime, file.phash),
dMinBtn, base;
uiresize.append($(row).append($(label).text(fm.i18n('width')), width),
$(row).append($(label).text(fm.i18n('height')), height, $('<div class="elfinder-resize-whctrls">').append(constr, reset)),
(quality? $(row).append($(label).text(fm.i18n('quality')), quality, $('<span/>')):$()),
(isJpeg? $(row).append($(label).text(fm.i18n('8pxgrid')).addClass('elfinder-resize-grid8'), grid8px):$()),
$(row).append($(label).text(fm.i18n('scale')), uiprop),
$(row).append(preset)
);
if(api2){
uicrop.append($(row).append($(label).text('X'), pointX),
$(row).append($(label).text('Y')).append(pointY),
$(row).append($(label).text(fm.i18n('width')), offsetX),
$(row).append($(label).text(fm.i18n('height')), offsetY, $('<div class="elfinder-resize-whctrls">').append(constrc, reset.clone(true))),
(quality? $(row).append($(label).text(fm.i18n('quality')), quality.clone(true), $('<span/>')):$()),
(isJpeg? $(row).append($(label).text(fm.i18n('8pxgrid')).addClass('elfinder-resize-grid8')):$()),
$(row).append(presetc)
);
uirotate.append($(row).addClass('elfinder-resize-degree').append($(label).text(fm.i18n('rotate')),
degree,
$('<span/>').text(fm.i18n('degree')),
$('<div/>').append(uideg270, uideg90)[ctrgrup]()
),
$(row).css('height', '20px').append(uidegslider),
((quality)? $(row)[losslessRotate < 1? 'show':'hide']().addClass('elfinder-resize-quality').append($(label).text(fm.i18n('quality')),
quality.clone(true),
$('<span/>')):$()
),
$(row).append($(label).text(fm.i18n('bgcolor')), bg, picker, reseter),
$(row).css('height', '20px').append(pallet)
);
uideg270.on('click', function(){
rdegree=rdegree - 90;
rotate.update(rdegree);
});
uideg90.on('click', function(){
rdegree=rdegree + 90;
rotate.update(rdegree);
});
}
dialog.append(uitype).on('resize', function(e){
e.stopPropagation();
});
if(api2){
control.append(uiresize, uicrop.hide(), uirotate.hide());
}else{
control.append(uiresize);
}
rhandle.append('<div class="'+hline+' '+hline+'-top"/>',
'<div class="'+hline+' '+hline+'-bottom"/>',
'<div class="'+vline+' '+vline+'-left"/>',
'<div class="'+vline+' '+vline+'-right"/>',
'<div class="'+rpoint+' '+rpoint+'-e"/>',
'<div class="'+rpoint+' '+rpoint+'-se"/>',
'<div class="'+rpoint+' '+rpoint+'-s"/>');
preview.append(spinner).append(rhandle.hide()).append(img.hide());
if(api2){
rhandlec.css('position', 'absolute')
.append('<div class="'+hline+' '+hline+'-top"/>',
'<div class="'+hline+' '+hline+'-bottom"/>',
'<div class="'+vline+' '+vline+'-left"/>',
'<div class="'+vline+' '+vline+'-right"/>',
'<div class="'+rpoint+' '+rpoint+'-n"/>',
'<div class="'+rpoint+' '+rpoint+'-e"/>',
'<div class="'+rpoint+' '+rpoint+'-s"/>',
'<div class="'+rpoint+' '+rpoint+'-w"/>',
'<div class="'+rpoint+' '+rpoint+'-ne"/>',
'<div class="'+rpoint+' '+rpoint+'-se"/>',
'<div class="'+rpoint+' '+rpoint+'-sw"/>',
'<div class="'+rpoint+' '+rpoint+'-nw"/>');
preview.append(basec.css('position', 'absolute').hide().append(imgc, rhandlec.append(coverc)));
preview.append(imgr.hide());
}
preview.css('overflow', 'hidden');
dialog.append(preview, control);
buttons[fm.i18n('btnApply')]=save;
if(useSaveAs){
buttons[fm.i18n('btnSaveAs')]=function(){ requestAnimationFrame(saveAs); };}
buttons[fm.i18n('btnCancel')]=function(){ dialog.elfinderdialog('close'); };
dialog.find('input,button').addClass('elfinder-tabstop');
base=self.fmDialog(dialog, {
title:fm.escape(file.name),
width:dialogWidth,
resizable:false,
buttons:buttons,
open:function(){
var substituteImg=(fm.option('substituteImg', file.hash)&&file.size > options.dimSubImgSize)? true:false,
hasSize=(file.width&&file.height)? true:false;
dialog.parent().css('overflow', 'hidden');
dMinBtn=base.find('.ui-dialog-titlebar .elfinder-titlebar-minimize').hide();
fm.bind('resize', dinit);
img.attr('src', src);
imgc.attr('src', src);
imgr.attr('src', src);
if(api2){
imgr.on('mousedown touchstart', rotate.start)
.on('touchend', rotate.stop);
base.on('mouseup', rotate.stop);
}
if(hasSize&&!substituteImg){
return init();
}
if(file.size > (options.getDimThreshold||0)){
dimreq=fm.request({
data:{cmd:'dim', target:file.hash, substitute:(substituteImg? 400:'')},
preventDefault:true
})
.done(function(data){
if(data.dim){
var dim=data.dim.split('x');
file.width=dim[0];
file.height=dim[1];
setdim(dim);
if(data.url){
img.attr('src', data.url);
imgc.attr('src', data.url);
imgr.attr('src', data.url);
}
return init();
}});
}else if(hasSize){
return init();
}},
close:function(){
if(api2){
imgr.off('mousedown touchstart', rotate.start)
.off('touchend', rotate.stop);
$(document).off('mouseup', rotate.stop);
}
fm.unbind('resize', dinit);
$(this).elfinderdialog('destroy');
},
resize:function(e, data){
if(data&&data.minimize==='off'){
dinit();
}}
}).attr('id', id).closest('.ui-dialog').addClass(clsediting);
if(fm.UA.ltIE8){
$('.elfinder-dialog').css('filter', '');
}
coverc.css({ 'opacity': 0.2, 'background-color': '#fff', 'position': 'absolute'}),
rhandlec.css('cursor', 'move');
rhandlec.find('.elfinder-resize-handle-point').css({
'background-color':'#fff',
'opacity': 0.5,
'border-color':'#000'
});
if(! api2){
uitype.find('.api2').remove();
}
control.find('input,select').prop('disabled', true);
control.find('input.elfinder-resize-quality')
.next('span').addClass('elfinder-resize-jpgsize').attr('title', fm.i18n('roughFileSize'));
},
id, dialog
;
if(!files.length||files[0].mime.indexOf('image/')===-1){
return dfrd.reject();
}
id='resize-'+fm.namespace+'-'+files[0].hash;
dialog=fmnode.find('#'+id);
if(dialog.length){
dialog.elfinderdialog('toTop');
return dfrd.resolve();
}
open(files[0], id);
return dfrd;
};};
(function ($){
var findProperty=function (styleObject, styleArgs){
var i=0 ;
for(i in styleArgs){
if(typeof styleObject[styleArgs[i]]!='undefined')
return styleArgs[i];
}
styleObject[styleArgs[i]]='';
return styleArgs[i];
};
$.cssHooks.rotate={
get: function(elem, computed, extra){
return $(elem).rotate();
},
set: function(elem, value){
$(elem).rotate(value);
return value;
}};
$.cssHooks.transform={
get: function(elem, computed, extra){
var name=findProperty(elem.style ,
['WebkitTransform', 'MozTransform', 'OTransform' , 'msTransform' , 'transform']);
return elem.style[name];
},
set: function(elem, value){
var name=findProperty(elem.style ,
['WebkitTransform', 'MozTransform', 'OTransform' , 'msTransform' , 'transform']);
elem.style[name]=value;
return value;
}};
$.fn.rotate=function(val){
var r;
if(typeof val=='undefined'){
if(!!window.opera){
r=this.css('transform').match(/rotate\((.*?)\)/);
return(r&&r[1])?
Math.round(parseFloat(r[1]) * 180 / Math.PI):0;
}else{
r=this.css('transform').match(/rotate\((.*?)\)/);
return(r&&r[1])? parseInt(r[1]):0;
}}
this.css('transform',
this.css('transform').replace(/none|rotate\(.*?\)/, '') + 'rotate(' + parseInt(val) + 'deg)');
return this;
};
$.fx.step.rotate=function(fx){
if(fx.state==0){
fx.start=$(fx.elem).rotate();
fx.now=fx.start;
}
$(fx.elem).rotate(fx.now);
};
if(typeof window.addEventListener=="undefined"&&typeof document.getElementsByClassName=="undefined"){
var GetAbsoluteXY=function(element){
var pnode=element;
var x=pnode.offsetLeft;
var y=pnode.offsetTop;
while(pnode.offsetParent){
pnode=pnode.offsetParent;
if(pnode!=document.body&&pnode.currentStyle['position']!='static'){
break;
}
if(pnode!=document.body&&pnode!=document.documentElement){
x -=pnode.scrollLeft;
y -=pnode.scrollTop;
}
x +=pnode.offsetLeft;
y +=pnode.offsetTop;
}
return { x: x, y: y };};
var StaticToAbsolute=function (element){
if(element.currentStyle['position']!='static'){
return ;
}
var xy=GetAbsoluteXY(element);
element.style.position='absolute' ;
element.style.left=xy.x + 'px';
element.style.top=xy.y + 'px';
};
var IETransform=function(element,transform){
var r;
var m11=1;
var m12=1;
var m21=1;
var m22=1;
if(typeof element.style['msTransform']!='undefined'){
return true;
}
StaticToAbsolute(element);
r=transform.match(/rotate\((.*?)\)/);
var rotate=(r&&r[1])	?	parseInt(r[1]):0;
rotate=rotate % 360;
if(rotate < 0) rotate=360 + rotate;
var radian=rotate * Math.PI / 180;
var cosX=Math.cos(radian);
var sinY=Math.sin(radian);
m11 *=cosX;
m12 *=-sinY;
m21 *=sinY;
m22 *=cosX;
element.style.filter=(element.style.filter||'').replace(/progid:DXImageTransform\.Microsoft\.Matrix\([^)]*\)/, "") +
("progid:DXImageTransform.Microsoft.Matrix(" +
"M11=" + m11 +
",M12=" + m12 +
",M21=" + m21 +
",M22=" + m22 +
",FilterType='bilinear',sizingMethod='auto expand')")
;
var ow=parseInt(element.style.width||element.width||0);
var oh=parseInt(element.style.height||element.height||0);
radian=rotate * Math.PI / 180;
var absCosX=Math.abs(Math.cos(radian));
var absSinY=Math.abs(Math.sin(radian));
var dx=(ow - (ow * absCosX + oh * absSinY)) / 2;
var dy=(oh - (ow * absSinY + oh * absCosX)) / 2;
element.style.marginLeft=Math.floor(dx) + "px";
element.style.marginTop=Math.floor(dy) + "px";
return(true);
};
var transform_set=$.cssHooks.transform.set;
$.cssHooks.transform.set=function(elem, value){
transform_set.apply(this, [elem, value]);
IETransform(elem,value);
return value;
};}})(jQuery);
(elFinder.prototype.commands.restore=function(){
"use strict";
var self=this,
fm=this.fm,
fakeCnt=0,
getFilesRecursively=function(files){
var dfd=$.Deferred(),
dirs=[],
results=[],
reqs=[],
phashes=[],
getFile;
dfd._xhrReject=function(){
$.each(reqs, function(){
this&&this.reject&&this.reject();
});
getFile&&getFile._xhrReject();
};
$.each(files, function(i, f){
f.mime==='directory'? dirs.push(f):results.push(f);
});
if(dirs.length){
$.each(dirs, function(i, d){
reqs.push(fm.request({
data:{cmd:'open', target:d.hash},
preventDefault:true,
asNotOpen:true
}));
phashes[i]=d.hash;
});
$.when.apply($, reqs).fail(function(){
dfd.reject();
}).done(function(){
var items=[];
$.each(arguments, function(i, r){
var files;
if(r.files){
if(r.files.length){
items=items.concat(r.files);
}else{
items.push({
hash: 'fakefile_' + (fakeCnt++),
phash: phashes[i],
mime: 'fakefile',
name: 'fakefile',
ts: 0
});
}}
});
fm.cache(items);
getFile=getFilesRecursively(items).done(function(res){
results=results.concat(res);
dfd.resolve(results);
});
});
}else{
dfd.resolve(results);
}
return dfd;
},
restore=function(dfrd, files, targets, ops){
var rHashes={},
others=[],
found=false,
dirs=[],
opts=ops||{},
id=+new Date(),
tm, getFile;
fm.lockfiles({files:targets});
dirs=$.map(files, function(f){
return f.mime==='directory'? f.hash:null;
});
dfrd.done(function(){
dirs&&fm.exec('rm', dirs, {forceRm:true, quiet:true});
}).always(function(){
fm.unlockfiles({files:targets});
});
tm=setTimeout(function(){
fm.notify({type:'search', id:id, cnt:1, hideCnt:true, cancel:function(){
getFile&&getFile._xhrReject();
dfrd.reject();
}});
}, fm.notifyDelay);
fakeCnt=0;
getFile=getFilesRecursively(files).always(function(){
tm&&clearTimeout(tm);
fm.notify({type:'search', id: id, cnt:-1, hideCnt:true});
}).fail(function(){
dfrd.reject('errRestore', 'errFileNotFound');
}).done(function(res){
var errFolderNotfound=['errRestore', 'errFolderNotFound'],
dirTop='';
if(res.length){
$.each(res, function(i, f){
var phash=f.phash,
pfile,
srcRoot, tPath;
while(phash){
if(srcRoot=fm.trashes[phash]){
if(! rHashes[srcRoot]){
if(found){
others.push(f.hash);
return null;
}
rHashes[srcRoot]={};
found=true;
}
tPath=fm.path(f.hash).substr(fm.path(phash).length).replace(/\\/g, '/');
tPath=tPath.replace(/\/[^\/]+?$/, '');
if(tPath===''){
tPath='/';
}
if(!rHashes[srcRoot][tPath]){
rHashes[srcRoot][tPath]=[];
}
if(f.mime==='fakefile'){
fm.updateCache({removed:[f.hash]});
}else{
rHashes[srcRoot][tPath].push(f.hash);
}
if(!dirTop||dirTop.length > tPath.length){
dirTop=tPath;
}
break;
}
pfile=fm.file(phash);
if(!pfile){
phash=false;
$.each(fm.trashes, function(ph){
var file=fm.file(ph),
filePath=fm.path(ph);
if((!file.volumeid||f.hash.indexOf(file.volumeid)===0)&&fm.path(f.hash).indexOf(filePath)===0){
phash=ph;
return false;
}});
}else{
phash=pfile.phash;
}}
});
if(found){
$.each(rHashes, function(src, dsts){
var dirs=Object.keys(dsts),
cnt=dirs.length;
fm.request({
data:{cmd:'mkdir', target:src, dirs:dirs},
notify:{type:'chkdir', cnt:cnt},
preventFail:true
}).fail(function(error){
dfrd.reject(error);
fm.unlockfiles({files:targets});
}).done(function(data){
var cmdPaste, hashes;
if(hashes=data.hashes){
cmdPaste=fm.getCommand ('paste');
if(cmdPaste){
fm.one('mkdirdone', function(){
var hasErr=false;
$.each(dsts, function(dir, files){
if(hashes[dir]){
if(files.length){
if(fm.file(hashes[dir])){
fm.clipboard(files, true);
fm.exec('paste', [ hashes[dir] ], {_cmd:'restore', noToast:(opts.noToast||dir!==dirTop)})
.done(function(data){
if(data&&(data.error||data.warning)){
hasErr=true;
}})
.fail(function(){
hasErr=true;
})
.always(function(){
if(--cnt < 1){
dfrd[hasErr? 'reject':'resolve']();
if(others.length){
fm.exec('restore', others);
}}
});
}else{
dfrd.reject(errFolderNotfound);
}}else{
if(--cnt < 1){
dfrd.resolve();
if(others.length){
fm.exec('restore', others);
}}
}}
});
});
}else{
dfrd.reject(['errRestore', 'errCmdNoSupport', '(paste)']);
}}else{
dfrd.reject(errFolderNotfound);
}});
});
}else{
dfrd.reject(errFolderNotfound);
}}else{
dfrd.reject('errFileNotFound');
dirs&&fm.exec('rm', dirs, {forceRm:true, quiet:true});
}});
};
this.restore=restore;
this.linkedCmds=['copy', 'paste', 'mkdir', 'rm'];
this.updateOnSelect=false;
this.init=function(){
self=this;
fm=this.fm;
};
this.getstate=function(sel, e){
sel=sel||fm.selected();
return sel.length&&$.grep(sel, function(h){var f=fm.file(h); return f&&! f.locked&&! fm.isRoot(f)? true:false; }).length==sel.length
? 0:-1;
};
this.exec=function(hashes, opts){
var dfrd=$.Deferred()
.fail(function(error){
error&&fm.error(error);
}),
files=self.files(hashes);
if(! files.length){
return dfrd.reject();
}
$.each(files, function(i, file){
if(fm.isRoot(file)){
return !dfrd.reject(['errRestore', file.name]);
}
if(file.locked){
return !dfrd.reject(['errLocked', file.name]);
}});
if(dfrd.state()==='pending'){
this.restore(dfrd, files, hashes, opts);
}
return dfrd;
};}).prototype={ forceLoad:true };
elFinder.prototype.commands.rm=function(){
"use strict";
var self=this,
fm=this.fm,
tpl='<div class="ui-helper-clearfix elfinder-rm-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}<div class="elfinder-rm-desc">{desc}</div></div>',
confirm=function(dfrd, targets, files, tHash, addTexts){
var cnt=targets.length,
cwd=fm.cwd().hash,
descs=[],
spinner=fm.i18n('calc') + '<span class="elfinder-spinner"/>',
dialog, text, tmb, size, f, fname;
if(cnt > 1){
size=0;
$.each(files, function(h, f){
if(f.size&&f.size!='unknown'&&f.mime!=='directory'){
var s=parseInt(f.size);
if(s >=0&&size >=0){
size +=s;
}}else{
size='unknown';
return false;
}});
getSize=(size==='unknown');
descs.push(fm.i18n('size')+': '+(getSize? spinner:fm.formatSize(size)));
text=[$(tpl.replace('{class}', 'elfinder-cwd-icon-group').replace('{title}', '<strong>' + fm.i18n('items')+ ': ' + cnt + '</strong>').replace('{desc}', descs.join('<br>')))];
}else{
f=files[0];
tmb=fm.tmb(f);
getSize=(f.mime==='directory');
descs.push(fm.i18n('size')+': '+(getSize? spinner:fm.formatSize(f.size)));
descs.push(fm.i18n('modify')+': '+fm.formatDate(f));
fname=fm.escape(f.i18||f.name).replace(/([_.])/g, '&#8203;$1');
text=[$(tpl.replace('{class}', fm.mime2class(f.mime)).replace('{title}', '<strong>' + fname + '</strong>').replace('{desc}', descs.join('<br>')))];
}
if(addTexts){
text=text.concat(addTexts);
}
text.push(tHash? 'confirmTrash':'confirmRm');
dialog=fm.confirm({
title:self.title,
text:text,
accept:{
label:'btnRm',
callback:function(){
if(tHash){
self.toTrash(dfrd, targets, tHash);
}else{
remove(dfrd, targets);
}}
},
cancel:{
label:'btnCancel',
callback:function(){
fm.unlockfiles({files:targets});
if(targets.length===1&&fm.file(targets[0]).phash!==cwd){
fm.select({selected:targets});
}else{
fm.selectfiles({files:targets});
}
dfrd.reject();
}}
});
if(tmb){
$('<img/>')
.on('load', function(){ dialog.find('.elfinder-cwd-icon').addClass(tmb.className).css('background-image', "url('"+tmb.url+"')"); })
.attr('src', tmb.url);
}
if(getSize){
getSize=fm.getSize($.map(files, function(f){ return f.mime==='directory'? f.hash:null; })).done(function(data){
dialog.find('span.elfinder-spinner').parent().html(fm.i18n('size')+': '+data.formated);
}).fail(function(){
dialog.find('span.elfinder-spinner').parent().html(fm.i18n('size')+': '+fm.i18n('unknown'));
}).always(function(){
getSize=false;
});
}},
toTrash=function(dfrd, targets, tHash){
var dsts={},
itemCnt=targets.length,
maxCnt=self.options.toTrashMaxItems,
checkDirs=[],
reqDfd=$.Deferred(),
req, dirs, cnt;
if(itemCnt > maxCnt){
self.confirm(dfrd, targets, self.files(targets), null, [fm.i18n('tooManyToTrash')]);
return;
}
$.each(targets, function(i, h){
var file=fm.file(h),
path=fm.path(h).replace(/\\/g, '/'),
m=path.match(/^[^\/]+?(\/(?:[^\/]+?\/)*)[^\/]+?$/);
if(file){
if(m){
m[1]=m[1].replace(/(^\/.*?)\/?$/, '$1');
if(! dsts[m[1]]){
dsts[m[1]]=[];
}
dsts[m[1]].push(h);
}
if(file.mime==='directory'){
checkDirs.push(h);
}}
});
if(checkDirs.length){
req=fm.request({
data:{cmd:'size', targets:checkDirs},
notify:{type: 'readdir', cnt: 1, hideCnt: true},
preventDefault:true
}).done(function(data){
var cnt=0;
data.fileCnt&&(cnt +=parseInt(data.fileCnt));
data.dirCnt&&(cnt +=parseInt(data.dirCnt));
reqDfd[cnt > maxCnt ? 'reject':'resolve']();
}).fail(function(){
reqDfd.reject();
});
setTimeout(function(){
var xhr=(req&&req.xhr)? req.xhr:null;
if(xhr&&xhr.state()=='pending'){
req.syncOnFail(false);
req.reject();
reqDfd.reject();
}}, self.options.infoCheckWait * 1000);
}else{
reqDfd.resolve();
}
reqDfd.done(function(){
dirs=Object.keys(dsts);
cnt=dirs.length;
if(cnt){
fm.request({
data:{cmd:'mkdir', target:tHash, dirs:dirs},
notify:{type:'chkdir', cnt:cnt},
preventFail:true
})
.fail(function(error){
dfrd.reject(error);
fm.unlockfiles({files:targets});
})
.done(function(data){
var margeRes=function(data, phash, reqData){
var undo, prevUndo, redo, prevRedo;
$.each(data, function(k, v){
if(Array.isArray(v)){
if(res[k]){
res[k]=res[k].concat(v);
}else{
res[k]=v;
}}
});
if(data.sync){
res.sync=1;
}
if(data.added&&data.added.length){
undo=function(){
var targets=[],
dirs=$.map(data.added, function(f){ return f.mime==='directory'? f.hash:null; });
$.each(data.added, function(i, f){
if($.inArray(f.phash, dirs)===-1){
targets.push(f.hash);
}});
return fm.exec('restore', targets, {noToast: true});
};
redo=function(){
return fm.request({
data:reqData,
notify:{type:'redo', cnt:targets.length}});
};
if(res.undo){
prevUndo=res.undo;
res.undo=function(){
undo();
prevUndo();
};}else{
res.undo=undo;
}
if(res.redo){
prevRedo=res.redo;
res.redo=function(){
redo();
prevRedo();
};}else{
res.redo=redo;
}}
},
err=['errTrash'],
res={},
hasNtf=function(){
return fm.ui.notify.children('.elfinder-notify-trash').length;
},
hashes, tm, prg, prgSt;
if(hashes=data.hashes){
prg=1 / cnt * 100;
prgSt=cnt===1? 100:5;
tm=setTimeout(function(){
fm.notify({type:'trash', cnt:1, hideCnt:true, progress:prgSt});
}, fm.notifyDelay);
$.each(dsts, function(dir, files){
var phash=fm.file(files[0]).phash,
reqData;
if(hashes[dir]){
reqData={cmd:'paste', dst:hashes[dir], targets:files, cut:1};
fm.request({
data:reqData,
preventDefault:true
})
.fail(function(error){
if(error){
err=err.concat(error);
}})
.done(function(data){
data=fm.normalize(data);
fm.updateCache(data);
margeRes(data, phash, reqData);
if(data.warning){
err=err.concat(data.warning);
delete data.warning;
}
data.removed&&data.removed.length&&fm.remove(data);
data.added&&data.added.length&&fm.add(data);
data.changed&&data.changed.length&&fm.change(data);
fm.trigger('paste', data);
fm.trigger('pastedone');
data.sync&&fm.sync();
})
.always(function(){
var hashes=[], addTexts, end=2;
if(hasNtf()){
fm.notify({type:'trash', cnt:0, hideCnt:true, progress:prg});
}else{
prgSt+=prg;
}
if(--cnt < 1){
tm&&clearTimeout(tm);
hasNtf()&&fm.notify({type:'trash', cnt:-1});
fm.unlockfiles({files:targets});
if(Object.keys(res).length){
if(err.length > 1){
if(res.removed||res.removed.length){
hashes=$.grep(targets, function(h){
return $.inArray(h, res.removed)===-1? true:false;
});
}
if(hashes.length){
if(err.length > end){
end=(fm.messages[err[end-1]]||'').indexOf('$')===-1? end:end + 1;
}
dfrd.reject();
fm.exec('rm', hashes, { addTexts: err.slice(0, end), forceRm: true });
}else{
fm.error(err);
}}
res._noSound=true;
if(res.undo&&res.redo){
res.undo={
cmd:'trash',
callback:res.undo,
};
res.redo={
cmd:'trash',
callback:res.redo
};}
dfrd.resolve(res);
}else{
dfrd.reject(err);
}}
});
}});
}else{
dfrd.reject('errFolderNotFound');
fm.unlockfiles({files:targets});
}});
}else{
dfrd.reject(['error', 'The folder hierarchy to be deleting can not be determined.']);
fm.unlockfiles({files:targets});
}}).fail(function(){
self.confirm(dfrd, targets, self.files(targets), null, [fm.i18n('tooManyToTrash')]);
});
},
remove=function(dfrd, targets, quiet){
var notify=quiet? {}:{type:'rm', cnt:targets.length};
fm.request({
data:{cmd:'rm', targets:targets},
notify:notify,
preventFail:true
})
.fail(function(error){
dfrd.reject(error);
})
.done(function(data){
if(data.error||data.warning){
data.sync=true;
}
dfrd.resolve(data);
})
.always(function(){
fm.unlockfiles({files:targets});
});
},
getTHash=function(targets){
var thash=null,
root1st;
if(targets&&targets.length){
if(targets.length > 1&&fm.searchStatus.state===2){
root1st=fm.file(fm.root(targets[0])).volumeid;
if(!$.grep(targets, function(h){ return h.indexOf(root1st)!==0? true:false ; }).length){
thash=fm.option('trashHash', targets[0]);
}}else{
thash=fm.option('trashHash', targets[0]);
}}
return thash;
},
getSize=false;
this.confirm=confirm;
this.toTrash=toTrash;
this.remove=remove;
this.syncTitleOnChange=true;
this.updateOnSelect=false;
this.shortcuts=[{
pattern:'delete ctrl+backspace shift+delete'
}];
this.value='rm';
this.init=function(){
self=this;
fm=this.fm;
self.change(function(){
var targets;
delete self.extra;
self.title=fm.i18n('cmd' + self.value);
self.className=self.value;
self.button&&self.button.children('span.elfinder-button-icon')[self.value==='trash'? 'addClass':'removeClass']('elfinder-button-icon-trash');
if(self.value==='trash'){
self.extra={
icon: 'rm',
node: $('<span/>')
.attr({title: fm.i18n('cmdrm')})
.on('ready', function(e, data){
targets=data.targets;
})
.on('click touchstart', function(e){
if(e.type==='touchstart'&&e.originalEvent.touches.length > 1){
return;
}
e.stopPropagation();
e.preventDefault();
fm.getUI().trigger('click');
fm.exec('rm', targets, {_userAction: true, forceRm:true});
})
};}});
};
this.getstate=function(select){
var sel=this.hashes(select);
return sel.length&&$.grep(sel, function(h){ var f=fm.file(h); return f&&! f.locked&&! fm.isRoot(f)? true:false; }).length==sel.length
? 0:-1;
};
this.exec=function(hashes, cOpts){
var opts=cOpts||{},
dfrd=$.Deferred()
.always(function(){
if(getSize&&getSize.state&&getSize.state()==='pending'){
getSize.reject();
}})
.fail(function(error){
error&&fm.error(error);
}).done(function(data){
!opts.quiet&&!data._noSound&&data.removed&&data.removed.length&&fm.trigger('playsound', {soundFile:'rm.wav'});
}),
files=self.files(hashes),
cnt=files.length,
tHash=null,
addTexts=opts.addTexts? opts.addTexts:null,
forceRm=opts.forceRm,
quiet=opts.quiet,
targets;
if(! cnt){
return dfrd.reject();
}
$.each(files, function(i, file){
if(fm.isRoot(file)){
return !dfrd.reject(['errRm', file.name, 'errPerm']);
}
if(file.locked){
return !dfrd.reject(['errLocked', file.name]);
}});
if(dfrd.state()==='pending'){
targets=self.hashes(hashes);
cnt=files.length;
if(forceRm||(self.event&&self.event.originalEvent&&self.event.originalEvent.shiftKey)){
tHash='';
self.title=fm.i18n('cmdrm');
}
if(tHash===null){
tHash=getTHash(targets);
}
fm.lockfiles({files:targets});
if(tHash&&self.options.quickTrash){
self.toTrash(dfrd, targets, tHash);
}else{
if(quiet){
remove(dfrd, targets, quiet);
}else{
self.confirm(dfrd, targets, files, tHash, addTexts);
}}
}
return dfrd;
};
fm.bind('select contextmenucreate closecontextmenu', function(e){
var targets=(e.data? (e.data.selected||e.data.targets):null)||fm.selected();
if(targets&&targets.length){
self.update(void(0), (targets? getTHash(targets):fm.option('trashHash'))? 'trash':'rm');
}});
};
elFinder.prototype.commands.search=function(){
"use strict";
this.title='Find files';
this.options={ui:'searchbutton'};
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.getstate=function(){
return 0;
};
this.exec=function(q, target, mime, type){
var fm=this.fm,
reqDef=[],
sType=type||'',
onlyMimes=fm.options.onlyMimes,
phash, targetVolids=[],
setType=function(data){
if(sType&&sType!=='SearchName'&&sType!=='SearchMime'){
data.type=sType;
}
return data;
};
if(typeof q=='string'&&q){
if(typeof target=='object'){
mime=target.mime||'';
target=target.target||'';
}
target=target? target:'';
if(mime){
mime=$.trim(mime).replace(',', ' ').split(' ');
if(onlyMimes.length){
mime=$.map(mime, function(m){
m=$.trim(m);
return m&&($.inArray(m, onlyMimes)!==-1
|| $.grep(onlyMimes, function(om){ return m.indexOf(om)===0? true:false; }).length
)? m:null;
});
}}else{
mime=[].concat(onlyMimes);
}
fm.trigger('searchstart', setType({query:q, target:target, mimes:mime}));
if(! onlyMimes.length||mime.length){
if(target===''&&fm.api >=2.1){
$.each(fm.roots, function(id, hash){
reqDef.push(fm.request({
data:setType({cmd:'search', q:q, target:hash, mimes:mime}),
notify:{type:'search', cnt:1, hideCnt:(reqDef.length? false:true)},
cancel:true,
preventDone:true
}));
});
}else{
reqDef.push(fm.request({
data:setType({cmd:'search', q:q, target:target, mimes:mime}),
notify:{type:'search', cnt:1, hideCnt:true},
cancel:true,
preventDone:true
}));
if(target!==''&&fm.api >=2.1&&Object.keys(fm.leafRoots).length){
$.each(fm.leafRoots, function(hash, roots){
phash=hash;
while(phash){
if(target===phash){
$.each(roots, function(){
var f=fm.file(this);
f&&f.volumeid&&targetVolids.push(f.volumeid);
reqDef.push(fm.request({
data:setType({cmd:'search', q:q, target:this, mimes:mime}),
notify:{type:'search', cnt:1, hideCnt:false},
cancel:true,
preventDone:true
}));
});
}
phash=(fm.file(phash)||{}).phash;
}});
}}
}else{
reqDef=[$.Deferred().resolve({files: []})];
}
fm.searchStatus.mixed=(reqDef.length > 1)? targetVolids:false;
return $.when.apply($, reqDef).done(function(data){
var argLen=arguments.length,
i;
data.warning&&fm.error(data.warning);
if(argLen > 1){
data.files=(data.files||[]);
for(i=1; i < argLen; i++){
arguments[i].warning&&fm.error(arguments[i].warning);
if(arguments[i].files){
data.files.push.apply(data.files, arguments[i].files);
}}
}
data.files&&data.files.length&&fm.cache(data.files);
fm.lazy(function(){
fm.trigger('search', data);
}).then(function(){
return fm.lazy(function(){
fm.trigger('searchdone');
});
}).then(function(){
data.sync&&fm.sync();
});
});
}
fm.getUI('toolbar').find('.'+fm.res('class', 'searchbtn')+' :text').trigger('focus');
return $.Deferred().reject();
};};
elFinder.prototype.commands.selectall=function(){
"use strict";
var self=this,
state=0;
this.fm.bind('select', function(e){
state=(e.data&&e.data.selectall)? -1:0;
});
this.state=0;
this.updateOnSelect=false;
this.getstate=function(){
return state;
};
this.exec=function(){
$(document).trigger($.Event('keydown', { keyCode: 65, ctrlKey:true, shiftKey:false, altKey:false, metaKey:false }));
return $.Deferred().resolve();
};};
elFinder.prototype.commands.selectinvert=function(){
"use strict";
this.updateOnSelect=false;
this.getstate=function(){
return 0;
};
this.exec=function(){
$(document).trigger($.Event('keydown', { keyCode: 73, ctrlKey:true, shiftKey:true, altKey:false, metaKey:false }));
return $.Deferred().resolve();
};};
elFinder.prototype.commands.selectnone=function(){
"use strict";
var self=this,
fm=this.fm,
state=-1;
fm.bind('select', function(e){
state=(e.data&&e.data.unselectall)? -1:0;
});
this.state=-1;
this.updateOnSelect=false;
this.getstate=function(){
return state;
};
this.exec=function(){
fm.getUI('cwd').trigger('unselectall');
return $.Deferred().resolve();
};};
elFinder.prototype.commands.sort=function(){
"use strict";
var self=this,
fm=self.fm,
setVar=function(){
self.variants=[];
$.each(fm.sortRules, function(name, value){
if(fm.sorters[name]){
var arr=(name===fm.sortType)? (fm.sortOrder==='asc'? 'n':'s'):'';
self.variants.push([name, (arr? '<span class="ui-icon ui-icon-arrowthick-1-'+arr+'"></span>':'') + '&nbsp;' + fm.i18n('sort'+name)]);
}});
self.variants.push('|');
self.variants.push([
'stick',
(fm.sortStickFolders? '<span class="ui-icon ui-icon-check"/>':'') + '&nbsp;' + fm.i18n('sortFoldersFirst')
]);
if(fm.ui.tree&&fm.options.sortAlsoTreeview!==null){
self.variants.push('|');
self.variants.push([
'tree',
(fm.sortAlsoTreeview? '<span class="ui-icon ui-icon-check"/>':'') + '&nbsp;' + fm.i18n('sortAlsoTreeview')
]);
}
updateContextmenu();
},
updateContextmenu=function(){
var cm=fm.getUI('contextmenu'),
icon, sub;
if(cm.is(':visible')){
icon=cm.find('span.elfinder-button-icon-sort');
sub=icon.siblings('div.elfinder-contextmenu-sub');
sub.find('span.ui-icon').remove();
sub.children('div.elfinder-contextsubmenu-item').each(function(){
var tgt=$(this).children('span'),
name=tgt.text().trim(),
arr;
if(name===(i18Name.stick||(i18Name.stick=fm.i18n('sortFoldersFirst')))){
if(fm.sortStickFolders){
tgt.prepend('<span class="ui-icon ui-icon-check"/>');
}}else if(name===(i18Name.tree||(i18Name.tree=fm.i18n('sortAlsoTreeview')))){
if(fm.sortAlsoTreeview){
tgt.prepend('<span class="ui-icon ui-icon-check"/>');
}}else if(name===(i18Name[fm.sortType]||(i18Name[fm.sortType]=fm.i18n('sort' + fm.sortType)))){
arr=fm.sortOrder==='asc'? 'n':'s';
tgt.prepend('<span class="ui-icon ui-icon-arrowthick-1-'+arr+'"></span>');
}});
}},
i18Name={};
this.options={ui:'sortbutton'};
this.keepContextmenu=true;
fm.bind('sortchange', setVar)
.bind('sorterupdate', function(){
setVar();
fm.getUI().children('.elfinder-button-sort-menu').children('.elfinder-button-menu-item').each(function(){
var tgt=$(this),
rel=tgt.attr('rel');
tgt.toggle(!!(! rel||fm.sorters[rel]));
});
})
.bind('cwdrender', function(){
var cols=$(fm.cwd).find('div.elfinder-cwd-wrapper-list table');
if(cols.length){
$.each(fm.sortRules, function(name, value){
var td=cols.find('thead tr td.elfinder-cwd-view-th-'+name);
if(td.length){
var current=(name==fm.sortType),
sort={
type:name,
order:current ? fm.sortOrder=='asc' ? 'desc':'asc':fm.sortOrder
},arr;
if(current){
td.addClass('ui-state-active');
arr=fm.sortOrder=='asc' ? 'n':'s';
$('<span class="ui-icon ui-icon-triangle-1-'+arr+'"/>').appendTo(td);
}
$(td).on('click', function(e){
if(! $(this).data('dragging')){
e.stopPropagation();
if(! fm.getUI('cwd').data('longtap')){
fm.exec('sort', [], sort);
}}
})
.on('mouseenter mouseleave', function(e){
$(this).toggleClass('ui-state-hover', e.type==='mouseenter');
});
}});
}});
this.getstate=function(){
return 0;
};
this.exec=function(hashes, cOpt){
var fm=this.fm,
sortopt=$.isPlainObject(cOpt)? cOpt:(function(){
cOpt +='';
var sOpts={};
if(cOpt==='stick'){
sOpts.stick = !fm.sortStickFolders;
}else if(cOpt==='tree'){
sOpts.tree = !fm.sortAlsoTreeview;
}else if(fm.sorters[cOpt]){
if(fm.sortType===cOpt){
sOpts.order=fm.sortOrder==='asc'? 'desc':'asc';
}else{
sOpts.type=cOpt;
}}
return sOpts;
})(),
sort=Object.assign({
type:fm.sortType,
order:fm.sortOrder,
stick:fm.sortStickFolders,
tree:fm.sortAlsoTreeview
}, sortopt);
return fm.lazy(function(){
fm.setSort(sort.type, sort.order, sort.stick, sort.tree);
this.resolve();
});
};};
elFinder.prototype.commands.undo=function(){
"use strict";
var self=this,
fm=this.fm,
setTitle=function(undo){
if(undo){
self.title=fm.i18n('cmdundo') + ' ' + fm.i18n('cmd'+undo.cmd);
self.state=0;
}else{
self.title=fm.i18n('cmdundo');
self.state=-1;
}
self.change();
},
cmds=[];
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.shortcuts=[{
pattern:'ctrl+z'
}];
this.syncTitleOnChange=true;
this.getstate=function(){
return cmds.length? 0:-1;
};
this.setUndo=function(undo, redo){
var _undo={};
if(undo){
if($.isPlainObject(undo)&&undo.cmd&&undo.callback){
Object.assign(_undo, undo);
if(redo){
delete redo.undo;
_undo.redo=redo;
}else{
fm.getCommand ('redo').setRedo(null);
}
cmds.push(_undo);
setTitle(_undo);
}}
};
this.exec=function(){
var redo=fm.getCommand ('redo'),
dfd=$.Deferred(),
undo, res, _redo={};
if(cmds.length){
undo=cmds.pop();
if(undo.redo){
Object.assign(_redo, undo.redo);
delete undo.redo;
}else{
_redo=null;
}
dfd.done(function(){
if(_redo){
redo.setRedo(_redo, undo);
}});
setTitle(cmds.length? cmds[cmds.length-1]:void(0));
res=undo.callback();
if(res&&res.done){
res.done(function(){
dfd.resolve();
}).fail(function(){
dfd.reject();
});
}else{
dfd.resolve();
}
if(cmds.length){
this.update(0, cmds[cmds.length - 1].name);
}else{
this.update(-1, '');
}}else{
dfd.reject();
}
return dfd;
};
fm.bind('exec', function(e){
var data=e.data||{};
if(data.opts&&data.opts._userAction){
if(data.dfrd&&data.dfrd.done){
data.dfrd.done(function(res){
if(res&&res.undo&&res.redo){
res.undo.redo=res.redo;
self.setUndo(res.undo);
}});
}}
});
};
elFinder.prototype.commands.redo=function(){
"use strict";
var self=this,
fm=this.fm,
setTitle=function(redo){
if(redo&&redo.callback){
self.title=fm.i18n('cmdredo') + ' ' + fm.i18n('cmd'+redo.cmd);
self.state=0;
}else{
self.title=fm.i18n('cmdredo');
self.state=-1;
}
self.change();
},
cmds=[];
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.shortcuts=[{
pattern:'shift+ctrl+z ctrl+y'
}];
this.syncTitleOnChange=true;
this.getstate=function(){
return cmds.length? 0:-1;
};
this.setRedo=function(redo, undo){
if(redo===null){
cmds=[];
setTitle();
}else{
if(redo&&redo.cmd&&redo.callback){
if(undo){
redo.undo=undo;
}
cmds.push(redo);
setTitle(redo);
}}
};
this.exec=function(){
var undo=fm.getCommand ('undo'),
dfd=$.Deferred(),
redo, res, _undo={}, _redo={};
if(cmds.length){
redo=cmds.pop();
if(redo.undo){
Object.assign(_undo, redo.undo);
Object.assign(_redo, redo);
delete _redo.undo;
dfd.done(function(){
undo.setUndo(_undo, _redo);
});
}
setTitle(cmds.length? cmds[cmds.length-1]:void(0));
res=redo.callback();
if(res&&res.done){
res.done(function(){
dfd.resolve();
}).fail(function(){
dfd.reject();
});
}else{
dfd.resolve();
}
return dfd;
}else{
return dfd.reject();
}};};
(elFinder.prototype.commands.up=function(){
"use strict";
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.shortcuts=[{
pattern:'ctrl+up'
}];
this.getstate=function(){
return this.fm.cwd().phash ? 0:-1;
};
this.exec=function(){
var fm=this.fm,
cwdhash=fm.cwd().hash;
return this.fm.cwd().phash ? this.fm.exec('open', this.fm.cwd().phash).done(function(){
fm.one('opendone', function(){
fm.selectfiles({files:[cwdhash]});
});
}):$.Deferred().reject();
};}).prototype={ forceLoad:true };
elFinder.prototype.commands.upload=function(){
"use strict";
var hover=this.fm.res('class', 'hover');
this.disableOnSearch=true;
this.updateOnSelect=false;
this.shortcuts=[{
pattern:'ctrl+u'
}];
this.getstate=function(select){
var fm=this.fm, f,
sel=(select||[fm.cwd().hash]);
if(!this._disabled&&sel.length==1){
f=fm.file(sel[0]);
}
return (f&&f.mime=='directory'&&f.write)? 0:-1;
};
this.exec=function(data){
var fm=this.fm,
cwdHash=fm.cwd().hash,
getTargets=function(){
var tgts=data&&(data instanceof Array)? data:null,
sel;
if(! data||data instanceof Array){
if(! tgts&&(sel=fm.selected()).length===1&&fm.file(sel[0]).mime==='directory'){
tgts=sel;
}else if(!tgts||tgts.length!==1||fm.file(tgts[0]).mime!=='directory'){
tgts=[ cwdHash ];
}}
return tgts;
},
targets=getTargets(),
check=targets? targets[0]:(data&&data.target? data.target:null),
targetDir=check? fm.file(check):fm.cwd(),
fmUpload=function(data){
fm.upload(data)
.fail(function(error){
dfrd.reject(error);
})
.done(function(data){
var cwd=fm.getUI('cwd'),
node;
dfrd.resolve(data);
if(data&&data.added&&data.added[0]&&! fm.ui.notify.children('.elfinder-notify-upload').length){
var newItem=fm.findCwdNodes(data.added);
if(newItem.length){
newItem.trigger('scrolltoview');
}else{
if(targetDir.hash!==cwdHash){
node=$('<div/>').append($('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">'+fm.i18n('cmdopendir')+'</span></button>')
.on('mouseenter mouseleave', function(e){
$(this).toggleClass('ui-state-hover', e.type=='mouseenter');
}).on('click', function(){
fm.exec('open', check).done(function(){
fm.one('opendone', function(){
fm.trigger('selectfiles', {files:$.map(data.added, function(f){return f.hash;})});
});
});
})
);
}else{
fm.trigger('selectfiles', {files:$.map(data.added, function(f){return f.hash;})});
}
fm.toast({msg: fm.i18n(['complete', fm.i18n('cmdupload')]), extNode: node});
}}
})
.progress(function(){
dfrd.notifyWith(this, Array.from(arguments));
});
},
upload=function(data){
dialog.elfinderdialog('close');
if(targets){
data.target=targets[0];
}
fmUpload(data);
},
getSelector=function(){
var hash=targetDir.hash,
dirs=$.map(fm.files(hash), function(f){
return (f.mime==='directory'&&f.write)? f:null;
});
if(! dirs.length){
return $();
}
return $('<div class="elfinder-upload-dirselect elfinder-tabstop" title="' + fm.i18n('folders') + '"/>')
.on('click', function(e){
e.stopPropagation();
e.preventDefault();
dirs=fm.sortFiles(dirs);
var $this=$(this),
cwd=fm.cwd(),
base=dialog.closest('div.ui-dialog'),
getRaw=function(f, icon){
return {
label:fm.escape(f.i18||f.name),
icon:icon,
remain:false,
callback:function(){
var title=base.children('.ui-dialog-titlebar:first').find('span.elfinder-upload-target');
targets=[ f.hash ];
title.html(' - ' + fm.escape(f.i18||f.name));
$this.trigger('focus');
},
options:{
className:(targets&&targets.length&&f.hash===targets[0])? 'ui-state-active':'',
iconClass:f.csscls||'',
iconImg:f.icon||''
}};},
raw=[ getRaw(targetDir, 'opendir'), '|' ];
$.each(dirs, function(i, f){
raw.push(getRaw(f, 'dir'));
});
$this.trigger('blur');
fm.trigger('contextmenu', {
raw: raw,
x: e.pageX||$(this).offset().left,
y: e.pageY||$(this).offset().top,
prevNode: base,
fitHeight: true
});
}).append('<span class="elfinder-button-icon elfinder-button-icon-dir" />');
},
inputButton=function(type, caption){
var button,
input=$('<input type="file" ' + type + '/>')
.on('click', function(){
if(fm.UA.IE){
setTimeout(function(){
form.css('display', 'none').css('position', 'relative');
requestAnimationFrame(function(){
form.css('display', '').css('position', '');
});
}, 100);
}})
.on('change', function(){
upload({input:input.get(0), type:'files'});
})
.on('dragover', function(e){
e.originalEvent.dataTransfer.dropEffect='copy';
}),
form=$('<form/>').append(input).on('click', function(e){
e.stopPropagation();
});
return $('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-tabstop elfinder-focus"><span class="ui-button-text">'+fm.i18n(caption)+'</span></div>')
.append(form)
.on('click', function(e){
e.stopPropagation();
e.preventDefault();
input.trigger('click');
})
.on('mouseenter mouseleave', function(e){
$(this).toggleClass(hover, e.type==='mouseenter');
});
},
dfrd=$.Deferred(),
dialog, dropbox, pastebox, dropUpload, paste, dirs, spinner, uidialog;
dropUpload=function(e){
e.stopPropagation();
e.preventDefault();
var file=false,
type='',
elfFrom=null,
mycwd='',
data=null,
target=e._target||null,
trf=e.dataTransfer||null,
kind=(trf.items&&trf.items.length&&trf.items[0].kind)? trf.items[0].kind:'',
errors;
if(trf){
try {
elfFrom=trf.getData('elfinderfrom');
if(elfFrom){
mycwd=window.location.href + fm.cwd().hash;
if((!target&&elfFrom===mycwd)||target===mycwd){
dfrd.reject();
return;
}}
} catch(e){}
if(kind==='file'&&(trf.items[0].getAsEntry||trf.items[0].webkitGetAsEntry)){
file=trf;
type='data';
}else if(kind!=='string'&&trf.files&&trf.files.length&&$.inArray('Text', trf.types)===-1){
file=trf.files;
type='files';
}else{
try {
if((data=trf.getData('text/html'))&&data.match(/<(?:img|a)/i)){
file=[ data ];
type='html';
}} catch(e){}
if(! file){
if(data=trf.getData('text')){
file=[ data ];
type='text';
}else if(trf&&trf.files){
kind='file';
}}
}}
if(file){
fmUpload({files:file, type:type, target:target, dropEvt:e});
}else{
errors=['errUploadNoFiles'];
if(kind==='file'){
errors.push('errFolderUpload');
}
fm.error(errors);
dfrd.reject();
}};
if(!targets&&data){
if(data.input||data.files){
data.type='files';
fmUpload(data);
}else if(data.dropEvt){
dropUpload(data.dropEvt);
}
return dfrd;
}
paste=function(ev){
var e=ev.originalEvent||ev;
var files=[], items=[];
var file;
if(e.clipboardData){
if(e.clipboardData.items&&e.clipboardData.items.length){
items=e.clipboardData.items;
for (var i=0; i < items.length; i++){
if(e.clipboardData.items[i].kind=='file'){
file=e.clipboardData.items[i].getAsFile();
files.push(file);
}}
}else if(e.clipboardData.files&&e.clipboardData.files.length){
files=e.clipboardData.files;
}
if(files.length){
upload({files:files, type:'files', clipdata:true});
return;
}}
var my=e.target||e.srcElement;
requestAnimationFrame(function(){
var type='text',
src;
if(my.innerHTML){
$(my).find('img').each(function(i, v){
if(v.src.match(/^webkit-fake-url:\/\//)){
$(v).remove();
}});
if($(my).find('a,img').length){
type='html';
}
src=my.innerHTML;
my.innerHTML='';
upload({files:[ src ], type:type});
}});
};
dialog=$('<div class="elfinder-upload-dialog-wrapper"/>')
.append(inputButton('multiple', 'selectForUpload'));
if(! fm.UA.Mobile&&(function(input){
return (typeof input.webkitdirectory!=='undefined'||typeof input.directory!=='undefined');})(document.createElement('input'))){
dialog.append(inputButton('multiple webkitdirectory directory', 'selectFolder'));
}
if(targetDir.dirs){
if(targetDir.hash===cwdHash||fm.navHash2Elm(targetDir.hash).hasClass('elfinder-subtree-loaded')){
getSelector().appendTo(dialog);
}else{
spinner=$('<div class="elfinder-upload-dirselect" title="' + fm.i18n('nowLoading') + '"/>')
.append('<span class="elfinder-button-icon elfinder-button-icon-spinner" />')
.appendTo(dialog);
fm.request({cmd:'tree', target:targetDir.hash})
.done(function(){
fm.one('treedone', function(){
spinner.replaceWith(getSelector());
uidialog.elfinderdialog('tabstopsInit');
});
})
.fail(function(){
spinner.remove();
});
}}
if(fm.dragUpload){
dropbox=$('<div class="ui-corner-all elfinder-upload-dropbox elfinder-tabstop" contenteditable="true" data-ph="'+fm.i18n('dropPasteFiles')+'"></div>')
.on('paste', function(e){
paste(e);
})
.on('mousedown click', function(){
$(this).trigger('focus');
})
.on('focus', function(){
this.innerHTML='';
})
.on('mouseover', function(){
$(this).addClass(hover);
})
.on('mouseout', function(){
$(this).removeClass(hover);
})
.on('dragenter', function(e){
e.stopPropagation();
e.preventDefault();
$(this).addClass(hover);
})
.on('dragleave', function(e){
e.stopPropagation();
e.preventDefault();
$(this).removeClass(hover);
})
.on('dragover', function(e){
e.stopPropagation();
e.preventDefault();
e.originalEvent.dataTransfer.dropEffect='copy';
$(this).addClass(hover);
})
.on('drop', function(e){
dialog.elfinderdialog('close');
targets&&(e.originalEvent._target=targets[0]);
dropUpload(e.originalEvent);
})
.prependTo(dialog)
.after('<div class="elfinder-upload-dialog-or">'+fm.i18n('or')+'</div>')[0];
}else{
pastebox=$('<div class="ui-corner-all elfinder-upload-dropbox" contenteditable="true">'+fm.i18n('dropFilesBrowser')+'</div>')
.on('paste drop', function(e){
paste(e);
})
.on('mousedown click', function(){
$(this).trigger('focus');
})
.on('focus', function(){
this.innerHTML='';
})
.on('dragenter mouseover', function(){
$(this).addClass(hover);
})
.on('dragleave mouseout', function(){
$(this).removeClass(hover);
})
.prependTo(dialog)
.after('<div class="elfinder-upload-dialog-or">'+fm.i18n('or')+'</div>')[0];
}
uidialog=this.fmDialog(dialog, {
title:this.title + '<span class="elfinder-upload-target">' + (targetDir? ' - ' + fm.escape(targetDir.i18||targetDir.name):'') + '</span>',
modal:true,
resizable:false,
destroyOnClose:true,
propagationEvents:['mousemove', 'mouseup', 'click'],
close:function(){
var cm=fm.getUI('contextmenu');
if(cm.is(':visible')){
cm.click();
}}
});
return dfrd;
};};
elFinder.prototype.commands.view=function(){
"use strict";
var self=this,
fm=this.fm,
subMenuRaw;
this.value=fm.viewType;
this.alwaysEnabled=true;
this.updateOnSelect=false;
this.options={ ui:'viewbutton'};
this.getstate=function(){
return 0;
};
this.extra={
icon: 'menu',
node: $('<span/>')
.attr({title: fm.i18n('viewtype')})
.on('click touchstart', function(e){
if(e.type==='touchstart'&&e.originalEvent.touches.length > 1){
return;
}
var node=$(this);
e.stopPropagation();
e.preventDefault();
fm.trigger('contextmenu', {
raw: getSubMenuRaw(),
x: node.offset().left,
y: node.offset().top
});
})
};
this.exec=function(){
var self=this,
value=fm.storage('view', this.value=='list' ? 'icons':'list');
return fm.lazy(function(){
fm.viewchange();
self.update(void(0), value);
this.resolve();
});
};
fm.bind('init', function(){
subMenuRaw=(function(){
var cwd=fm.getUI('cwd'),
raws=[],
sizeNames=fm.options.uiOptions.cwd.iconsView.sizeNames,
max=fm.options.uiOptions.cwd.iconsView.sizeMax,
i, size;
for (i=0; i <=max; i++){
raws.push({
label:fm.i18n(sizeNames[i]||('Size-' + i + ' icons')),
icon:'view',
callback:(function(s){
return function(){
cwd.trigger('iconpref', {size: s});
fm.storage('iconsize', s);
if(self.value==='list'){
self.exec();
}};})(i)
}
);
}
raws.push('|');
raws.push({
label:fm.i18n('viewlist'),
icon:'view-list',
callback:function(){
if(self.value!=='list'){
self.exec();
}}
}
);
return raws;
})();
}).bind('contextmenucreate', function(){
self.extra={
icon: 'menu',
node: $('<span/>')
.attr({title: fm.i18n('cmdview')})
.on('click touchstart', function(e){
if(e.type==='touchstart'&&e.originalEvent.touches.length > 1){
return;
}
var node=$(this),
raw=subMenuRaw.concat(),
idx, i;
if(self.value==='list'){
idx=subMenuRaw.length - 1;
}else{
idx=parseInt(fm.storage('iconsize')||0);
}
for (i=0; i < subMenuRaw.length; i++){
if(subMenuRaw[i]!=='|'){
subMenuRaw[i].options=(i===idx? {'className': 'ui-state-active'}:void(0))
;
}}
e.stopPropagation();
e.preventDefault();
fm.trigger('contextmenu', {
raw: subMenuRaw,
x: node.offset().left,
y: node.offset().top
});
})
};});
};
return elFinder;
}));
jQuery.noConflict();
(function($){
$(function(){
(function(editors, elFinder){
if(typeof define==='function'&&define.amd){
define(['elfinder'], editors);
}else if(elFinder){
var optEditors=elFinder.prototype._options.commandsOptions.edit.editors;
elFinder.prototype._options.commandsOptions.edit.editors=optEditors.concat(editors(elFinder));
}}(function(elFinder){
"use strict";
var apps={},
getfile=window.location.search.match(/getfile=([a-z]+)/),
useRequire=elFinder.prototype.hasRequire,
hasFlash=(function(){
var hasFlash;
try {
hasFlash = !!(new ActiveXObject('ShockwaveFlash.ShockwaveFlash'));
} catch (e){
hasFlash = !!(typeof window.orientation==='undefined'||(navigator&&navigator.mimeTypes["application/x-shockwave-flash"]));
}
return hasFlash;
})(),
initImgTag=function(id, file, content, fm){
var node=$(this).children('img:first'),
spnr=$('<div/>')
.css({
position: 'absolute',
top: '50%',
textAlign: 'center',
width: '100%',
fontSize: '16pt'
})
.html(fm.i18n('ntfloadimg'))
.hide()
.appendTo(this);
node.attr('id', id+'-img')
.attr('src', content)
.css({'height':'', 'max-width':'100%', 'max-height':'100%', 'cursor':'pointer'})
.data('loading', function(done){
var btns=node.closest('.elfinder-dialog').find('button,.elfinder-titlebar-button');
btns.prop('disabled', !done)[done? 'removeClass':'addClass']('ui-state-disabled');
node.css('opacity', done? '':'0.3');
spnr[done? 'hide':'show']();
return node;
});
},
imgBase64=function(node, mime){
var style=node.attr('style'),
img, canvas, ctx, data;
try {
node.attr('style', '');
img=node.get(0);
canvas=document.createElement('canvas');
canvas.width=img.width;
canvas.height=img.height;
node.attr('style', style);
canvas.getContext('2d').drawImage(img, 0, 0);
data=canvas.toDataURL(mime);
} catch(e){
data=node.attr('src');
}
return data;
},
pixlrCallBack=function(){
if(!hasFlash||window.parent===window){
return;
}
var pixlr=window.location.search.match(/[?&]pixlr=([^&]+)/),
image=window.location.search.match(/[?&]image=([^&]+)/),
p, ifm, url, node;
if(pixlr){
p=window.parent;
ifm=p.$('#'+pixlr[1]+'iframe').hide();
node=p.$('#'+pixlr[1]).data('resizeoff')();
if(image[1].substr(0, 4)==='http'){
url=image[1];
if(window.location.protocol==='https:'){
url=url.replace(/^http:/, 'https:');
}
node.on('load error', function(){
node.data('loading')(true);
})
.attr('src', url)
.data('loading')();
}else{
node.data('loading')(true);
}
ifm.remove();
}},
pixlrSetup=function(opts, fm){
if(!hasFlash||fm.UA.ltIE8){
this.disabled=true;
}},
pixlrLoad=function(mode, base){
var self=this,
fm=this.fm,
clPreventBack=fm.res('class', 'preventback'),
node=$(base).children('img:first')
.data('loading')()
.data('resizeoff', function(){
$(window).off('resize.'+node.attr('id'));
dialog.addClass(clPreventBack);
return node;
})
.on('click', function(){
launch();
}),
dialog=$(base).closest('.ui-dialog'),
elfNode=fm.getUI(),
container=$('<iframe class="ui-front" allowtransparency="true">'),
file=this.file,
error=function(error){
container.remove();
node.data('loading')(true);
fm.error(error||'Can not launch Pixlr.');
},
launch=function(){
var src='https://pixlr.com/'+mode+'/?s=c',
myurl=window.location.href.toString().replace(/#.*$/, ''),
opts={};
errtm=setTimeout(error, 15000);
myurl +=(myurl.indexOf('?')===-1? '?':'&') + 'pixlr='+node.attr('id');
src +='&referrer=elFinder&locktitle=true';
src +='&exit='+encodeURIComponent(myurl+'&image=0');
src +='&target='+encodeURIComponent(myurl);
src +='&title='+encodeURIComponent(file.name);
src +='&locktype='+encodeURIComponent(file.mime==='image/png'? 'png':'jpg');
src +='&image='+encodeURIComponent(node.attr('src'));
opts.src=src;
opts.css={
width: '100%',
height: $(window).height()+'px',
position: 'fixed',
display: 'block',
backgroundColor: 'transparent',
border: 'none',
top: 0,
right: 0
};
self.trigger('Prepare', {
node: base,
editorObj: void(0),
instance: container,
opts: opts
});
container
.attr('id', node.attr('id')+'iframe')
.attr('src', opts.src)
.css(opts.css)
.on('load', function(){
errtm&&clearTimeout(errtm);
setTimeout(function(){
if(container.is(':hidden')){
error('Please disable your ad blocker.');
}}, 1000);
dialog.addClass(clPreventBack);
fm.toFront(container);
})
.on('error', error)
.appendTo(elfNode.hasClass('elfinder-fullscreen')? elfNode:'body');
$(window).on('resize.'+node.attr('id'), function(){
container.css('height', $(window).height());
});
},
errtm;
launch();
};
pixlrCallBack();
if(getfile){
getfile=getfile[1];
if(getfile==='ckeditor'){
elFinder.prototype._options.getFileCallback=function(file, fm){
window.opener.CKEDITOR.tools.callFunction((function(){
var reParam=new RegExp('(?:[\?&]|&amp;)CKEditorFuncNum=([^&]+)', 'i'),
match=window.location.search.match(reParam);
return (match&&match.length > 1) ? match[1]:'';
})(), fm.convAbsUrl(file.url));
fm.destroy();
window.close();
};}else if(getfile==='tinymce'){
elFinder.prototype._options.getFileCallback=function(file, fm){
parent.tinymce.activeEditor.windowManager.getParams().oninsert(file, fm);
parent.tinymce.activeEditor.windowManager.close();
};}}
return [
{
info:{
id:'pixlreditor',
name:'Pixlr Editor',
iconImg:'img/edit_pixlreditor.png',
urlAsContent: true,
schemeContent: true,
single: true
},
mimes:[],
html:'<div style="width:100%;height:300px;max-height:100%;text-align:center;"><img/></div>',
setup:function(opts, fm){
pixlrSetup.call(this, opts, fm);
},
init:function(id, file, url, fm){
initImgTag.call(this, id, file, fm.convAbsUrl(url), fm);
},
getContent:function(){
return $(this).children('img:first').attr('src');
},
load:function(base){
pixlrLoad.call(this, 'editor', base);
},
save:function(base){},
close:function(base){}},
{
info:{
id: 'pixlrexpress',
name:'Pixlr Express',
iconImg:'img/edit_pixlrexpress.png',
urlAsContent: true,
schemeContent: true,
single: true
},
mimes:[],
html:'<div style="width:100%;height:300px;max-height:100%;text-align:center;"><img/></div>',
setup:function(opts, fm){
pixlrSetup.call(this, opts, fm);
},
init:function(id, file, url, fm){
initImgTag.call(this, id, file, fm.convAbsUrl(url), fm);
},
getContent:function(){
return $(this).children('img:first').attr('src');
},
load:function(base){
pixlrLoad.call(this, 'express', base);
},
save:function(base){},
close:function(base){}},
{
info:{
id:'creativecloud',
name:'Creative Cloud',
iconImg:'img/edit_creativecloud.png',
schemeContent: true,
single: true
},
mimes:[],
html:'<div style="width:100%;height:300px;max-height:100%;text-align:center;"><img/></div>',
setup:function(opts, fm){
if(fm.UA.ltIE8||!opts.extraOptions||!opts.extraOptions.creativeCloudApiKey){
this.disabled=true;
}else{
this.apiKey=opts.extraOptions.creativeCloudApiKey;
}},
init:function(id, file, content, fm){
initImgTag.call(this, id, file, content, fm);
},
getContent:function(){
return $(this).children('img:first').attr('src');
},
load:function(base){
var self=this,
fm=this.fm,
node=$(base).children('img:first'),
dialog=$(base).closest('.ui-dialog'),
elfNode=fm.getUI(),
dfrd=$.Deferred(),
container=$('#elfinder-aviary-container'),
init=function(onload){
var getLang=function(){
var langMap={
'zh_TW':'zh_HANT',
'zh_CN':'zh_HANS'
};
return langMap[fm.lang]? langMap[fm.lang]:fm.lang;
}, opts;
if(!container.length){
container=$('<div id="elfinder-aviary-container" class="ui-front"/>').css({
position: 'fixed',
top: 0,
right: 0,
width: '100%',
height: $(window).height(),
overflow: 'auto'
}).hide().appendTo(elfNode.hasClass('elfinder-fullscreen')? elfNode:'body');
$(window).on('resize.'+fm.namespace, function(){
container.css('height', $(window).height());
});
elfNode.on('resize.'+fm.namespace, function(e, data){
e.preventDefault();
e.stopPropagation();
data&&data.fullscreen&&container.appendTo(data.fullscreen==='on'? elfNode:'body');
});
fm.bind('destroy', function(){
container.remove();
});
}else{
container.appendTo(container.parent());
}
node.on('click', launch).data('loading')();
opts={
apiKey: self.confObj.apiKey,
onSave: function(imageID, newURL){
featherEditor.showWaitIndicator();
node.on('load error', function(){
node.data('loading')(true);
})
.attr('crossorigin', 'anonymous')
.attr('src', newURL)
.data('loading')();
featherEditor.close();
},
onLoad: onload||function(){},
onClose: function(){
dialog.removeClass(fm.res('class', 'preventback'));
$(container).hide();
},
appendTo: container.get(0),
maxSize: 2048,
language: getLang()
};
self.trigger('Prepare', {
node: base,
editorObj: Aviary,
instance: void(0),
opts: opts
});
featherEditor=new Aviary.Feather(opts);
container.css('z-index', $(base).closest('.elfinder-dialog').css('z-index'));
dfrd.resolve(featherEditor);
},
launch=function(){
dialog.addClass(fm.res('class', 'preventback'));
$(container).show();
featherEditor.launch({
image: node.attr('id'),
url: node.attr('src')
});
node.data('loading')(true);
},
featherEditor, extraOpts;
if(typeof Aviary==='undefined'){
fm.loadScript(['https://dme0ih8comzn4.cloudfront.net/imaging/v3/editor.js'], function(){
init(launch);
}, {loadType: 'tag'});
}else{
init();
launch();
}
return dfrd;
},
save:function(base){
var node=$(base).children('img:first');
if(node.attr('src').substr(0, 5)!=='data:'){
node.attr('src', imgBase64(node, this.file.mime));
}}
},
{
setup:function(opts, fm){
if(fm.UA.ltIE8||!fm.options.cdns.ace){
this.disabled=true;
}},
info:{
id:'aceeditor',
name:'ACE Editor',
iconImg:'img/edit_aceeditor.png'
},
load:function(textarea){
var self=this,
fm=this.fm,
dfrd=$.Deferred(),
cdn=fm.options.cdns.ace,
start=function(){
var editor, editorBase, mode,
ta=$(textarea),
taBase=ta.parent(),
dialog=taBase.parent(),
id=textarea.id + '_ace',
ext=self.file.name.replace(/^.+\.([^.]+)|(.+)$/, '$1$2').toLowerCase(),
mimeMode={
'text/x-php':'php',
'application/x-php':'php',
'text/html':'html',
'application/xhtml+xml':'html',
'text/javascript':'javascript',
'application/javascript':'javascript',
'text/css':'css',
'text/x-c':'c_cpp',
'text/x-csrc':'c_cpp',
'text/x-chdr':'c_cpp',
'text/x-c++':'c_cpp',
'text/x-c++src':'c_cpp',
'text/x-c++hdr':'c_cpp',
'text/x-shellscript':'sh',
'application/x-csh':'sh',
'text/x-python':'python',
'text/x-java':'java',
'text/x-java-source':'java',
'text/x-ruby':'ruby',
'text/x-perl':'perl',
'application/x-perl':'perl',
'text/x-sql':'sql',
'text/xml':'xml',
'application/docbook+xml':'xml',
'application/xml':'xml'
};
taBase.height(taBase.height());
ace.config.set('basePath', cdn);
editorBase=$('<div id="'+id+'" style="width:100%; height:100%;"/>').text(ta.val()).insertBefore(ta.hide());
ta.data('ace', true);
editor=ace.edit(id);
editor.$blockScrolling=Infinity;
editor.setOptions({
theme: 'ace/theme/monokai',
fontSize: '14px',
wrap: true,
});
ace.config.loadModule('ace/ext/modelist', function(){
mode=ace.require('ace/ext/modelist').getModeForPath('/' + self.file.name).name;
if(mode==='text'){
if(mimeMode[self.file.mime]){
mode=mimeMode[self.file.mime];
}}
taBase.prev().children('.elfinder-dialog-title').append(' (' + self.file.mime + ':' + mode.split(/[\/\\]/).pop() + ')');
editor.setOptions({
mode: 'ace/mode/' + mode
});
});
ace.config.loadModule('ace/ext/language_tools', function(){
ace.require('ace/ext/language_tools');
editor.setOptions({
enableBasicAutocompletion: true,
enableSnippets: true,
enableLiveAutocompletion: false
});
});
ace.config.loadModule('ace/ext/settings_menu', function(){
ace.require('ace/ext/settings_menu').init(editor);
});
editor.commands.addCommand ({
name:"saveFile",
bindKey: {
win:'Ctrl-s',
mac:'Command-s'
},
exec: function(editor){
self.doSave();
}});
editor.commands.addCommand ({
name:"closeEditor",
bindKey: {
win:'Ctrl-w|Ctrl-q',
mac:'Command-w|Command-q'
},
exec: function(editor){
self.doCancel();
}});
editor.resize();
$('<div class="ui-dialog-buttonset"/>').css('float', 'left')
.append($('<button/>').html(self.fm.i18n('TextArea'))
.button()
.on('click', function(){
if(ta.data('ace')){
ta.removeData('ace');
editorBase.hide();
ta.val(editor.session.getValue()).show().trigger('focus');
$(this).text('AceEditor');
}else{
ta.data('ace', true);
editorBase.show();
editor.setValue(ta.hide().val(), -1);
editor.focus();
$(this).html(self.fm.i18n('TextArea'));
}})
)
.append($('<button>Ace editor setting</button>')
.button({
icons: {
primary: 'ui-icon-gear',
secondary: 'ui-icon-triangle-1-e'
},
text: false
})
.on('click', function(){
editor.showSettingsMenu();
$('#ace_settingsmenu')
.css('font-size', '80%')
.find('div[contains="setOptions"]').hide().end()
.parent().parent().appendTo($('#elfinder'));
})
)
.prependTo(taBase.next());
self.trigger('Prepare', {
node: textarea,
editorObj: ace,
instance: editor,
opts: {}});
dfrd.resolve(editor);
};
if(!self.confObj.loader){
self.confObj.loader=$.Deferred();
self.fm.loadScript([ cdn+'/ace.js' ], function(){
self.confObj.loader.resolve();
}, void 0, {obj: window, name: 'ace'});
}
self.confObj.loader.done(start);
return dfrd;
},
close:function(textarea, instance){
instance&&instance.destroy();
},
save:function(textarea, instance){
instance&&$(textarea).data('ace')&&(textarea.value=instance.session.getValue());
},
focus:function(textarea, instance){
instance&&$(textarea).data('ace')&&instance.focus();
},
resize:function(textarea, instance, e, data){
instance&&instance.resize();
}},
{
setup:function(opts, fm){
if(fm.UA.ltIE10||!fm.options.cdns.codemirror){
this.disabled=true;
}},
info:{
id:'codemirror',
name:'CodeMirror',
iconImg:'img/edit_codemirror.png'
},
load:function(textarea){
var fm=this.fm,
cmUrl=fm.options.cdns.codemirror,
dfrd=$.Deferred(),
self=this,
start=function(CodeMirror){
var ta=$(textarea),
base=ta.parent(),
editor, editorBase, opts;
base.height(base.height());
opts={
lineNumbers: true,
lineWrapping: true,
extraKeys:{
'Ctrl-S': function(){ self.doSave(); },
'Ctrl-Q': function(){ self.doCancel(); },
'Ctrl-W': function(){ self.doCancel(); }}
};
self.trigger('Prepare', {
node: textarea,
editorObj: CodeMirror,
instance: void(0),
opts: opts
});
editor=CodeMirror.fromTextArea(textarea, opts);
dfrd.resolve(editor);
var info, m, mode, spec;
if(! info){
info=CodeMirror.findModeByMIME(self.file.mime);
}
if(! info&&(m=self.file.name.match(/.+\.([^.]+)$/))){
info=CodeMirror.findModeByExtension(m[1]);
}
if(info){
CodeMirror.modeURL=useRequire? 'codemirror/mode/%N/%N.min':cmUrl + '/mode/%N/%N.min.js';
mode=info.mode;
spec=info.mime;
editor.setOption('mode', spec);
CodeMirror.autoLoadMode(editor, mode);
base.prev().children('.elfinder-dialog-title').append(' (' + spec + ':' + mode + ')');
}
editorBase=$(editor.getWrapperElement()).css({
padding: 0,
border: 'none'
});
ta.data('cm', true);
editorBase.height('100%');
$('<div class="ui-dialog-buttonset"/>').css('float', 'left')
.append($('<button/>').html(self.fm.i18n('TextArea'))
.button()
.on('click', function(){
if(ta.data('cm')){
ta.removeData('cm');
editorBase.hide();
ta.val(editor.getValue()).show().trigger('focus');
$(this).text('CodeMirror');
}else{
ta.data('cm', true);
editorBase.show();
editor.setValue(ta.hide().val());
editor.refresh();
editor.focus();
$(this).html(self.fm.i18n('TextArea'));
}})
)
.prependTo(base.next());
};
if(!self.confObj.loader){
self.confObj.loader=$.Deferred();
if(useRequire){
require.config({
packages: [{
name: 'codemirror',
location: cmUrl,
main: 'codemirror.min'
}],
map: {
'codemirror': {
'codemirror/lib/codemirror': 'codemirror'
}}
});
require([
'codemirror',
'codemirror/addon/mode/loadmode.min',
'codemirror/mode/meta.min'
], function(CodeMirror){
self.confObj.loader.resolve(CodeMirror);
});
}else{
self.fm.loadScript([
cmUrl + '/codemirror.min.js'
], function(){
self.fm.loadScript([
cmUrl + '/addon/mode/loadmode.min.js',
cmUrl + '/mode/meta.min.js'
], function(){
self.confObj.loader.resolve(CodeMirror);
});
}, {loadType: 'tag'});
}
self.fm.loadCss(cmUrl + '/codemirror.css');
}
self.confObj.loader.done(start);
return dfrd;
},
close:function(textarea, instance){
instance&&instance.toTextArea();
},
save:function(textarea, instance){
instance&&$(textarea).data('cm')&&(textarea.value=instance.getValue());
},
focus:function(textarea, instance){
instance&&$(textarea).data('cm')&&instance.focus();
},
resize:function(textarea, instance, e, data){
instance&&instance.refresh();
}},
{
setup:function(opts, fm){
if(fm.UA.ltIE10||!fm.options.cdns.simplemde){
this.disabled=true;
}},
info:{
id:'simplemde',
name:'SimpleMDE',
iconImg:'img/edit_simplemde.png'
},
exts:['md'],
load:function(textarea){
var self=this,
fm=this.fm,
base=$(textarea).parent(),
dfrd=$.Deferred(),
cdn=fm.options.cdns.simplemde,
start=function(SimpleMDE){
var h=base.height(),
delta=base.outerHeight(true) - h + 14,
editor, editorBase, opts;
textarea._setHeight=function(height){
var h=height||base.height(),
ctrH=0,
areaH;
base.children('.editor-toolbar,.editor-statusbar').each(function(){
ctrH +=$(this).outerHeight(true);
});
areaH=h - ctrH - delta;
editorBase.height(areaH);
editor.codemirror.refresh();
return areaH;
};
base.height(h);
opts={
element: textarea,
autofocus: true
};
self.trigger('Prepare', {
node: textarea,
editorObj: SimpleMDE,
instance: void(0),
opts: opts
});
editor=new SimpleMDE(opts);
dfrd.resolve(editor);
editorBase=$(editor.codemirror.getWrapperElement());
editorBase.css('min-height', '50px')
.children('.CodeMirror-scroll').css('min-height', '50px');
textarea._setHeight(h);
};
if(!self.confObj.loader){
self.confObj.loader=$.Deferred();
self.fm.loadCss(cdn+'/simplemde.min.css');
if(useRequire){
require([
cdn+'/simplemde.min.js'
], function(SimpleMDE){
self.confObj.loader.resolve(SimpleMDE);
});
}else{
self.fm.loadScript([cdn+'/simplemde.min.js'], function(){
self.confObj.loader.resolve(SimpleMDE);
}, {loadType: 'tag'});
}}
self.confObj.loader.done(start);
return dfrd;
},
close:function(textarea, instance){
instance&&instance.toTextArea();
instance=null;
},
save:function(textarea, instance){
instance&&(textarea.value=instance.value());
},
focus:function(textarea, instance){
instance&&instance.codemirror.focus();
},
resize:function(textarea, instance, e, data){
instance&&textarea._setHeight();
}},
{
info:{
id:'ckeditor',
name:'CKEditor',
iconImg:'img/edit_ckeditor.png'
},
exts:['htm', 'html', 'xhtml'],
setup:function(opts, fm){
if(!fm.options.cdns.ckeditor){
this.disabled=true;
}else{
if(opts.extraOptions&&opts.extraOptions.managerUrl){
this.managerUrl=opts.extraOptions.managerUrl;
}}
},
load:function(textarea){
var self=this,
fm=this.fm,
dfrd=$.Deferred(),
init=function(){
var base=$(textarea).parent(),
dlg=base.closest('.elfinder-dialog'),
h=base.height(),
reg=/([&?]getfile=)[^&]+/,
loc=self.confObj.managerUrl||window.location.href.replace(/#.*$/, ''),
name='ckeditor',
opts;
if(reg.test(loc)){
loc=loc.replace(reg, '$1' + name);
}else{
loc +='?getfile=' + name;
}
base.height(h);
opts={
startupFocus:true,
fullPage: true,
allowedContent: true,
filebrowserBrowseUrl:loc,
toolbarCanCollapse: true,
toolbarStartupExpanded: !fm.UA.Mobile,
removePlugins: 'resize',
extraPlugins: 'colorbutton,justify,docprops',
on: {
'instanceReady':function(e){
var editor=e.editor;
editor.resize('100%', h);
dlg.one('beforedommove.'+fm.namespace, function(){
editor.destroy();
}).one('dommove.'+fm.namespace, function(){
self.load(textarea).done(function(editor){
self.instance=editor;
});
});
dfrd.resolve(e.editor);
}}
};
self.trigger('Prepare', {
node: textarea,
editorObj: CKEDITOR,
instance: void(0),
opts: opts
});
CKEDITOR.replace(textarea.id, opts);
CKEDITOR.on('dialogDefinition', function(e){
var dlg=e.data.definition.dialog;
dlg.on('show', function(e){
fm.getUI().append($('.cke_dialog_background_cover')).append(this.getElement().$);
});
dlg.on('hide', function(e){
$('body:first').append($('.cke_dialog_background_cover')).append(this.getElement().$);
});
});
};
if(!self.confObj.loader){
self.confObj.loader=$.Deferred();
window.CKEDITOR_BASEPATH=fm.options.cdns.ckeditor + '/';
$.getScript(fm.options.cdns.ckeditor + '/ckeditor.js', function(){
self.confObj.loader.resolve();
});
}
self.confObj.loader.done(init);
return dfrd;
},
close:function(textarea, instance){
instance&&instance.destroy();
},
save:function(textarea, instance){
instance&&(textarea.value=instance.getData());
},
focus:function(textarea, instance){
instance&&instance.focus();
},
resize:function(textarea, instance, e, data){
var self;
if(instance){
if(instance.status==='ready'){
instance.resize('100%', $(textarea).parent().height());
}}
}},
{
info:{
id:'ckeditor5',
name:'CKEditor5',
iconImg:'img/edit_ckeditor5.png'
},
exts:['htm', 'html', 'xhtml'],
html:'<div class="edit-editor-ckeditor5"></div>',
setup:function(opts, fm){
var confObj=this;
if(!fm.options.cdns.ckeditor5||typeof window.Symbol!=='function'||typeof Symbol()!=='symbol'){
this.disabled=true;
}else{
if(opts.extraOptions&&opts.extraOptions.ckeditor5Mode){
this.ckeditor5Mode=opts.extraOptions.ckeditor5Mode;
}}
fm.bind('destroy', function(){
confObj.editor=null;
});
},
prepare:function(base, dialogOpts, file){
$(base).height(base.editor.fm.getUI().height() - 100);
},
init:function(id, file, data, fm){
var m=data.match(/^([\s\S]*<body[^>]*>)([\s\S]+)(<\/body>[\s\S]*)$/i),
header='',
body='',
footer='';
this.css({
width: '100%',
height: '100%',
'box-sizing': 'border-box'
});
if(m){
header=m[1];
body=m[2];
footer=m[3];
}else{
body=data;
}
this.data('data', {
header: header,
body: body,
footer: footer
});
},
load:function(editnode){
var self=this,
fm=this.fm,
dfrd=$.Deferred(),
mode=self.confObj.ckeditor5Mode||'balloon',
lang=(function(){
var l=fm.lang.toLowerCase().replace('_', '-');
if(l.substr(0, 2)==='zh'&&l!=='zh-cn'){
l='zh';
}
return l;
})(),
init=function(cEditor){
var base=$(editnode).parent(),
opts;
base.height(fm.getUI().height() - 100);
opts={
toolbar: ['heading', '|', 'bold', 'italic', 'link', 'imageUpload', 'bulletedList', 'numberedList', 'blockQuote', 'undo', 'redo' ],
language: lang
};
self.trigger('Prepare', {
node: editnode,
editorObj: cEditor,
instance: void(0),
opts: opts
});
cEditor
.create(editnode, opts)
.then(function(editor){
var fileRepo=editor.plugins.get('FileRepository');
fileRepo.createUploadAdapter=function(loader){
return new uploder(loader);
};
editor.setData($(editnode).data('data').body);
fm.getUI().append($('body > div.ck-body'));
$('div.ck-balloon-panel').css({
'z-index': fm.getMaximizeCss().zIndex + 1
});
dfrd.resolve(editor);
/*fm.log({
plugins: cEditor.build.plugins.map(function(p){ return p.pluginName; }),
toolbars: Array.from(editor.ui.componentFactory.names())
});*/
})
['catch'](function(error){
fm.error(error);
});
},
uploder=function(loader){
this.upload=function(){
return new Promise(function(resolve, reject){
fm.exec('upload', {files: [loader.file]}, void(0), fm.cwd().hash)
.done(function(data){
if(data.added&&data.added.length){
fm.url(data.added[0].hash, { async: true }).done(function(url){
resolve({
'default': fm.convAbsUrl(url)
});
}).fail(function(){
reject('errFileNotFound');
});
}else{
reject(fm.i18n(data.error? data.error:'errUpload'));
}})
.fail(function(error){
reject(fm.i18n(error? (error==='userabort'? 'errAbort':error):'errUploadNoFiles'));
})
.progress(function(data){
loader.uploadTotal=data.total;
loader.uploaded=data.progress;
});
});
};
this.abort=function(){
fm.getUI().trigger('uploadabort');
};}, loader;
if(!self.confObj.editor){
loader=$.Deferred();
self.fm.loadScript([
fm.options.cdns.ckeditor5 + '/' + mode + '/ckeditor.js'
], function(editor){
if(!editor){
editor=window.BalloonEditor||window.InlineEditor||window.ClassicEditor;
}
if(fm.lang!=='en'){
self.fm.loadScript([
fm.options.cdns.ckeditor5 + '/' + mode + '/translations/' + lang + '.js'
], function(obj){
loader.resolve(editor);
}, {
tryRequire: true,
loadType: 'tag',
error: function(obj){
lang='en';
loader.resolve(editor);
}});
}else{
loader.resolve(editor);
}}, {
tryRequire: true,
loadType: 'tag'
});
loader.done(function(editor){
self.confObj.editor=editor;
init(editor);
});
}else{
init(self.confObj.editor);
}
return dfrd;
},
getContent:function(){
var data=$(this).data('data');
return data.header + data.body + data.footer;
},
close:function(editnode, instance){
instance&&instance.destroy();
},
save:function(editnode, instance){
var elm=$(editnode),
data=elm.data('data');
if(instance){
data.body=instance.getData();
elm.data('data', data);
}},
focus:function(editnode, instance){
$(editnode).trigger('focus');
}},
{
info:{
id:'tinymce',
name:'TinyMCE',
iconImg:'img/edit_tinymce.png'
},
exts:['htm', 'html', 'xhtml'],
setup:function(opts, fm){
if(!fm.options.cdns.tinymce){
this.disabled=true;
}else{
if(opts.extraOptions&&opts.extraOptions.managerUrl){
this.managerUrl=opts.extraOptions.managerUrl;
}}
},
load:function(textarea){
var self=this,
fm=this.fm,
dfrd=$.Deferred(),
init=function(){
var base=$(textarea).parent(),
dlg=base.closest('.elfinder-dialog'),
h=base.height(),
delta=base.outerHeight(true) - h,
opts;
base.height(h);
textarea._setHeight=function(height){
var base=$(this).parent(),
h=height||base.height(),
ctrH=0,
areaH;
base.find('.mce-container-body:first').children('.mce-toolbar,.mce-toolbar-grp,.mce-statusbar').each(function(){
ctrH +=$(this).outerHeight(true);
});
areaH=h - ctrH - delta;
base.find('.mce-edit-area iframe:first').height(areaH);
return areaH;
};
opts={
selector: '#' + textarea.id,
resize: false,
plugins: [
'fullpage',
'image', 'link', 'media',
'code', 'fullscreen'
],
init_instance_callback:function(editor){
textarea._setHeight(h);
dlg.one('beforedommove.'+fm.namespace, function(){
tinymce.execCommand ('mceRemoveEditor', false, textarea.id);
}).one('dommove.'+fm.namespace, function(){
self.load(textarea).done(function(editor){
self.instance=editor;
});
});
dfrd.resolve(editor);
},
file_picker_callback:function (callback, value, meta){
var reg=/([&?]getfile=)[^&]+/,
loc=self.confObj.managerUrl||window.location.href.replace(/#.*$/, ''),
name='tinymce';
if(reg.test(loc)){
loc=loc.replace(reg, '$1' + name);
}else{
loc +='?getfile=' + name;
}
tinymce.activeEditor.windowManager.open({
file: loc,
title: 'elFinder',
width: 900,
height: 450,
resizable: 'yes'
}, {
oninsert: function (file, elf){
var url, reg, info;
url=elf.convAbsUrl(file.url);
info=file.name + ' (' + elf.formatSize(file.size) + ')';
if(meta.filetype=='file'){
callback(url, {text: info, title: info});
}
if(meta.filetype=='image'){
callback(url, {alt: info});
}
if(meta.filetype=='media'){
callback(url);
}}
});
return false;
}};
self.trigger('Prepare', {
node: textarea,
editorObj: tinymce,
instance: void(0),
opts: opts
});
tinymce.init(opts);
};
fm.getUI().hasClass('elfinder-fullscreen-native')&&fm.exec('fullscreen');
if(!self.confObj.loader){
self.confObj.loader=$.Deferred();
$.getScript(fm.options.cdns.tinymce + '/tinymce.min.js', function(){
setTimeout(function(){
self.confObj.loader.resolve();
}, 0);
});
}
self.confObj.loader.done(init);
return dfrd;
},
close:function(textarea, instance){
instance&&tinymce.execCommand ('mceRemoveEditor', false, textarea.id);
},
save:function(textarea, instance){
instance&&instance.save();
},
focus:function(textarea, instance){
instance&&instance.focus();
},
resize:function(textarea, instance, e, data){
instance&&textarea._setHeight();
}},
{
info:{
id:'zohoeditor',
name:'Zoho Editor',
iconImg:'img/edit_zohooffice.png',
cmdCheck:'ZohoOffice',
preventGet: true,
hideButtons: true,
syncInterval:15000
},
mimes:[
'application/msword',
'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
'application/vnd.oasis.opendocument.text',
'application/rtf',
'text/html',
'application/vnd.ms-excel',
'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
'application/vnd.oasis.opendocument.spreadsheet',
'application/vnd.sun.xml.calc',
'text/csv',
'text/tab-separated-values',
'application/vnd.ms-powerpoint',
'application/vnd.openxmlformats-officedocument.presentationml.presentation',
'application/vnd.openxmlformats-officedocument.presentationml.slideshow',
'application/vnd.oasis.opendocument.presentation',
'application/vnd.sun.xml.impress'
],
html:'<iframe style="width:100%;max-height:100%;border:none;"></iframe>',
setup:function(opts, fm){
if(fm.UA.Mobile||fm.UA.ltIE8){
this.disabled=true;
}},
prepare:function(base, dialogOpts, file){
var elfNode=base.editor.fm.getUI();
$(base).height(elfNode.height());
dialogOpts.width=Math.max(dialogOpts.width||0, elfNode.width() * 0.8);
},
init:function(id, file, dum, fm){
var ta=this,
ifm=$(this).hide(),
spnr=$('<div/>')
.css({
position: 'absolute',
top: '50%',
textAlign: 'center',
width: '100%',
fontSize: '16pt'
})
.html(fm.i18n('nowLoading') + '<span class="elfinder-spinner"/>')
.appendTo(ifm.parent()),
cdata=function(){
var data='';
$.each(fm.customData, function(key, val){
data +='&' + encodeURIComponent(key) + '=' + encodeURIComponent(val);
});
return data;
};
$(ta).data('xhr', fm.request({
data: {
cmd: 'editor',
name: 'ZohoOffice',
method: 'init',
'args[target]': file.hash,
'args[lang]':fm.lang,
'args[cdata]':cdata
},
preventDefault:true
}).done(function(data){
var opts;
if(data.zohourl){
opts={
css: {
height: '100%'
}};
ta.editor.trigger('Prepare', {
node: ta,
editorObj: void(0),
instance: ifm,
opts: opts
});
ifm.attr('src', data.zohourl).show().css(opts.css);
}else{
data.error&&fm.error(data.error);
ta.elfinderdialog('destroy');
}}).fail(function(error){
error&&fm.error(error);
ta.elfinderdialog('destroy');
}).always(function(){
spnr.remove();
}));
},
load:function(){},
getContent:function(){},
save:function(){},
beforeclose:function(base){
var dfd=$.Deferred(),
ab='about:blank';
base.src=ab;
setTimeout(function(){
var src;
try {
src=base.contentWindow.location.href;
} catch(e){
src=null;
}
if(src===ab){
dfd.resolve();
}else{
dfd.reject();
}}, 10);
return dfd;
},
close:function(ta){
var fm=this.fm,
xhr=$(ta).data('xhr');
if(xhr.state()==='pending'){
xhr.reject();
}}
},
{
info:{
id:'ziparchive',
name:'btnMount',
cmdCheck:'ZipArchive',
edit:function(file, editor){
var fm=this,
dfrd=$.Deferred();
fm.request({
data:{
cmd: 'netmount',
protocol: 'ziparchive',
host: file.hash,
path: file.phash
},
notify:{type:'netmount', cnt:1, hideCnt:true}}).done(function(data){
var pdir;
if(data.added&&data.added.length){
if(data.added[0].phash){
if(pdir=fm.file(data.added[0].phash)){
if(! pdir.dirs){
pdir.dirs=1;
fm.change({ changed: [ pdir ] });
}}
}
fm.one('netmountdone', function(){
fm.exec('open', data.added[0].hash);
fm.one('opendone', function(){
data.toast&&fm.toast(data.toast);
});
});
}
dfrd.resolve();
})
.fail(function(error){
dfrd.reject(error);
});
return dfrd;
}},
mimes:['application/zip'],
load:function(){},
save:function(){}},
{
info:{
id:'textarea',
name:'TextArea',
useTextAreaEvent:true
},
load:function(textarea){
this.trigger('Prepare', {
node: textarea,
editorObj: void(0),
instance: void(0),
opts: {}});
},
save:function(){}}
];
}, window.elFinder));
});
})(jQuery);
(function(root, factory){
if(typeof define==='function'&&define.amd){
define(['elfinder'], factory);
}else if(typeof exports!=='undefined'){
module.exports=factory(require('elfinder'));
}else{
factory(root.elFinder);
}}(this, function(elFinder){
elFinder.prototype.i18.nl={
translator:'Barry vd. Heuvel &lt;barry@fruitcakestudio.nl&gt;',
language:'Nederlands',
direction:'ltr',
dateFormat:'d-m-Y H:i',
fancyDateFormat:'$1 H:i',
messages:{
'error':'Fout',
'errUnknown':'Onbekend fout.',
'errUnknownCmd':'Onbekend commando.',
'errJqui':'Ongeldige jQuery UI configuratie. Selectable, draggable en droppable componenten moeten aanwezig zijn.',
'errNode':'Voor elFinder moet een DOM Element gemaakt worden.',
'errURL':'Ongeldige elFinder configuratie! URL optie is niet ingesteld.',
'errAccess':'Toegang geweigerd.',
'errConnect':'Kan geen verbinding met de backend maken.',
'errAbort':'Verbinding afgebroken.',
'errTimeout':'Verbinding time-out.',
'errNotFound':'Backend niet gevonden.',
'errResponse':'Ongeldige reactie van de backend.',
'errConf':'Mappen zijn niet aan u toegewezen.',
'errJSON':'PHP JSON module niet geïnstalleerd.',
'errNoVolumes':' ',
'errCmdParams':'Ongeldige parameters voor commando "$1".',
'errDataNotJSON':'Data is niet JSON.',
'errDataEmpty':'Data is leeg.',
'errCmdReq':'Backend verzoek heeft een commando naam nodig.',
'errOpen':'Kan "$1" niet openen.',
'errNotFolder':'Object is geen map.',
'errNotFile':'Object is geen bestand.',
'errRead':'Kan "$1" niet lezen.',
'errWrite':'Kan niet schrijven in "$1".',
'errPerm':'Toegang geweigerd.',
'errLocked':'"$1" is vergrendeld en kan niet hernoemd, verplaats of verwijderd worden.',
'errExists':'Bestand "$1" bestaat al.',
'errInvName':'Ongeldige bestandsnaam.',
'errFolderNotFound':'Map niet gevonden.',
'errFileNotFound':'Bestand niet gevonden.',
'errTrgFolderNotFound':'Doelmap"$1" niet gevonden.',
'errPopup':'De browser heeft voorkomen dat de pop-up is geopend. Pas de browser instellingen aan om de popup te kunnen openen.',
'errMkdir':'Kan map "$1" niet aanmaken.',
'errMkfile':'Kan bestand "$1" niet aanmaken.',
'errRename':'Kan "$1" niet hernoemen.',
'errCopyFrom':'Bestanden kopiëren van "$1" is niet toegestaan.',
'errCopyTo':'Bestanden kopiëren naar "$1" is niet toegestaan.',
'errMkOutLink':'Kan geen link maken buiten de hoofdmap.',
'errUpload':'Upload fout.',
'errUploadFile':'Kan "$1" niet uploaden.',
'errUploadNoFiles':'Geen bestanden gevonden om te uploaden.',
'errUploadTotalSize':'Data overschrijdt de maximale grootte.',
'errUploadFileSize':'Bestand overschrijdt de maximale grootte.',
'errUploadMime':'Bestandstype niet toegestaan.',
'errUploadTransfer':'"$1" overdrachtsfout.',
'errUploadTemp':'Kan geen tijdelijk bestand voor de upload maken.',
'errNotReplace':'Object "$1" bestaat al op deze locatie en kan niet vervangen worden door een ander type object.',
'errReplace':'Kan "$1" niet vervangen.',
'errSave':'Kan "$1" niet opslaan.',
'errCopy':'Kan "$1" niet kopiëren.',
'errMove':'Kan "$1" niet verplaatsen.',
'errCopyInItself':'Kan "$1" niet in zichzelf kopiëren.',
'errRm':'Kan "$1" niet verwijderen.',
'errRmSrc':'Kan bronbestanden niet verwijderen.',
'errExtract':'Kan de bestanden van "$1" niet uitpakken.',
'errArchive':'Kan het archief niet maken.',
'errArcType':'Archief type is niet ondersteund.',
'errNoArchive':'Bestand is geen archief of geen ondersteund archief type.',
'errCmdNoSupport':'Backend ondersteund dit commando niet.',
'errReplByChild':'De map "$1" kan niet vervangen worden door een item uit die map.',
'errArcSymlinks':'Om veiligheidsredenen kan een bestand met symlinks of bestanden met niet toegestane namen niet worden uitgepakt .',
'errArcMaxSize':'Archief overschrijdt de maximale bestandsgrootte.',
'errResize':'Kan het formaat van "$1" niet wijzigen.',
'errResizeDegree':'Ongeldig aantal graden om te draaien.',
'errResizeRotate':'Afbeelding kan niet gedraaid worden.',
'errResizeSize':'Ongeldig afbeelding formaat.',
'errResizeNoChange':'Afbeelding formaat is niet veranderd.',
'errUsupportType':'Bestandstype wordt niet ondersteund.',
'errNotUTF8Content':'Bestand "$1" is niet in UTF-8 and kan niet aangepast worden.',
'errNetMount':'Kan "$1" niet mounten.',
'errNetMountNoDriver':'Niet ondersteund protocol.',
'errNetMountFailed':'Mount mislukt.',
'errNetMountHostReq':'Host is verplicht.',
'errSessionExpires':'Uw sessie is verlopen vanwege inactiviteit.',
'errCreatingTempDir':'Kan de tijdelijke map niet aanmaken: "$1" ',
'errFtpDownloadFile':'Kan het bestand niet downloaden vanaf FTP: "$1"',
'errFtpUploadFile':'Kan het bestand niet uploaden naar FTP: "$1"',
'errFtpMkdir':'Kan het externe map niet aanmaken op de FTP-server: "$1"',
'errArchiveExec':'Er is een fout opgetreden bij het archivering van de bestanden: "$1" ',
'errExtractExec':'Er is een fout opgetreden bij het uitpakken van de bestanden: "$1" ',
'errNetUnMount':'Kan niet unmounten',
'errConvUTF8':'Kan niet converteren naar UTF-8',
'errFolderUpload':'Probeer Google Chrome, als je de map wil uploaden.',
'cmdarchive':'Maak archief',
'cmdback':'Vorige',
'cmdcopy':'Kopieer',
'cmdcut':'Knip',
'cmddownload':'Download',
'cmdduplicate':'Dupliceer',
'cmdedit':'Pas bestand aan',
'cmdextract':'Bestanden uit archief uitpakken',
'cmdforward':'Volgende',
'cmdgetfile':'Kies bestanden',
'cmdhelp':'Over deze software',
'cmdhome':'Home',
'cmdinfo':'Bekijk info',
'cmdmkdir':'Nieuwe map',
'cmdmkfile':'Nieuw tekstbestand',
'cmdopen':'Open',
'cmdpaste':'Plak',
'cmdquicklook':'Voorbeeld',
'cmdreload':'Vernieuwen',
'cmdrename':'Naam wijzigen',
'cmdrm':'Verwijder',
'cmdsearch':'Zoek bestanden',
'cmdup':'Ga een map hoger',
'cmdupload':'Upload bestanden',
'cmdview':'Bekijk',
'cmdresize':'Formaat wijzigen',
'cmdsort':'Sorteren',
'cmdnetmount':'Mount netwerk volume',
'cmdnetunmount': 'Unmount',
'cmdplaces':'Naar Plaatsen',
'cmdchmod':'Wijzig modus',
'btnClose':'Sluit',
'btnSave':'Opslaan',
'btnRm':'Verwijder',
'btnApply':'Toepassen',
'btnCancel':'Annuleren',
'btnNo':'Nee',
'btnYes':'Ja',
'btnMount':'Mount',
'btnApprove': 'Ga naar $1 & keur goed',
'btnUnmount': 'Unmount',
'btnConv':'Converteer',
'btnCwd':'Hier',
'btnVolume':'Volume',
'btnAll':'Alles',
'btnMime':'MIME Type',
'btnFileName':'Bestandsnaam',
'btnSaveClose': 'Opslaan & Sluiten',
'btnBackup':'Back-up',
'ntfopen':'Bezig met openen van map',
'ntffile':'Bezig met openen bestand',
'ntfreload':'Herladen map inhoud',
'ntfmkdir':'Bezig met map maken',
'ntfmkfile':'Bezig met Bestanden maken',
'ntfrm':'Verwijderen bestanden',
'ntfcopy':'Kopieer bestanden',
'ntfmove':'Verplaats bestanden',
'ntfprepare':'Voorbereiden kopiëren',
'ntfrename':'Hernoem bestanden',
'ntfupload':'Bestanden uploaden actief',
'ntfdownload':'Bestanden downloaden actief',
'ntfsave':'Bestanden opslaan',
'ntfarchive':'Archief aan het maken',
'ntfextract':'Bestanden uitpakken actief',
'ntfsearch':'Zoeken naar bestanden',
'ntfresize':'Formaat wijzigen van afbeeldingen',
'ntfsmth':'Iets aan het doen',
'ntfloadimg':'Laden van plaatje',
'ntfnetmount':'Mounten van netwerk volume',
'ntfnetunmount': 'Unmounten van netwerk volume',
'ntfdim':'Opvragen afbeeldingen dimensies',
'ntfreaddir':'Map informatie lezen',
'ntfurl':'URL van link ophalen',
'ntfchmod':'Bestandsmodus wijzigen',
'ntfpreupload': 'Upload bestandsnaam verifiëren',
'dateUnknown':'onbekend',
'Today':'Vandaag',
'Yesterday':'Gisteren',
'msJan':'Jan',
'msFeb':'Feb',
'msMar':'Mar',
'msApr':'Apr',
'msMay':'Mei',
'msJun':'Jun',
'msJul':'Jul',
'msAug':'Aug',
'msSep':'Sep',
'msOct':'Okt',
'msNov':'Nov',
'msDec':'Dec',
'January':'Januari',
'February':'Februari',
'March':'Maart',
'April':'April',
'May':'Mei',
'June':'Juni',
'July':'Juli',
'August':'Augustus',
'September':'September',
'October':'Oktober',
'November':'November',
'December':'December',
'Sunday':'Zondag',
'Monday':'Maandag',
'Tuesday':'Dinsdag',
'Wednesday':'Woensdag',
'Thursday':'Donderdag',
'Friday':'Vrijdag',
'Saturday':'Zaterdag',
'Sun':'Zo',
'Mon':'Ma',
'Tue':'Di',
'Wed':'Wo',
'Thu':'Do',
'Fri':'Vr',
'Sat':'Za',
'sortname':'op naam',
'sortkind':'op type',
'sortsize':'op grootte',
'sortdate':'op datum',
'sortFoldersFirst':'Mappen eerst',
'untitled file.txt':'NieuwBestand.txt',
'untitled folder':'NieuweMap',
'Archive':'NieuwArchief',
'confirmReq':'Bevestiging nodig',
'confirmRm':'Weet u zeker dat u deze bestanden wil verwijderen?<br/>Deze actie kan niet ongedaan gemaakt worden!',
'confirmRepl':'Oud bestand vervangen door het nieuwe bestand?',
'confirmConvUTF8':'Niet in UTF-8<br/>Converteren naar UTF-8?<br/>De inhoud wordt UTF-8 door op te slaan na de conversie.',
'confirmNotSave':'Het is aangepast.<br/>Wijzigingen gaan verloren als je niet opslaat.',
'apllyAll':'Toepassen op alles',
'name':'Naam',
'size':'Grootte',
'perms':'Rechten',
'modify':'Aangepast',
'kind':'Type',
'read':'lees',
'write':'schrijf',
'noaccess':'geen toegang',
'and':'en',
'unknown':'onbekend',
'selectall':'Selecteer alle bestanden',
'selectfiles':'Selecteer bestand (en)',
'selectffile':'Selecteer eerste bestand',
'selectlfile':'Selecteer laatste bestand',
'viewlist':'Lijst weergave',
'viewicons':'Icoon weergave',
'places':'Plaatsen',
'calc':'Bereken',
'path':'Pad',
'aliasfor':'Alias voor',
'locked':'Vergrendeld',
'dim':'Dimensies',
'files':'Bestanden',
'folders':'Mappen',
'items':'Items',
'yes':'ja',
'no':'nee',
'link':'Link',
'searcresult':'Zoek resultaten',
'selected':'geselecteerde items',
'about':'Over',
'shortcuts':'Snelkoppelingen',
'help':'Help',
'webfm':'Web bestandsmanager',
'ver':'Versie',
'protocolver':'protocol versie',
'homepage':'Project home',
'docs':'Documentatie',
'github':'Fork ons op Github',
'twitter':'Volg ons op twitter',
'facebook':'Wordt lid op facebook',
'team':'Team',
'chiefdev':'Hoofd ontwikkelaar',
'developer':'ontwikkelaar',
'contributor':'bijdrager',
'maintainer':'onderhouder',
'translator':'vertaler',
'icons':'Iconen',
'dontforget':'En vergeet je handdoek niet!',
'shortcutsof':'Snelkoppelingen uitgeschakeld',
'dropFiles':'Sleep hier uw bestanden heen',
'or':'of',
'selectForUpload':'Selecteer bestanden om te uploaden',
'moveFiles':'Verplaats bestanden',
'copyFiles':'Kopieer bestanden',
'rmFromPlaces':'Verwijder uit Plaatsen',
'aspectRatio':'Aspect ratio',
'scale':'Schaal',
'width':'Breedte',
'height':'Hoogte',
'resize':'Verkleinen',
'crop':'Bijsnijden',
'rotate':'Draaien',
'rotate-cw':'Draai 90 graden rechtsom',
'rotate-ccw':'Draai 90 graden linksom',
'degree':'°',
'netMountDialogTitle':'Mount netwerk volume',
'protocol':'Protocol',
'host':'Host',
'port':'Poort',
'user':'Gebruikersnaams',
'pass':'Wachtwoord',
'confirmUnmount':'Weet u zeker dat u $1 wil unmounten?',
'dropFilesBrowser': 'Sleep of plak bestanden vanuit de browser',
'dropPasteFiles':'Sleep of plak bestanden hier',
'encoding':'Encodering',
'locale':'Locale',
'searchTarget':'Doel: $1',
'searchMime':'Zoek op invoer MIME Type',
'owner':'Eigenaar',
'group':'Groep',
'other':'Overig',
'execute':'Uitvoeren',
'perm':'Rechten',
'mode':'Modus',
'kindUnknown':'Onbekend',
'kindFolder':'Map',
'kindAlias':'Alias',
'kindAliasBroken':'Kapot alias',
'kindApp':'Applicatie',
'kindPostscript':'Postscript document',
'kindMsOffice':'Microsoft Office document',
'kindMsWord':'Microsoft Word document',
'kindMsExcel':'Microsoft Excel document',
'kindMsPP':'Microsoft Powerpoint presentation',
'kindOO':'Open Office document',
'kindAppFlash':'Flash applicatie',
'kindPDF':'Portable Document Format (PDF)',
'kindTorrent':'Bittorrent bestand',
'kind7z':'7z archief',
'kindTAR':'TAR archief',
'kindGZIP':'GZIP archief',
'kindBZIP':'BZIP archief',
'kindXZ':'XZ archief',
'kindZIP':'ZIP archief',
'kindRAR':'RAR archief',
'kindJAR':'Java JAR bestand',
'kindTTF':'True Type font',
'kindOTF':'Open Type font',
'kindRPM':'RPM package',
'kindText':'Tekst bestand',
'kindTextPlain':'Tekst',
'kindPHP':'PHP bronbestand',
'kindCSS':'Cascading style sheet',
'kindHTML':'HTML document',
'kindJS':'Javascript bronbestand',
'kindRTF':'Rich Text Format',
'kindC':'C bronbestand',
'kindCHeader':'C header bronbestand',
'kindCPP':'C++ bronbestand',
'kindCPPHeader':'C++ header bronbestand',
'kindShell':'Unix shell script',
'kindPython':'Python bronbestand',
'kindJava':'Java bronbestand',
'kindRuby':'Ruby bronbestand',
'kindPerl':'Perl bronbestand',
'kindSQL':'SQL bronbestand',
'kindXML':'XML document',
'kindAWK':'AWK bronbestand',
'kindCSV':'Komma gescheiden waardes',
'kindDOCBOOK':'Docbook XML document',
'kindMarkdown':'Markdown tekst',
'kindImage':'Afbeelding',
'kindBMP':'BMP afbeelding',
'kindJPEG':'JPEG afbeelding',
'kindGIF':'GIF afbeelding',
'kindPNG':'PNG afbeelding',
'kindTIFF':'TIFF afbeelding',
'kindTGA':'TGA afbeelding',
'kindPSD':'Adobe Photoshop afbeelding',
'kindXBITMAP':'X bitmap afbeelding',
'kindPXM':'Pixelmator afbeelding',
'kindAudio':'Audio media',
'kindAudioMPEG':'MPEG audio',
'kindAudioMPEG4':'MPEG-4 audio',
'kindAudioMIDI':'MIDI audio',
'kindAudioOGG':'Ogg Vorbis audio',
'kindAudioWAV':'WAV audio',
'AudioPlaylist':'MP3 playlist',
'kindVideo':'Video media',
'kindVideoDV':'DV video',
'kindVideoMPEG':'MPEG video',
'kindVideoMPEG4':'MPEG-4 video',
'kindVideoAVI':'AVI video',
'kindVideoMOV':'Quick Time video',
'kindVideoWM':'Windows Media video',
'kindVideoFlash':'Flash video',
'kindVideoMKV':'Matroska video',
'kindVideoOGG':'Ogg video'
}};}));